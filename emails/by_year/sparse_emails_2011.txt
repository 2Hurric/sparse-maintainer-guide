--- Emails for Year 2011 ---

=== Thread: "advancing past deep designator" warnings ===

From: Randy Dunlap <rdunlap () xenotime ! net>
To: linux-sparse
Subject: "advancing past deep designator" warnings
Date: Sun, 29 May 2011 21:57:12 +0000
Message-ID: <20110529145712.eefa4d52.rdunlap () xenotime ! net>
--------------------
Hi,

Can you give me an idea about what this warning means and what to do about it?
Thanks.


(x86_64 allmodconfig, linux-2.6.39-git18)


drivers/usb/gadget/f_audio.c:229:9: warning: advancing past deep designator
drivers/usb/gadget/f_acm.c:261:9: warning: advancing past deep designator
drivers/usb/gadget/f_ecm.c:283:9: warning: advancing past deep designator
drivers/usb/gadget/cdc2.c:112:9: warning: advancing past deep designator
drivers/usb/gadget/f_ecm.c:283:9: warning: advancing past deep designator
drivers/usb/gadget/f_subset.c:217:9: warning: advancing past deep designator
drivers/usb/gadget/f_rndis.c:294:9: warning: advancing past deep designator
drivers/usb/gadget/f_eem.c:130:9: warning: advancing past deep designator
drivers/usb/gadget/ether.c:218:9: warning: advancing past deep designator
drivers/usb/gadget/f_hid.c:577:9: warning: advancing past deep designator
drivers/usb/gadget/hid.c:113:9: warning: advancing past deep designator
drivers/usb/gadget/f_acm.c:261:9: warning: advancing past deep designator
drivers/usb/gadget/f_ecm.c:283:9: warning: advancing past deep designator
drivers/usb/gadget/f_subset.c:217:9: warning: advancing past deep designator
drivers/usb/gadget/f_rndis.c:294:9: warning: advancing past deep designator
drivers/usb/gadget/multi.c:139:9: warning: advancing past deep designator
drivers/usb/gadget/f_ncm.c:346:9: warning: advancing past deep designator
drivers/usb/gadget/ncm.c:120:9: warning: advancing past deep designator
drivers/usb/gadget/f_acm.c:261:9: warning: advancing past deep designator
drivers/usb/gadget/f_ecm.c:283:9: warning: advancing past deep designator
drivers/usb/gadget/f_obex.c:76:9: warning: advancing past deep designator
drivers/usb/gadget/f_serial.c:114:9: warning: advancing past deep designator
drivers/usb/gadget/nokia.c:73:9: warning: advancing past deep designator
drivers/usb/gadget/f_acm.c:261:9: warning: advancing past deep designator
drivers/usb/gadget/f_obex.c:76:9: warning: advancing past deep designator
drivers/usb/gadget/f_serial.c:114:9: warning: advancing past deep designator
drivers/usb/gadget/serial.c:74:9: warning: advancing past deep designator
drivers/usb/gadget/f_uvc.c:47:9: warning: advancing past deep designator
drivers/usb/gadget/webcam.c:58:9: warning: advancing past deep designator
drivers/usb/gadget/f_sourcesink.c:138:9: warning: advancing past deep designator
drivers/usb/gadget/f_loopback.c:125:9: warning: advancing past deep designator
drivers/usb/gadget/zero.c:167:9: warning: advancing past deep designator
drivers/net/wan/x25_asy.c:527:17: error: return with no return value
drivers/usb/gadget/f_ecm.c:283:9: warning: advancing past deep designator
drivers/usb/gadget/f_subset.c:217:9: warning: advancing past deep designator
drivers/usb/gadget/f_rndis.c:294:9: warning: advancing past deep designator


---
~Randy
*** Remember to use Documentation/SubmitChecklist when testing your code ***
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: "advancing past deep designator" warnings
Date: Mon, 30 May 2011 06:21:41 +0000
Message-ID: <20110530062141.GH3099 () shale ! localdomain>
--------------------
On Sun, May 29, 2011 at 02:57:12PM -0700, Randy Dunlap wrote:
> Hi,
> 
> Can you give me an idea about what this warning means and what to do about it?
> Thanks.
>

It means that you have an array declared like:
	int x[] = {
		[4] = 5,  <-- designator.
		6         <-- advance one step.
	};

GCC handles these correctly, so I don't think we'd want to change
anything in the kernel because of them.

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Randy Dunlap <rdunlap () xenotime ! net>
To: linux-sparse
Subject: Re: "advancing past deep designator" warnings
Date: Mon, 30 May 2011 16:45:32 +0000
Message-ID: <20110530094532.5a4dc8c4.rdunlap () xenotime ! net>
--------------------
On Mon, 30 May 2011 09:21:41 +0300 Dan Carpenter wrote:

> On Sun, May 29, 2011 at 02:57:12PM -0700, Randy Dunlap wrote:
> > Hi,
> > 
> > Can you give me an idea about what this warning means and what to do about it?
> > Thanks.
> >
> 
> It means that you have an array declared like:
> 	int x[] = {
> 		[4] = 5,  <-- designator.
> 		6         <-- advance one step.
> 	};
> 
> GCC handles these correctly, so I don't think we'd want to change
> anything in the kernel because of them.

Hi Dan,
Thanks for the explanation.  I'll just ignore these warnings.

---
~Randy
*** Remember to use Documentation/SubmitChecklist when testing your code ***
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: (slightly) inconsistent code in evaluate.c:type_difference ===

From: Jonathan =?utf-8?Q?Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: (slightly) inconsistent code in evaluate.c:type_difference
Date: Tue, 23 Aug 2011 22:49:35 +0000
Message-ID: <20110823224935.GA1935 () debian ! debian>
--------------------
Hello, Sparse devs,

in evaluate.c, at lines 623 and 624, t1 and t2 are expected not to be
NULL, while a few lines later (630 and 638), they are checked to avoid
a NULL pointer dereference. That's at least a bit confusing.

Thanks,
	Jonathan NeuschÃ¤fer
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Congratulation's, Your e-mail have won $1,000,000.00 Dollars ===

From: "Mrs. Evelyn McGregor" <mredemptionsa () gala ! net>
To: linux-sparse
Subject: Congratulation's, Your e-mail have won $1,000,000.00 Dollars
Date: Thu, 21 Jul 2011 15:47:44 +0000
Message-ID: <1311263264.57438.YahooMailRC () web181116 ! mail ! ne1 ! yahoo ! com>
--------------------
--0-390971794-1311263264=:57438
Content-Type: text/plain; charset=us-ascii



 Congratulation's, Your e-mail have won $1,000,000.00 Dollars

--0-390971794-1311263264=:57438
Content-Type: application/rtf; name="CANADA_NOTIFICATION.rtf"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="CANADA_NOTIFICATION.rtf"

e1xydGYxXGFuc2lcYW5zaWNwZzEyNTJcdWMxXGRlZmYwXHN0c2hmZGJjaDBc
c3RzaGZsb2NoMFxzdHNoZmhpY2gwXHN0c2hmYmkwXGRlZmxhbmcxMDMzXGRl
ZmxhbmdmZTEwMzN7XGZvbnR0Ymx7XGYwXGZyb21hblxmY2hhcnNldDBcZnBy
cTJ7XCpccGFub3NlIDAyMDIwNjAzMDUwNDA1MDIwMzA0fVRpbWVzIE5ldyBS
b21hbjt9e1xmMVxmc3dpc3NcZmNoYXJzZXQwXGZwcnEye1wqXHBhbm9zZSAw
MjBiMDYwNDAyMDIwMjAyMDIwNH1BcmlhbDt9DQp7XGYzNlxmcm9tYW5cZmNo
YXJzZXQyMzhcZnBycTIgVGltZXMgTmV3IFJvbWFuIENFO317XGYzN1xmcm9t
YW5cZmNoYXJzZXQyMDRcZnBycTIgVGltZXMgTmV3IFJvbWFuIEN5cjt9e1xm
MzlcZnJvbWFuXGZjaGFyc2V0MTYxXGZwcnEyIFRpbWVzIE5ldyBSb21hbiBH
cmVlazt9e1xmNDBcZnJvbWFuXGZjaGFyc2V0MTYyXGZwcnEyIFRpbWVzIE5l
dyBSb21hbiBUdXI7fQ0Ke1xmNDFcZnJvbWFuXGZjaGFyc2V0MTc3XGZwcnEy
IFRpbWVzIE5ldyBSb21hbiAoSGVicmV3KTt9e1xmNDJcZnJvbWFuXGZjaGFy
c2V0MTc4XGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoQXJhYmljKTt9e1xmNDNc
ZnJvbWFuXGZjaGFyc2V0MTg2XGZwcnEyIFRpbWVzIE5ldyBSb21hbiBCYWx0
aWM7fXtcZjQ0XGZyb21hblxmY2hhcnNldDE2M1xmcHJxMiBUaW1lcyBOZXcg
Um9tYW4gKFZpZXRuYW1lc2UpO30NCntcZjQ2XGZzd2lzc1xmY2hhcnNldDIz
OFxmcHJxMiBBcmlhbCBDRTt9e1xmNDdcZnN3aXNzXGZjaGFyc2V0MjA0XGZw
cnEyIEFyaWFsIEN5cjt9e1xmNDlcZnN3aXNzXGZjaGFyc2V0MTYxXGZwcnEy
IEFyaWFsIEdyZWVrO317XGY1MFxmc3dpc3NcZmNoYXJzZXQxNjJcZnBycTIg
QXJpYWwgVHVyO317XGY1MVxmc3dpc3NcZmNoYXJzZXQxNzdcZnBycTIgQXJp
YWwgKEhlYnJldyk7fQ0Ke1xmNTJcZnN3aXNzXGZjaGFyc2V0MTc4XGZwcnEy
IEFyaWFsIChBcmFiaWMpO317XGY1M1xmc3dpc3NcZmNoYXJzZXQxODZcZnBy
cTIgQXJpYWwgQmFsdGljO317XGY1NFxmc3dpc3NcZmNoYXJzZXQxNjNcZnBy
cTIgQXJpYWwgKFZpZXRuYW1lc2UpO319e1xjb2xvcnRibDtccmVkMFxncmVl
bjBcYmx1ZTA7XHJlZDBcZ3JlZW4wXGJsdWUyNTU7XHJlZDBcZ3JlZW4yNTVc
Ymx1ZTI1NTtccmVkMFxncmVlbjI1NVxibHVlMDsNClxyZWQyNTVcZ3JlZW4w
XGJsdWUyNTU7XHJlZDI1NVxncmVlbjBcYmx1ZTA7XHJlZDI1NVxncmVlbjI1
NVxibHVlMDtccmVkMjU1XGdyZWVuMjU1XGJsdWUyNTU7XHJlZDBcZ3JlZW4w
XGJsdWUxMjg7XHJlZDBcZ3JlZW4xMjhcYmx1ZTEyODtccmVkMFxncmVlbjEy
OFxibHVlMDtccmVkMTI4XGdyZWVuMFxibHVlMTI4O1xyZWQxMjhcZ3JlZW4w
XGJsdWUwO1xyZWQxMjhcZ3JlZW4xMjhcYmx1ZTA7XHJlZDEyOFxncmVlbjEy
OFxibHVlMTI4Ow0KXHJlZDE5MlxncmVlbjE5MlxibHVlMTkyO317XHN0eWxl
c2hlZXR7XHFsIFxsaTBccmkwXHdpZGN0bHBhclxhc3BhbHBoYVxhc3BudW1c
ZmFhdXRvXGFkanVzdHJpZ2h0XHJpbjBcbGluMFxpdGFwMCBcZnMyNFxsYW5n
MTAzM1xsYW5nZmUxMDMzXGNncmlkXGxhbmducDEwMzNcbGFuZ2ZlbnAxMDMz
IFxzbmV4dDAgTm9ybWFsO317XCpcY3MxMCBcYWRkaXRpdmUgXHNzZW1paGlk
ZGVuIERlZmF1bHQgUGFyYWdyYXBoIEZvbnQ7fXtcKg0KXHRzMTFcdHNyb3dk
XHRyZnRzV2lkdGhCM1x0cnBhZGRsMTA4XHRycGFkZHIxMDhcdHJwYWRkZmwz
XHRycGFkZGZ0M1x0cnBhZGRmYjNcdHJwYWRkZnIzXHRzY2VsbHdpZHRoZnRz
MFx0c3ZlcnRhbHRcdHNicmRydFx0c2JyZHJsXHRzYnJkcmJcdHNicmRyclx0
c2JyZHJkZ2xcdHNicmRyZGdyXHRzYnJkcmhcdHNicmRydiANClxxbCBcbGkw
XHJpMFx3aWRjdGxwYXJcYXNwYWxwaGFcYXNwbnVtXGZhYXV0b1xhZGp1c3Ry
aWdodFxyaW4wXGxpbjBcaXRhcDAgXGZzMjBcbGFuZzEwMjRcbGFuZ2ZlMTAy
NFxjZ3JpZFxsYW5nbnAxMDI0XGxhbmdmZW5wMTAyNCBcc25leHQxMSBcc3Nl
bWloaWRkZW4gTm9ybWFsIFRhYmxlO319e1wqXGxhdGVudHN0eWxlc1xsc2Rz
dGltYXgxNTZcbHNkbG9ja2VkZGVmMH17XCpccnNpZHRibCBccnNpZDc0NTk5
MVxyc2lkOTkzMjYzDQpccnNpZDM0MzAyMTVccnNpZDU1ODc0NDBccnNpZDc3
MzYzMDRccnNpZDEwNjE5MzA1XHJzaWQxNTQ5MTQyNlxyc2lkMTU4MDcxODl9
e1wqXGdlbmVyYXRvciBNaWNyb3NvZnQgV29yZCAxMS4wLjU2MDQ7fXtcaW5m
b3tcdGl0bGUgQ0FOQURBIExPVFRFUlkvIEVNQUlMIERSQVcgT05UQVJJTyA0
OSB9e1xhdXRob3IgcGMwMn17XG9wZXJhdG9yIHBjMDN9e1xjcmVhdGltXHly
MjAxMVxtbzdcZHkyM1xocjE3XG1pbjIyfQ0Ke1xyZXZ0aW1ceXIyMDExXG1v
N1xkeTIzXGhyMTdcbWluMjJ9e1x2ZXJzaW9uMn17XGVkbWluczJ9e1xub2Zw
YWdlczF9e1xub2Z3b3JkczMzN317XG5vZmNoYXJzMTkyMX17XG5vZmNoYXJz
d3MyMjU0fXtcdmVybjI0Njg5fX1cd2lkb3djdHJsXGZ0bmJqXGFlbmRkb2Nc
bm94bGF0dG95ZW5cZXhwc2hydG5cbm91bHRybHNwY1xkbnRibG5zYmRiXG5v
c3BhY2Vmb3J1bFxoeXBoY2FwczBcaG9yemRvY1xkZ2hzcGFjZTEyMFxkZ3Zz
cGFjZTEyMA0KXGRnaG9yaWdpbjE3MDFcZGd2b3JpZ2luMTk4NFxkZ2hzaG93
MFxkZ3ZzaG93M1xqY29tcHJlc3Ncdmlld2tpbmQ0XHZpZXdzY2FsZTEwMFxu
b2xuaHRhZGp0YmxccnNpZHJvb3Q1NTg3NDQwIFxmZXQwXHNlY3RkIFxsaW5l
eDBcc2VjdGRlZmF1bHRjbFxzZnRuYmoge1wqXHBuc2VjbHZsMVxwbnVjcm1c
cG5zdGFydDFccG5pbmRlbnQ3MjBccG5oYW5nIHtccG50eHRhIC59fXtcKlxw
bnNlY2x2bDINClxwbnVjbHRyXHBuc3RhcnQxXHBuaW5kZW50NzIwXHBuaGFu
ZyB7XHBudHh0YSAufX17XCpccG5zZWNsdmwzXHBuZGVjXHBuc3RhcnQxXHBu
aW5kZW50NzIwXHBuaGFuZyB7XHBudHh0YSAufX17XCpccG5zZWNsdmw0XHBu
bGNsdHJccG5zdGFydDFccG5pbmRlbnQ3MjBccG5oYW5nIHtccG50eHRhICl9
fXtcKlxwbnNlY2x2bDVccG5kZWNccG5zdGFydDFccG5pbmRlbnQ3MjBccG5o
YW5nIHtccG50eHRiICh9e1xwbnR4dGEgKX19e1wqXHBuc2VjbHZsNg0KXHBu
bGNsdHJccG5zdGFydDFccG5pbmRlbnQ3MjBccG5oYW5nIHtccG50eHRiICh9
e1xwbnR4dGEgKX19e1wqXHBuc2VjbHZsN1xwbmxjcm1ccG5zdGFydDFccG5p
bmRlbnQ3MjBccG5oYW5nIHtccG50eHRiICh9e1xwbnR4dGEgKX19e1wqXHBu
c2VjbHZsOFxwbmxjbHRyXHBuc3RhcnQxXHBuaW5kZW50NzIwXHBuaGFuZyB7
XHBudHh0YiAofXtccG50eHRhICl9fXtcKlxwbnNlY2x2bDlccG5sY3JtXHBu
c3RhcnQxXHBuaW5kZW50NzIwXHBuaGFuZyANCntccG50eHRiICh9e1xwbnR4
dGEgKX19XHBhcmRccGxhaW4gXHFsIFxsaTBccmkwXG5vd2lkY3RscGFyXGZh
YXV0b1xyaW4wXGxpbjBcaXRhcDBccGFyYXJzaWQ3NDU5OTEgXGZzMjRcbGFu
ZzEwMzNcbGFuZ2ZlMTAzM1xjZ3JpZFxsYW5nbnAxMDMzXGxhbmdmZW5wMTAz
MyB7XGJcZjFcZnMyMFxpbnNyc2lkNzQ1OTkxIENBTkFEQSBMT1RURVJZLyBF
TUFJTCBEUkFXIE9OVEFSSU8gNDl9e1xmMVxmczIwXGluc3JzaWQ3NDU5OTEg
IA0KXHBhciB9e1xiXGYxXGZzMjBcY2YxXGluc3JzaWQ3NDU5OTEgMTU1MCBQ
cmluY2VzcyBTdHJlZXQgS2luZ3N0b24sIE9OLCBDYW5hZGEsIEs3TSA5RTN9
e1xmMVxmczIwXGluc3JzaWQ3NDU5OTEgIA0KXHBhciB9e1xmMVxmczIwXGNm
MVxpbnNyc2lkNzQ1OTkxIFdlYnNpdGU6IH17XGYxXGZzMjBcdWxcaW5zcnNp
ZDc0NTk5MSBodHRwOi8vd3d3LmxvdHRvbG9yZS5jb20vb250YXJpbzQ5Lmh0
bWx9e1xmMVxmczIwXGluc3JzaWQ3NDU5OTEgDQpccGFyIH17XGJcZjFcZnMy
MFxjZjFcaW5zcnNpZDc0NTk5MSBVSyBPZmZpY2UgTm8gNDcgU2UxIDduYSBc
ZW5kYXNoICBCYWxraW5nIExvbmRvbiBVbml0ZWQgS2luZ2RvbSB9e1xmMVxm
czIwXGluc3JzaWQ3NDU5OTEgDQpccGFyIH17XGYxXGZzMTlcaW5zcnNpZDc0
NTk5MSBcfn17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAgDQpccGFyIH17XGJc
ZnMzNlxpbnNyc2lkNzQ1OTkxIFNhdCwgSnVseSAxNiwgMjAxMX17XGJcZjFc
ZnMzNlxpbnNyc2lkNzQ1OTkxICAtIE9udGFyaW8gNDl9e1xmMVxmczIwXGlu
c3JzaWQ3NDU5OTEgDQpccGFyIH17XGJcZjFcZnMyMFxjZjFcaW5zcnNpZDc0
NTk5MSBcflx+XH5cflx+XH5cflx+XH5cflx+XH5cflx+XH5cflx+XH5cflx+
XH5cflx+XH5cflx+XH5cflx+XH5cflx+XH5cflx+XH5cflx+XH5cflx+XH5c
flx+XH5cflx+XH5cflx+XH5cflx+XH4gXH5cfn17XGJcZjFcZnMyMFx1bFxj
ZjFcaW5zcnNpZDc0NTk5MSBXSU5OSU5HIE5VTUJFUlMgfXtcZjFcZnMyMFxp
bnNyc2lkNzQ1OTkxIA0KXHBhciB9XHRyb3dkIFxpcm93MFxpcm93YmFuZDBc
bGFzdHJvdyBcdHMxMVx0cnFjXHRyZ2FwaDEwXHRycmgyNTdcdHJsZWZ0LTEw
XHRyZnRzV2lkdGgxXHRyZnRzV2lkdGhCM1x0cmZ0c1dpZHRoQTNcdHJwYWRk
bDEwXHRycGFkZHIxMFx0cnBhZGRmbDNcdHJwYWRkZnIzIFxjbHZlcnRhbGNc
Y2xicmRydFxicmRyc1xicmRydzE1XGJyZHJjZjE2IFxjbGJyZHJsXGJyZHJz
XGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmJcYnJkcnNcYnJkcncxNVxicmRy
Y2YxNiANClxjbGJyZHJyXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsdHhs
cnRiXGNsZnRzV2lkdGgzXGNsd1dpZHRoNDY3XGNsc2hkcmF3bmlsIFxjZWxs
eDQ1N1xjbHZlcnRhbGNcY2xicmRydFxicmRyc1xicmRydzE1XGJyZHJjZjE2
IFxjbGJyZHJsXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmJcYnJk
cnNcYnJkcncxNVxicmRyY2YxNiBcY2xicmRyclxicmRyc1xicmRydzE1XGJy
ZHJjZjE2IA0KXGNsdHhscnRiXGNsZnRzV2lkdGgzXGNsd1dpZHRoNjI4XGNs
c2hkcmF3bmlsIFxjZWxseDEwODVcY2x2ZXJ0YWxjXGNsYnJkcnRcYnJkcnNc
YnJkcncxNVxicmRyY2YxNiBcY2xicmRybFxicmRyc1xicmRydzE1XGJyZHJj
ZjE2IFxjbGJyZHJiXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcnJc
YnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2x0eGxydGJcY2xmdHNXaWR0aDNc
Y2x3V2lkdGg2MjhcY2xzaGRyYXduaWwgXGNlbGx4MTcxMw0KXGNsdmVydGFs
Y1xjbGJyZHJ0XGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmxcYnJk
cnNcYnJkcncxNVxicmRyY2YxNiBcY2xicmRyYlxicmRyc1xicmRydzE1XGJy
ZHJjZjE2IFxjbGJyZHJyXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsdHhs
cnRiXGNsZnRzV2lkdGgzXGNsd1dpZHRoNjI4XGNsc2hkcmF3bmlsIFxjZWxs
eDIzNDFcY2x2ZXJ0YWxjXGNsYnJkcnRcYnJkcnNcYnJkcncxNVxicmRyY2Yx
NiBcY2xicmRybA0KXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmJc
YnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2xicmRyclxicmRyc1xicmRydzE1
XGJyZHJjZjE2IFxjbHR4bHJ0YlxjbGZ0c1dpZHRoM1xjbHdXaWR0aDYyOFxj
bHNoZHJhd25pbCBcY2VsbHgyOTY5XGNsdmVydGFsY1xjbGJyZHJ0XGJyZHJz
XGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmxcYnJkcnNcYnJkcncxNVxicmRy
Y2YxNiBcY2xicmRyYlxicmRyc1xicmRydzE1XGJyZHJjZjE2IA0KXGNsYnJk
cnJcYnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2x0eGxydGJcY2xmdHNXaWR0
aDNcY2x3V2lkdGg1NThcY2xzaGRyYXduaWwgXGNlbGx4MzUyN1xjbHZlcnRh
bGNcY2xicmRydFxicmRyc1xicmRydzE1XGJyZHJjZjE2IFxjbGJyZHJsXGJy
ZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmJcYnJkcnNcYnJkcncxNVxi
cmRyY2YxNiBcY2xicmRyclxicmRyc1xicmRydzE1XGJyZHJjZjE2IA0KXGNs
dHhscnRiXGNsZnRzV2lkdGgzXGNsd1dpZHRoMTgxNlxjbHNoZHJhd25pbCBc
Y2VsbHg1MzQzXHBhcmQgXHFjIFxsaTBccmkwXG5vd2lkY3RscGFyXGludGJs
XGZhYXV0b1xyaW4wXGxpbjBccGFyYXJzaWQxMDYxOTMwNSB7XGJcZnMzNlxp
bnNyc2lkNzQ1OTkxIDZ9e1xpbnNyc2lkNzQ1OTkxIFx+IFxjZWxsIH17XGJc
ZnMzNlxpbnNyc2lkNzQ1OTkxIDI3fXtcaW5zcnNpZDc0NTk5MSAgXGNlbGwg
fXtcYlxmczM2XGluc3JzaWQ3NDU5OTEgMzV9DQp7XGluc3JzaWQ3NDU5OTEg
XGNlbGwgfXtcYlxmczM2XGluc3JzaWQ3NDU5OTEgMzZ9e1xpbnNyc2lkNzQ1
OTkxICBcY2VsbCB9e1xiXGZzMzZcaW5zcnNpZDc0NTk5MSAzOH17XGluc3Jz
aWQ3NDU5OTEgIFxjZWxsIH17XGJcZnMzNlxpbnNyc2lkNzQ1OTkxIDQ2fXtc
aW5zcnNpZDc0NTk5MSAgXGNlbGwgfXtcYlxmczM2XGluc3JzaWQ3NDU5OTEg
Qm9udXN9e1xiXGluc3JzaWQ3NDU5OTEgXH5cfn17XGJcZnMzNlxpbnNyc2lk
NzQ1OTkxIDEzfXsNClxpbnNyc2lkNzQ1OTkxIFxjZWxsIH1ccGFyZCBccWwg
XGxpMFxyaTBcd2lkY3RscGFyXGludGJsXGFzcGFscGhhXGFzcG51bVxmYWF1
dG9cYWRqdXN0cmlnaHRccmluMFxsaW4wIHtcaW5zcnNpZDc0NTk5MSBcdHJv
d2QgXGlyb3cwXGlyb3diYW5kMFxsYXN0cm93IA0KXHRzMTFcdHJxY1x0cmdh
cGgxMFx0cnJoMjU3XHRybGVmdC0xMFx0cmZ0c1dpZHRoMVx0cmZ0c1dpZHRo
QjNcdHJmdHNXaWR0aEEzXHRycGFkZGwxMFx0cnBhZGRyMTBcdHJwYWRkZmwz
XHRycGFkZGZyMyBcY2x2ZXJ0YWxjXGNsYnJkcnRcYnJkcnNcYnJkcncxNVxi
cmRyY2YxNiBcY2xicmRybFxicmRyc1xicmRydzE1XGJyZHJjZjE2IFxjbGJy
ZHJiXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcnJcYnJkcnNcYnJk
cncxNVxicmRyY2YxNiANClxjbHR4bHJ0YlxjbGZ0c1dpZHRoM1xjbHdXaWR0
aDQ2N1xjbHNoZHJhd25pbCBcY2VsbHg0NTdcY2x2ZXJ0YWxjXGNsYnJkcnRc
YnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2xicmRybFxicmRyc1xicmRydzE1
XGJyZHJjZjE2IFxjbGJyZHJiXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNs
YnJkcnJcYnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2x0eGxydGJcY2xmdHNX
aWR0aDNcY2x3V2lkdGg2MjhcY2xzaGRyYXduaWwgXGNlbGx4MTA4NQ0KXGNs
dmVydGFsY1xjbGJyZHJ0XGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJk
cmxcYnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2xicmRyYlxicmRyc1xicmRy
dzE1XGJyZHJjZjE2IFxjbGJyZHJyXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYg
XGNsdHhscnRiXGNsZnRzV2lkdGgzXGNsd1dpZHRoNjI4XGNsc2hkcmF3bmls
IFxjZWxseDE3MTNcY2x2ZXJ0YWxjXGNsYnJkcnRcYnJkcnNcYnJkcncxNVxi
cmRyY2YxNiBcY2xicmRybA0KXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNs
YnJkcmJcYnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2xicmRyclxicmRyc1xi
cmRydzE1XGJyZHJjZjE2IFxjbHR4bHJ0YlxjbGZ0c1dpZHRoM1xjbHdXaWR0
aDYyOFxjbHNoZHJhd25pbCBcY2VsbHgyMzQxXGNsdmVydGFsY1xjbGJyZHJ0
XGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmxcYnJkcnNcYnJkcncx
NVxicmRyY2YxNiBcY2xicmRyYlxicmRyc1xicmRydzE1XGJyZHJjZjE2IA0K
XGNsYnJkcnJcYnJkcnNcYnJkcncxNVxicmRyY2YxNiBcY2x0eGxydGJcY2xm
dHNXaWR0aDNcY2x3V2lkdGg2MjhcY2xzaGRyYXduaWwgXGNlbGx4Mjk2OVxj
bHZlcnRhbGNcY2xicmRydFxicmRyc1xicmRydzE1XGJyZHJjZjE2IFxjbGJy
ZHJsXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcmJcYnJkcnNcYnJk
cncxNVxicmRyY2YxNiBcY2xicmRyclxicmRyc1xicmRydzE1XGJyZHJjZjE2
IA0KXGNsdHhscnRiXGNsZnRzV2lkdGgzXGNsd1dpZHRoNTU4XGNsc2hkcmF3
bmlsIFxjZWxseDM1MjdcY2x2ZXJ0YWxjXGNsYnJkcnRcYnJkcnNcYnJkcncx
NVxicmRyY2YxNiBcY2xicmRybFxicmRyc1xicmRydzE1XGJyZHJjZjE2IFxj
bGJyZHJiXGJyZHJzXGJyZHJ3MTVcYnJkcmNmMTYgXGNsYnJkcnJcYnJkcnNc
YnJkcncxNVxicmRyY2YxNiBcY2x0eGxydGJcY2xmdHNXaWR0aDNcY2x3V2lk
dGgxODE2XGNsc2hkcmF3bmlsIFxjZWxseDUzNDMNClxyb3cgfVxwYXJkIFxx
YyBcbGkwXHJpMFxub3dpZGN0bHBhclxmYWF1dG9ccmluMFxsaW4wXGl0YXAw
XHBhcmFyc2lkNzQ1OTkxIHtcZjFcZnMyMFxjZjFcaW5zcnNpZDc0NTk5MSBc
fn17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAgDQpccGFyIH17XGYxXGZzMjBc
Y2YxXGluc3JzaWQ3NDU5OTEgV2UgaGFwcGlseSBhbm5vdW5jZSB0byB5b3Ug
dGhlIGRyYXcgb2YgQ2FuYWRpYW4gTmF0aW9uYWwgTG90dGVyeSB0aGUgfXtc
YlxmMVxmczIwXGNmMVxpbnNyc2lkNzQ1OTkxIFVLL0NBTkFEQX17XGYxXGZz
MjBcY2YxXGluc3JzaWQ3NDU5OTEgIG9ubGluZSBTd2VlcHN0YWtlcyBJbnRl
cm5hdGlvbmFsIHByb2dyYW0gaGVsZCBvbiB9e1xiXGYxXGZzMjBcY2YxXGlu
c3JzaWQ3NDU5OTEgU2F0fXsNClxiXGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAs
IEp1bHkgMTYsIDIwMTF9e1xmMVxmczIwXGNmMVxpbnNyc2lkNzQ1OTkxIC59
e1xmMVxmczIwXGluc3JzaWQ3NDU5OTEgIA0KXHBhciB9e1xmMVxmczIwXGNm
MVxpbnNyc2lkNzQ1OTkxIFx+IH17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAN
ClxwYXIgWW91IGhhdmUgd29uIH17XGJcZjFcZnMyMFxpbnNyc2lkNzQ1OTkx
IFVTRCQxLDAwMCwwMDAuMDAgKE9uZSBNaWxsaW9uIFVuaXRlZCBTdGF0ZXMg
RG9sbGFycyBPbmx5KX17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAgZnJvbSBD
YW5hZGlhbiBsb3R0ZXJ5IGRyYXcgfXtcYlxmMVxmczIwXGNmMVxpbnNyc2lk
NzQ1OTkxIDIwMTEuIFl9e1xmMVxmczIwXGNmMVxpbnNyc2lkNzQ1OTkxIA0K
b3VyIEVtYWlsIElEIHdhcyBvbmUgb2YgdGhlIHNlbGVjdGVkIGVtYWlscyBh
bGwgb3ZlciB0aGUgd29ybGQgaW4gdGhlIGxvdHRlcnkgZHJhdyBhbmQgaXQg
Y29tZXMgb3V0IG9uZSBvZiB0aGUgbHVja3kgd2lubmluZyBudW1iZXJ9e1xi
XGYxXGZzMjBcY2YxXGluc3JzaWQ3NDU5OTEgLn17XGYxXGZzMjBcY2YxXGlu
c3JzaWQ3NDU5OTEgIH17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSANClxwYXIg
fXtcZjFcZnMyMFxjZjFcaW5zcnNpZDc0NTk5MSBcfn17XGYxXGZzMjBcaW5z
cnNpZDc0NTk5MSAgDQpccGFyIFlvdSBhcmUgcmVxdWVzdGVkIHRvIGNvbnRh
Y3QgdGhlIFByb2Nlc3NpbmcgRGlyZWN0b3IgaW1tZWRpYXRlbHkgeW91IHJl
Y2VpdmUgdGhpcyBub3RpZmljYXRpb24gd2l0aCB0aGUgYmVsb3cgaW5mb3Jt
YXRpb24sIHRvIGVuYWJsZSBoaW0gc3RhcnQgd2l0aCB0aGUgcHJvY2Vzc2lu
ZyBmb3IgdGhlIHJlbGVhc2Ugb2YgeW91ciB3aW5uaW5nIHByaXplIHdpdGhv
dXQgYW55IGRlbGF5LiANClxwYXIgfXtcZjFcZnMyMFxjZjFcaW5zcnNpZDc0
NTk5MSBcfn17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAgDQpccGFyIEZvciBm
dXJ0aGVyIGluZm9ybWF0aW9uIGFib3V0IGhvdyB0byByZWNlaXZlIHlvdSBh
d2FyZCB3aW5uaW5nIHByaXplIGNvbnRhY3Q6IA0KXHBhciB9e1xiXGYxXGZz
MjhcY2YxXGluc3JzaWQ3NDU5OTEgXH59e1xmMVxmczIwXGluc3JzaWQ3NDU5
OTEgIA0KXHBhciB9e1xiXGYxXGZzMjhcY2YxXGluc3JzaWQ3NDU5OTEgRElS
RUNUT1IgT0YgUEFZTUVOVC9JTkZPUk1BVElPTn17XGYxXGZzMjBcaW5zcnNp
ZDc0NTk5MSAgDQpccGFyIH17XGJcZjFcZnMyOFxjZjFcaW5zcnNpZDc0NTk5
MSBDQU5BREEgUkVHSU9OQUwgT0ZGSUNFIFMuQX17XGYxXGZzMjBcaW5zcnNp
ZDc0NTk5MSBcfiANClxwYXIgfXtcYlxmMVxmczI4XGNmMVxpbnNyc2lkNzQ1
OTkxIE5BTUU6IE1SLiBEQVZJRVMgR1JBVFRBTn17XGYxXGZzMjBcaW5zcnNp
ZDc0NTk5MSAgDQpccGFyIH17XGJcZjFcZnMyOFxjZjFcaW5zcnNpZDc0NTk5
MSBcflx+XH5cflx+XH5cflx+XH5cfiBQSE9ORTogKzI3IDczIDYyNyAxMDQ2
fXtcZjFcZnMyMFxpbnNyc2lkNzQ1OTkxICANClxwYXIgfXtcYlxmMVxmczI4
XGNmMVxpbnNyc2lkNzQ1OTkxIEUtTUFJTDogfXtcYlxmMVxmczI4XHVsXGlu
c3JzaWQ3NDU5OTFcY2hhcnJzaWQxNTgwNzE4OSBjYW5hZGlhbi5zYWZyaWNh
LnJlZGVtcHRpb24yfXtcYlxmMVxmczI4XHVsXGluc3JzaWQ3NDU5OTEgQGdt
YWlsLmNvbX17XGYxXGZzMjBcaW5zcnNpZDc0NTk5MSAgDQpccGFyIH17XGJc
ZjFcZnMyOFxjZjFcaW5zcnNpZDc0NTk5MSBFLU1BSUw6IH17XGJcZjFcZnMy
OFx1bFxpbnNyc2lkNzQ1OTkxIGNhbmFkaWFuLnNhZnJpY2EucmVkZW1wdGlv
bjFAZ21haWwuY29tfXtcZjFcZnMyMFxpbnNyc2lkNzQ1OTkxIA0KXHBhciB9
e1xiXGYxXGZzMTZcbGFuZzcxNzdcbGFuZ2ZlMTAzM1xsYW5nbnA3MTc3XGlu
c3JzaWQ3NDU5OTEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoq
KiAqKioqKioqKioqKioqKioqKioqKioqKioqKipcbGluZSB9e1xmMVxmczE2
XGxhbmc3MTc3XGxhbmdmZTEwMzNcbGFuZ25wNzE3N1xpbnNyc2lkNzQ1OTkx
IERJU0NMQUlNRVIgJiBDT05GSURFTlRJQUxJVFk6XGxpbmUgVGhlIGluZm9y
bWF0aW8NCm4gY29udGFpbmVkIGluIHRoaXMgY29tbXVuaWNhdGlvbiBpcyBp
bnRlbmRlZCBzb2xlbHkgZm9yIHRoZSB1c2Ugb2YgdGhlIGluZGl2aWR1YWwg
b3IgZW50aXR5IHRvIHdob20gaXQgaXMgYWRkcmVzc2VkIGFuZCBvdGhlcnMg
YXV0aG9yaXplZCB0byByZWNlaXZlIGl0LCBhcyBpdCBtYXkgY29udGFpbiBj
b25maWRlbnRpYWwgb3IgbGVnYWxseSBwcml2aWxlZ2VkIGluZm9ybWF0aW9u
LiBJZiB5b3UgYXJlIG5vdCB0aGUgaW50ZW5kZWQgcmVjaXBpZQ0Kbg0KdCB5
b3UgYXJlIGhlcmVieSBub3RpZmllZCB0aGF0IGFueSBkaXNjbG9zdXJlLCB1
bmF1dGhvcml6ZWQgdXNlLCBjb3B5aW5nLCBkaXN0cmlidXRpb24gb3IgdGFr
aW5nIGFueSBhY3Rpb24gaW4gcmVsaWFuY2Ugb24gdGhlIGNvbnRlbnRzIG9m
IHRoaXMgaW5mb3JtYXRpb24gaXMgc3RyaWN0bHkgcHJvaGliaXRlZCBhbmQg
bWF5IGJlIHVubGF3ZnVsLiBJZiB5b3UgaGF2ZSByZWNlaXZlZCB0aGlzIGNv
bW11bmljYXRpb24gaW4gZXJyb3IsIHBsZWFzDQplIG5vdGlmeSB1cyBpbW1l
ZGlhdGVseSBieSByZXNwb25kaW5nIHRvIHRoaXMgZW1haWwgYW5kIHRoZW4g
ZGVsZXRlIGl0IGZyb20geW91ciBzeXN0ZW0uXGxpbmUgQ2FuYWRhIExvdHRl
cnkgaXMgbmVpdGhlciBsaWFibGUgZm9yIHRoZSBwcm9wZXIgYW5kIGNvbXBs
ZXRlIHRyYW5zbWlzc2lvbiBvZiB0aGUgaW5mb3JtYXRpb24gY29udGFpbmVk
IGluIHRoaXMgY29tbXVuaWNhdGlvbiBub3IgZm9yIGFueSBkZWxheSBpbiBp
dHMgcmVjZWlwdC4gDQpcbGluZSB9e1xiXGYxXGZzMTZcbGFuZzcxNzdcbGFu
Z2ZlMTAzM1xsYW5nbnA3MTc3XGluc3JzaWQ3NDU5OTEgKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqICoqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKn17XGYxXGZzMTZcbGFuZzcxNzdcbGFuZ2ZlMTAzM1xsYW5nbnA3MTc3
XGluc3JzaWQ3NDU5OTEgXH59e1xmMVxmczE2XGluc3JzaWQ3NDU5OTEgXH59
e1xmMVxmczIwXGluc3JzaWQ3NDU5OTEgIA0KXHBhciB9e1xiXGYxXGZzMjhc
Y2YxXGluc3JzaWQ3NDU5OTEgWW91cnMgZmFpdGhmdWxseSx9e1xmMVxmczIw
XGluc3JzaWQ3NDU5OTEgIA0KXHBhciB9e1xiXGYxXGZzMjhcY2YxXGluc3Jz
aWQ3NDU5OTEgTXJzLiBFdmVseW4gTWNHcmVnb3IgfXtcZjFcZnMyMFxpbnNy
c2lkNzQ1OTkxIA0KXHBhciB9e1xmMVxmczI4XGNmMVxpbnNyc2lkNzQ1OTkx
IFtQdWJsaWNpdHkgU2VjcmV0YXJ5XS59e1xmMVxmczIwXGluc3JzaWQ3NDU5
OTFcY2hhcnJzaWQ1NTg3NDQwIA0KXHBhciB9XHBhcmQgXHFsIFxsaTBccmkw
XHdpZGN0bHBhclxhc3BhbHBoYVxhc3BudW1cZmFhdXRvXGFkanVzdHJpZ2h0
XHJpbjBcbGluMFxpdGFwMFxwYXJhcnNpZDc0NTk5MSB7XGluc3JzaWQ1NTg3
NDQwXGNoYXJyc2lkNzQ1OTkxIA0KXHBhciB9fQ==

--0-390971794-1311263264=:57438--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Flow graph - identify loop body ===

From: Diego Pinheiro <diegoquintanap () gmail ! com>
To: linux-sparse
Subject: Flow graph - identify loop body
Date: Fri, 13 May 2011 16:32:40 +0000
Message-ID: <BANLkTikHXzguWK00TCO41x1_13BffCYyRg () mail ! gmail ! com>
--------------------
Hello,

I'm trying to identify loop bodies to write its information in a xml
file, but i didn't get how sparse works with it.

How could I know which node is a loop body in the flow graph?
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: Flow graph - identify loop body
Date: Sat, 14 May 2011 07:43:58 +0000
Message-ID: <BANLkTin+brzQZcEoxV6EGmoyS9R6w-cuxw () mail ! gmail ! com>
--------------------
On 5/13/11, Diego Pinheiro <diegoquintanap@gmail.com> wrote:
> Hello,
>
> I'm trying to identify loop bodies to write its information in a xml
> file, but i didn't get how sparse works with it.
>
> How could I know which node is a loop body in the flow graph?

You might want try downloading smatch (http://smatch.sf.net) and
looking in smatch_flow.c

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Diego Pinheiro <diegoquintanap () gmail ! com>
To: linux-sparse
Subject: Re: Flow graph - identify loop body
Date: Tue, 17 May 2011 22:09:16 +0000
Message-ID: <BANLkTi==PTAQ1jPc5g9xPm843DhZ9zuTsQ () mail ! gmail ! com>
--------------------
Thanks, it really helped.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Hello From Beldorin. ===

From: Beldorin minu Duke <beldo_minu1985 () yahoo ! com>
To: linux-sparse
Subject: Hello From Beldorin.
Date: Mon, 03 Oct 2011 10:59:21 +0000
Message-ID: <1317639561.4e8995892e7bb () mail ! sportgear ! com ! tw>
--------------------


Hello it is my pleasure and desire to contact you and a make a fromal 
introduction of myself to you,how are you doing today,i hope that my little note 
finds you in good health and proper state of mind.

My name is Beldorin Duke i am 24years old single girl with no kid,i am in search 
of true love,friendship and business partnership that i think could benefit me 
and you,i will explain myself more clear and better when i recieve your reply 
through my private emailbox for further discussion on these.
(beldorinminu@yahoo.com)

Have a pleasant and favourable day as i hope reading from you soon,i will send 
you my details which includes pictures of mine in my next email.be assured of my 
best regards and warm wishes.

Beldorin Duke
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html

================================================================================


################################################################################

=== Thread: LLVM and PSEUDO_REG/PSEUDO_PHI ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 19:45:41 +0000
Message-ID: <alpine.DEB.2.00.1108292242110.24020 () localhost6 ! localdomain6>
--------------------
  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---1463808768-1318521429-1314647147=:24020
Content-Type: TEXT/PLAIN; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

[ Adding sparse-linux to CC. ]

On Sat, 27 Aug 2011, Linus Torvalds wrote:
> On Sat, Aug 27, 2011 at 2:19 AM, Pekka Enberg <penberg@kernel.org> wrote:
>>
>> Looking at this:
>>
>> sete:
>> .L0x7f188cf71c90:
>>        <entry-point>
>>        seteq.32    %r83 <- %arg1, %arg2
>>        cast.32     %r84 <- (8) %r83
>>        ret.32      %r84
>>
>> Why do we have "seteq.32" there but then we have a "cast.32" from %r83 which
>> is 8 bits? Isn't it linearize.c that's confused here?
>
> No, the code is correct, you misunderstand what "seteq" does.
>
> The 32 in "seteq.32" is the OPERAND WIDTH. It takes two 32-bit values
> and checks that they are equal.
>
> The OUTPUT WIDTH is "boolean". Which you changed to 8 bits (to match
> x86 semantics). So when you return an "int", you do indeed need to
> cast from 8 bits to 32 bits.
>
> There are a few ops that have different operand width from output
> width. The cast operation itself is the obvious case, and it shows its
> operand/output widths explicitly. But "setcc" is another - since the
> output is always just a boolean.

So you were obviously correct. I checked the LLVM bitcode and I was simply 
using the wrong type of cast. With this small change:

diff --git a/sparse-llvm.c b/sparse-llvm.c
index f89f7a7..a9bf679 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -607,7 +607,7 @@ static void output_op_cast(struct function *fn, struct instruction *insn)
  	if (symbol_is_fp_type(insn->type))
  		target = LLVMBuildFPCast(fn->builder, src, symbol_type(insn->type), target_name);
  	else
-		target = LLVMBuildIntCast(fn->builder, src, symbol_type(insn->type), target_name);
+		target = LLVMBuildZExt(fn->builder, src, symbol_type(insn->type), target_name);

  	insn->target->priv = target;
  }

the generated code now looks sane:

0000000000000000 <sete>:
    0:	39 f7                	cmp    %esi,%edi
    2:	0f 94 c0             	sete   %al
    5:	0f b6 c0             	movzbl %al,%eax
    8:	c3                   	retq
    9:	eb 05                	jmp    10 <setne>

However, i'm not 100% sure that's sufficient. Is OP_CAST always 
zero-extend or do we need to check for something specific here?

 			Pekka
---1463808768-1318521429-1314647147=:24020--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 19:52:24 +0000
Message-ID: <4E5BEDF8.4090907 () garzik ! org>
--------------------
On 08/29/2011 03:45 PM, Pekka Enberg wrote:
> However, i'm not 100% sure that's sufficient. Is OP_CAST always
> zero-extend or do we need to check for something specific here?


At a minimum we must deal with pointer casts in there too?

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 20:32:33 +0000
Message-ID: <CA+55aFw1rzBG42oDz8PajG78CeuKyRBZW+vFwmE5e2XEtcFDfw () mail ! gmail ! com>
--------------------
On Mon, Aug 29, 2011 at 12:45 PM, Pekka Enberg <penberg@kernel.org> wrote:
>
> However, i'm not 100% sure that's sufficient. Is OP_CAST always zero-extend
> or do we need to check for something specific here?

OP_CAST is always a zero-extend, OP_SCAST is a sign-extending one.

(Of course, they may be *truncating* casts too, which don't need to
generate any code on most architectures).

OP_PTRCAST should act as OP_CAST.

NOTE! The casting is dubious. We only have a single OP_FPCAST, for
example, and that's just broken. Right now "OP_FPCAST" means that the
*source* was a FP value. But if we cast *to* a FP value, it ends up
showing up as OP_[S]CAST, which is just bogus. The FPCAST should be
for any FP operation (to or from or both), and then the FPCAST logic
would have to decide how it handles it.

The FP support in general is pretty weak. The kernel doesn't do FP, I
never really cared about it.

                            Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 20:42:37 +0000
Message-ID: <CAOJsxLFciLwdu1cBd9LO77U-9P+3e7agYYd8tV1qCf_4HeWGVg () mail ! gmail ! com>
--------------------
On Mon, Aug 29, 2011 at 12:45 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> However, i'm not 100% sure that's sufficient. Is OP_CAST always zero-extend
>> or do we need to check for something specific here?

On Mon, Aug 29, 2011 at 11:32 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> OP_CAST is always a zero-extend, OP_SCAST is a sign-extending one.
>
> (Of course, they may be *truncating* casts too, which don't need to
> generate any code on most architectures).
>
> OP_PTRCAST should act as OP_CAST.

OK, makes perfect sense. We don't support OP_SCAST or OP_PTRCAST yet
so those should be fine. I fixed OP_CAST like this:

https://github.com/penberg/sparse-llvm/commit/2dea6f7fb07cd18255cf1d73079638dc96bdd08b

So comparison operators should be OK now.

On Mon, Aug 29, 2011 at 11:32 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> NOTE! The casting is dubious. We only have a single OP_FPCAST, for
> example, and that's just broken. Right now "OP_FPCAST" means that the
> *source* was a FP value. But if we cast *to* a FP value, it ends up
> showing up as OP_[S]CAST, which is just bogus. The FPCAST should be
> for any FP operation (to or from or both), and then the FPCAST logic
> would have to decide how it handles it.
>
> The FP support in general is pretty weak. The kernel doesn't do FP, I
> never really cared about it.

Good to know. I've added support for simple FP ops though and they
seem to be fine.

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Lucky Winner! ===

From: <tyder13 () cox ! net>
To: linux-sparse
Subject: Lucky Winner!
Date: Tue, 01 Feb 2011 01:42:37 +0000
Message-ID: <20110131204237.17XWR.1067459.imail () fed1rmwml34>
--------------------
You have been awarded ÃÂ£850,000 from the OXFAM GB - UK 
the cash/grant donation Promo for Global Economic Scheme.
For claims, Contact Dr. Ben Andrew. 
via e-mail

Name:
Country:
Age:
Phone Number:
Gender:
Occupation:
Your Qualification Number (OG/N231/E101/BDB) 

 (oxfam003@aol.com)
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Novafora relicenses Transmeta sparse copyrights under the MIT ===

From: Alexey Zaytsev <alexey.zaytsev () gmail ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT
Date: Wed, 15 Apr 2009 12:25:56 +0000
Message-ID: <f19298770904150525w65e3b04cqe02afc9284eeb559 () mail ! gmail ! com>
--------------------
On Wed, Apr 15, 2009 at 04:06, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
>
> On Tue, 14 Apr 2009, H. Peter Anvin wrote:
>>
>> Novafora has agreed to relicense the copyrights in sparse that were previously
>> owned by Transmeta (i.e. the work Linus did before 2003-07-01) under the MIT
>> license.
>>
>> Git repository:
>>
>> http://git.kernel.org/?p=devel/sparse/novafora/sparse.git;a=summary

Excellent news. Congratulations to everyone and special thanks
to Peter and Robert.

Now, should all the contributors jump in and state their consent with
the relicensing? If so, for my modest contributions, you have it. While
personally preferring LGPL, I'm also ok with MIT.

>
> That commit is also merged into my copy of sparse at
>
> Â  Â  Â  Â http://git.kernel.org/?p=linux/kernel/git/torvalds/sparse.git;a=summary

You might already know, but just in case, there is a new sparse development
tree with some recent commits:

http://git.kernel.org/?p=devel/sparse/chrisl/sparse.git;a=summary

It probably should become the new official tree, if Josh and Christopher
do not mind.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT
Date: Fri, 17 Apr 2009 10:16:22 +0000
Message-ID: <70318cbf0904170316v290edcfag2ac62a15a7254259 () mail ! gmail ! com>
--------------------
On Wed, Apr 15, 2009 at 5:25 AM, Alexey Zaytsev
<alexey.zaytsev@gmail.com> wrote:
> On Wed, Apr 15, 2009 at 04:06, Linus Torvalds
> Excellent news. Congratulations to everyone and special thanks
> to Peter and Robert.
>
> Now, should all the contributors jump in and state their consent with
> the relicensing? If so, for my modest contributions, you have it. While
> personally preferring LGPL, I'm also ok with MIT.

Great news. I am fine with LGPL or MIT license.

> It probably should become the new official tree, if Josh and Christopher
> do not mind.

I think probably best let Josh decide what to do with it. He can pull from
my tree if he want. Either way I will keep doing what I am doing. There is not
much traffic on sparse any way. Al Viro makes most of the heavy
lifting now days.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Novafora relicenses Transmeta sparse copyrights under the MIT license ===

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Tue, 14 Apr 2009 22:49:52 +0000
Message-ID: <49E51310.3050005 () zytor ! com>
--------------------
Hi all,

I just received a git tree from Robert Bedichek, VP of Engineering at 
Novafora Corporation, which bought Transmeta Corporation earlier this year.

Novafora has agreed to relicense the copyrights in sparse that were 
previously owned by Transmeta (i.e. the work Linus did before 
2003-07-01) under the MIT license.

Git repository:

http://git.kernel.org/?p=devel/sparse/novafora/sparse.git;a=summary

Specific commit:

http://git.kernel.org/?p=devel/sparse/novafora/sparse.git;a=commitdiff;h=23525c14bc263d70165fedf469d35cdb31b0ac35

Thanks to Novafora, and special thanks to Robert for putting up with a 
couple of snafus over the course of this.  From start to finish, this 
took over half a year to actually make happen.

	-hpa
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Wed, 09 Feb 2011 19:41:51 +0000
Message-ID: <AANLkTim3MRfHFRWqx2NuvpXrZ2MCoWwkyzX58tF-Paq6 () mail ! gmail ! com>
--------------------
I really would like to relicense Smatch.  Probably to GPL v2 or
higher.  What's the status of the Sparse relicensing?  Is anyone
working on this?  Should I start emailing people to get individual
sign-offs on using the MIT license?

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Wed, 09 Feb 2011 20:05:19 +0000
Message-ID: <c00d7ac4-b44b-48b1-a844-31357a2b70ba () email ! android ! com>
--------------------
It happened years ago.

"Dan Carpenter" <error27@gmail.com> wrote:

>I really would like to relicense Smatch.  Probably to GPL v2 or
>higher.  What's the status of the Sparse relicensing?  Is anyone
>working on this?  Should I start emailing people to get individual
>sign-offs on using the MIT license?
>
>regards,
>dan carpenter

-- 
Sent from my mobile phone.  Please pardon any lack of formatting.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Wed, 09 Feb 2011 20:06:22 +0000
Message-ID: <d1d2510a-b610-4d7d-a171-35a52d57acfc () email ! android ! com>
--------------------
Oh, you mean other contributors...

"Dan Carpenter" <error27@gmail.com> wrote:

>I really would like to relicense Smatch.  Probably to GPL v2 or
>higher.  What's the status of the Sparse relicensing?  Is anyone
>working on this?  Should I start emailing people to get individual
>sign-offs on using the MIT license?
>
>regards,
>dan carpenter

-- 
Sent from my mobile phone.  Please pardon any lack of formatting.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Schrober <franzschrober () yahoo ! de>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Wed, 06 Nov 2013 16:14:26 +0000
Message-ID: <1557645.KYkK99zUUy () bentobox>
--------------------
On Tuesday 14 April 2009 15:49:52 H. Peter Anvin wrote:
> Hi all,
> 
> I just received a git tree from Robert Bedichek, VP of Engineering at
> Novafora Corporation, which bought Transmeta Corporation earlier this year.
> 
> Novafora has agreed to relicense the copyrights in sparse that were
> previously owned by Transmeta (i.e. the work Linus did before
> 2003-07-01) under the MIT license.
> 
> Git repository:
> 
> http://git.kernel.org/?p=devel/sparse/novafora/sparse.git;a=summary
> 
> Specific commit:
> 
> http://git.kernel.org/?p=devel/sparse/novafora/sparse.git;a=commitdiff;h=235
> 25c14bc263d70165fedf469d35cdb31b0ac35

Does anyone still has this version? I cannot find it in the three sparse repos
[1,2,3] on git.kernel.org.

[1] https://git.kernel.org/cgit/devel/sparse/chrisl/sparse.git/commit/?id=23525c14bc263d70165fedf469d35cdb31b0ac35
[2] https://git.kernel.org/cgit/devel/sparse/sparse.git/commit/?id=23525c14bc263d70165fedf469d35cdb31b0ac35
[3] https://git.kernel.org/cgit/linux/kernel/git/viro/sparse.git/commit/?id=23525c14bc263d70165fedf469d35cdb31b0ac35
-- 
Franz Schrober
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Wed, 06 Nov 2013 17:16:58 +0000
Message-ID: <527A798A.2010002 () zytor ! com>
--------------------
On 11/06/2013 08:14 AM, Schrober wrote:
> 
> Does anyone still has this version? I cannot find it in the three sparse repos
> [1,2,3] on git.kernel.org.
> 
> [1] https://git.kernel.org/cgit/devel/sparse/chrisl/sparse.git/commit/?id=23525c14bc263d70165fedf469d35cdb31b0ac35
> [2] https://git.kernel.org/cgit/devel/sparse/sparse.git/commit/?id=23525c14bc263d70165fedf469d35cdb31b0ac35
> [3] https://git.kernel.org/cgit/linux/kernel/git/viro/sparse.git/commit/?id=23525c14bc263d70165fedf469d35cdb31b0ac35
> 

I have a copy; I have uploaded it to:

http://git.zytor.com/?p=users/hpa/sparse/sparse.git;a=commitdiff;h=23525c14bc263d70165fedf469d35cdb31b0ac35

It would be good if someone would not only pull this but merge it into
the master branch of the main sparse repo.

	-hpa

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Schrober <franzschrober () yahoo ! de>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Thu, 07 Nov 2013 09:46:45 +0000
Message-ID: <1778650.2HXIBSXfmv () bentobox>
--------------------
This is a multi-part message in MIME format.

--nextPart2650447.zdTZMrryiP
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain; charset="iso-8859-1"

On Wednesday 06 November 2013 11:40:29 Christopher Li wrote:
> On Wed, Nov 6, 2013 at 9:16 AM, H. Peter Anvin <hpa@zytor.com> wrote:=

> > I have a copy; I have uploaded it to:
> >=20
> > http://git.zytor.com/?p=3Dusers/hpa/sparse/sparse.git;a=3Dcommitdif=
f;h=3D23525c1
> > 4bc263d70165fedf469d35cdb31b0ac35
> >=20
> > It would be good if someone would not only pull this but merge it i=
nto
> > the master branch of the main sparse repo.
>=20
> Good idea. Let me do that.

Would be nice when you would do that or at least add a "relicense" bran=
ch to
have it available for the relicensing process.

The following Authors may have to be asked for their aggreement to reli=
cense
their work under the MIT license. The data is gathered by checking the =
author
field between
1bcc92138dcdf718dc3e0c694565f56e669d6ee3..1c1a74106ea78f624105be6a9bb5d=
24268f38d91
(chrisl's sparse repo). At least I understood the idea behind this thre=
ad so [1].

Adam DiCarlo <bikko@us.ibm.com>
Alberto Bertogli <albertito@blitiri.com.ar>, <albertito@gmail.com>
Alecs King <alecsk@gmail.com>
Alexander Shishkin <alexander.shishckin@gmail.com>
Alexander Viro <viro@parcelfarce.linux.theplanet.co.uk>, <viro@www.linu=
x.org.uk>
Alexey Dobriyan <adobriyan@gmail.com>, <adobriyan@mail.ru>
Al Viro <viro@ftp.linux.org.uk>, <viro@zeniv.linux.org.uk>, <viro@ZenIV=
.linux.org.uk>
Andries E. Brouwer <Andries.Brouwer@cwi.nl>
Arnaldo Carvalho de Melo <acme@conectiva.com.br>, <acme@ghostprotocols.=
net>, <acme@parisc.kerneljanitors.org>
Atsushi Nemoto <anemo@mba.ocn.ne.jp>
Benjamin Herrenschmidt <benh@kernel.crashing.org>
Ben Pfaff <blp@nicira.com>
Bernd Petrovitsch <bernd@sysprog.at>
Bernhard Fischer <berny.f@aon.at>
Blue Swirl <blauwirbel@gmail.com>
Chris Wedgwood <cw@f00f.org>
Damien Lespiau <damien.lespiau@gmail.com>
Dan Carpenter <error27@gmail.com>
Daniel De Graaf <danieldegraaf@gmail.com>
Dan McGee <dan@archlinux.org>
Dan Sheridan <djs@postman.org.uk>
Dave Jones <davej@redhat.com>
Dave Olien <dmo@osdl.org>
David Mosberger <davidm@napali.hpl.hp.com>
David S. Miller <davem@redhat.com>
Diego Elio Petten=F2 <flameeyes@gmail.com>
Emil Medve <Emilian.Medve@Freescale.com>
Ethan Jackson <ethan@nicira.com>
Florian Fainelli <f.fainelli@gmail.com>
Frederic Crozat <fcrozat@suse.com>
fzago@systemfabricworks.com <fzago@systemfabricworks.com>
Geoff Johnstone <geoff.johnstone@googlemail.com>
Hannes Eder <hannes@hanneseder.net>
James Westby <jw+debian@jameswestby.net>
Jan Pokorn=FD <pokorny_jan@seznam.cz>
Jeff Garzik <jeff@garzik.org>, <jgarzik@pobox.com>, <jgarzik@redhat.com=
>, <jlayton@redhat.com>
Jiri Slaby <jslaby@suse.cz>
Joel Soete <rubisher@scarlet.be>
Joe Perches <joe@perches.com>
Johannes Berg <johannes@sipsolutions.net>
Jonathan Neusch=E4fer <j.neuschaefer@gmx.net>
Kamil Dudka <kdudka@redhat.com>
Kim Phillips <kim.phillips@freescale.com>
KOSAKI Motohiro <kosaki.motohiro@gmail.com>
Kovarththanan Rajaratnam <krj@rajaratnam.dk>
Luc Van Oostenryck <lkml@looxix.net>, <luc.vanoostenryck@looxix.net>
Martin Nagy <nagy.martin@gmail.com>
Masatake YAMATO <yamato@redhat.com>
Mauro Dreissig <mukadr@gmail.com>
Michael Buesch <mb@bu3sch.de>
Michael Stefaniuc <mstefani@redhat.com>, <mstefaniuc@gmail.com>
Michael S. Tsirkin <mst@mellanox.co.il>
Mika Kukkonen <mikukkon@gmail.com>
Mike Frysinger <vapier.adi@gmail.com>, <vapier@gentoo.org>
Mitesh Shah <mshah@teja.com>
Morten Welinder <mortenw@gnome.org>
Morten Welinder <terra@gnome.org>
mshah@teja.com <mshah@teja.com>
Namhyung Kim <namhyung@gmail.com>
Nicolas Kaiser <nikai@nikai.net>
Oleg Nesterov <oleg@tv-sign.ru>
Pavel Roskin <proski@gnu.org>
Pekka Enberg <penberg@cs.helsinki.fi>, <penberg@kernel.org>
Peter Jones <pjones@redhat.com>
pj@ludd.ltu.se <pj@ludd.ltu.se>
Ralf.Wildenhues@gmx.de <Ralf.Wildenhues@gmx.de>
Ramsay Jones <ramsay@ramsay1.demon.co.uk>
Randy Dunlap <randy.dunlap@oracle.com>, <rdunlap@infradead.org>
Reinhard Tartler <siretart@tauware.de>
ricknu-0@student.ltu.se <ricknu-0@student.ltu.se>
rmps@joel.ist.utl.pt <rmps@joel.ist.utl.pt>
Rob Taylor <rob.taylor@codethink.co.uk>
Sam Ravnborg <sam@ravnborg.org>
Samuel Bronson <naesten@gmail.com>
santtu.hyrkko@gmail.com <santtu.hyrkko@gmail.com>
Shakthi Kannan <shakthimaan@gmail.com>
Stephen Hemminger <shemminger@osdl.org>
terra@gnome.org <terra@gnome.org>
Thomas Schmid <Thomas.Schmid@br-automation.com>
Tilman Sauerbeck <tilman@code-monkey.de>
Vegard Nossum <vegardno@ifi.uio.no>
viro@ZenIV.linux.org.uk <viro@ZenIV.linux.org.uk>
welinder@anemone.rentec.com <welinder@anemone.rentec.com>, <welinder@da=
rter.rentec.com>, <welinder@troll.com>
Xi Wang <xi.wang@gmail.com>
Yura Pakhuchiy <pakhuchiy@gmail.com>

Already aggreed:

Linus Torvalds <torvalds@evo.osdl.org>, <torvalds@g5.osdl.org>, <torval=
ds@home.osdl.org>, <torvalds@linux-foundation.org>, <torvalds@newtove.o=
sdl.org>, <torvalds@ppc970.osdl.org>, <torvalds@tove.osdl.org>, <torval=
ds@woody.linux-foundation.org>
 * http://article.gmane.org/gmane.comp.parsers.sparse/1800
Alexey Zaytsev <alexey.zaytsev@gmail.com>
 * http://article.gmane.org/gmane.comp.parsers.sparse/1801
Christopher Li <chrisl@vmware.com>, <sparse@chrisli.org>
 * http://article.gmane.org/gmane.comp.parsers.sparse/1803
David Given <dg@cowlark.com>
 * http://article.gmane.org/gmane.comp.parsers.sparse/1802
Josh Triplett <josh@freedesktop.org>, <josh@joshtriplett.org>, <josh@ke=
rnel.org>, <josht@us.ibm.com>, <josht@vnet.ibm.com>
 * (semi) http://article.gmane.org/gmane.comp.parsers.sparse/1879

Some of them may not have be really asked because their contributions i=
s not
copyrightable. But having their consent is still prefered.

Can Dan Carpenter sync his list and let us know what the state of the
relicense agreement gathering [2] is?

[1] http://thread.gmane.org/gmane.comp.parsers.sparse/1799
[2] http://thread.gmane.org/gmane.comp.parsers.sparse/2499
--=20
Franz Schrober
--nextPart2650447.zdTZMrryiP
Content-Disposition: attachment; filename="relicense.bundle"
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="UTF-8"; name="relicense.bundle"

IyB2MiBnaXQgYnVuZGxlCi0xYmNjOTIxMzhkY2RmNzE4ZGMzZTBjNjk0NTY1ZjU2ZTY2OWQ2ZWUz
IERvIGEgcHJvcGVyIHNjb3BlIGFsbG9jYXRvciwgZG9uJ3QgdXNlIHRoZSAiYnl0ZXMiIGFsbG9j
YXRvciB0aGF0IGRvZXNuJ3QgaGF2ZSBhbnkgYWxpZ25tZW50IGd1YXJhbnRlZXMuCjIzNTI1YzE0
YmMyNjNkNzAxNjVmZWRmNDY5ZDM1Y2RiMzFiMGFjMzUgcmVmcy9oZWFkcy9saWNlbnNlCgpQQUNL
AAAAAgAAAAOdHHicpZDBSsUwEEX3+YpZ6qIlbdq0ERHR1RMUkfcDyWTSFl+TkqZK/94snoq4EVzN
cOdyZu6kSASN67nkCq2pOXeilZyquul7ThaRY905axrsG7boSD5BZRBVXYneonVdlYsgjlI1rWxd
K0lKZSWRYHpLY4jwEgzFBHdkJxzpFa6jObe3PrxpF6IuMcw3UNVCdULJtoeCd5yzrM5TSvQfBns6
z+E0IfmVYIg6p9jWyQ/weDh+6uVv6wqHZ8jCTPG0Q3j3ZMHscMyAdaak4T7EJfvTFDxs3uZD00g/
oAAXX9RlizjqNUO+CQ/abzpmuIP8fVVeMrZOQ15UBOcKs1/9OTr7ALAImCj7DjrxC3/3bNytuAHD
6itOCb/urgx6eJybzD6Z3d3QwMDMxETBzTGQwfXUk7eL7mSbFLxerin/+a9YK9MCK6i0j6ezq1+w
K4PGqr7wg/3/VwrfiFOY/qXklrXCuZtgJRPdlRlNJmYrAoleJSCxQRVIXFMHEv+AxGQ1RqD0ZC9G
BSCZDSZ7GNWA5GZGoOLJ18DkT0YNIKnEBGK7gskMJpDeCUwgvVvA5A0w+YcJpFKVWRNI+jMrKQEd
WJKfnZqXWZWql8xQ3ce4ueZlX+D2g1OPv1r0YWrhZ/4YAB5EThDwaJmhK1w5OPeO0UmXu7djMnBl
33CVeJxtVU1v2zgQPS//wwKDnNpCiPPReNe9KTYds5UlQ5KTzZGWxhYbWTRIKkZO+hH7R/a/9dBr
h7KdTRYLCBZEct5782aG/rH8uepYrJ/lWhsJY2129HZKNwHYtijQWm1ANfQ4NGgdOA25kY3dont/
nlV0YPUCtSqwsWhBNi9Au37Tgl6DqxB2Rm+M3MKZ3Ulj8SwACd0YLG5l41TB+lUTAKmBfaWKqo8q
9O7FqE3lKB6flW5t/QJ7aaHCugTifFXE3igiAeURZE/SfKzFxvlsigqLJ9Wwy1VRjLqry+s/y6Jc
/3FJr2u8KIajzzfDm/XNEIfDUTlEvIa9chUBgmxdRdqc2pIZcruDUjpklN3XtkG4+hzA1cXF9Snd
jXJgcKetctq8gHSMVr4MBvR7/oSmwfpcm24z2LWrgS22gxKfsR4cvDm+zj0GpWrQGUXbJeiGzaWh
rC57slEAbVOi6QnXuq71XjWbUxm+MLLk5N6H4uNB3rsK/nYyjP09+vR7R+YbRJ9BUUmzwcCXvK8l
Gkuu6pWTqvEUkvnCHHJVFqxeu70ko73vkhqnUORNCaUu2i0ZfyjKWtXUGx9ILDvLjhFnH3uSEmUN
HZXHZ3La653XrffRkgPFoTdVU9RtSSLYabtWW3Wk8OF9wtajtpZS8EID2OpSrf0b+7zI9VrZKmCl
8tCr1tFiZ/1q713gMxlQtS3WtYdQ+NrIJ3n9GaJh5A4JOJrUE+8rvX2fCpm0bk1DnFj2CWsyzQ/a
6jsWfrSYq7q3RSx0U6p+gKiOOUHJlX5+Ow+Npqk5ON7XoFdhrXfhuGUrSeJXeLQMS0YGyzf5GM9P
vUzzR/bvuv9M7En8OQmYcciSaf4QphxEBos0uRcTPoGzMKNvGuYHkc+SZQ50Ig3j/BGSKYTxI3wT
8SQA/tci5VnGkhTEfBEJTmsiHkfLiYjv4Jbi4iTvIBJzkRNqnoBnPGIJnhEam/N0PKPP8FZEIn8M
YCrymEBhSqghLMI0F+NlFKawWKaLJOPEPyHcWMTTlGj4nMf5ORMxrQG/pw/IZmEU9VThMp91SUpE
KYyTxWMq7mY5zJJowmnxlpO08DbiB674kY2jUMwDmITz8I73UQnBpP2xo7yHGe+XiDCkZ5yLJPau
jJM4T+kzYHmS5q+hD6LLeABhKjLvyTRNCN87SiFJj0KBMT/AeLe9bvZaFDri81hm/F8xEx5GhJX5
4LcVpIKyVK/QOLjFkm5JfGL3qviOsKBRU6W/KqkHeLNRDaLxs/Z//xMso1vxq/bTMg5ZuDOqhsvD
NThih6bV1Kuqoebys3/sbt/Q//z49AveqiX5Y/8V+/6zK+nhjbNYS8SlqUvYsfk=

--nextPart2650447.zdTZMrryiP--

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Thu, 07 Nov 2013 10:01:59 +0000
Message-ID: <20131107100159.GT26669 () mwanda>
--------------------
Thanks for doing this.  A lot of those I have already.  Let me send you
what I have so far later today.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Michael Stefaniuc <mstefani () redhat ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Thu, 07 Nov 2013 11:04:12 +0000
Message-ID: <527B73AC.7090005 () redhat ! com>
--------------------
On 11/07/2013 11:01 AM, Dan Carpenter wrote:
> Thanks for doing this.  A lot of those I have already.  Let me send you
> what I have so far later today.
Actually I remember to have seen this exercise before.

Afair I have already given my consent before even though most likely my
changes aren't substantial to count.

bye
	michael
-- 
Michael Stefaniuc                           Tel.: +49-711-96437-199
Supervisor, APAC/EMEA IT Network            Fax.: +49-711-96437-111
--------------------------------------------------------------------
Reg. Adresse: Red Hat GmbH, Werner-von-Siemens-Ring 14, 85630 Grasbrunn
Handelsregister: Amtsgericht Muenchen HRB 153243
GeschÃ¤ftsfÃ¼hrer: Mark Hegarty, Charlie Peters, Michael Cunningham,
                 Charles Cachera
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Randy Dunlap <rdunlap () infradead ! org>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Thu, 07 Nov 2013 16:18:40 +0000
Message-ID: <527BBD60.3020503 () infradead ! org>
--------------------
On 11/07/13 01:46, Schrober wrote:
> On Wednesday 06 November 2013 11:40:29 Christopher Li wrote:
>> On Wed, Nov 6, 2013 at 9:16 AM, H. Peter Anvin <hpa@zytor.com> wrote:
>>> I have a copy; I have uploaded it to:
>>>
>>> http://git.zytor.com/?p=users/hpa/sparse/sparse.git;a=commitdiff;h=23525c1
>>> 4bc263d70165fedf469d35cdb31b0ac35
>>>
>>> It would be good if someone would not only pull this but merge it into
>>> the master branch of the main sparse repo.
>>
>> Good idea. Let me do that.
> 
> Would be nice when you would do that or at least add a "relicense" branch to
> have it available for the relicensing process.
> 
> The following Authors may have to be asked for their aggreement to relicense
> their work under the MIT license. The data is gathered by checking the author
> field between
> 1bcc92138dcdf718dc3e0c694565f56e669d6ee3..1c1a74106ea78f624105be6a9bb5d24268f38d91
> (chrisl's sparse repo). At least I understood the idea behind this thread so [1].
>
> Randy Dunlap <randy.dunlap@oracle.com>

I agree to relicense under the MIT license.

thanks,
-- 
~Randy
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Schrober <franzschrober () yahoo ! de>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Fri, 08 Nov 2013 16:13:08 +0000
Message-ID: <5578017.bROrmTJuHL () bentobox>
--------------------
On Friday 08 November 2013 00:24:15 Dan Carpenter wrote:
> I have attached a tar ball of people who agreed to the relicense.
> 
> It's really late here so I can help you go through it tomorrow if you
> have any questions.

Sorry your mail ended up inside the spam folder and I've only monitored the 
mailing list [1] for your mail.

The people which need extra work to get their changes relicensed under the MIT 
are

 * Adam DiCarlo <bikko@us.ibm.com>
   minor enhancement 8ea2cc615de7546d057fe0ed8ab2f7af278e6b2c
 * Benjamin Herrenschmidt <benh@kernel.crashing.org>
   minor bugfix 9c2ffd7b21e8e880243eaec40e9dbc66651b085c
 * Chris Wedgwood <cw@f00f.org>
   minor bugfixes 8fae62236344076f8f0113ed21bedaf45ccec43d
    dc4240e8b621ada294409782128e6d393b622cd1
 * Ethan Jackson <ethan@nicira.com>
   minor fix b0b4886be5f668959b8c75c9c811059e07b1073a
 * Frederic Crozat <fcrozat@suse.com>
   minor addition 8ab3b11aa5cf9f68e374fc297d4f285a65e706a1
 * James Westby <jw+debian@jameswestby.net>
   minor fixes 34ac7df96dd9609d684b0c949a52bc07ab1fd8b5
    006eff06c7adcfb0d06c6fadf6e9b64f0488b2bf
 * Jan Pokorný <pokorny_jan@seznam.cz>
   minor fixes 955cd225d2e3ee708e20de825eca82c8797897fd
    695dd9d068dd2316b92706d174df9e30c1e71dcf
   minor cleanups 05e666547ee05acadf7fed2d1fc9967c27739e9a
    7988e483ef47abb97004d7fb7f72b7037aa06bb6
    0c7d6bffbccead5fdf0897d575b12e389496c9d7
    b21baf0cce7b2a6c949577952dd159f1c9357d6b
 * Joe Perches <joe@perches.com>
   add of --version bcdb5ee5a83fbe2779cc6e49ab1fa87c50a20805
 * Kim Phillips <kim.phillips@freescale.com>
   minor fix 8e42bac6efcb047a2b3d812e42c00f82e3b8a984
 * KOSAKI Motohiro <kosaki.motohiro@gmail.com>
   minor fixes 0a04210cc856267d8371592dc55f8b8bb7596ecc
    2313167a83c397e8acc14d10706a7235f60fc497
 * Kovarththanan Rajaratnam <krj@rajaratnam.dk>
   minor fix ed450b3079832a4c92d0ba2110e4e9efd35ed339
 * Luc Van Oostenryck <lkml@looxix.net>, <luc.vanoostenryck@looxix.net>
   minor fixes 98346fe1671f052d4b2c7b36229235c64bb31a32
    aa163fa6869f050cd157afef23b82cc3bc14cb61
    269bcb9b9334057928d9c6eebd8555c88ebd3f2d
    0947976f74810d492fea90a4ddcd0f2d36ded535
    3ff22243cbc38719ab16d8c1f25605892337012b
    2cec905cb5d11e5b3a928f1038788d7c23a1cc33
    409eab7c1a8f1bd76d2a56428d01ad9d5938fb14
    fbaf5e4bc98b95d9350495a51bc89e4e7dddba4c
    e2559ab1f5d44c4708c60ff8cae240a854b56d34
    0feb9170ed4aad6a2c54f2850eb3d845cde77845
    d225b6dbdd931411ffb4bbf96ea2567ce572a9c4
    260a278aefde836683ea9a7e68f3983030338f39
    fafb86f96d323c9b23e8519987adc195e031f456
    faa939b386004bdb1c2aaf277f6fb7ac333f89d3
    98346fe1671f052d4b2c7b36229235c64bb31a32
    3ce2538d18c6bad49bc1acfbe41375fc54f3e0ad
    4cebb70b009aa80b63115c6bbae7428bcf17b652
    5213bc46472b1181aa6111b5d4814a0fbca69282
   rewrite 6690a7f7a4fbd4cd606e01b7feef678058cf4635
   add 4c520e1ad243ed347dfc0e1f8c6e3dec19994f42
    ca682df2d73399c4d24d4400cc1a06c9dfc79477
 * Masatake YAMATO <yamato@redhat.com>
   minor addition 3b1e38c703f8a3daea26b7d201442d8e74bbe199
    92c321cfd154a328d3bf0ce0e8b325cf1f70b1d0
    c3430e57bc57ff40d5ce95ef2d26b8d70346f58f
 * Mauro Dreissig <mukadr@gmail.com>
   minor fix 7a1da692083c1d9d2e604df89ed553fd2ede9907
 * Peter Jones <pjones@redhat.com>
   minor fix ce4b69f9e7878a7c7041b5f9cee587ed0d82e8cf
 * Peter A Jonsson <pj@ludd.ltu.se>
   minor fix fd59b219733d711b36ac70038fcb7496e4501920
 * Richard Knutsson <ricknu-0@student.ltu.se>
   minor refactoring cd4288f195f11f6c0a78bca03db009a0494da7cc
    318447b069ba9e9a403ca764be7e3924d2121142
    5b0858930b6a1097dbda6ceef6764070a73fd923
   minor fix 58af88c40f307476ffa482ed16b5e0586fea1b6f
 * rmps@joel.ist.utl.pt <rmps@joel.ist.utl.pt>
   minor fix 6f593900adbe226fbf55d5095d20e15c8fbc2304
 * Santtu Hyrkk,Av(B <santtu.hyrkko@gmail.com>
   minor fix 0c62759dd20ef959b01679413b475a9b5e226e4e
 * Shakthi Kannan <shakthimaan@gmail.com>
   manpage additions 970d7169d75068146152ba01a66381c800dbeb71
 * Xi Wang <xi.wang@gmail.com>
   minor fixes c0296d71405a97349d82e9909cad82a2af3271c2
    99bdda1a38a6e3622cb72f422b2fb05045c29df7
    469e5d6ea3353fb3039747f52fb506c9ba983d8b
    317876877c7c818c5cfd69da7bb45174b6ddadd4
    5b950a99d4a81db8581741def3ea6acf05b0b493
    4858eafe71ea9cd6e61a8ee2883e2cde28430f20
    bf6b5e73f4884270eb14dace0ba3598b9dc61b24
    0830fefd080cb921e89e4dae847803f3ed6efdd4
    f79914429cb466d1085a2a6204b38101ca75c608
    652eb801d2141b57dca3215e71c55e8356b407a2
    afa3245c069c532f3a88bf0053113c54480a1c1d
    4c982e9d3c6827afb529c7c7ce7fbe987eac24c6
  larger additions/fixes(?) 08d9fbaeda48e20a76206d550ac5ab5b2c60d99e
   e33b721d954a0c59ca1c09e75ec0657e0c3e0391
   b17550b274916fc5a4b6f89a3f95572e6f9bce7f
   0448f78f5fae84b8a9c1358129a03ea24e593b34
   64a6b4c61faa23c40a402656d044141a669965a3

Please keep in mind that the minor just says "propably not copyrightable" and 
not "nobody cares about this contribution". Every contribution is good.

The biggest "problem" seems to be Luc Van Oostenryck. Are we sure he is still 
alive? Because I have problems finding some working address for him. Maybe 
someone could try to contact him through linkedin or some other form.

[1] http://thread.gmane.org/gmane.comp.parsers.sparse/1799
-- 
Franz Schrober
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Frederic Crozat <fcrozat () suse ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Fri, 08 Nov 2013 16:21:20 +0000
Message-ID: <1383927680.2582.28.camel () par-r81vxc7 ! par ! novell ! com>
--------------------
Le vendredi 08 novembre 2013 Ã  17:13 +0100, Schrober a Ã©crit :
> On Friday 08 November 2013 00:24:15 Dan Carpenter wrote:
> > I have attached a tar ball of people who agreed to the relicense.
> > 
> > It's really late here so I can help you go through it tomorrow if you
> > have any questions.
> 
> Sorry your mail ended up inside the spam folder and I've only monitored the 
> mailing list [1] for your mail.
> 
> The people which need extra work to get their changes relicensed under the MIT 
> are
> 

<snip>

>  * Frederic Crozat <fcrozat@suse.com>
>    minor addition 8ab3b11aa5cf9f68e374fc297d4f285a65e706a1

I'm fine with the relicensing


-- 
Frederic Crozat <fcrozat@suse.com>
SUSE

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Fri, 08 Nov 2013 17:13:15 +0000
Message-ID: <CAOJsxLGWiZyuCd2UtL1NF1LydxMJZ122r1_kzkeakYFYpMmANg () mail ! gmail ! com>
--------------------
On Fri, Nov 8, 2013 at 6:13 PM, Schrober <franzschrober@yahoo.de> wrote:
>  * Xi Wang <xi.wang@gmail.com>
>    minor fixes c0296d71405a97349d82e9909cad82a2af3271c2
>     99bdda1a38a6e3622cb72f422b2fb05045c29df7
>     469e5d6ea3353fb3039747f52fb506c9ba983d8b
>     317876877c7c818c5cfd69da7bb45174b6ddadd4
>     5b950a99d4a81db8581741def3ea6acf05b0b493
>     4858eafe71ea9cd6e61a8ee2883e2cde28430f20
>     bf6b5e73f4884270eb14dace0ba3598b9dc61b24
>     0830fefd080cb921e89e4dae847803f3ed6efdd4
>     f79914429cb466d1085a2a6204b38101ca75c608
>     652eb801d2141b57dca3215e71c55e8356b407a2
>     afa3245c069c532f3a88bf0053113c54480a1c1d
>     4c982e9d3c6827afb529c7c7ce7fbe987eac24c6
>   larger additions/fixes(?) 08d9fbaeda48e20a76206d550ac5ab5b2c60d99e
>    e33b721d954a0c59ca1c09e75ec0657e0c3e0391
>    b17550b274916fc5a4b6f89a3f95572e6f9bce7f
>    0448f78f5fae84b8a9c1358129a03ea24e593b34
>    64a6b4c61faa23c40a402656d044141a669965a3

I assume most of those belong to Sparse/LLVM. Xi, any objections to
relicensing them under the MIT license?

                             Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Fri, 08 Nov 2013 17:27:40 +0000
Message-ID: <20131108172740.GW20521 () mwanda>
--------------------
Luc Van Oostenryck was Josh's summer of code student.  Josh volunteered
at Kernel Summit to try find him.  :)

Jan Pokorný agreed to the relicense.  I'll send that to you.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Fri, 08 Nov 2013 18:00:16 +0000
Message-ID: <20131108180016.GA16126 () mwanda>
--------------------
Actually it was Richard Knutsson who was the Summer of Code student.

I have messaged Luc Van Oostenryck on facebook.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Schrober <franzschrober () yahoo ! de>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Sat, 09 Nov 2013 08:23:08 +0000
Message-ID: <3115184.s67qhFfcDz () sven-desktop>
--------------------
On Friday 08 November 2013 17:13:08 Schrober wrote:
> The people which need extra work to get their changes relicensed under the
> MIT are

I have shortened the list to remove the persons which aggreed to a license 
change of sparse from the problematic OSL 1.1 to the MIT license. I've also 
added alternative mail addresses for people which changed their address

The biggest show stopper for a license change is Xi Wang <xi.wang@gmail.com>.

 * Adam DiCarlo <bikko@us.ibm.com> [alt: aph@debian.org,
    adam.dicarlo@gmail.com, adam@f2it.com]
   minor enhancement 8ea2cc615de7546d057fe0ed8ab2f7af278e6b2c
 * Benjamin Herrenschmidt <benh@kernel.crashing.org>
   minor bugfix 9c2ffd7b21e8e880243eaec40e9dbc66651b085c
 * Chris Wedgwood <cw@f00f.org>
   minor bugfixes 8fae62236344076f8f0113ed21bedaf45ccec43d
    dc4240e8b621ada294409782128e6d393b622cd1
 * Ethan Jackson <ethan@nicira.com>
   minor fix b0b4886be5f668959b8c75c9c811059e07b1073a
 * James Westby <jw+debian@jameswestby.net>
   minor fixes 34ac7df96dd9609d684b0c949a52bc07ab1fd8b5
    006eff06c7adcfb0d06c6fadf6e9b64f0488b2bf
 * Jan Pokorný <pokorny_jan@seznam.cz>
   minor fixes 955cd225d2e3ee708e20de825eca82c8797897fd
    695dd9d068dd2316b92706d174df9e30c1e71dcf
   minor cleanups 05e666547ee05acadf7fed2d1fc9967c27739e9a
    7988e483ef47abb97004d7fb7f72b7037aa06bb6
    0c7d6bffbccead5fdf0897d575b12e389496c9d7
    b21baf0cce7b2a6c949577952dd159f1c9357d6b
 * Joe Perches <joe@perches.com>
   add of --version bcdb5ee5a83fbe2779cc6e49ab1fa87c50a20805
 * Kim Phillips <kim.phillips@freescale.com>
   minor fix 8e42bac6efcb047a2b3d812e42c00f82e3b8a984
 * KOSAKI Motohiro <kosaki.motohiro@gmail.com>
   minor fixes 0a04210cc856267d8371592dc55f8b8bb7596ecc
    2313167a83c397e8acc14d10706a7235f60fc497
 * Kovarththanan Rajaratnam <krj@rajaratnam.dk>
    [alt: kovarththanan.rajaratnam@gmail.com]
   minor fix ed450b3079832a4c92d0ba2110e4e9efd35ed339
 * Masatake YAMATO <yamato@redhat.com>
   minor addition 3b1e38c703f8a3daea26b7d201442d8e74bbe199
    92c321cfd154a328d3bf0ce0e8b325cf1f70b1d0
    c3430e57bc57ff40d5ce95ef2d26b8d70346f58f
 * Mauro Dreissig <mukadr@gmail.com>
   minor fix 7a1da692083c1d9d2e604df89ed553fd2ede9907
 * Peter A Jonsson <pj@ludd.ltu.se>
   minor fix fd59b219733d711b36ac70038fcb7496e4501920
 * Richard Knutsson <ricknu-0@student.ltu.se>
   minor refactoring cd4288f195f11f6c0a78bca03db009a0494da7cc
    318447b069ba9e9a403ca764be7e3924d2121142
    5b0858930b6a1097dbda6ceef6764070a73fd923
   minor fix 58af88c40f307476ffa482ed16b5e0586fea1b6f
 * Rui Saraiva <rmps@joel.ist.utl.pt> [alt: rmps@mail.pt,
    rmps@digital.ist.utl.pt]
   minor fix 6f593900adbe226fbf55d5095d20e15c8fbc2304
 * Santtu Hyrkk,Av(B <santtu.hyrkko@gmail.com>
   minor fix 0c62759dd20ef959b01679413b475a9b5e226e4e
 * Shakthi Kannan <shakthimaan@gmail.com>
   manpage additions 970d7169d75068146152ba01a66381c800dbeb71
 * Xi Wang <xi.wang@gmail.com>
   minor fixes c0296d71405a97349d82e9909cad82a2af3271c2
    99bdda1a38a6e3622cb72f422b2fb05045c29df7
    469e5d6ea3353fb3039747f52fb506c9ba983d8b
    317876877c7c818c5cfd69da7bb45174b6ddadd4
    5b950a99d4a81db8581741def3ea6acf05b0b493
    4858eafe71ea9cd6e61a8ee2883e2cde28430f20
    bf6b5e73f4884270eb14dace0ba3598b9dc61b24
    0830fefd080cb921e89e4dae847803f3ed6efdd4
    f79914429cb466d1085a2a6204b38101ca75c608
    652eb801d2141b57dca3215e71c55e8356b407a2
    afa3245c069c532f3a88bf0053113c54480a1c1d
    4c982e9d3c6827afb529c7c7ce7fbe987eac24c6
  larger additions/fixes(?) 08d9fbaeda48e20a76206d550ac5ab5b2c60d99e
   e33b721d954a0c59ca1c09e75ec0657e0c3e0391
   b17550b274916fc5a4b6f89a3f95572e6f9bce7f
   0448f78f5fae84b8a9c1358129a03ea24e593b34
   64a6b4c61faa23c40a402656d044141a669965a3

> Please keep in mind that the minor just says "propably not copyrightable"
> and not "nobody cares about this contribution". Every contribution is good.

Already a big thanks to all the people which are helping to hopefully get this 
license change happening after so many years. And to everyone I've BCCed, 
please check whether you aggree to a license change and reply to this mail 
like the other people [2] who were asked.

[1] http://thread.gmane.org/gmane.comp.parsers.sparse/1799
[2] http://thread.gmane.org/gmane.comp.parsers.sparse/3466
--
Franz Schrober
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Sat, 09 Nov 2013 08:27:05 +0000
Message-ID: <1383985625.3081.0.camel () joe-AO722>
--------------------
On Sat, 2013-11-09 at 09:23 +0100, Schrober wrote:
>  * Joe Perches <joe@perches.com>
>    add of --version bcdb5ee5a83fbe2779cc6e49ab1fa87c50a20805

MIT license is fine with me.

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Adam DiCarlo <adam () bikko ! org>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Sat, 09 Nov 2013 19:42:30 +0000
Message-ID: <CA+Uhaid3JJjr2w-Qf2kKdmusb11JAUKipcy+AFtmCp_xpeJYBg () mail ! gmail ! com>
--------------------
Hello,

I agree with the license change.

My current emails: adam@bikko.org, adam.dicarlo@gmail.com

My former emails: bikko@us.ibm.com, adam@f2it.com

aph@debian.org is not me -- it's a different Adam Di Carlo.

Adam J. DiCarlo

On Sat, Nov 9, 2013 at 12:23 AM, Schrober <franzschrober@yahoo.de> wrote:
> On Friday 08 November 2013 17:13:08 Schrober wrote:
>> The people which need extra work to get their changes relicensed under the
>> MIT are
>
> I have shortened the list to remove the persons which aggreed to a license
> change of sparse from the problematic OSL 1.1 to the MIT license. I've also
> added alternative mail addresses for people which changed their address
>
> The biggest show stopper for a license change is Xi Wang <xi.wang@gmail.com>.
>
>  * Adam DiCarlo <bikko@us.ibm.com> [alt: aph@debian.org,
>     adam.dicarlo@gmail.com, adam@f2it.com]
>    minor enhancement 8ea2cc615de7546d057fe0ed8ab2f7af278e6b2c
>  * Benjamin Herrenschmidt <benh@kernel.crashing.org>
>    minor bugfix 9c2ffd7b21e8e880243eaec40e9dbc66651b085c
>  * Chris Wedgwood <cw@f00f.org>
>    minor bugfixes 8fae62236344076f8f0113ed21bedaf45ccec43d
>     dc4240e8b621ada294409782128e6d393b622cd1
>  * Ethan Jackson <ethan@nicira.com>
>    minor fix b0b4886be5f668959b8c75c9c811059e07b1073a
>  * James Westby <jw+debian@jameswestby.net>
>    minor fixes 34ac7df96dd9609d684b0c949a52bc07ab1fd8b5
>     006eff06c7adcfb0d06c6fadf6e9b64f0488b2bf
>  * Jan PokornÃ½ <pokorny_jan@seznam.cz>
>    minor fixes 955cd225d2e3ee708e20de825eca82c8797897fd
>     695dd9d068dd2316b92706d174df9e30c1e71dcf
>    minor cleanups 05e666547ee05acadf7fed2d1fc9967c27739e9a
>     7988e483ef47abb97004d7fb7f72b7037aa06bb6
>     0c7d6bffbccead5fdf0897d575b12e389496c9d7
>     b21baf0cce7b2a6c949577952dd159f1c9357d6b
>  * Joe Perches <joe@perches.com>
>    add of --version bcdb5ee5a83fbe2779cc6e49ab1fa87c50a20805
>  * Kim Phillips <kim.phillips@freescale.com>
>    minor fix 8e42bac6efcb047a2b3d812e42c00f82e3b8a984
>  * KOSAKI Motohiro <kosaki.motohiro@gmail.com>
>    minor fixes 0a04210cc856267d8371592dc55f8b8bb7596ecc
>     2313167a83c397e8acc14d10706a7235f60fc497
>  * Kovarththanan Rajaratnam <krj@rajaratnam.dk>
>     [alt: kovarththanan.rajaratnam@gmail.com]
>    minor fix ed450b3079832a4c92d0ba2110e4e9efd35ed339
>  * Masatake YAMATO <yamato@redhat.com>
>    minor addition 3b1e38c703f8a3daea26b7d201442d8e74bbe199
>     92c321cfd154a328d3bf0ce0e8b325cf1f70b1d0
>     c3430e57bc57ff40d5ce95ef2d26b8d70346f58f
>  * Mauro Dreissig <mukadr@gmail.com>
>    minor fix 7a1da692083c1d9d2e604df89ed553fd2ede9907
>  * Peter A Jonsson <pj@ludd.ltu.se>
>    minor fix fd59b219733d711b36ac70038fcb7496e4501920
>  * Richard Knutsson <ricknu-0@student.ltu.se>
>    minor refactoring cd4288f195f11f6c0a78bca03db009a0494da7cc
>     318447b069ba9e9a403ca764be7e3924d2121142
>     5b0858930b6a1097dbda6ceef6764070a73fd923
>    minor fix 58af88c40f307476ffa482ed16b5e0586fea1b6f
>  * Rui Saraiva <rmps@joel.ist.utl.pt> [alt: rmps@mail.pt,
>     rmps@digital.ist.utl.pt]
>    minor fix 6f593900adbe226fbf55d5095d20e15c8fbc2304
>  * Santtu Hyrkk ,Av (B <santtu.hyrkko@gmail.com>
>    minor fix 0c62759dd20ef959b01679413b475a9b5e226e4e
>  * Shakthi Kannan <shakthimaan@gmail.com>
>    manpage additions 970d7169d75068146152ba01a66381c800dbeb71
>  * Xi Wang <xi.wang@gmail.com>
>    minor fixes c0296d71405a97349d82e9909cad82a2af3271c2
>     99bdda1a38a6e3622cb72f422b2fb05045c29df7
>     469e5d6ea3353fb3039747f52fb506c9ba983d8b
>     317876877c7c818c5cfd69da7bb45174b6ddadd4
>     5b950a99d4a81db8581741def3ea6acf05b0b493
>     4858eafe71ea9cd6e61a8ee2883e2cde28430f20
>     bf6b5e73f4884270eb14dace0ba3598b9dc61b24
>     0830fefd080cb921e89e4dae847803f3ed6efdd4
>     f79914429cb466d1085a2a6204b38101ca75c608
>     652eb801d2141b57dca3215e71c55e8356b407a2
>     afa3245c069c532f3a88bf0053113c54480a1c1d
>     4c982e9d3c6827afb529c7c7ce7fbe987eac24c6
>   larger additions/fixes(?) 08d9fbaeda48e20a76206d550ac5ab5b2c60d99e
>    e33b721d954a0c59ca1c09e75ec0657e0c3e0391
>    b17550b274916fc5a4b6f89a3f95572e6f9bce7f
>    0448f78f5fae84b8a9c1358129a03ea24e593b34
>    64a6b4c61faa23c40a402656d044141a669965a3
>
>> Please keep in mind that the minor just says "propably not copyrightable"
>> and not "nobody cares about this contribution". Every contribution is good.
>
> Already a big thanks to all the people which are helping to hopefully get this
> license change happening after so many years. And to everyone I've BCCed,
> please check whether you aggree to a license change and reply to this mail
> like the other people [2] who were asked.
>
> [1] http://thread.gmane.org/gmane.comp.parsers.sparse/1799
> [2] http://thread.gmane.org/gmane.comp.parsers.sparse/3466
> --
> Franz Schrober
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Mon, 11 Nov 2013 03:58:51 +0000
Message-ID: <CANeU7Q==aAbytJQBz=xd7j-ca6ApRoq9k-8XcYC1dKpHHDu0xA () mail ! gmail ! com>
--------------------
Hi,

I receive reply from Xi Wang. He is fine with the MIT license change.
I quote his email here.

On Sun, Nov 10, 2013 at 6:51 PM, Xi Wang <xi.wang@gmail.com> wrote:
> Sure MIT license sounds good.  How/where
> should I ack the patches?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: =?ISO-8859-1?Q?Jan_Pokorn=FD?= <pokorny_jan () seznam ! cz>
To: linux-sparse
Subject: Re: Novafora relicenses Transmeta sparse copyrights under the MIT license
Date: Thu, 14 Nov 2013 23:33:52 +0000
Message-ID: <52855DE0.4090602 () seznam ! cz>
--------------------
On 11/08/2013 06:27 PM, Dan Carpenter wrote:
> Jan Pokorný agreed to the relicense.

That's it.

-- 
Jan
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: OP_CALL and function pointers ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: OP_CALL and function pointers
Date: Fri, 18 Nov 2011 12:42:17 +0000
Message-ID: <CAOJsxLFsLJaYNc4Q87o7tfmdZ9GZVVrCYs3Lyfh1gMc19VhLYQ () mail ! gmail ! com>
--------------------
On Fri, Nov 18, 2011 at 9:41 AM, Pekka Enberg <penberg@kernel.org> wrote:
>> I'm implementing support for function pointer calls and I noticed that
>> ->func->sym in 'strut instruction' is not SYM_NODE for function
>> pointers like it is for normal functions. Why is that?

On Fri, Nov 18, 2011 at 2:24 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> There *is* no real symbol to work with. It's an expression. The
> expression may not even be a symbol, it could easily be some real
> expression like
>
>      ret = (flag ? fn1 : fn2)(arg1, arg2);
>
> so trying to make up some "symbol" for it is just lying and crazy.

Aah, the current code by Jeff for OP_CALL makes perfect sense now. Thanks!

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: PICKUP YOUR $5000 USD VIA WESTERN UNION ===

From: UNITED NATIONS <tecnologias () ideay ! net ! ni>
To: linux-sparse
Subject: PICKUP YOUR $5000 USD VIA WESTERN UNION
Date: Thu, 24 Feb 2011 16:15:27 +0000
Message-ID: <1767946122.64261.1298564127130.JavaMail.root () mailbox ! ideay ! net ! ni>
--------------------


How are you?

We happily announce to you the draw of the United Nations programs held on the 30th January, 2011 in Nigeria. Your e-mail address attached to ticket number: 564 75600545 188. You have been compensated with the sum of  $500,000.00 USD and payment will be remitted to you via western union money transfer.


USD$5,000 has already be send to you since last week but we were unable to give you the information on phone for the past days but due to bad network here, So we decided to send you the details via email today.

Here is the western union information to pick up the USD5000.00.

MTCN : 782 543 4236 
SENDER'S NAME: MARYLIN JOHNSON 
TEXT QUESTION: IN GOD
ANSWER:WE TRUST 
AMOUNT SENT: $5000.00 USD
COUNTRY:NIGERIA

Thanks
Mrs. Linda Hall





--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Reduced call graph ===

From: Nguyen Thai Ngoc Duy <pclouds () gmail ! com>
To: linux-sparse
Subject: Reduced call graph
Date: Wed, 16 Nov 2011 13:23:57 +0000
Message-ID: <CACsJy8A2X0WukKXerJAN6pxARoGSh1O=8FM+iTZL-xzDCQ1W=w () mail ! gmail ! com>
--------------------
Hi,

Is it possible to ask "graph" to generate a call graph of all calls
from main() to specific function? If "graph" does not support it (I
suspect so after looking at graph.c), could you please give me a few
hints how to do it? I'm completely new to sparse.
-- 
Duy
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Reduced call graph
Date: Thu, 17 Nov 2011 22:12:21 +0000
Message-ID: <CANeU7Qns9GDx=XtiEzBph-3gq7WKX+uZMyVu7y3GETzAenFEVg () mail ! gmail ! com>
--------------------
On Wed, Nov 16, 2011 at 5:23 AM, Nguyen Thai Ngoc Duy <pclouds@gmail.com> wrote:
> Hi,
>
> Is it possible to ask "graph" to generate a call graph of all calls
> from main() to specific function? If "graph" does not support it (I
> suspect so after looking at graph.c), could you please give me a few
> hints how to do it? I'm completely new to sparse.

Hi Duy,

In order to find out all the call graphs, you need to at least run
very file in sparse. Then for each function, after linearization, you
can find out all the "call" instruction. A easier but not so precise
way is examine the "access" list in the entry point. That will
include every symbol rather than just function called.

e.g.

		struct entrypoint *ep;
		pseudo_t p;

		expand_symbol(sym);
		ep = linearize_symbol(sym);

		FOR_EACH_PTR(ep->accesses, p) {
			printf("   pseudo: %p type %d %s\n", p, p->type, show_pseudo(p));
		} END_FOR_EACH_PTR(p);

You just filter out the non-function symbols. However you need to write
some code to do that recursively.

Hope that helps.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Nguyen Thai Ngoc Duy <pclouds () gmail ! com>
To: linux-sparse
Subject: Re: Reduced call graph
Date: Fri, 18 Nov 2011 01:14:55 +0000
Message-ID: <CACsJy8BDYEx4-G2G-PEL3Q69pdBWwndE=Uyx5rV-pYPg570ZOA () mail ! gmail ! com>
--------------------
Hi,

On Fri, Nov 18, 2011 at 5:12 AM, Christopher Li <sparse@chrisli.org> wrote:
> In order to find out all the call graphs, you need to at least run
> very file in sparse. Then for each function, after linearization, you
> can find out all the "call" instruction. A easier but not so precise
> way is examine the "access" list in the entry point. That will
> include every symbol rather than just function called.
>
> e.g.
>
> Â  Â  Â  Â  Â  Â  Â  Â struct entrypoint *ep;
> Â  Â  Â  Â  Â  Â  Â  Â pseudo_t p;
>
> Â  Â  Â  Â  Â  Â  Â  Â expand_symbol(sym);
> Â  Â  Â  Â  Â  Â  Â  Â ep = linearize_symbol(sym);
>
> Â  Â  Â  Â  Â  Â  Â  Â FOR_EACH_PTR(ep->accesses, p) {
> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â printf(" Â  pseudo: %p type %d %s\n", p, p->type, show_pseudo(p));
> Â  Â  Â  Â  Â  Â  Â  Â } END_FOR_EACH_PTR(p);
>
> You just filter out the non-function symbols. However you need to write
> some code to do that recursively.

Thanks. Can I trace function callbacks too? I think it involves
keeping track of callbacks until they are called..
-- 
Duy
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Reduced call graph
Date: Fri, 18 Nov 2011 03:12:10 +0000
Message-ID: <CANeU7QnhCa5rdL4qgjiZKJdpHYzTrzEHEJDi+ytjchANcCa8Wg () mail ! gmail ! com>
--------------------
On Thu, Nov 17, 2011 at 5:14 PM, Nguyen Thai Ngoc Duy <pclouds@gmail.com> wrote:
>
> Thanks. Can I trace function callbacks too? I think it involves
> keeping track of callbacks until they are called..

Yes and no. You can enumerate the access list and find the
function pointer symbol. You can also find the instruction that
call to the function pointer.

However, that does not tell you want value is in that function
pointer. You need to do date flow analyze to find out the
value in the function pointer. In other words, exactly which function
it is call to. If the pointer is load from memory, it is very hard
to trace. That pointer value can be overwritten by any code.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse 0.4.4-rc1 ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Sparse 0.4.4-rc1
Date: Sat, 20 Aug 2011 22:59:36 +0000
Message-ID: <CANeU7QkxKZeaEDi_ZTOLDuSx+bP9xhOkmzbkOfvrGg1wZdWeFA () mail ! gmail ! com>
--------------------
It seems that my previous email get truncated.

It has been a long while since the last release. Mostly small
improvements. Noticeably the new gcc  build happier with
the new code.

The sparse project is the process of moving to the MIT license.
Thanks Dan for collecting the approvals.

So far we get most of the people sign off on the new license,
nobody objects yet. If you are the few people haven't reply
to the new license proposal, now it is a good time to do so.
Please reply to Dan off the list and Dan will aggregate the results.

Now, lets give the sparse code some test.

Chris

--

Ben Pfaff (1):
     evaluate: Allow sizeof(_Bool) to succeed.

Christopher Li (8):
     inspect: adding function arugument list
     Allow overwrite CFLAGS from command line
     Ignore attribute vector_size
     Remove set but not used variable
     inspect: Add switch statement and more
     validation: inline switch statement
     Fix inlining switch statement.
     Sparse 0.4.4-rc1

Diego Elio Pettenò (3):
     build: allow easy override of GCC_BASE
     build: add an all-installable target that builds the targets to install.
     Fix build with GCC 4.6 series.

Florian Fainelli (1):
     Makefile: warn user when libxml and/or libgtk2 are not available

Jan Pokorný (4):
     remove unused "container" macro
     flow.c: make comment for `dominates' reflect code
     use ARRAY_SIZE() when possible (continued)
     parse.c: "if(" -> "if (" adjustment

Jonathan Neuschäfer (1):
     fix a memory leak in compile-i386.c

Linus Torvalds (2):
     Add new streams to a hash-list based on their names
     Teach 'already_tokenized()' to use the stream name hash table

Namhyung Kim (3):
     use ARRAY_SIZE() when possible
     Fix tokenizer for octal escape sequences
     Update the validation check for escape sequences

Nicolas Kaiser (1):
     memops.c: always true expression

Pekka Enberg (1):
     sparse: Add 'artifical' to ignore attributes
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse 0.4.4-rc2 ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Sparse 0.4.4-rc2
Date: Mon, 29 Aug 2011 10:20:17 +0000
Message-ID: <4E5B67E1.80902 () chrisli ! org>
--------------------
Another week, another -rc.

It only has a small number of bug fix and enhancement
since the last rc, just the way I like it.
The finial release should be pretty close now.

Pekka Engerg announced an effort of adding llvm
to sparse back end. I am looking forward to merge
it after the finial release.

Chris

--

Christopher Li (3):
       Add test case for empty asm clobbers
       Fix parsing empty asm clobber
       Sparse 0.4.4-rc2

Jonathan Neuschäfer (2):
       FAQ: fix a typo ("because or")
       fix common misspellings with codespell

Kamil Dudka (2):
       cse: treat PHI-nodes as other instructions
       cse: update PHI users when throwing away an instruction

Linus Torvalds (3):
       Make 'linearize_iterator()' helper function
       Make 'linearize_switch()' helper function
       Make 'linearize_return()' helper function

Michael Stefaniuc (1):
       Ignore the ms_hook_prologue attribute.

Pekka Enberg (3):
       sparse: Enable unhandled validation tests
       Show expected vs. actual output on test failure
       sparse: Fix __builtin_safe_p for pure and const functions


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse at git.kernel.org ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Sparse at git.kernel.org
Date: Tue, 08 Nov 2011 07:16:54 +0000
Message-ID: <CAOJsxLF5opLkambUmDDk4fr0rMYNdU38p3duAZyXmG3mEXUa0Q () mail ! gmail ! com>
--------------------
Hi Chris,

When is sparse.git going to be back at git.kernel.org? Also, what are
your plans regarding merging the LLVM backend?

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Sparse at git.kernel.org
Date: Tue, 08 Nov 2011 08:39:51 +0000
Message-ID: <CANeU7QmoFOrhjCFnwcjZbUM3JDwLiwr-TOY0r+1tizz2=-QFGg () mail ! gmail ! com>
--------------------
Sorry about the that. I am a little bit stuck on getting the new PGP key
signed by some kernel hackers so I can regain my account on kernel.org.
It seems that the key signing need to do in the fact to face fashion and my
local kernel contact is limited.

Yes, I am looking forward to merge the LLVM back end once I regain the account.

BTW,  drop me an email off line if you can help me sign the PGP key.
I am in the bay area.

Chris

On Mon, Nov 7, 2011 at 11:16 PM, Pekka Enberg <penberg@kernel.org> wrote:
> Hi Chris,
>
> When is sparse.git going to be back at git.kernel.org? Also, what are
> your plans regarding merging the LLVM backend?
>
>                        Pekka
>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [ANNOUNCE] LLVM backend for Sparse ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [ANNOUNCE] LLVM backend for Sparse
Date: Sun, 28 Aug 2011 06:08:40 +0000
Message-ID: <alpine.DEB.2.00.1108280904070.7603 () localhost6 ! localdomain6>
--------------------
Hi everyone,

Jeff Garzik and myself have been hacking on LLVM backed for Sparse. The sources
are available on Github:

   git clone git://github.com/penberg/sparse-llvm.git

You can use sparse-llvm with the 'sparsec' shells script provided in the source
tree. It has a GCC compatible command line interface and uses GCC for linking.
For example, you can try to build sparse with sparse-llvm like this:

   make CC=sparsec

Developers who are interested in looking at the LLVM output can use the
'sparse-llvm' command as follows:

   sparse-llvm foo.c | llvm-dis

The backend is already capable of generating code for simple C code on various
platforms. Supported C features include:

   * Function calls

   * Switch statements

   * if-else statements

   * Arithmetic operations

   * Bitwise operations

   * Floating point arithmetic

There's many features that are not supported so if you see an error message
such as this while compiling a C file:

   sparse-llvm: sparse-llvm.c:165: pseudo_type: Assertion `0' failed.

don't panic because it simply means you're attempting to use an unsupported
feature. Help implementing them is more than welcome!

 			Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Sun, 28 Aug 2011 13:51:45 +0000
Message-ID: <alpine.DEB.2.00.1108281651330.2689 () localhost6 ! localdomain6>
--------------------
On Sun, 28 Aug 2011, Christopher Li wrote:
> I attach a patch to limit g++ usage only to llvm related programs.
> Currently it use g++ to link other sparse programs.

Applied, thanks!
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Sun, 28 Aug 2011 16:54:03 +0000
Message-ID: <CA+55aFymNRxwWMVPwhWKGB7T2UXduGccjW1FgKYGCb8QH9QAhg () mail ! gmail ! com>
--------------------
On Sun, Aug 28, 2011 at 7:01 AM, Pekka Enberg <penberg@kernel.org> wrote:
>
> It's lack of PSEUDO_SYM support. I haven't quite figured out what kind of
> code to generate for that because, frankly, I'm not completely sure what
> it's all about. ;-)

So "PSEUDO_SYM" is just a "link-time constant".

IOW, it's nothing but a pointer to an in-memory variable, and from a
code generation standpoint generating the symbol should be just about
the same as generating a constant, except rather than an actual value,
it's now a linker reference.

Of course, what complicates them is that you also need to generate the
symbol definition itself (somewhere else). In particular, the
sym->initializer points to the initializer of a symbol, and they can
be *complicated*. Generating the output for some symbols can be a
major pain in the *ss, just think about a complex structure array
initializer.

The PSEUDO_SYM you hit for the "hello world" program is trivial,
though. It's an unnamed symbol of type "char []", and it has a trivial
initializer (the string itself). So symbols can be hard to generate,
but there are simple cases.

So for a PSUEDO_SYM, you need to look up "struct symbol" for it
(pseudo->sym), which then has:

 - name of the symbol (sym->ident). Of course, some symbols don't have
names, like the constant string example.

 - type/size/alignment information (sym->ctype)

 - initializer information (sym->initializer - which can be a really
complex expression). Of course, for external symbols - or symbols with
no initializer - this is just empty.

There's way more to symbol types in sparse than that, but apart from
the initializer expression, most of the symbol complexity has been
handled by earlier stages (ie a *lot* of the front-end of sparse is
about symbols and their types).

                          Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 07:41:23 +0000
Message-ID: <CAOJsxLE-3CLPrLhphaVLs6CoWi0JYA02=Ny_fRrn8wqS2o0NcQ () mail ! gmail ! com>
--------------------
On Sun, Aug 28, 2011 at 7:01 AM, Pekka Enberg <penberg@kernel.org> wrote:
>> It's lack of PSEUDO_SYM support. I haven't quite figured out what kind of
>> code to generate for that because, frankly, I'm not completely sure what
>> it's all about. ;-)

On Sun, Aug 28, 2011 at 7:54 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> So "PSEUDO_SYM" is just a "link-time constant".
>
> IOW, it's nothing but a pointer to an in-memory variable, and from a
> code generation standpoint generating the symbol should be just about
> the same as generating a constant, except rather than an actual value,
> it's now a linker reference.
>
> Of course, what complicates them is that you also need to generate the
> symbol definition itself (somewhere else). In particular, the
> sym->initializer points to the initializer of a symbol, and they can
> be *complicated*. Generating the output for some symbols can be a
> major pain in the *ss, just think about a complex structure array
> initializer.
>
> The PSEUDO_SYM you hit for the "hello world" program is trivial,
> though. It's an unnamed symbol of type "char []", and it has a trivial
> initializer (the string itself). So symbols can be hard to generate,
> but there are simple cases.
>
> So for a PSUEDO_SYM, you need to look up "struct symbol" for it
> (pseudo->sym), which then has:
>
>  - name of the symbol (sym->ident). Of course, some symbols don't have
> names, like the constant string example.
>
>  - type/size/alignment information (sym->ctype)
>
>  - initializer information (sym->initializer - which can be a really
> complex expression). Of course, for external symbols - or symbols with
> no initializer - this is just empty.
>
> There's way more to symbol types in sparse than that, but apart from
> the initializer expression, most of the symbol complexity has been
> handled by earlier stages (ie a *lot* of the front-end of sparse is
> about symbols and their types).

Right. Will the "link time constant" 'struct symbol' be part of the
symbol_list? If it is, then we already do LLVMAddGlobal in
output_data() on it and could probably just stash that into a ->priv
member in 'struct symbol' and use that in pseudo_to_value().
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 09:19:27 +0000
Message-ID: <4E5B599F.4090205 () chrisli ! org>
--------------------
On 08/29/2011 12:41 AM, Pekka Enberg wrote:
> Right. Will the "link time constant" 'struct symbol' be part of the 
> symbol_list? If it is, then we already do LLVMAddGlobal in 
> output_data() on it and could probably just stash that into a ->priv 
> member in 'struct symbol' and use that in pseudo_to_value(). 

The link time constant is a LLVMValueRef, it is just the address of the 
symbol.
Yes, it will belong to the function scope's symbol_list but not 
necessary the global one.
Here is some tips that help me a lot on my own llvm branch, which lost 
due to a hard
drive crash. It was able to do hello world back then.

LLVM can output c++ source code that construct the llvm byte code.

# this will emit hello.s as the llvm asm code
$ clang -S -emit-llvm hello.c

# this will generate hello.s.cpp which is the c++ source code to construct
# the llvm byte code above

$ llc -march=cpp hello.s

The hello.s.cpp is a very good reference to build the llvm byte code in C.
It is in C++, but convert to llvm C binding should be easy.
BTW, "-march=c" does not generate C bindings, it generate the
equivalent IR in C code instead.

Hope that helps.

Chris



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 14:22:47 +0000
Message-ID: <CAOJsxLEMvZMX9x0s4VGx9KMPdPbcHqtg0Q=o6ivSCamC3aHUrg () mail ! gmail ! com>
--------------------
On Sat, Aug 27, 2011 at 11:08 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> Jeff Garzik and myself have been hacking on LLVM backed for Sparse. The
>> sources
>> are available on Github:
>>
>>  git clone git://github.com/penberg/sparse-llvm.git

On Sun, Aug 28, 2011 at 11:51 AM, Christopher Li <sparse@chrisli.org> wrote:
> Very impressive. That is some sparse 0.5 material.
> I will start merging it as soon as I release 0.4.4
>
> I play around with it a little bit, It seems choke on the hello
> world program. Shouldn't be hard to fix though.

It's alive!

$ cat validation/backend/hello.c
#include <stdio.h>

int main(int argc, char *argv[])
{
	puts("hello, world");

	return 0;
}

/*
 * check-name: 'hello, world' code generation
 * check-command: ./sparsec -c $file -o tmp.o
 */
$ ./sparsec -c validation/backend/hello.c -o tmp.o && gcc tmp.o && ./a.out
hello, world

You can find details in this commit:

https://github.com/penberg/sparse-llvm/commit/deb11bd4ee6ed46bce6a5e35a69ada519d81a0a8

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Derek M Jones <derek () knosof ! co ! uk>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 15:14:51 +0000
Message-ID: <4E5BACEB.7020502 () knosof ! co ! uk>
--------------------
Pekka,

>>> Jeff Garzik and myself have been hacking on LLVM backed for Sparse. The
...
> It's alive!

Congratulations.  It is always great to see a compiler generate
executable code for the first time.

It is useful to have a semantic checker generate executable code
because it provides confirmation that lots of internal processing
is working as intended and therefore increases confidence
that the semantic checks are correct.

Can people allay my concern that this work is not on the slippery
slope leading to sparse becoming the recommended compiler for
building the kernel?

-- 
Derek M. Jones                   tel: +44 (0) 1252 520 667
Knowledge Software Ltd           blog:shape-of-code.codingguidelines.com
Source code analysis             http://www.knosof.co.uk
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 15:27:22 +0000
Message-ID: <4E5BAFDA.6080407 () garzik ! org>
--------------------
On 08/29/2011 10:22 AM, Pekka Enberg wrote:
> On Sat, Aug 27, 2011 at 11:08 PM, Pekka Enberg<penberg@kernel.org>  wrote:
>>> Jeff Garzik and myself have been hacking on LLVM backed for Sparse. The
>>> sources
>>> are available on Github:
>>>
>>>   git clone git://github.com/penberg/sparse-llvm.git
>
> On Sun, Aug 28, 2011 at 11:51 AM, Christopher Li<sparse@chrisli.org>  wrote:
>> Very impressive. That is some sparse 0.5 material.
>> I will start merging it as soon as I release 0.4.4
>>
>> I play around with it a little bit, It seems choke on the hello
>> world program. Shouldn't be hard to fix though.
>
> It's alive!
>
> $ cat validation/backend/hello.c
> #include<stdio.h>
>
> int main(int argc, char *argv[])
> {
> 	puts("hello, world");
>
> 	return 0;
> }

you should be more adventurous, and try varargs!  :)

This also works:

[WARNING: it only works if I disable optimization, for some reason]

[jgarzik@bd sparse-llvm]$ ./sparse-llvm foo.c | llc > foo.s
[jgarzik@bd sparse-llvm]$ gcc -o foo foo.s
[jgarzik@bd sparse-llvm]$ ./foo
hello, world!
[jgarzik@bd sparse-llvm]$ cat foo.c

#include <stdio.h>

int main (int argc, char *argv[])
{
	printf("%s\n", "hello, world!");

	return 0;
}


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Derek M Jones <derek () knosof ! co ! uk>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 15:42:54 +0000
Message-ID: <4E5BB37E.7090905 () knosof ! co ! uk>
--------------------
Jeff,

>> Can people allay my concern that this work is not on the slippery
>> slope leading to sparse becoming the recommended compiler for
>> building the kernel?
>
> I doubt sparse will ever have the testing, support and deployment
> infrastructure of the gcc ecosystem.

Exactly.  Unfortunately people's desire to control their world is often
stronger.

-- 
Derek M. Jones                   tel: +44 (0) 1252 520 667
Knowledge Software Ltd           blog:shape-of-code.codingguidelines.com
Source code analysis             http://www.knosof.co.uk
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [ANNOUNCE] LLVM backend for Sparse
Date: Mon, 29 Aug 2011 16:58:36 +0000
Message-ID: <CA+55aFwmtOQgksqdWH=PrsPcDaG44kKBu+3knz9h4zJLGD4X8g () mail ! gmail ! com>
--------------------
On Mon, Aug 29, 2011 at 8:14 AM, Derek M Jones <derek@knosof.co.uk> wrote:
>
> Can people allay my concern that this work is not on the slippery
> slope leading to sparse becoming the recommended compiler for
> building the kernel?

That was never really a goal.

What *was* a goal for me a long time ago was to make sparse be a
"preprocessor" in front of gcc, because the standard C pre-processor
has always been weak and we've always abused it in nasty ways (look at
all the games we play with "sizeof" and "typeof" to make our
"kernel-C" have a kind of generic programming).

Having a semantically aware preprocessor would allow kernel-specific
type extensions (like the "__user" attribute we already use purely for
checking runs), and allow debug facilities like "trace accesses to
this variable" without having to have ugly and unreadable wrappers
etc.

But even that got put on the back-burner when gcc improved the
pre-processor performance. It used to be a separate phase, and quite
slow, and having a quick semantic analysis in front of cc1 that
replaced the gcc preprocessor wouldn't have been a big slow-down. But
with the new (well, no longer new) built-in pre-processor, a sparse
front-end would slow down kernel compiles noticeably.

The main reason I used to want to have a back-end was that without a
back-end you cannot really verify the front-end. You can read
"test-linearize" output all day long, you'll never really get very
far. Once you generate code, and can use the thing to actually compile
real programs, that gives you *way* more confidence that you're doing
things right.

                          Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [GIT PULL] Sparse LLVM backend ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [GIT PULL] Sparse LLVM backend
Date: Fri, 25 Nov 2011 07:46:06 +0000
Message-ID: <alpine.LFD.2.02.1111250945120.7544 () tux ! localdomain>
--------------------
Hi Chris,

Please consider pulling latest LLVM backend code from:

   git://github.com/penberg/sparse-llvm.git for-chris

The backend is still work in progress but it already supports the following C
language features:

   - Arithmetic operations

   - Comparison operations

   - Logical operations

   - Bitwise operations

   - Loops

   - Casts

   - Structs and unions

The backend has been tested on i386 and x86-64. Some features have also been
tested on PPC against LLVM 2.6.

Please note that sparse uses 32-bit data type sizes by default so the generated
code on 64-bit is not correct. We'd need something like the following patch to
fix it:

   http://thread.gmane.org/gmane.comp.parsers.sparse/2654/focus=2655

 			Pekka

------------------>


The following changes since commit 65a4e2fc656aa6e99604358056d8599a1823a8bc:

   sparse 0.4.4 (2011-11-21 01:56:02 -0800)

are available in the git repository at:
   git://github.com/penberg/sparse-llvm.git for-chris

Christopher Li (1):
       Limit usage of g++ to llvm related programs.

Jeff Garzik (15):
       sparse, llvm: if-else code generation
       sparse-llvm: OP_SEL
       sparse-llvm: OP_SWITCH
       sparse-llvm: OP_LOAD
       sparse-llvm OP_PHISOURCE: replace copy with target=src pointer operation
       sparse, llvm: replace FIXME comment with assert(), following existing style
       sparse, llvm: implement OP_CALL
       sparse, llvm: move OP_PHI code from switch statement to separate function
       sparse, llvm: move OP_CAST code to separate func.  support FP casts.
       sparse, llvm: create helper for obtaining instruction's type
       sparse, llvm: store module-local functions on function reference list
       sparse, llvm: move OP_COPY support to separate function.  Add FP support.
       sparse, llvm: support OP_STORE
       sparse, llvm: Fix loops, by properly handling OP_PHI forward references
       sparse, llvm: add loop testcase

Kamil Dudka (2):
       cse: treat PHI-nodes as other instructions
       cse: update PHI users when throwing away an instruction

Pekka Enberg (59):
       sparse, llvm: Initial commit
       sparse, llvm: Fix assert() in sparse code
       sparse, llvm: Fix global variable initialization
       sparse, llvm: Fix 'sparsec' when it's not in PATH
       llvm, sparse: Separate entry and exit basic blocks
       sparse, llvm: Add switch statement to output_insn()
       sparse, llvm: OP_RET/PSEUDO_VAL code generation
       sparse, llvm: Add support for OP_RET/PSEUDO_ARG
       sparse, llvm: Introduce 'struct function' to clean up code
       sparse, llvm: Add output_op_binary() stub
       sparse, llvm: Implement OP_ADD
       sparse, llvm: Add support for more binary ops
       sparse, llvm: Implement some binary comparison ops
       sparse, llvm: Move binop tests to validation/backend
       sparse, llvm: Implement OP_CAST
       sparse, llvm: Floating point support for binops
       sparse, llvm: Reorganize code generation tests
       sparse, llvm: Bitwise not operator codegen
       sparse, llvm: Kill ifdef'd unssa() call
       sparse, llvm: Kill debugging code
       Merge pull request #1 from jgarzik/hacks
       Merge pull request #2 from jgarzik/hacks
       sparse, llvm: Warn the user when we fall back to GCC
       sparse, llvm: Code generation for string constants
       sparse, llvm: Cleanup output_data()
       sparse, llvm: Fix OP_CAST to use zero-extend
       sparse, llvm: Improve sparsec front-end
       sparse, llvm: Fix PSEUDO_OP code generation
       sparse, llvm: Don't redefine module local functions
       Revert "sparse, llvm: Don't redefine module local functions"
       sparse, llvm: Fix code generation for casts
       sparse, llvm: Fix pseudo_type() for PSEUDO_ARG
       Merge pull request #3 from jgarzik/hacks
       Merge branch 'master' of github.com:penberg/sparse-llvm
       llvm, sparse: Fix symbol_is_fp_type() goof
       Merge pull request #4 from jgarzik/hacks
       sparse, llvm: Fix code generation for 'long double' data type
       sparse, llvm: Add support for struct types
       sparse, llvm: Add support for symbol initializers
       sparse: Bump up sizeof(_Bool) to 8 bits
       sparse, llvm: Add support for logical ops
       sparse, llvm: Fix 'void *' pointer code generation
       sparse, llvm: Use new LLVM type system API for structs
       sparse, llvm: Fix struct code generation
       sparse, llvm: Fix symbol_type() for bitfields and enums
       sparse, llvm: Add support for array types
       sparse, llvm: Add support for union types
       sparse, llvm: Make 'sparsec' error handling more robust
       sparse, llvm: Function pointer code generation
       sparse, llvm: Fix symbol initializer code generation
       sparse, llvm: Fix 'extern' symbol code generation
       sparse, llvm: Make llc output to stdout in sparsec
       sparse, llvm: Pointer cast code generation
       sparse, llvm: OP_SET_B and OP_SET_A code generation
       sparse, llvm: More comparison ops code generation
       sparse, llvm: Simplify comparison op code generation
       sparse, llvm: FP comparison op code generation
       Merge pull request #6 from jgarzik/hacks
       sparse, llvm: Don't fail the build if LLVM is too old

  .gitignore                          |    1 +
  Makefile                            |   26 +-
  cse.c                               |   20 +-
  linearize.h                         |    2 +
  sparse-llvm.c                       | 1238 +++++++++++++++++++++++++++++++++++
  sparsec                             |   52 ++
  target.c                            |    2 +-
  validation/backend/arithmetic-ops.c |   94 +++
  validation/backend/array.c          |    6 +
  validation/backend/bitwise-ops.c    |   64 ++
  validation/backend/cast.c           |   47 ++
  validation/backend/cmp-ops.c        |   84 +++
  validation/backend/function-ptr.c   |   11 +
  validation/backend/hello.c          |   13 +
  validation/backend/logical-ops.c    |   24 +
  validation/backend/loop.c           |   21 +
  validation/backend/ptrcast.c        |    9 +
  validation/backend/struct.c         |   19 +
  validation/backend/union.c          |   12 +
  validation/sizeof-bool.c            |    6 +-
  20 files changed, 1737 insertions(+), 14 deletions(-)
  create mode 100644 sparse-llvm.c
  create mode 100755 sparsec
  create mode 100644 validation/backend/arithmetic-ops.c
  create mode 100644 validation/backend/array.c
  create mode 100644 validation/backend/bitwise-ops.c
  create mode 100644 validation/backend/cast.c
  create mode 100644 validation/backend/cmp-ops.c
  create mode 100644 validation/backend/function-ptr.c
  create mode 100644 validation/backend/hello.c
  create mode 100644 validation/backend/logical-ops.c
  create mode 100644 validation/backend/loop.c
  create mode 100644 validation/backend/ptrcast.c
  create mode 100644 validation/backend/struct.c
  create mode 100644 validation/backend/union.c

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 0/3] linearize_statement: split up into helper functions ===

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: [PATCH 0/3] linearize_statement: split up into helper functions
Date: Sat, 27 Aug 2011 21:26:31 +0000
Message-ID: <alpine.LFD.2.02.1108271424400.18733 () i5 ! linux-foundation ! org>
--------------------

This is a trivial series of three patches to clean up
linearize_statement() a bit by separating out three of the more
complicated cases. 

No actual code changes.

Linus Torvalds (3):
  Make 'linearize_iterator()' helper function
  Make 'linearize_switch()' helper function
  Make 'linearize_return()' helper function

 linearize.c |  259 +++++++++++++++++++++++++++++++----------------------------
 1 files changed, 136 insertions(+), 123 deletions(-)

-- 
1.7.6.409.ge7a85.dirty

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/2] FAQ: fix a typo ("because or") ===

From: =?UTF-8?q?Jonathan=20Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: [PATCH 1/2] FAQ: fix a typo ("because or")
Date: Sat, 20 Aug 2011 15:02:58 +0000
Message-ID: <1313852579-14468-1-git-send-email-j.neuschaefer () gmx ! net>
--------------------
Signed-off-by: Jonathan NeuschÃ¤fer <j.neuschaefer@gmx.net>
---
 FAQ |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/FAQ b/FAQ
index 3bfcb71..4cad826 100644
--- a/FAQ
+++ b/FAQ
@@ -5,7 +5,7 @@ Q.  Why not just use gcc?
 A.  Gcc is big, complex, and the gcc maintainers are not interested in
     other uses of the gcc front-end.  In fact, gcc has explicitly
     resisted splitting up the front and back ends and having some common
-    intermediate language because or religious license issues - you can
+    intermediate language because of religious license issues - you can
     have multiple front ends and back ends, but they all have to be part
     of gcc and licensed under the GPL. 
 
-- 
1.7.5.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 1/2] FAQ: fix a typo ("because or")
Date: Sat, 20 Aug 2011 22:25:52 +0000
Message-ID: <CANeU7Qn_zC-hGbV7hvzga1nXN0nt0f-_-uvzO9Emm7G_ny6CBA () mail ! gmail ! com>
--------------------
On Sat, Aug 20, 2011 at 8:02 AM, Jonathan Neuschäfer
<j.neuschaefer@gmx.net> wrote:
> Signed-off-by: Jonathan Neuschäfer <j.neuschaefer@gmx.net>

Thanks for catching that. Will apply both of them.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/2] sparse, llvm: Make 'sparsec' error handling more robust ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 1/2] sparse, llvm: Make 'sparsec' error handling more robust
Date: Fri, 18 Nov 2011 15:30:58 +0000
Message-ID: <1321630259-2213-1-git-send-email-penberg () kernel ! org>
--------------------
Make 'sparsec' more robust against SIGSEGV in Sparse/LLVM code so that 'make
check' detects test breakage.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparsec |    9 ++++++++-
 1 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/sparsec b/sparsec
index 1e5c8bd..33e1a2b 100755
--- a/sparsec
+++ b/sparsec
@@ -2,6 +2,8 @@
 #
 # GCC compatible C compiler based on Sparse LLVM
 
+set +e
+
 SPARSEOPTS=""
 DIRNAME=`dirname $0`
 
@@ -27,9 +29,12 @@ while [ $# -gt 0 ]; do
 	shift
 done
 
+TMPLLVM=`mktemp -t tmp.XXXXXX`".llvm"
 TMPFILE=`mktemp -t tmp.XXXXXX`".o"
 
-$DIRNAME/sparse-llvm $SPARSEOPTS | llc | as -o $TMPFILE
+$DIRNAME/sparse-llvm $SPARSEOPTS > $TMPLLVM
+
+llc $TMPLLVM | as -o $TMPFILE
 
 if [ $NEED_LINK -eq 1 ]; then
 	if [ -z $OUTFILE ]; then
@@ -43,3 +48,5 @@ else
 	fi
 	mv $TMPFILE $OUTFILE
 fi
+
+rm -f $TMPLLVM
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/2] sparse, llvm: Pointer cast code generation ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 1/2] sparse, llvm: Pointer cast code generation
Date: Tue, 22 Nov 2011 15:27:40 +0000
Message-ID: <1321975661-1692-1-git-send-email-penberg () kernel ! org>
--------------------
This patch implement code generation for OP_PTRCAST using LLVMBuildBitCast().

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c                |   20 +++++++++++++++++++-
 validation/backend/ptrcast.c |    9 +++++++++
 2 files changed, 28 insertions(+), 1 deletions(-)
 create mode 100644 validation/backend/ptrcast.c

diff --git a/sparse-llvm.c b/sparse-llvm.c
index 1a2a34d..e3d8883 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -812,6 +812,24 @@ static void output_op_phi(struct function *fn, struct instruction *insn)
 	insn->target->priv = target;
 }
 
+static void output_op_ptrcast(struct function *fn, struct instruction *insn)
+{
+	LLVMValueRef src, target;
+	char target_name[64];
+
+	src = insn->src->priv;
+	if (!src)
+		src = pseudo_to_value(fn, insn, insn->src);
+
+	pseudo_name(insn->target, target_name);
+
+	assert(!symbol_is_fp_type(insn->type));
+
+	target = LLVMBuildBitCast(fn->builder, src, insn_symbol_type(fn->module, insn), target_name);
+
+	insn->target->priv = target;
+}
+
 static void output_op_cast(struct function *fn, struct instruction *insn, LLVMOpcode op)
 {
 	LLVMValueRef src, target;
@@ -917,7 +935,7 @@ static void output_insn(struct function *fn, struct instruction *insn)
 		assert(0);
 		break;
 	case OP_PTRCAST:
-		assert(0);
+		output_op_ptrcast(fn, insn);
 		break;
 	case OP_BINARY ... OP_BINARY_END:
 	case OP_BINCMP ... OP_BINCMP_END:
diff --git a/validation/backend/ptrcast.c b/validation/backend/ptrcast.c
new file mode 100644
index 0000000..46f8add
--- /dev/null
+++ b/validation/backend/ptrcast.c
@@ -0,0 +1,9 @@
+static char *ptrcast(unsigned long *x)
+{
+	return (unsigned char *) x;
+}
+
+/*
+ * check-name: Pointer cast code generation
+ * check-command: ./sparsec -c $file -o tmp.o
+ */
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/2] sparse, llvm: Use new LLVM type system API for structs ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 1/2] sparse, llvm: Use new LLVM type system API for structs
Date: Mon, 24 Oct 2011 15:37:21 +0000
Message-ID: <1319470642-21031-1-git-send-email-penberg () kernel ! org>
--------------------
To fix an issue with structs that refer to themselves:

  struct symbol {
          struct symbol *next;
  };

convert the code to use new type system API introduced in LLVM 3.0 so that
there's a LLVMTypeRef of the struct we can look up while walking through the
struct members.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c |   15 +++++++++++++--
 1 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index fc0c2e9..14744e5 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -40,15 +40,26 @@ static LLVMTypeRef sym_struct_type(struct symbol *sym)
 {
 	LLVMTypeRef elem_types[MAX_STRUCT_MEMBERS];
 	struct symbol *member;
+	char buffer[256];
+	LLVMTypeRef ret;
 	unsigned nr = 0;
 
+	sprintf(buffer, "%.*s", sym->ident->len, sym->ident->name);
+
+	ret = LLVMStructCreateNamed(LLVMGetGlobalContext(), buffer);
+
 	FOR_EACH_PTR(sym->symbol_list, member) {
+		LLVMTypeRef member_type;
+
 		assert(nr < MAX_STRUCT_MEMBERS);
 
-		elem_types[nr++] = symbol_type(member);
+		member_type = symbol_type(member);
+
+		elem_types[nr++] = member_type; 
 	} END_FOR_EACH_PTR(member);
 
-	return LLVMStructType(elem_types, nr, 0 /* packed? */);
+	LLVMStructSetBody(ret, elem_types, nr, 0 /* packed? */); 
+	return ret;
 }
 
 static LLVMTypeRef sym_ptr_type(struct symbol *sym)
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/2] sparse: Bump up sizeof(_Bool) to 8 bits ===

From: Pekka Enberg <penberg () cs ! helsinki ! fi>
To: linux-sparse
Subject: [PATCH 1/2] sparse: Bump up sizeof(_Bool) to 8 bits
Date: Mon, 26 Sep 2011 14:47:23 +0000
Message-ID: <1317048444-1772-1-git-send-email-penberg () cs ! helsinki ! fi>
--------------------
From: Pekka Enberg <penberg@kernel.org>

We need sizeof(_Bool) to be one byte to generate code for boolean expressions
in the LLVM backend.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 target.c                 |    2 +-
 validation/sizeof-bool.c |    6 +-----
 2 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/target.c b/target.c
index 17b228a..6a535bc 100644
--- a/target.c
+++ b/target.c
@@ -14,7 +14,7 @@ int max_alignment = 16;
 /*
  * Integer data types
  */
-int bits_in_bool = 1;
+int bits_in_bool = 8;
 int bits_in_char = 8;
 int bits_in_short = 16;
 int bits_in_int = 32;
diff --git a/validation/sizeof-bool.c b/validation/sizeof-bool.c
index 6c68748..71ae1bc 100644
--- a/validation/sizeof-bool.c
+++ b/validation/sizeof-bool.c
@@ -4,9 +4,5 @@ static int a(void)
 }
 /*
  * check-name: sizeof(_Bool) is valid
- * check-description: sizeof(_Bool) was rejected because _Bool is not an even
- * number of bytes
- * check-error-start
-sizeof-bool.c:3:16: warning: expression using sizeof bool
- * check-error-end
+ * check-description: sizeof(_Bool) is valid
  */
-- 
1.7.6.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/3] evaluate: warn on identical exprs around '&&' ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Sun, 28 Aug 2011 02:50:10 +0000
Message-ID: <20110828025010.GB20823 () leaf>
--------------------
On Sun, Aug 28, 2011 at 10:26:53AM +1200, Chris Forbes wrote:
> Adds a warning when identical expressions are found on both sides of the '&&' operator. This is a common error resulting from copy & paste.
> 
> Excludes identical expressions found while preprocessing, so we don't get upset about #if defined(FOO) && defined(BAR), which happens all the time, and is perfectly valid.
> 
> Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>

Very nice patch series!  I replied to patch 3 about a bit of patch cleanup, but otherwise this looks fine, and I've wanted to see this check for a while.

Would you consider also checking for identical expresions on both sides
of an &, |, or ^?  The former two seem like likely cases when composing
flags, and the latter seems like a likely error as well.

Also, how does your patch handle expressions like this: *x++ && *x++
Or this: f() && f()

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: Re: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Sun, 28 Aug 2011 02:57:36 +0000
Message-ID: <CAH3ygc01LpeDEY3tmy+ntGH_EC=S7f9AOackWo8dL=5YP6GKkg () mail ! gmail ! com>
--------------------
> Also, how does your patch handle expressions like this: *x++ && *x++
> Or this: f() && f()

Those cases will both warn. Do I need to be looking for potential side
effects, and considering these expressions "probably correct" in those
cases?

-- Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Sun, 28 Aug 2011 03:14:18 +0000
Message-ID: <1314501260-27254-1-git-send-email-chrisf () ijw ! co ! nz>
--------------------
Adds a warning when identical expressions are found on both sides of the '&&' operator. This is a common error resulting from copy & paste.

Excludes identical expressions found while preprocessing, so we don't get upset about #if defined(FOO) && defined(BAR), which happens all the time, and is perfectly valid.

Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>
---
 evaluate.c                                |  133 +++++++++++++++++++++++++++++
 validation/check_identical_exprs_on_and.c |   30 +++++++
 2 files changed, 163 insertions(+), 0 deletions(-)
 create mode 100644 validation/check_identical_exprs_on_and.c

diff --git a/evaluate.c b/evaluate.c
index f7a5678..4914442 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -853,8 +853,141 @@ static struct symbol *evaluate_conditional(struct expression *expr, int iterator
 	return ctype;
 }
 
+static int str_equal(struct string *a, struct string *b)
+{
+	return a->length == b->length &&
+		!memcmp(a->data, b->data, a->length);
+}
+
+static int ident_equal(struct ident *a, struct ident *b)
+{
+	/* only correct when used in the context of expr_equiv.
+		should compare symbols? for general case? */
+	return a->len == b->len &&
+		!memcmp(a->name, b->name, a->len);
+}
+
+/* expr_equiv and expr_list_equiv are mutually recursive */
+static int expr_equiv(struct expression *lhs, struct expression *rhs);
+
+static int expr_list_equiv(struct expression_list *lhs,
+			   struct expression_list *rhs)
+{
+	int l_length = expression_list_size(lhs);
+	int r_length = expression_list_size(rhs);
+	struct expression **l_items, **r_items;
+	int i;
+
+	if (l_length != r_length)
+		return 0;
+
+	l_items = alloca(sizeof( *l_items ) * l_length);
+	r_items = alloca(sizeof( *r_items ) * r_length);
+
+	linearize_ptr_list((struct ptr_list *)lhs, (void **)l_items, l_length);
+	linearize_ptr_list((struct ptr_list *)rhs, (void **)r_items, r_length);
+
+	for (i = 0; i < l_length; i++) {
+		if (!expr_equiv(l_items[i], r_items[i]))
+			return 0;
+	}
+
+	return 1;
+}
+
+int expr_equiv(struct expression *lhs, struct expression *rhs)
+{
+	/* recursively determine if lhs ~ rhs. */
+	if (!lhs || !rhs) return 0;
+
+	if (lhs->type != rhs->type) return 0;
+	if (lhs->flags != rhs->flags) return 0;
+	if (lhs->op != rhs->op) return 0;
+	if (lhs->ctype != rhs->ctype) return 0;
+
+	switch (lhs->type) {
+	case EXPR_VALUE:
+		return lhs->value == rhs->value &&
+			lhs->taint == rhs->taint;
+	case EXPR_FVALUE:
+		return lhs->fvalue == rhs->fvalue;
+	case EXPR_STRING:
+		return lhs->wide == rhs->wide &&
+			str_equal(lhs->string, rhs->string);
+/*	case EXPR_UNOP:	*/	/* this is mentioned in the union, but doesn't
+				actually exist */
+	case EXPR_PREOP:
+	case EXPR_POSTOP:
+		return lhs->op_value == rhs->op_value &&
+			expr_equiv(lhs->unop, rhs->unop);
+	case EXPR_SYMBOL:
+	case EXPR_TYPE:
+		return lhs->symbol == rhs->symbol;
+	case EXPR_BINOP:
+	case EXPR_COMMA:
+	case EXPR_COMPARE:
+	case EXPR_LOGICAL:
+	case EXPR_ASSIGNMENT:
+		return expr_equiv(lhs->left, rhs->left) &&
+			expr_equiv(lhs->right, rhs->right);
+	case EXPR_DEREF:
+		return expr_equiv(lhs->deref, rhs->deref) &&
+			ident_equal(lhs->member, rhs->member);
+	case EXPR_SLICE:
+		return expr_equiv(lhs->base, rhs->base) &&
+			lhs->r_bitpos == rhs->r_bitpos &&
+			lhs->r_nrbits == rhs->r_nrbits;
+	case EXPR_CAST:
+	case EXPR_SIZEOF:
+		return lhs->cast_type == rhs->cast_type &&
+			expr_equiv(lhs->cast_expression,
+				rhs->cast_expression);
+	case EXPR_CONDITIONAL:
+	case EXPR_SELECT:
+		return expr_equiv(lhs->conditional, rhs->conditional) &&
+			expr_equiv(lhs->cond_true, rhs->cond_true) &&
+			expr_equiv(lhs->cond_false, rhs->cond_false);
+	case EXPR_CALL:
+		return expr_equiv(lhs->fn, rhs->fn) &&
+			expr_list_equiv(lhs->args, rhs->args);
+	case EXPR_LABEL:
+		return lhs->label_symbol == rhs->label_symbol;
+	case EXPR_INITIALIZER:
+		return expr_list_equiv(lhs->expr_list, rhs->expr_list);
+	case EXPR_IDENTIFIER:
+		return ident_equal(lhs->expr_ident, rhs->expr_ident) &&
+			lhs->field == rhs->field &&
+			expr_equiv(lhs->ident_expression,
+				rhs->ident_expression);
+	case EXPR_INDEX:
+		return lhs->idx_from == rhs->idx_from &&
+			lhs->idx_to == rhs->idx_to &&
+			expr_equiv(lhs->idx_expression, rhs->idx_expression);
+	case EXPR_POS:
+		return lhs->init_offset == rhs->init_offset &&
+			lhs->init_nr == rhs->init_nr &&
+			expr_equiv(lhs->init_expr, rhs->init_expr);
+	case EXPR_OFFSETOF:
+		return lhs->in == rhs->in &&
+			expr_equiv(lhs->down, rhs->down);
+
+	default:
+		return 0;
+	}
+
+	return 1;
+}
+
 static struct symbol *evaluate_logical(struct expression *expr)
 {
+	if (!preprocessing) {
+		if (expr->op == SPECIAL_LOGICAL_AND &&
+			expr_equiv(expr->left, expr->right)) {
+			warning(expr->pos, "identical expressions on both "
+				"sides of '&&'");
+		}
+	}
+
 	if (!evaluate_conditional(expr->left, 0))
 		return NULL;
 	if (!evaluate_conditional(expr->right, 0))
diff --git a/validation/check_identical_exprs_on_and.c b/validation/check_identical_exprs_on_and.c
new file mode 100644
index 0000000..6560429
--- /dev/null
+++ b/validation/check_identical_exprs_on_and.c
@@ -0,0 +1,30 @@
+extern void bar(void);
+
+static void foo(void *a, void *b, void *c)
+{
+	if (a && a)	/* should warn */
+		bar();
+
+	if (a && b)	/* should not warn */
+		bar();
+
+	if ((a == b) && (a == b))	/* should warn */
+		bar();
+
+	if ((a == b) && (b == c))	/* should not warn */
+		bar();
+}
+
+/* should not warn */
+#if defined(BLETCHEROUS_PLATFORM) && defined(BROKEN_VERSION_OF_SAME)
+	/* do something suitably bizarre */
+#endif
+
+/*
+ * check-name: A warning should be issued for identical expressions on both sides of the '&&' operator.
+ *
+ * check-error-start
+check_identical_exprs_on_and.c:5:15: warning: identical expressions on both sides of '&&'
+check_identical_exprs_on_and.c:11:22: warning: identical expressions on both sides of '&&'
+ * check-error-end
+ */
-- 
1.7.4.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Sun, 28 Aug 2011 03:33:14 +0000
Message-ID: <20110828033314.GC20823 () leaf>
--------------------
On Sun, Aug 28, 2011 at 02:53:52PM +1200, Chris Forbes wrote:
> I'm concerned about the potential for false-positives [after
> preprocessing is done] when combining a bunch of flags.
> 
> I'll throw together another patch to add &|^ support, run it against a
> bunch of real codebases, and see how crazy it is.

Fair enough.  I'd hope that doesn't happen, but I can imagine some
scenarios based on preprocessor macros that could cause that.  However,
if you find that it mostly works and occasionally produces false
positives, you might consider providing an off-by-default warning option
to enable it.

Ideally, we'd try to take textual equality into account from before the
preprocessing step, but that seems anywhere from difficult to impossible
depending on the degree of macro insanity.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jonathan =?utf-8?Q?Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: Re: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Mon, 29 Aug 2011 10:01:06 +0000
Message-ID: <20110829100106.GE15022 () debian ! debian>
--------------------
On Sun, Aug 28, 2011 at 03:14:18PM +1200, Chris Forbes wrote:
> +	case EXPR_BINOP:
> +	case EXPR_COMMA:
> +	case EXPR_COMPARE:
> +	case EXPR_LOGICAL:
> +	case EXPR_ASSIGNMENT:
> +		return expr_equiv(lhs->left, rhs->left) &&
> +			expr_equiv(lhs->right, rhs->right);
[...]
> +	if ((a == b) && (a == b))	/* should warn */
> +		bar();
> +
> +	if ((a == b) && (b == c))	/* should not warn */
> +		bar();

Should it maybe also handle cases like this?

if ((a == b) && (b == a))
	bar();

Thanks,
	Jonathan NeuschÃ¤fer
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Mon, 29 Aug 2011 10:25:01 +0000
Message-ID: <20110829102501.GA22825 () leaf>
--------------------
On Mon, Aug 29, 2011 at 12:01:06PM +0200, Jonathan Neuschäfer wrote:
> On Sun, Aug 28, 2011 at 03:14:18PM +1200, Chris Forbes wrote:
> > +	case EXPR_BINOP:
> > +	case EXPR_COMMA:
> > +	case EXPR_COMPARE:
> > +	case EXPR_LOGICAL:
> > +	case EXPR_ASSIGNMENT:
> > +		return expr_equiv(lhs->left, rhs->left) &&
> > +			expr_equiv(lhs->right, rhs->right);
> [...]
> > +	if ((a == b) && (a == b))	/* should warn */
> > +		bar();
> > +
> > +	if ((a == b) && (b == c))	/* should not warn */
> > +		bar();
> 
> Should it maybe also handle cases like this?
> 
> if ((a == b) && (b == a))
> 	bar();

That seems both significantly harder to handle and significantly less
likely (since it won't occur due to simple copy/paste).  Probably worth
doing at some point, but I don't think a first pass needs to consider
it.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 1/3] evaluate: warn on identical exprs around '&&'
Date: Wed, 31 Aug 2011 00:24:55 +0000
Message-ID: <CANeU7QkM+Umno8n5tpVBvrBit_RMphOqqkODKkoxM9SNUCRfUA () mail ! gmail ! com>
--------------------
On Sat, Aug 27, 2011 at 3:26 PM, Chris Forbes <chrisf@ijw.co.nz> wrote:
> Adds a warning when identical expressions are found on both sides of the '&&' operator. This is a common error resulting from copy & paste.
>
> Excludes identical expressions found while preprocessing, so we don't get upset about #if defined(FOO) && defined(BAR), which happens all the time, and is perfectly valid.

I create a branch for the identical expression check.

http://git.kernel.org/?p=devel/sparse/chrisl/sparse.git;a=shortlog;h=refs/heads/warn-equiv-expr

I did not plan to include it in this 0.4.4 release yet.
For now bug fix only.

I also want to see how it perform on project source code.
It is adding complexity and CPU run time to sparse, I like to see some
results.

> +static int ident_equal(struct ident *a, struct ident *b)
> +{
> +	/* only correct when used in the context of expr_equiv.
> +		should compare symbols? for general case? */
> +	return a->len == b->len &&
> +		!memcmp(a->name, b->name, a->len);
> +}

The ident_equal is overkill. The ident has been hashed and guarantee
unique.


You only need to compare pointer a == b. The whole point of
ident hashing is to reduce memcmp.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/3] sparse, llvm: Fix symbol initializer code generation ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 1/3] sparse, llvm: Fix symbol initializer code generation
Date: Mon, 21 Nov 2011 20:03:28 +0000
Message-ID: <1321905810-2253-1-git-send-email-penberg () kernel ! org>
--------------------
The output_data() function does not see right hand side symbols for expressions
such as this in target.c:

  struct symbol *size_t_ctype = &uint_ctype;

Therefore, call output_data() recursively if LLVMGetNamedGlobal() returns NULL
for a symbol.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index c037e02..ca49a6e 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -1055,7 +1055,7 @@ static void output_fn(LLVMModuleRef module, struct entrypoint *ep)
 	END_FOR_EACH_PTR(bb);
 }
 
-static int output_data(LLVMModuleRef module, struct symbol *sym)
+static LLVMValueRef output_data(LLVMModuleRef module, struct symbol *sym)
 {
 	struct expression *initializer = sym->initializer;
 	LLVMValueRef initial_value;
@@ -1071,6 +1071,8 @@ static int output_data(LLVMModuleRef module, struct symbol *sym)
 			struct symbol *sym = initializer->symbol;
 
 			initial_value = LLVMGetNamedGlobal(module, show_ident(sym->ident));
+			if (!initial_value)
+				initial_value = output_data(module, sym);
 			break;
 		}
 		default:
@@ -1090,7 +1092,7 @@ static int output_data(LLVMModuleRef module, struct symbol *sym)
 
 	LLVMSetInitializer(data, initial_value);
 
-	return 0;
+	return data;
 }
 
 static int compile(LLVMModuleRef module, struct symbol_list *list)
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/3] sparse, llvm: Use LLVMInt1Type() in sym_basetype_type() ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 1/3] sparse, llvm: Use LLVMInt1Type() in sym_basetype_type()
Date: Wed, 21 Dec 2011 09:25:26 +0000
Message-ID: <1324459528-9344-1-git-send-email-penberg () kernel ! org>
--------------------
In preparation for reverting commit 2ded1e7 ("sparse: Bump up sizeof(_Bool) to
8 bits"), teach sym_basetype_type() about LLVMInt1Type().

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index 38f40fc..a291a0d 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -175,6 +175,9 @@ static LLVMTypeRef sym_basetype_type(struct symbol *sym)
 		}
 	} else {
 		switch (sym->bit_size) {
+		case 1:
+			ret = LLVMInt1Type();
+			break;
 		case -1:	/* 'void *' is treated like 'char *' */
 		case 8:
 			ret = LLVMInt8Type();
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/5] sparse: Show expected vs. actual output on test ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 1/5] sparse: Show expected vs. actual output on test
Date: Sat, 27 Aug 2011 08:20:04 +0000
Message-ID: <alpine.DEB.2.00.1108271114560.2570 () localhost6 ! localdomain6>
--------------------
On Tue, 23 Aug 2011, Christopher Li wrote:
> I think we might just give the same error message for
> "known to fail" case as well. Yes, it is annoying to see them,
> but that is the point, we want to fix them.

No, people who did not break them should not need to see the errors! If 
you're going to have a "known to fail" flag, then it really should be 
silent *by default*. When I run make check, I want to know I didn't break 
anything. If someone flagged a test as "known to fail", I really don't 
need to care about it.

Alternatively, we could get rid of the "known to fail" tag completely and 
just make sure the tests pass all the time. I actually wanted to do that 
but didn't have the skills to fix the remaining issues ;-)

 			Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/5] sparse: Show expected vs. actual output on test failure ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 1/5] sparse: Show expected vs. actual output on test failure
Date: Tue, 23 Aug 2011 22:32:19 +0000
Message-ID: <CANeU7Q=oqi044rJYbZ1XnwJovEL-9WV8xW83-LDC23n-GVTxiQ () mail ! gmail ! com>
--------------------
On Mon, Aug 22, 2011 at 6:57 AM, Pekka Enberg <penberg@kernel.org> wrote:
> This patch changes 'make check' output to show sparse output compared to
> expected results upon unexpected test failure. For example,
> static-forward-decl.c output would look like this if it would not be tagged as
> "known to fail":

I like that. Some minor suggestion:

There are two files to check for,  "output" and "error".
"$stream" is the loop variable. You only print the last one in the loop.
The "output" diff file does not show.

I think we might just give the same error message for
"known to fail" case as well. Yes, it is annoying to see them,
but that is the point, we want to fix them.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 1/5] sparse: Show expected vs. actual output on test failure
Date: Fri, 26 Aug 2011 09:10:24 +0000
Message-ID: <4E576300.2070609 () kernel ! org>
--------------------
On 8/22/11 4:57 PM, Pekka Enberg wrote:
> This patch changes 'make check' output to show sparse output compared to
> expected results upon unexpected test failure. For example,
> static-forward-decl.c output would look like this if it would not be tagged as
> "known to fail":
>
>         TEST     static forward declaration (static-forward-decl.c)
>    error: actual error text does not match expected error text.
>    --- static-forward-decl.c.error.expected	2011-08-22 06:29:40.000000000 +0000
>    +++ static-forward-decl.c.error.got	2011-08-22 06:29:40.000000000 +0000
>    @@ -0,0 +1 @@
>    +static-forward-decl.c:3:5: warning: symbol 'f' was not declared. Should it be static?
>    error: see static-forward-decl.c.error.* for further investigation.
>    info: test 'static-forward-decl.c' is known to fail
>
> This makes it easier to detect and analyze test breakage.
>
> Cc: Christopher Li<sparse@chrisli.org>
> Cc: Linus Torvalds<torvalds@linux-foundation.org>
> Signed-off-by: Pekka Enberg<penberg@kernel.org>
> ---
>   validation/test-suite |    2 ++
>   1 files changed, 2 insertions(+), 0 deletions(-)
>
> diff --git a/validation/test-suite b/validation/test-suite
> index 42f7bd7..7549fd2 100755
> --- a/validation/test-suite
> +++ b/validation/test-suite
> @@ -146,6 +146,8 @@ do_test()
>   		if [ "$?" -eq "0" ]; then
>   			echo "info: test '$file' is known to fail"
>   			known_ko_tests=`expr $known_ko_tests + 1`
> +		else
> +			cat "$file".$stream.diff
>   		fi
>   		return 1
>   	else

Chris, the patch you committed is different from mine:

http://git.kernel.org/?p=devel/sparse/chrisl/sparse.git;a=commitdiff;h=a7a00d5108c36b8baaf54814aa1f42583dabc754

Your patch now makes the runner verbose for "known to fail" tests
which is definitely not something we should do. If someone tagged
the test as "known to fail", we should treat it just like we treat
passed test cases.

The whole point of my patch was to make "make check" pinpoint
*unexpected* breakage so that anyone who bothers to do "make check"
on their patches can never cause regressions.

                         Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/2] fix common misspellings with codespell ===

From: =?UTF-8?q?Jonathan=20Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: [PATCH 2/2] fix common misspellings with codespell
Date: Sat, 20 Aug 2011 15:02:59 +0000
Message-ID: <1313852579-14468-2-git-send-email-j.neuschaefer () gmx ! net>
--------------------
See http://git.profusion.mobi/cgit.cgi/lucas/codespell/ for more
information on codespell.

Signed-off-by: Jonathan NeuschÃ¤fer <j.neuschaefer@gmx.net>
---
 LICENSE                                  |    2 +-
 README                                   |    2 +-
 ast-model.c                              |    2 +-
 validation/preprocessor/preprocessor19.c |    2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/LICENSE b/LICENSE
index 06440ff..be0fd01 100644
--- a/LICENSE
+++ b/LICENSE
@@ -26,7 +26,7 @@ requirements of this license.
 
 	 http://www.opensource.org/licenses/osl.php
 
-  please refer to there for the authorative and slightly more
+  please refer to there for the authoritative and slightly more
   pretty-printed version ]
 
 ------
diff --git a/README b/README
index 033ae15..63f752b 100644
--- a/README
+++ b/README
@@ -62,7 +62,7 @@ more requirements.  The user is free to do whatever he wants with the
 parse tree that got built up, and needs not worry about the library ever
 again.  There is no extra state, there are no parser callbacks, there is
 only the parse tree that is described by the header files. The action
-funtion takes a pointer to a symbol_list and does whatever it likes with it.
+function takes a pointer to a symbol_list and does whatever it likes with it.
 
 The library also contains (as an example user) a few clients that do the
 preprocessing, parsing and type evaluation and just print out the
diff --git a/ast-model.c b/ast-model.c
index f516340..704c487 100644
--- a/ast-model.c
+++ b/ast-model.c
@@ -167,7 +167,7 @@ ast_tree_model_init (GtkTreeModelIface *iface)
 
 /*****************************************************************************
  *
- *  ast_init: this is called everytime a new ast node object
+ *  ast_init: this is called every time a new ast node object
  *            instance is created (we do that in ast_new).
  *            Initialise the list structure's fields here.
  *
diff --git a/validation/preprocessor/preprocessor19.c b/validation/preprocessor/preprocessor19.c
index 7dd3820..e70dad1 100644
--- a/validation/preprocessor/preprocessor19.c
+++ b/validation/preprocessor/preprocessor19.c
@@ -1,4 +1,4 @@
-/* got burned by that - freed the new defintion in the case when we had
+/* got burned by that - freed the new definition in the case when we had
    warned and replaced the old one */
 #define A x
 #define A y
-- 
1.7.5.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/2] fix common misspellings with codespell
Date: Sat, 20 Aug 2011 22:34:20 +0000
Message-ID: <CANeU7Qkia-AL80HjMnk_LQ1vux+bkZifJ=fGV6+-w9QwmuZrRw () mail ! gmail ! com>
--------------------
On Sat, Aug 20, 2011 at 8:02 AM, Jonathan Neuschäfer
<j.neuschaefer@gmx.net> wrote:
> See http://git.profusion.mobi/cgit.cgi/lucas/codespell/ for more
> information on codespell.

All applied. This code spell is interesting.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/2] mmc: fix integer assignments to pointer ===

From: "S, Venkatraman" <svenkatr () ti ! com>
To: linux-sparse
Subject: Re: [PATCH 2/2] mmc: fix integer assignments to pointer
Date: Wed, 24 Aug 2011 18:45:45 +0000
Message-ID: <CANfBPZ_ZJB-0zZYJpeSqzo7U18s71nOd8=5ZyKQ8=A6dzg+6-A () mail ! gmail ! com>
--------------------
On Wed, Aug 24, 2011 at 2:08 AM, Sam Ravnborg <sam@ravnborg.org> wrote:
>>
>> I'm still a little confused -- the {0} or memset(0, struct ..);
>> formations are used often in the kernel, even with pointers involved.
>> Is the warning (Wnon_pointer_null) run against the kernel by default,
>> or did Venkatraman add it manually?  If default, is it catching bugs?
>
> Did a quick "allnoconfig" build. With this minimal build the warning only triggered three times.
> So a lot of these has been fixed already.
>
>        Sam
>
I did my typical omap build on mainline and mmc-next and see that the warnings
have increased, and not fixed.
I will post upated patch series.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/2] sparse, llvm: Fix struct code generation ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 2/2] sparse, llvm: Fix struct code generation
Date: Mon, 24 Oct 2011 15:37:22 +0000
Message-ID: <1319470642-21031-2-git-send-email-penberg () kernel ! org>
--------------------
Use LLVMGetTypeByName() to look up struct data types to fix code generation for
structs that refer to themselves.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c               |   50 +++++++++++++++++++++++-------------------
 validation/backend/struct.c |    1 +
 2 files changed, 28 insertions(+), 23 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index 14744e5..5d1b79c 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -32,11 +32,11 @@ static inline bool symbol_is_fp_type(struct symbol *sym)
 	return sym->ctype.base_type == &fp_type;
 }
 
-static LLVMTypeRef symbol_type(struct symbol *sym);
+static LLVMTypeRef symbol_type(LLVMModuleRef module, struct symbol *sym);
 
 #define MAX_STRUCT_MEMBERS 64
 
-static LLVMTypeRef sym_struct_type(struct symbol *sym)
+static LLVMTypeRef sym_struct_type(LLVMModuleRef module, struct symbol *sym)
 {
 	LLVMTypeRef elem_types[MAX_STRUCT_MEMBERS];
 	struct symbol *member;
@@ -46,6 +46,10 @@ static LLVMTypeRef sym_struct_type(struct symbol *sym)
 
 	sprintf(buffer, "%.*s", sym->ident->len, sym->ident->name);
 
+	ret = LLVMGetTypeByName(module, buffer);
+	if (ret)
+		return ret;
+
 	ret = LLVMStructCreateNamed(LLVMGetGlobalContext(), buffer);
 
 	FOR_EACH_PTR(sym->symbol_list, member) {
@@ -53,7 +57,7 @@ static LLVMTypeRef sym_struct_type(struct symbol *sym)
 
 		assert(nr < MAX_STRUCT_MEMBERS);
 
-		member_type = symbol_type(member);
+		member_type = symbol_type(module, member);
 
 		elem_types[nr++] = member_type; 
 	} END_FOR_EACH_PTR(member);
@@ -62,9 +66,9 @@ static LLVMTypeRef sym_struct_type(struct symbol *sym)
 	return ret;
 }
 
-static LLVMTypeRef sym_ptr_type(struct symbol *sym)
+static LLVMTypeRef sym_ptr_type(LLVMModuleRef module, struct symbol *sym)
 {
-	LLVMTypeRef type = symbol_type(sym->ctype.base_type);
+	LLVMTypeRef type = symbol_type(module, sym->ctype.base_type);
 
 	return LLVMPointerType(type, 0);
 }
@@ -112,22 +116,22 @@ static LLVMTypeRef sym_basetype_type(struct symbol *sym)
 	return ret;
 }
 
-static LLVMTypeRef symbol_type(struct symbol *sym)
+static LLVMTypeRef symbol_type(LLVMModuleRef module, struct symbol *sym)
 {
 	LLVMTypeRef ret = NULL;
 
 	switch (sym->type) {
 	case SYM_NODE:
-		ret = symbol_type(sym->ctype.base_type);
+		ret = symbol_type(module, sym->ctype.base_type);
 		break;
 	case SYM_BASETYPE:
 		ret = sym_basetype_type(sym);
 		break;
 	case SYM_PTR:
-		ret = sym_ptr_type(sym);
+		ret = sym_ptr_type(module, sym);
 		break;
 	case SYM_STRUCT:
-		ret = sym_struct_type(sym);
+		ret = sym_struct_type(module, sym);
 		break;
 	default:
 		assert(0);
@@ -135,10 +139,10 @@ static LLVMTypeRef symbol_type(struct symbol *sym)
 	return ret;
 }
 
-static LLVMTypeRef insn_symbol_type(struct instruction *insn)
+static LLVMTypeRef insn_symbol_type(LLVMModuleRef module, struct instruction *insn)
 {
 	if (insn->type)
-		return symbol_type(insn->type);
+		return symbol_type(module, insn->type);
 
 	switch (insn->size) {
 		case 8:		return LLVMInt8Type();
@@ -234,7 +238,7 @@ static LLVMValueRef pseudo_to_value(struct function *fn, struct instruction *ins
 		break;
 	}
 	case PSEUDO_VAL:
-		result = LLVMConstInt(insn_symbol_type(insn), pseudo->value, 1);
+		result = LLVMConstInt(insn_symbol_type(fn->module, insn), pseudo->value, 1);
 		break;
 	case PSEUDO_ARG: {
 		result = LLVMGetParam(fn->fn, pseudo->nr - 1);
@@ -265,7 +269,7 @@ static LLVMTypeRef pseudo_type(struct function *fn, struct instruction *insn, ps
 
 	switch (pseudo->type) {
 	case PSEUDO_REG:
-		result = symbol_type(pseudo->def->type);
+		result = symbol_type(fn->module, pseudo->def->type);
 		break;
 	case PSEUDO_SYM: {
 		struct symbol *sym = pseudo->sym;
@@ -287,7 +291,7 @@ static LLVMTypeRef pseudo_type(struct function *fn, struct instruction *insn, ps
 		break;
 	}
 	case PSEUDO_VAL:
-		result = insn_symbol_type(insn);
+		result = insn_symbol_type(fn->module, insn);
 		break;
 	case PSEUDO_ARG:
 		result = LLVMTypeOf(LLVMGetParam(fn->fn, pseudo->nr - 1));
@@ -691,7 +695,7 @@ static void output_op_phi(struct function *fn, struct instruction *insn)
 	pseudo_t phi;
 	LLVMValueRef target;
 
-	target = LLVMBuildPhi(fn->builder, insn_symbol_type(insn),
+	target = LLVMBuildPhi(fn->builder, insn_symbol_type(fn->module, insn),
 				"phi");
 	int pll = 0;
 	FOR_EACH_PTR(insn->phi_list, phi) {
@@ -733,9 +737,9 @@ static void output_op_cast(struct function *fn, struct instruction *insn, LLVMOp
 	assert(!symbol_is_fp_type(insn->type));
 
 	if (insn->size < LLVMGetIntTypeWidth(LLVMTypeOf(src)))
-		target = LLVMBuildTrunc(fn->builder, src, insn_symbol_type(insn), target_name);
+		target = LLVMBuildTrunc(fn->builder, src, insn_symbol_type(fn->module, insn), target_name);
 	else
-		target = LLVMBuildCast(fn->builder, op, src, insn_symbol_type(insn), target_name);
+		target = LLVMBuildCast(fn->builder, op, src, insn_symbol_type(fn->module, insn), target_name);
 
 	insn->target->priv = target;
 }
@@ -749,7 +753,7 @@ static void output_op_copy(struct function *fn, struct instruction *insn,
 
 	pseudo_name(insn->target, target_name);
 	src = pseudo_to_value(fn, insn, pseudo);
-	const_type = insn_symbol_type(insn);
+	const_type = insn_symbol_type(fn->module, insn);
 
 	/*
 	 * This is nothing more than 'target = src'
@@ -910,12 +914,12 @@ static void output_fn(LLVMModuleRef module, struct entrypoint *ep)
 	FOR_EACH_PTR(base_type->arguments, arg) {
 		struct symbol *arg_base_type = arg->ctype.base_type;
 
-		arg_types[nr_args++] = symbol_type(arg_base_type);
+		arg_types[nr_args++] = symbol_type(module, arg_base_type);
 	} END_FOR_EACH_PTR(arg);
 
 	name = show_ident(sym->ident);
 
-	return_type = symbol_type(ret_type);
+	return_type = symbol_type(module, ret_type);
 
 	function.module = module;
 
@@ -972,7 +976,7 @@ static int output_data(LLVMModuleRef module, struct symbol *sym)
 	if (initializer) {
 		switch (initializer->type) {
 		case EXPR_VALUE:
-			initial_value = LLVMConstInt(symbol_type(sym), initializer->value, 1);
+			initial_value = LLVMConstInt(symbol_type(module, sym), initializer->value, 1);
 			break;
 		case EXPR_SYMBOL: {
 			struct symbol *sym = initializer->symbol;
@@ -984,14 +988,14 @@ static int output_data(LLVMModuleRef module, struct symbol *sym)
 			assert(0);
 		}
 	} else {
-		LLVMTypeRef type = symbol_type(sym);
+		LLVMTypeRef type = symbol_type(module, sym);
 
 		initial_value = LLVMConstNull(type);
 	}
 
 	name = show_ident(sym->ident);
 
-	data = LLVMAddGlobal(module, symbol_type(sym->ctype.base_type), name);
+	data = LLVMAddGlobal(module, symbol_type(module, sym->ctype.base_type), name);
 
 	LLVMSetLinkage(data, data_linkage(sym));
 
diff --git a/validation/backend/struct.c b/validation/backend/struct.c
index 9d0cb56..1afaf2d 100644
--- a/validation/backend/struct.c
+++ b/validation/backend/struct.c
@@ -6,6 +6,7 @@ struct symbol {
 	void			*p;
 	const char		*name;
 	struct ctype		ctype;
+	struct symbol		*next_id;
 };
 
 static struct symbol sym;
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/2] sparse, llvm: OP_SET_B and OP_SET_A code generation ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 2/2] sparse, llvm: OP_SET_B and OP_SET_A code generation
Date: Tue, 22 Nov 2011 15:27:41 +0000
Message-ID: <1321975661-1692-2-git-send-email-penberg () kernel ! org>
--------------------
This patch implement unsigned less than and greater than comparison operator
LLVM code generation.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c                |    4 ++--
 validation/backend/cmp-ops.c |   10 ++++++++++
 2 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index e3d8883..6402666 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -516,10 +516,10 @@ static void output_op_binary(struct function *fn, struct instruction *insn)
 		target = LLVMBuildICmp(fn->builder, LLVMIntSGT, lhs, rhs, target_name);
 		break;
 	case OP_SET_B:
-		assert(0);
+		target = LLVMBuildICmp(fn->builder, LLVMIntULT, lhs, rhs, target_name);
 		break;
 	case OP_SET_A:
-		assert(0);
+		target = LLVMBuildICmp(fn->builder, LLVMIntUGT, lhs, rhs, target_name);
 		break;
 	case OP_SET_BE:
 		assert(0);
diff --git a/validation/backend/cmp-ops.c b/validation/backend/cmp-ops.c
index 5a89bee..b1ad227 100644
--- a/validation/backend/cmp-ops.c
+++ b/validation/backend/cmp-ops.c
@@ -18,6 +18,16 @@ static int setg(int x, int y)
 	return x > y;
 }
 
+static int setb(unsigned int x, unsigned int y)
+{
+	return x < y;
+}
+
+static int seta(unsigned int x, unsigned int y)
+{
+	return x > y;
+}
+
 /*
  * check-name: Comparison operator code generation
  * check-command: ./sparsec -c $file -o tmp.o
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/3] Make 'linearize_switch()' helper function ===

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: [PATCH 2/3] Make 'linearize_switch()' helper function
Date: Sat, 27 Aug 2011 21:27:45 +0000
Message-ID: <alpine.LFD.2.02.1108271427260.18733 () i5 ! linux-foundation ! org>
--------------------

From: Linus Torvalds <torvalds@linux-foundation.org>
Date: Sat, 27 Aug 2011 11:41:35 -0700
Subject: [PATCH 2/3] Make 'linearize_switch()' helper function

Rather than do it in that huge 'linearize_statement()' function, split
out the switch generation case.  Avoids one level of indentation, and
makes for simpler and more straightforward functions.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
---
 linearize.c |  126 ++++++++++++++++++++++++++++++----------------------------
 1 files changed, 65 insertions(+), 61 deletions(-)

diff --git a/linearize.c b/linearize.c
index 2decd5300859..e48854755b1e 100644
--- a/linearize.c
+++ b/linearize.c
@@ -1843,6 +1843,69 @@ static pseudo_t linearize_declaration(struct entrypoint *ep, struct statement *s
 	return VOID;
 }
 
+static pseudo_t linearize_switch(struct entrypoint *ep, struct statement *stmt)
+{
+	struct symbol *sym;
+	struct instruction *switch_ins;
+	struct basic_block *switch_end = alloc_basic_block(ep, stmt->pos);
+	struct basic_block *active, *default_case;
+	struct multijmp *jmp;
+	pseudo_t pseudo;
+
+	pseudo = linearize_expression(ep, stmt->switch_expression);
+
+	active = ep->active;
+	if (!bb_reachable(active))
+		return VOID;
+
+	switch_ins = alloc_instruction(OP_SWITCH, 0);
+	use_pseudo(switch_ins, pseudo, &switch_ins->cond);
+	add_one_insn(ep, switch_ins);
+	finish_block(ep);
+
+	default_case = NULL;
+	FOR_EACH_PTR(stmt->switch_case->symbol_list, sym) {
+		struct statement *case_stmt = sym->stmt;
+		struct basic_block *bb_case = get_bound_block(ep, sym);
+
+		if (!case_stmt->case_expression) {
+			default_case = bb_case;
+			continue;
+		} else {
+			int begin, end;
+
+			begin = end = case_stmt->case_expression->value;
+			if (case_stmt->case_to)
+				end = case_stmt->case_to->value;
+			if (begin > end)
+				jmp = alloc_multijmp(bb_case, end, begin);
+			else
+				jmp = alloc_multijmp(bb_case, begin, end);
+
+		}
+		add_multijmp(&switch_ins->multijmp_list, jmp);
+		add_bb(&bb_case->parents, active);
+		add_bb(&active->children, bb_case);
+	} END_FOR_EACH_PTR(sym);
+
+	bind_label(stmt->switch_break, switch_end, stmt->pos);
+
+	/* And linearize the actual statement */
+	linearize_statement(ep, stmt->switch_statement);
+	set_activeblock(ep, switch_end);
+
+	if (!default_case)
+		default_case = switch_end;
+
+	jmp = alloc_multijmp(default_case, 1, 0);
+	add_multijmp(&switch_ins->multijmp_list, jmp);
+	add_bb(&default_case->parents, active);
+	add_bb(&active->children, default_case);
+	sort_switch_cases(switch_ins);
+
+	return VOID;
+}
+
 static pseudo_t linearize_iterator(struct entrypoint *ep, struct statement *stmt)
 {
 	struct statement  *pre_statement = stmt->iterator_pre_statement;
@@ -2030,67 +2093,8 @@ pseudo_t linearize_statement(struct entrypoint *ep, struct statement *stmt)
 		break;
 	}
 
-	case STMT_SWITCH: {
-		struct symbol *sym;
-		struct instruction *switch_ins;
-		struct basic_block *switch_end = alloc_basic_block(ep, stmt->pos);
-		struct basic_block *active, *default_case;
-		struct multijmp *jmp;
-		pseudo_t pseudo;
-
-		pseudo = linearize_expression(ep, stmt->switch_expression);
-
-		active = ep->active;
-		if (!bb_reachable(active))
-			break;
-
-		switch_ins = alloc_instruction(OP_SWITCH, 0);
-		use_pseudo(switch_ins, pseudo, &switch_ins->cond);
-		add_one_insn(ep, switch_ins);
-		finish_block(ep);
-
-		default_case = NULL;
-		FOR_EACH_PTR(stmt->switch_case->symbol_list, sym) {
-			struct statement *case_stmt = sym->stmt;
-			struct basic_block *bb_case = get_bound_block(ep, sym);
-
-			if (!case_stmt->case_expression) {
-				default_case = bb_case;
-				continue;
-			} else {
-				int begin, end;
-
-				begin = end = case_stmt->case_expression->value;
-				if (case_stmt->case_to)
-					end = case_stmt->case_to->value;
-				if (begin > end)
-					jmp = alloc_multijmp(bb_case, end, begin);
-				else
-					jmp = alloc_multijmp(bb_case, begin, end);
-
-			}
-			add_multijmp(&switch_ins->multijmp_list, jmp);
-			add_bb(&bb_case->parents, active);
-			add_bb(&active->children, bb_case);
-		} END_FOR_EACH_PTR(sym);
-
-		bind_label(stmt->switch_break, switch_end, stmt->pos);
-
-		/* And linearize the actual statement */
-		linearize_statement(ep, stmt->switch_statement);
-		set_activeblock(ep, switch_end);
-
-		if (!default_case)
-			default_case = switch_end;
-
-		jmp = alloc_multijmp(default_case, 1, 0);
-		add_multijmp(&switch_ins->multijmp_list, jmp);
-		add_bb(&default_case->parents, active);
-		add_bb(&active->children, default_case);
-		sort_switch_cases(switch_ins);
-
-		break;
-	}
+	case STMT_SWITCH:
+		return linearize_switch(ep, stmt);
 
 	case STMT_ITERATOR:
 		return linearize_iterator(ep, stmt);
-- 
1.7.6.409.ge7a85.dirty

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/3] evaluate: warn on identical exprs around '||' ===

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: [PATCH 2/3] evaluate: warn on identical exprs around '||'
Date: Sat, 27 Aug 2011 22:26:54 +0000
Message-ID: <1314484015-7694-2-git-send-email-chrisf () ijw ! co ! nz>
--------------------
Same as prev, but for || operator.

Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>
---
 evaluate.c                               |    4 ++++
 validation/check_identical_exprs_on_or.c |   24 ++++++++++++++++++++++++
 2 files changed, 28 insertions(+), 0 deletions(-)
 create mode 100644 validation/check_identical_exprs_on_or.c

diff --git a/evaluate.c b/evaluate.c
index 08f6ae6..11de7aa 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -985,6 +985,10 @@ static struct symbol *evaluate_logical(struct expression *expr)
 			expr_equiv(expr->left, expr->right)) {
 			warning(expr->pos, "identical expressions on both "
 				"sides of '&&'");
+		} else if (expr->op == SPECIAL_LOGICAL_OR &&
+			expr_equiv(expr->left, expr->right)) {
+			warning(expr->pos, "identical expressions on both "
+				"sides of '||'");
 		}
 	}
 
diff --git a/validation/check_identical_exprs_on_or.c b/validation/check_identical_exprs_on_or.c
new file mode 100644
index 0000000..74fe226
--- /dev/null
+++ b/validation/check_identical_exprs_on_or.c
@@ -0,0 +1,24 @@
+extern void bar(void);
+
+static void foo(void *a, void *b, void *c)
+{
+	if (a || a)	/* should warn */
+		bar();
+
+	if (a || b)	/* should not warn */
+		bar();
+
+	if ((a == b) || (a == b))	/* should warn */
+		bar();
+
+	if ((a == b) || (b == c))	/* should not warn */
+		bar();
+}
+/*
+ * check-name: A warning should be issued for identical expressions on both sides of the '||' operator.
+ *
+ * check-error-start
+check_identical_exprs_on_or.c:5:15: warning: identical expressions on both sides of '||'
+check_identical_exprs_on_or.c:11:22: warning: identical expressions on both sides of '||'
+ * check-error-end
+ */
-- 
1.7.4.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: [PATCH 2/3] evaluate: warn on identical exprs around '||'
Date: Sun, 28 Aug 2011 03:14:19 +0000
Message-ID: <1314501260-27254-2-git-send-email-chrisf () ijw ! co ! nz>
--------------------
Same as prev, but for || operator.

Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>
---
 evaluate.c                               |    4 ++++
 validation/check_identical_exprs_on_or.c |   24 ++++++++++++++++++++++++
 2 files changed, 28 insertions(+), 0 deletions(-)
 create mode 100644 validation/check_identical_exprs_on_or.c

diff --git a/evaluate.c b/evaluate.c
index 4914442..0e5d691 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -985,6 +985,10 @@ static struct symbol *evaluate_logical(struct expression *expr)
 			expr_equiv(expr->left, expr->right)) {
 			warning(expr->pos, "identical expressions on both "
 				"sides of '&&'");
+		} else if (expr->op == SPECIAL_LOGICAL_OR &&
+			expr_equiv(expr->left, expr->right)) {
+			warning(expr->pos, "identical expressions on both "
+				"sides of '||'");
 		}
 	}
 
diff --git a/validation/check_identical_exprs_on_or.c b/validation/check_identical_exprs_on_or.c
new file mode 100644
index 0000000..74fe226
--- /dev/null
+++ b/validation/check_identical_exprs_on_or.c
@@ -0,0 +1,24 @@
+extern void bar(void);
+
+static void foo(void *a, void *b, void *c)
+{
+	if (a || a)	/* should warn */
+		bar();
+
+	if (a || b)	/* should not warn */
+		bar();
+
+	if ((a == b) || (a == b))	/* should warn */
+		bar();
+
+	if ((a == b) || (b == c))	/* should not warn */
+		bar();
+}
+/*
+ * check-name: A warning should be issued for identical expressions on both sides of the '||' operator.
+ *
+ * check-error-start
+check_identical_exprs_on_or.c:5:15: warning: identical expressions on both sides of '||'
+check_identical_exprs_on_or.c:11:22: warning: identical expressions on both sides of '||'
+ * check-error-end
+ */
-- 
1.7.4.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/3] sparse, llvm: Add test case for <stdbool.h> type ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 2/3] sparse, llvm: Add test case for <stdbool.h> type
Date: Wed, 21 Dec 2011 09:25:27 +0000
Message-ID: <1324459528-9344-2-git-send-email-penberg () kernel ! org>
--------------------
As it turns out, our validation test harness doesn't catch <stdbool.h> related
breakage so add a minimal test case that does.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 validation/backend/bool-test.c |   11 +++++++++++
 1 files changed, 11 insertions(+), 0 deletions(-)
 create mode 100644 validation/backend/bool-test.c

diff --git a/validation/backend/bool-test.c b/validation/backend/bool-test.c
new file mode 100644
index 0000000..51ae356
--- /dev/null
+++ b/validation/backend/bool-test.c
@@ -0,0 +1,11 @@
+#include <stdbool.h>
+
+static bool return_false(void)
+{
+	return false;
+}
+
+/*
+ * check-name: Boolean type code generation
+ * check-command: ./sparsec -c $file -o tmp.o
+ */
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 2/3] sparse, llvm: Add test case for <stdbool.h> type
Date: Wed, 21 Dec 2011 09:58:10 +0000
Message-ID: <20111221095810.GA27308 () leaf>
--------------------
On Wed, Dec 21, 2011 at 11:25:27AM +0200, Pekka Enberg wrote:
> As it turns out, our validation test harness doesn't catch <stdbool.h> related
> breakage so add a minimal test case that does.
[...]
> --- /dev/null
> +++ b/validation/backend/bool-test.c
> @@ -0,0 +1,11 @@
> +#include <stdbool.h>
> +
> +static bool return_false(void)
> +{
> +	return false;
> +}

Do we want tests that depend on system header files?

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 2/3] sparse, llvm: Add test case for <stdbool.h> type
Date: Wed, 21 Dec 2011 10:18:32 +0000
Message-ID: <CAOJsxLEOy+=xYUTieDpx6=GLUUXpCW0tv4g_Xd0Ow_qz3D7a6Q () mail ! gmail ! com>
--------------------
On Wed, Dec 21, 2011 at 11:25:27AM +0200, Pekka Enberg wrote:
>> As it turns out, our validation test harness doesn't catch <stdbool.h> related
>> breakage so add a minimal test case that does.
> [...]
>> --- /dev/null
>> +++ b/validation/backend/bool-test.c
>> @@ -0,0 +1,11 @@
>> +#include <stdbool.h>
>> +
>> +static bool return_false(void)
>> +{
>> +     return false;
>> +}

On Wed, Dec 21, 2011 at 11:58 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> Do we want tests that depend on system header files?

I changed it to use _Bool instead. Thanks!
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/3] sparse, llvm: Add test case for <stdbool.h> type
Date: Thu, 22 Dec 2011 00:23:04 +0000
Message-ID: <CANeU7QmBSjM+d3atTakQpUPKLY7hmRxfH044uAigMF8GevaAjg () mail ! gmail ! com>
--------------------
On Wed, Dec 21, 2011 at 2:18 AM, Pekka Enberg <penberg@kernel.org> wrote:
> On Wed, Dec 21, 2011 at 11:58 AM, Josh Triplett <josh@joshtriplett.org> wrote:
>> Do we want tests that depend on system header files?
>
> I changed it to use _Bool instead. Thanks!

This series looks great to me.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 2/3] sparse, llvm: Add test case for <stdbool.h> type
Date: Thu, 22 Dec 2011 05:53:26 +0000
Message-ID: <1324533207.1428.318.camel () jaguar>
--------------------
On Wed, Dec 21, 2011 at 11:58 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> >> Do we want tests that depend on system header files?

On Wed, Dec 21, 2011 at 2:18 AM, Pekka Enberg <penberg@kernel.org> wrote:
> > I changed it to use _Bool instead. Thanks!

On Wed, 2011-12-21 at 16:23 -0800, Christopher Li wrote:
> This series looks great to me.

The patches are in master branch of:

  git://github.com/penberg/sparse-llvm.git

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/3] sparse, llvm: Fix 'extern' symbol code generation ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 2/3] sparse, llvm: Fix 'extern' symbol code generation
Date: Mon, 21 Nov 2011 20:03:29 +0000
Message-ID: <1321905810-2253-2-git-send-email-penberg () kernel ! org>
--------------------
LLVMExternalLinkage is used for both extern and non-extern C symbols. The
linkage is differentiated by LLVMSetInitializer() which is should not be called
for extern symbols.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index ca49a6e..1a2a34d 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -1090,7 +1090,8 @@ static LLVMValueRef output_data(LLVMModuleRef module, struct symbol *sym)
 
 	LLVMSetLinkage(data, data_linkage(sym));
 
-	LLVMSetInitializer(data, initial_value);
+	if (!(sym->ctype.modifiers & MOD_EXTERN))
+		LLVMSetInitializer(data, initial_value);
 
 	return data;
 }
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/5] sparse: Enable unhandled validation tests ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 2/5] sparse: Enable unhandled validation tests
Date: Mon, 22 Aug 2011 15:24:01 +0000
Message-ID: <20110822152401.GB21442 () leaf>
--------------------
On Mon, Aug 22, 2011 at 04:57:28PM +0300, Pekka Enberg wrote:
> This patch enables unhandled tests that did not have "check-name" specified.
> It's pointless not to run them.
[...]
> --- a/validation/badtype1.c
> +++ b/validation/badtype1.c
> @@ -1 +1,6 @@
>  static void foo(enum bar baz);
> +
> +/*
> + * check-name: enum not in scope
> + * check-known-to-fail
> + */
[...]
> --- a/validation/struct-ns2.c
> +++ b/validation/struct-ns2.c
> @@ -12,3 +12,8 @@ h (void)
>    struct Bar y;
>    y.i = 1;
>  }
> +
> +/*
> + * check-name: struct not in scope
> + * check-known-to-fail
> + */

Ouch, case in point; I didn't know these two tests had broken.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/5] sparse: Enable unhandled validation tests
Date: Wed, 24 Aug 2011 21:05:51 +0000
Message-ID: <CANeU7Q=xwx6TNA9PE_30=9i+KrCF0gRfXm2UPAXBpCg-7uncPg () mail ! gmail ! com>
--------------------
On Mon, Aug 22, 2011 at 6:57 AM, Pekka Enberg <penberg@kernel.org> wrote:
> This patch enables unhandled tests that did not have "check-name" specified.
> It's pointless not to run them.

Good catch. Applied.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 2/5] sparse: Enable unhandled validation tests
Date: Thu, 25 Aug 2011 10:30:20 +0000
Message-ID: <4E56243C.1070906 () kernel ! org>
--------------------
On 8/25/11 12:05 AM, Christopher Li wrote:
> On Mon, Aug 22, 2011 at 6:57 AM, Pekka Enberg<penberg@kernel.org>  wrote:
>> This patch enables unhandled tests that did not have "check-name" specified.
>> It's pointless not to run them.
> Good catch. Applied.
>
Is there something wrong with the following patches?

[PATCH 3/5] sparse: Fix __builtin_safe_p for pure and const functions
[PATCH 4/5] sparse, i386: Fix boolean bit size

Or haven't you gotten to them yet?
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/5] sparse: Enable unhandled validation tests
Date: Fri, 26 Aug 2011 03:42:54 +0000
Message-ID: <CANeU7QkykP-5cfgtQvQ5Sa69uxSu9QBMkCxbLLytY7mK0h8dRg () mail ! gmail ! com>
--------------------
On Thu, Aug 25, 2011 at 3:30 AM, Pekka Enberg <penberg@kernel.org> wrote:
> [PATCH 3/5] sparse: Fix __builtin_safe_p for pure and const functions

My fault. I have been travelling with limited Internet access.

Nothing serious wrong in this patch. This patch is much harder than the
other minor fix ups. So good progress on your sparse hacking.

There are two things I am considering and I am try some simple modifications,
which did not go very far yet.
1) It would be better not adding the attribute bits into the modifiers.
   We have been moving the attribute bits out of the modifiers.
   For very simple reason, it the modifier has very limited number of bits.
   We need better infrastructure support from storing attribute in general
   any way.

   On the other hand, there are a few other attribute bits are done it the
   same way so that is not your fault. Not adding to the modifier bits is
   a much bigger change.

2) The expand_symbol_call(), it return early if the pure bit is set.
    That might have unwanted side effect if the pure attribute is combine
    with the symbol that require expand. e.g. If some one apply pure attribute
    to symbol __builtin_const_p (I agree it is silly BTW), then
__buildin_const_p
    will not expand properly. I would move the return statement a few
lines below

Over all I am tempting to just apply it and fix the rest when we clean up
the attribute bits.

Actually, I just did that. Push to the chrisl repository, you can check if that
works for you or not.

> [PATCH 4/5] sparse, i386: Fix boolean bit size

I will reply in the original email.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/3] Make 'linearize_return()' helper function ===

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: [PATCH 3/3] Make 'linearize_return()' helper function
Date: Sat, 27 Aug 2011 21:28:51 +0000
Message-ID: <alpine.LFD.2.02.1108271427540.18733 () i5 ! linux-foundation ! org>
--------------------

From: Linus Torvalds <torvalds@linux-foundation.org>
Date: Sat, 27 Aug 2011 11:43:24 -0700
Subject: [PATCH 3/3] Make 'linearize_return()' helper function

Rather than do it in that huge 'linearize_statement()' function, split
out the return generation case.  Avoids one level of indentation, and
makes for simpler and more straightforward functions.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
---

You'd think "return" is easily linearized, but it's actually not at all 
trivial. Inline functions and all that..

 linearize.c |   48 ++++++++++++++++++++++++++----------------------
 1 files changed, 26 insertions(+), 22 deletions(-)

diff --git a/linearize.c b/linearize.c
index e48854755b1e..320972745d6d 100644
--- a/linearize.c
+++ b/linearize.c
@@ -1843,6 +1843,30 @@ static pseudo_t linearize_declaration(struct entrypoint *ep, struct statement *s
 	return VOID;
 }
 
+static pseudo_t linearize_return(struct entrypoint *ep, struct statement *stmt)
+{
+	struct expression *expr = stmt->expression;
+	struct basic_block *bb_return = get_bound_block(ep, stmt->ret_target);
+	struct basic_block *active;
+	pseudo_t src = linearize_expression(ep, expr);
+	active = ep->active;
+	if (active && src != &void_pseudo) {
+		struct instruction *phi_node = first_instruction(bb_return->insns);
+		pseudo_t phi;
+		if (!phi_node) {
+			phi_node = alloc_typed_instruction(OP_PHI, expr->ctype);
+			phi_node->target = alloc_pseudo(phi_node);
+			phi_node->bb = bb_return;
+			add_instruction(&bb_return->insns, phi_node);
+		}
+		phi = alloc_phi(active, src, type_size(expr->ctype));
+		phi->ident = &return_ident;
+		use_pseudo(phi_node, phi, add_pseudo(&phi_node->phi_list, phi));
+	}
+	add_goto(ep, bb_return);
+	return VOID;
+}
+
 static pseudo_t linearize_switch(struct entrypoint *ep, struct statement *stmt)
 {
 	struct symbol *sym;
@@ -1980,28 +2004,8 @@ pseudo_t linearize_statement(struct entrypoint *ep, struct statement *stmt)
 	case STMT_ASM:
 		return linearize_asm_statement(ep, stmt);
 
-	case STMT_RETURN: {
-		struct expression *expr = stmt->expression;
-		struct basic_block *bb_return = get_bound_block(ep, stmt->ret_target);
-		struct basic_block *active;
-		pseudo_t src = linearize_expression(ep, expr);
-		active = ep->active;
-		if (active && src != &void_pseudo) {
-			struct instruction *phi_node = first_instruction(bb_return->insns);
-			pseudo_t phi;
-			if (!phi_node) {
-				phi_node = alloc_typed_instruction(OP_PHI, expr->ctype);
-				phi_node->target = alloc_pseudo(phi_node);
-				phi_node->bb = bb_return;
-				add_instruction(&bb_return->insns, phi_node);
-			}
-			phi = alloc_phi(active, src, type_size(expr->ctype));
-			phi->ident = &return_ident;
-			use_pseudo(phi_node, phi, add_pseudo(&phi_node->phi_list, phi));
-		}
-		add_goto(ep, bb_return);
-		return VOID;
-	}
+	case STMT_RETURN:
+		return linearize_return(ep, stmt);
 
 	case STMT_CASE: {
 		add_label(ep, stmt->case_label);
-- 
1.7.6.409.ge7a85.dirty

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/3] Revert "sparse: Bump up sizeof(_Bool) to 8 bits" ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 3/3] Revert "sparse: Bump up sizeof(_Bool) to 8 bits"
Date: Wed, 21 Dec 2011 09:25:28 +0000
Message-ID: <1324459528-9344-3-git-send-email-penberg () kernel ! org>
--------------------
This reverts commit 2ded1e7406914eda77abde035416140849d76f68. It's no longer
needed as LLVM backend supports 1-bit integers.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 target.c                 |    2 +-
 validation/sizeof-bool.c |    6 +++++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/target.c b/target.c
index 6a535bc..17b228a 100644
--- a/target.c
+++ b/target.c
@@ -14,7 +14,7 @@ int max_alignment = 16;
 /*
  * Integer data types
  */
-int bits_in_bool = 8;
+int bits_in_bool = 1;
 int bits_in_char = 8;
 int bits_in_short = 16;
 int bits_in_int = 32;
diff --git a/validation/sizeof-bool.c b/validation/sizeof-bool.c
index 71ae1bc..6c68748 100644
--- a/validation/sizeof-bool.c
+++ b/validation/sizeof-bool.c
@@ -4,5 +4,9 @@ static int a(void)
 }
 /*
  * check-name: sizeof(_Bool) is valid
- * check-description: sizeof(_Bool) is valid
+ * check-description: sizeof(_Bool) was rejected because _Bool is not an even
+ * number of bytes
+ * check-error-start
+sizeof-bool.c:3:16: warning: expression using sizeof bool
+ * check-error-end
  */
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/3] evaluate: warn on identical exprs on ?: ===

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: [PATCH 3/3] evaluate: warn on identical exprs on ?:
Date: Sat, 27 Aug 2011 22:26:55 +0000
Message-ID: <1314484015-7694-3-git-send-email-chrisf () ijw ! co ! nz>
--------------------
Adds a warning when identical expressions are found on both the true and false branches of ?:. This is another common copy-paste error.

Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>
---
 evaluate.c                                 |    8 +++++++-
 validation/check_identical_exprs_on_cond.c |   13 +++++++++++++
 2 files changed, 20 insertions(+), 1 deletions(-)
 create mode 100644 validation/check_identical_exprs_on_cond.c

diff --git a/evaluate.c b/evaluate.c
index 11de7aa..c339e63 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -898,7 +898,7 @@ static int expr_list_equiv(struct expression_list *lhs,
 int expr_equiv(struct expression *lhs, struct expression *rhs)
 {
 	/* recursively determine if lhs ~ rhs. */
-	if (!lhs ^ !rhs) return 0;
+	if (!lhs || !rhs) return 0;
 
 	if (lhs->type != rhs->type) return 0;
 	if (lhs->flags != rhs->flags) return 0;
@@ -1220,6 +1220,12 @@ static struct symbol *evaluate_conditional_expression(struct expression *expr)
 	const char * typediff;
 	int qual;
 
+	if (!preprocessing) {
+		if (expr_equiv(expr->cond_true, expr->cond_false))
+			warning(expr->pos, "identical expressions on both "
+				"branches of '?:'");
+	}
+
 	if (!evaluate_conditional(expr->conditional, 0))
 		return NULL;
 	if (!evaluate_expression(expr->cond_false))
diff --git a/validation/check_identical_exprs_on_cond.c b/validation/check_identical_exprs_on_cond.c
new file mode 100644
index 0000000..85a9938
--- /dev/null
+++ b/validation/check_identical_exprs_on_cond.c
@@ -0,0 +1,13 @@
+extern void bar(void);
+
+static void foo(void *a, void *b, void *c)
+{
+	void * d = a ? b : b; /* should warn */
+}
+/*
+ * check-name: A warning should be issued for identical expressions on both the true and false branches of the '?:' operator.
+ *
+ * check-error-start
+check_identical_exprs_on_cond.c:5:22: warning: identical expressions on both branches of '?:'
+ * check-error-end
+ */
-- 
1.7.4.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 3/3] evaluate: warn on identical exprs on ?:
Date: Sun, 28 Aug 2011 02:46:19 +0000
Message-ID: <20110828024618.GA20823 () leaf>
--------------------
On Sun, Aug 28, 2011 at 10:26:55AM +1200, Chris Forbes wrote:
> Adds a warning when identical expressions are found on both the true and false branches of ?:. This is another common copy-paste error.
> 
> Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>
> ---
>  evaluate.c                                 |    8 +++++++-
>  validation/check_identical_exprs_on_cond.c |   13 +++++++++++++
>  2 files changed, 20 insertions(+), 1 deletions(-)
>  create mode 100644 validation/check_identical_exprs_on_cond.c
> 
> diff --git a/evaluate.c b/evaluate.c
> index 11de7aa..c339e63 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -898,7 +898,7 @@ static int expr_list_equiv(struct expression_list *lhs,
>  int expr_equiv(struct expression *lhs, struct expression *rhs)
>  {
>  	/* recursively determine if lhs ~ rhs. */
> -	if (!lhs ^ !rhs) return 0;
> +	if (!lhs || !rhs) return 0;

You introduced this earlier in the same patch series.  This looks like
it needs some patch cleanup.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: [PATCH 3/3] evaluate: warn on identical exprs on ?:
Date: Sun, 28 Aug 2011 03:14:20 +0000
Message-ID: <1314501260-27254-3-git-send-email-chrisf () ijw ! co ! nz>
--------------------
Adds a warning when identical expressions are found on both the true and false branches of ?:. This is another common copy-paste error.

Signed-off-by: Chris Forbes <chrisf@ijw.co.nz>
---
 evaluate.c                                 |    6 ++++++
 validation/check_identical_exprs_on_cond.c |   13 +++++++++++++
 2 files changed, 19 insertions(+), 0 deletions(-)
 create mode 100644 validation/check_identical_exprs_on_cond.c

diff --git a/evaluate.c b/evaluate.c
index 0e5d691..c339e63 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -1220,6 +1220,12 @@ static struct symbol *evaluate_conditional_expression(struct expression *expr)
 	const char * typediff;
 	int qual;
 
+	if (!preprocessing) {
+		if (expr_equiv(expr->cond_true, expr->cond_false))
+			warning(expr->pos, "identical expressions on both "
+				"branches of '?:'");
+	}
+
 	if (!evaluate_conditional(expr->conditional, 0))
 		return NULL;
 	if (!evaluate_expression(expr->cond_false))
diff --git a/validation/check_identical_exprs_on_cond.c b/validation/check_identical_exprs_on_cond.c
new file mode 100644
index 0000000..85a9938
--- /dev/null
+++ b/validation/check_identical_exprs_on_cond.c
@@ -0,0 +1,13 @@
+extern void bar(void);
+
+static void foo(void *a, void *b, void *c)
+{
+	void * d = a ? b : b; /* should warn */
+}
+/*
+ * check-name: A warning should be issued for identical expressions on both the true and false branches of the '?:' operator.
+ *
+ * check-error-start
+check_identical_exprs_on_cond.c:5:22: warning: identical expressions on both branches of '?:'
+ * check-error-end
+ */
-- 
1.7.4.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/3] sparse, llvm: Make llc output to stdout in sparsec ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH 3/3] sparse, llvm: Make llc output to stdout in sparsec
Date: Mon, 21 Nov 2011 20:03:30 +0000
Message-ID: <1321905810-2253-3-git-send-email-penberg () kernel ! org>
--------------------
This patch fixes a bug in 'sparsec' that made it generate empty object files.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparsec |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/sparsec b/sparsec
index 33e1a2b..9c90b30 100755
--- a/sparsec
+++ b/sparsec
@@ -34,7 +34,7 @@ TMPFILE=`mktemp -t tmp.XXXXXX`".o"
 
 $DIRNAME/sparse-llvm $SPARSEOPTS > $TMPLLVM
 
-llc $TMPLLVM | as -o $TMPFILE
+llc -o - $TMPLLVM | as -o $TMPFILE
 
 if [ $NEED_LINK -eq 1 ]; then
 	if [ -z $OUTFILE ]; then
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 4/5] sparse, i386: Fix boolean bit size ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 4/5] sparse, i386: Fix boolean bit size
Date: Mon, 22 Aug 2011 15:28:47 +0000
Message-ID: <20110822152847.GC21442 () leaf>
--------------------
On Mon, Aug 22, 2011 at 04:57:30PM +0300, Pekka Enberg wrote:
> The value of 'ctype->bit_size' is set to 1 for booleans which confuses the i386
> backend:
> 
>   ./compile allocate.c
>   compile: compile-i386.c:1406: emit_binop: Assertion `0' failed.
>   Aborted
> 
> Looking at the code, we assume that "bit_size / 8" gives a sane result on
> various places. This patch fixes the problem by bumping bit_size to 8 for
> booleans. This also makes sizeof(_Bool) return 1 which is consistent with what
> GCC 4.4.3, for example, does.

Seems reasonable; that would make it consistent with the behavior of
structs or arrays of bool, at least in GCC.  As far as I know, GCC
doesn't have any logic to attempt to compress a bool down to a single
bit of storage.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 4/5] sparse, i386: Fix boolean bit size
Date: Fri, 26 Aug 2011 03:59:49 +0000
Message-ID: <CANeU7QktGkA-u9x7FzDUosVjNfhYeNv0C9o0G9n=SmuivWeNpQ () mail ! gmail ! com>
--------------------
On Mon, Aug 22, 2011 at 6:57 AM, Pekka Enberg <penberg@kernel.org> wrote:
> The value of 'ctype->bit_size' is set to 1 for booleans which confuses the i386
> backend:
>
>  ./compile allocate.c
>  compile: compile-i386.c:1406: emit_binop: Assertion `0' failed.
>  Aborted
>
> Looking at the code, we assume that "bit_size / 8" gives a sane result on
> various places. This patch fixes the problem by bumping bit_size to 8 for
> booleans. This also makes sizeof(_Bool) return 1 which is consistent with what
> GCC 4.4.3, for example, does.
>
> diff --git a/target.c b/target.c
> index 17b228a..6a535bc 100644
> --- a/target.c
> +++ b/target.c
> @@ -14,7 +14,7 @@ int max_alignment = 16;
>  /*
>  * Integer data types
>  */
> -int bits_in_bool = 1;
> +int bits_in_bool = 8;

I object this part. I consider the sizeof(_Bool) == 1 as external behaviour.
But internally we should know that the real useful part of bool is in just one
bit, not any bit of that  1 byte storage.

Allowing _Bool to be addressable is a separate issue. I consider those
rest of 7 bit as paddings. Not the useful part of _Bool.

>  int bits_in_char = 8;
>  int bits_in_short = 16;
>  int bits_in_int = 32;
> diff --git a/validation/sizeof-bool.c b/validation/sizeof-bool.c
> index 6c68748..31b0585 100644
> --- a/validation/sizeof-bool.c
> +++ b/validation/sizeof-bool.c
> @@ -4,9 +4,6 @@ static int a(void)
>  }
>  /*
>  * check-name: sizeof(_Bool) is valid
> - * check-description: sizeof(_Bool) was rejected because _Bool is not an even
> - * number of bytes
>  * check-error-start
> -sizeof-bool.c:3:16: warning: expression using sizeof bool
>  * check-error-end
>  */

We should just fix the validation.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 4/5] sparse, i386: Fix boolean bit size
Date: Fri, 26 Aug 2011 05:28:05 +0000
Message-ID: <CAOJsxLG6OFC6tBYQtHu7k_3bYKWeag0cGiogG4XYQM6tCUeTgQ () mail ! gmail ! com>
--------------------
On Fri, Aug 26, 2011 at 6:59 AM, Christopher Li <sparse@chrisli.org> wrote:
> On Mon, Aug 22, 2011 at 6:57 AM, Pekka Enberg <penberg@kernel.org> wrote:
>> The value of 'ctype->bit_size' is set to 1 for booleans which confuses the i386
>> backend:
>>
>>  ./compile allocate.c
>>  compile: compile-i386.c:1406: emit_binop: Assertion `0' failed.
>>  Aborted
>>
>> Looking at the code, we assume that "bit_size / 8" gives a sane result on
>> various places. This patch fixes the problem by bumping bit_size to 8 for
>> booleans. This also makes sizeof(_Bool) return 1 which is consistent with what
>> GCC 4.4.3, for example, does.
>>
>> diff --git a/target.c b/target.c
>> index 17b228a..6a535bc 100644
>> --- a/target.c
>> +++ b/target.c
>> @@ -14,7 +14,7 @@ int max_alignment = 16;
>>  /*
>>  * Integer data types
>>  */
>> -int bits_in_bool = 1;
>> +int bits_in_bool = 8;
>
> I object this part. I consider the sizeof(_Bool) == 1 as external behaviour.
> But internally we should know that the real useful part of bool is in just one
> bit, not any bit of that  1 byte storage.

You missed the most important part of my reasoning: sparse code
already expects "bit_size / 8" to return a non-zero number and it's
not just compile-i386.c! So while I don't disagree with you that we
should internally know that a bool is just one bit, I don't consider
that to be relevant for this particular patch.

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 4/5] sparse, i386: Fix boolean bit size
Date: Fri, 26 Aug 2011 06:26:29 +0000
Message-ID: <CAOJsxLEfoSizTVvcNb0sTyXR1eE5-RksqRAm6s8i1WrNJ68-0g () mail ! gmail ! com>
--------------------
On Fri, Aug 26, 2011 at 8:28 AM, Pekka Enberg <penberg@kernel.org> wrote:
> On Fri, Aug 26, 2011 at 6:59 AM, Christopher Li <sparse@chrisli.org> wrote:
>> On Mon, Aug 22, 2011 at 6:57 AM, Pekka Enberg <penberg@kernel.org> wrote:
>>> The value of 'ctype->bit_size' is set to 1 for booleans which confuses the i386
>>> backend:
>>>
>>>  ./compile allocate.c
>>>  compile: compile-i386.c:1406: emit_binop: Assertion `0' failed.
>>>  Aborted
>>>
>>> Looking at the code, we assume that "bit_size / 8" gives a sane result on
>>> various places. This patch fixes the problem by bumping bit_size to 8 for
>>> booleans. This also makes sizeof(_Bool) return 1 which is consistent with what
>>> GCC 4.4.3, for example, does.
>>>
>>> diff --git a/target.c b/target.c
>>> index 17b228a..6a535bc 100644
>>> --- a/target.c
>>> +++ b/target.c
>>> @@ -14,7 +14,7 @@ int max_alignment = 16;
>>>  /*
>>>  * Integer data types
>>>  */
>>> -int bits_in_bool = 1;
>>> +int bits_in_bool = 8;
>>
>> I object this part. I consider the sizeof(_Bool) == 1 as external behaviour.
>> But internally we should know that the real useful part of bool is in just one
>> bit, not any bit of that  1 byte storage.
>
> You missed the most important part of my reasoning: sparse code
> already expects "bit_size / 8" to return a non-zero number and it's
> not just compile-i386.c! So while I don't disagree with you that we
> should internally know that a bool is just one bit, I don't consider
> that to be relevant for this particular patch.

Oh, I see the same problem with sparse-llvm when generating code for OP_CAST.

This little C function:

  int sete(int x, int y)
  {
    return x == y;
  }

is compiled by GCC to:

00000170 <setne>:
 170:	55                   	push   %ebp
 171:	89 e5                	mov    %esp,%ebp
 173:	8b 45 0c             	mov    0xc(%ebp),%eax
 176:	39 45 08             	cmp    %eax,0x8(%ebp)
 179:	5d                   	pop    %ebp
 17a:	0f 95 c0             	setne  %al
 17d:	0f b6 c0             	movzbl %al,%eax
 180:	c3                   	ret

Sparse-llvm compiles the code to this which seems wrong:

00000140 <sete>:
 140:	31 c9                	xor    %ecx,%ecx
 142:	8b 44 24 08          	mov    0x8(%esp),%eax
 146:	39 44 24 04          	cmp    %eax,0x4(%esp)
 14a:	b8 ff ff ff ff       	mov    $0xffffffff,%eax
 14f:	0f 45 c1             	cmovne %ecx,%eax
 152:	c3                   	ret

However, if I bump up 'bits_in_bool' to 32:

diff --git a/target.c b/target.c
index 17b228a..2b83498 100644
--- a/target.c
+++ b/target.c
@@ -14,7 +14,7 @@ int max_alignment = 16;
 /*
  * Integer data types
  */
-int bits_in_bool = 1;
+int bits_in_bool = 32;
 int bits_in_char = 8;
 int bits_in_short = 16;
 int bits_in_int = 32;

I get this from sparse-llvm:

00000140 <sete>:
 140:	8b 44 24 08          	mov    0x8(%esp),%eax
 144:	39 44 24 04          	cmp    %eax,0x4(%esp)
 148:	0f 94 c0             	sete   %al
 14b:	c3                   	ret

I don't know sparse well enough to know what's the right thing to do
here. Linus, Jeff, Chris, someone, anyone, help!!!

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 5/5] sparse: Add end-to-end compiler shell script ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH 5/5] sparse: Add end-to-end compiler shell script
Date: Thu, 25 Aug 2011 10:28:59 +0000
Message-ID: <4E5623EB.10707 () kernel ! org>
--------------------
On 8/22/11 5:51 PM, Jeff Garzik wrote:
> On 08/22/2011 09:57 AM, Pekka Enberg wrote:
>> This patch adds a 'kcc' shell script that combines the sparse's i386 
>> backend
>> with GCC and GNU assembler to make it easier for people to find bugs 
>> in sparse.
>> You can, for example, attempt to build sparse with itself and see it 
>> crash and
>> burn:
>>
>>    make&&  find . -name "*.o" | xargs rm
>>    make CC=./kcc
>>         CC       test-lexing.o
>>    FIXME! no value for symbol preprocess_only.  creating pseudo 1 
>> (stack offset 4)
>>    {standard input}: Assembler messages:
>>    {standard input}:79: Error: operand type mismatch for `mov'
>>    make: *** [test-lexing.o] Error 1
>>
>> Cc: Christopher Li<sparse@chrisli.org>
>> Cc: Jeff Garzik<jgarzik@redhat.com>
>> Cc: Linus Torvalds<torvalds@linux-foundation.org>
>> Signed-off-by: Pekka Enberg<penberg@kernel.org>
>
> For the record, the i386 backend is quite incomplete and awful.
>
> Ideally, an sparse compiler would work from linearized output, not 
> from walking the tree as compile-i386 does.

Christopher, please drop this patch. I'm not planning to continue
hacking on compile-i386.c.

                                     Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2] sparse: Reduce 'test-suite' run output ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Reduce 'test-suite' run output
Date: Wed, 31 Aug 2011 00:42:28 +0000
Message-ID: <CANeU7QmpvS_qVWifU32EjCb+oFM7gc7WJ3qW5ERiQxvL9mmfTQ () mail ! gmail ! com>
--------------------
On Tue, Aug 30, 2011 at 12:24 PM, Pekka Enberg <penberg@kernel.org> wrote:
> -
> -       echo "     TEST    $test_name ($file)"
> +       if test -t 1; then
> +               printf "\r     TEST    %-80s" "$file ($test_name)"
> +       else
> +               echo "     TEST    $test_name ($file)"
> +       fi

Can you test the terminal once and save the result to a local variable?
There is no need to run the test over and over again for every line of output.

>                if [ "$?" -ne "0" ]; then
> +                       echo ""

Please just echo. Empty argument is not necessary.
Also, shouldn't this wrap by "if terminial" test as well?
You are adding new lines for non terminal case.

>                        error "actual $stream text does not match expected $stream text."
>                        error  "see $file.$stream.* for further investigation."
>                        cat "$file".$stream.diff
> @@ -163,6 +167,7 @@ do_test_suite()
>
>        # prints some numbers
>        tests_nr=`expr $ok_tests + $ko_tests`
> +       echo ""

Same here.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] FAQ: update the website address and call it Wiki ===

From: =?UTF-8?q?Jonathan=20Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: [PATCH] FAQ: update the website address and call it Wiki
Date: Mon, 22 Aug 2011 20:18:14 +0000
Message-ID: <1314044294-27704-1-git-send-email-j.neuschaefer () gmx ! net>
--------------------
Signed-off-by: Jonathan NeuschÃ¤fer <j.neuschaefer@gmx.net>
---
 FAQ |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/FAQ b/FAQ
index 4cad826..290de0e 100644
--- a/FAQ
+++ b/FAQ
@@ -88,7 +88,7 @@ A.  Yeah, well...  It parses a fairly complete subset of "extended C" as
 
 Q.  What other sparse resources are available?
 
-A.  Website: http://www.kernel.org/pub/software/devel/sparse/
+A.  Wiki: http://sparse.wiki.kernel.org/index.php/Main_Page
 
     Mailing list: linux-sparse@vger.kernel.org
     See http://vger.kernel.org/vger-lists.html#linux-sparse for subscription
-- 
1.7.5.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] Makefile: warn user when libxml and/or libgtk2 are not available ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] Makefile: warn user when libxml and/or libgtk2 are not available
Date: Wed, 09 Mar 2011 17:42:52 +0000
Message-ID: <AANLkTinFZsQG9tjishsKs-ntLPwN5xM0izbVihnPRKP2 () mail ! gmail ! com>
--------------------
On Wed, Mar 9, 2011 at 6:06 AM, Florian Fainelli <f.fainelli@gmail.com> wrote:
>
> Is this version okay with you? Shall I re-submit the patch as a separate email?

This version is fine. I will apply it today.

Thanks for the patch.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI ===

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 10:04:15 +0000
Message-ID: <4E5A129F.1090801 () garzik ! org>
--------------------
On 08/28/2011 01:16 AM, Pekka Enberg wrote:
> On Sat, 27 Aug 2011, Jeff Garzik wrote:
>> OK, I lied. Function call support (OP_CALL) sent your way via github
>> pull request.
>
> Pulled, thanks!

(added list to CC)

Just sent another, tiny pull req.  That's it for tonight.

Random thoughts / backend status:

* it will soon be necessary to pay more attention to target-specific 
details.  we need some mechanism for specifying i386, x86-64, etc. so 
that we may fill in bits_in_pointer and similar values properly.  This 
may involve some sparse hacking IIRC, because sparse (used to be?) 
largely hardcoded to use i386 target values when checking.  Or maybe 
this is already done, and I just am ignorant of that area of the code.

* playing with some simple loop test cases, we are blocked on properly 
listing out all phi's in an OP_PHI.  sparse correctly sends us 
OP_PHISOURCE, and test-linearize output looks good, but if the phisrc is 
from a succeeding basic block, we may lack 'priv' necessary to fill in 
LLVMValueRef required by LLVM phi machinery.

* my development workflow is very simple.  create testcase; look at 
test-linearize output; observe how linearize.c's show_instruction() and 
show_pseudo() walk their data structures; copy this into sparse-llvm.

* it would be nice to get "printf(hello world)" working all the way 
through sparsec.

* need to start integrating struct support.  LLVM has a type system 
where one defines data structures in the IR, then uses 'getelementptr' 
LLVM instruction to build addresses for complex load/store operations. 
The Linux kernel uses a lot of function calls (indirect branches) from 
values buried deep within a struct.

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 10:18:33 +0000
Message-ID: <4E5A15F9.2090007 () garzik ! org>
--------------------
> Random thoughts / backend status:

And,

* a "make check" that exercises our known-working backend tests all the 
way through compilation, linking and execution would be VERY helpful. 
i.e. pass values to the binops tests, and make sure we receive expected 
results.

In the early stages, this may mean linking with a gcc-compiled test harness?

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 17:04:54 +0000
Message-ID: <CA+55aFw5VYSXduhXrtQx5CM4ubvOoHtrbyF74Y_wOQpBxE6Vmw () mail ! gmail ! com>
--------------------
On Sun, Aug 28, 2011 at 3:04 AM, Jeff Garzik <jeff@garzik.org> wrote:
>
> * need to start integrating struct support.  LLVM has a type system where
> one defines data structures in the IR, then uses 'getelementptr' LLVM
> instruction to build addresses for complex load/store operations. The Linux
> kernel uses a lot of function calls (indirect branches) from values buried
> deep within a struct.

You really shouldn't need to do that.

You should consider all types to be just "blocks of memory", and
sparse has already calculated all offsets etc for you. As far as LLVM
is concerned, the memory has no structure, it's just a blob.

Sometimes you cannot even get the "element" name. Look at
./test-linearize output of something like this:

  struct hello {
    int a,b,c;
  };

  int bar(struct hello *arg)
  {
	return ((char *)&arg->b)[1] + arg->c;
  }

and realize that that byte access isn't accessing an element at all -
it's just accessing a *part* of an element. The more complicated cases
is actually when you access multiple elements in one go.

And sparse has figured all that out for you already, done the alias
analysis (ok, just stupid overlap analysis) etc.

Btw, if you look at test-linearize output for that, you'll see the
"ptrcast" thing. We don't simplify that away, so you will see
something like

	add.32      %r2 <- %arg1, $4
	ptrcast.32  %r3 <- (32) %r2
	load.8      %r4 <- 1[%r3]

instead of just

	load.8      %r4 <- 5[%arg1]

but that's just a small "I left all pointer casts around, even if they
don't do anything" detail.

                           Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 18:23:00 +0000
Message-ID: <CA+55aFxm9vB8mFFy7y4pctyOeOE=8CjYUvL1mDdOnp2CihPd9w () mail ! gmail ! com>
--------------------
On Sun, Aug 28, 2011 at 10:52 AM, Josh Triplett <josh@joshtriplett.org> wrote:
>>
>> You should consider all types to be just "blocks of memory", and
>> sparse has already calculated all offsets etc for you. As far as LLVM
>> is concerned, the memory has no structure, it's just a blob.
>
> I suspect LLVM's optimization passes won't particularly care for that
> approach.

That's fine. We've already done the CSE and alias analysis on the
thing. And as mentioned, trying to turn overlapping (or partial)
accesses into some "named accesses" is just *wrong*. They weren't
named in the C code either. They are accesses through pointer
arithmetic. Trying to make them be somehow named would just be crazy.

                       Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 19:31:45 +0000
Message-ID: <4E5A97A1.4010504 () garzik ! org>
--------------------
On 08/28/2011 01:04 PM, Linus Torvalds wrote:
> On Sun, Aug 28, 2011 at 3:04 AM, Jeff Garzik<jeff@garzik.org>  wrote:
>>
>> * need to start integrating struct support.  LLVM has a type system where
>> one defines data structures in the IR, then uses 'getelementptr' LLVM
>> instruction to build addresses for complex load/store operations. The Linux
>> kernel uses a lot of function calls (indirect branches) from values buried
>> deep within a struct.
>
> You really shouldn't need to do that.
>
> You should consider all types to be just "blocks of memory", and
> sparse has already calculated all offsets etc for you. As far as LLVM
> is concerned, the memory has no structure, it's just a blob.

We _already_ do this in the backend, and LLVM supports 
LOAD-from-random-address just fine:
https://github.com/penberg/sparse-llvm/blob/master/sparse-llvm.c#L325

But that comment was thinking more medium term, supporting multiple 
platforms means properly handling struct layout in memory, which gets 
into the realm of platform-specific ABIs.

It didn't seem like we would want to encode a ton of ABI detail into the 
sparse C front-end.  But it sounds like there will be a lot of ABI 
detail found, if sparse is doing all the memory layout and such.


> Sometimes you cannot even get the "element" name. Look at
> ./test-linearize output of something like this:

Nobody cares about the element name, least of all LLVM.  LLVM provides a 
convenience naming feature, but you don't have to use that.

ABI-dictated memory layout is the main detail to get right, across 
platforms.

	Jeff



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 19:33:34 +0000
Message-ID: <4E5A980E.70308 () garzik ! org>
--------------------
On 08/28/2011 02:23 PM, Linus Torvalds wrote:
> On Sun, Aug 28, 2011 at 10:52 AM, Josh Triplett<josh@joshtriplett.org>  wrote:
>>>
>>> You should consider all types to be just "blocks of memory", and
>>> sparse has already calculated all offsets etc for you. As far as LLVM
>>> is concerned, the memory has no structure, it's just a blob.
>>
>> I suspect LLVM's optimization passes won't particularly care for that
>> approach.
>
> That's fine. We've already done the CSE and alias analysis on the
> thing. And as mentioned, trying to turn overlapping (or partial)
> accesses into some "named accesses" is just *wrong*. They weren't
> named in the C code either. They are accesses through pointer
> arithmetic. Trying to make them be somehow named would just be crazy.

LLVM just cares about layout.

It does not care about naming (or lack thereof).  Nobody/nothing is 
trying to make them named.

	Jeff


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Sun, 28 Aug 2011 19:46:16 +0000
Message-ID: <CA+55aFwcfL16REFvFe7MLsnr73_24x86biPGu2XD+ZmocZR_mA () mail ! gmail ! com>
--------------------
On Sun, Aug 28, 2011 at 12:31 PM, Jeff Garzik <jeff@garzik.org> wrote:
>
> But that comment was thinking more medium term, supporting multiple
> platforms means properly handling struct layout in memory, which gets into
> the realm of platform-specific ABIs.
>
> It didn't seem like we would want to encode a ton of ABI detail into the
> sparse C front-end.  But it sounds like there will be a lot of ABI detail
> found, if sparse is doing all the memory layout and such.

But you *have* to encode it into the front end.

Things like size and alignment of types is exactly what sparse was all
about from the beginning. And if the front-end doesn't know the
offsets into structures, it cannot do any of the load/store
optimizations, which all very much depend on alias information, and
which are how sparse does a lot of the semantic analysis.

A number of the things sparse already does (ie the lock analysis etc)
very much depends on being able to do CSE over accesses to local
variables etc, which originally were memory operations - turning those
memops into registers etc is how sparse can follow things like
branches to branches and optimize them away, which it needs to handle
things like "if (trylock()) -> unlock" sequences.

Now, admittedly we could do much of that without necessarily handling
the *generic* case of loading/storing to structure members etc,
because the case we tend to care about in the sparse code analysis
phase tends to be about the trivial "local variable" case, so in that
sense sparse does a lot more than strictly necessary for just
following the code. But it's much nicer (I think) to have a tool that
really understands the code, than just apply patterns to it.

Of course, "just applying patterns to it" is actually what coccinelle
does, and it has been very successful. So ..

                      Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 14:42:49 +0000
Message-ID: <alpine.DEB.2.00.1108291741350.12047 () localhost6 ! localdomain6>
--------------------
On Sun, 28 Aug 2011, Jeff Garzik wrote:
> * it will soon be necessary to pay more attention to target-specific details. 
> we need some mechanism for specifying i386, x86-64, etc. so that we may fill 
> in bits_in_pointer and similar values properly.  This may involve some sparse 
> hacking IIRC, because sparse (used to be?) largely hardcoded to use i386 
> target values when checking.  Or maybe this is already done, and I just am 
> ignorant of that area of the code.


Can you think of anything else except target.c that needs to be fixed in 
sparse?

 			Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 14:45:00 +0000
Message-ID: <alpine.DEB.2.00.1108291743080.12047 () localhost6 ! localdomain6>
--------------------
On Sun, 28 Aug 2011, Jeff Garzik wrote:
>> Random thoughts / backend status:
>
> And,
>
> * a "make check" that exercises our known-working backend tests all the way 
> through compilation, linking and execution would be VERY helpful. i.e. pass 
> values to the binops tests, and make sure we receive expected results.
>
> In the early stages, this may mean linking with a gcc-compiled test harness?

Yes, makes sense. We could have a separate test-runner.c that's compiled 
by GCC. I'm not quite sure how to hook that up into 
validation/test-runner.c cleanly, though.

 			Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 15:14:39 +0000
Message-ID: <4E5BACDF.6050401 () garzik ! org>
--------------------
On 08/29/2011 10:42 AM, Pekka Enberg wrote:
> On Sun, 28 Aug 2011, Jeff Garzik wrote:
>> * it will soon be necessary to pay more attention to target-specific
>> details. we need some mechanism for specifying i386, x86-64, etc. so
>> that we may fill in bits_in_pointer and similar values properly. This
>> may involve some sparse hacking IIRC, because sparse (used to be?)
>> largely hardcoded to use i386 target values when checking. Or maybe
>> this is already done, and I just am ignorant of that area of the code.
>
>
> Can you think of anything else except target.c that needs to be fixed in
> sparse?

struct layout is what immediately comes to mind.  But it is mainly a 
"only time will tell" answer, most likely.

	Jeff




--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] Re: LLVM and PSEUDO_REG/PSEUDO_PHI
Date: Mon, 29 Aug 2011 16:16:40 +0000
Message-ID: <20110829161640.GA23515 () leaf>
--------------------
On Mon, Aug 29, 2011 at 05:42:49PM +0300, Pekka Enberg wrote:
> On Sun, 28 Aug 2011, Jeff Garzik wrote:
> >* it will soon be necessary to pay more attention to
> >target-specific details. we need some mechanism for specifying
> >i386, x86-64, etc. so that we may fill in bits_in_pointer and
> >similar values properly.  This may involve some sparse hacking
> >IIRC, because sparse (used to be?) largely hardcoded to use i386
> >target values when checking.  Or maybe this is already done, and I
> >just am ignorant of that area of the code.
> 
> Can you think of anything else except target.c that needs to be
> fixed in sparse?

Take a look at the cgcc script.  Most of what it does to handle
target-specific information should occur in sparse instead.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] cse: update PHI users when throwing away an instruction ===

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: [PATCH] cse: update PHI users when throwing away an instruction
Date: Sun, 28 Aug 2011 08:53:48 +0000
Message-ID: <4E5A021C.4000406 () garzik ! org>
--------------------
On 08/28/2011 02:33 AM, Pekka Enberg wrote:
> On Sat, Aug 27, 2011 at 4:39 PM, Kamil Dudka<kdudka@redhat.com>  wrote:
>>> The attached patch solves the dangling PHI nodes and does not seem to break
>>> anything at first glance.  It is probably not the most efficient solution,
>>> but it might at least show where to look for the problem.
>
> On Sun, Aug 28, 2011 at 3:34 AM, Linus Torvalds
> <torvalds@linux-foundation.org>  wrote:
>> Hmm. From a quick look, looks fine to me. And checks the kernel, and
>> does indeed get rid of the extraneous phi nodes in the test-case.
>>
>> Ack.
>
> I applied both patches to sparse-llvm.git. Jeff, do they cure all loop
> related issues?

They look promising...  Currently loops are stuck due to issues 
unrelated to core sparse:  OP_PHI does not show successor phi's due to 
->priv==NULL.  Loops definitely will not work without both predecessors 
and successors both having a correct ->priv pointing to LLVM data.

	Jeff




--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] evaluate: Allow sizeof(_Bool) to succeed. ===

From: Ben Pfaff <blp () nicira ! com>
To: linux-sparse
Subject: Re: [PATCH] evaluate: Allow sizeof(_Bool) to succeed.
Date: Thu, 12 May 2011 20:48:06 +0000
Message-ID: <20110512204806.GC3371 () nicira ! com>
--------------------
On Wed, May 11, 2011 at 05:09:42PM -0700, Christopher Li wrote:
> On Mon, May 9, 2011 at 1:49 PM, Ben Pfaff <blp@nicira.com> wrote:
> > I could change my IDL code generator to do something different for
> > this case, but I don't see anything actually wrong with it. ?This
> > userspace code is not performance-critical or sensitive to memory
> > usage, so it's not necessary on the face of it to optimize it.
> 
> Removing the warning will lose the chance to see it on other potential
> problematic usage. If you insist on no warning. You can submit a patch
> to add a switch to disable it. We have a lot of those for fine grain warning
> control. I just don't see this warning can hurt on the kernel checking side.

For now, I've decided to just rewrite code on the Open vSwitch side to
avoid sizeof(_Bool) entirely.  If it becomes a problem again, I'll
submit a -Wno-sizeof-bool patch.

Thanks for considering my reasons.

Ben
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] recognize binary constants ===

From: Kamal Mostafa <kamal () canonical ! com>
To: linux-sparse
Subject: Re: [PATCH] recognize binary constants
Date: Thu, 08 Sep 2011 17:47:30 +0000
Message-ID: <1315504050.2011.16.camel () marconi>
--------------------

--=-vgG7aYFYh08E3Ust3OCa
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

A small change to your patch, Dan:  I added a call to tolower(), since
"0B11" is also a valid syntax.

 -Kamal

---------------------------------------------------------------------------

=46rom a9273391fe5f410321a0668e18beaebce086e23d Mon Sep 17 00:00:00 2001
From: Kamal Mostafa <kamal@canonical.com>
Date: Thu, 8 Sep 2011 10:34:27 -0700
Subject: [PATCH] recognize binary constants

Sparse doesn't parse binary constants properly so the following code
generates an error:

	x =3D 0b11;

test.c:5:17: error: constant 0b11 is not a valid number

Reported-by: Kamal Mostafa <kamal@canonical.com>
Signed-off-by: Dan Carpenter <error27@gmail.com>
Signed-off-by: Kamal Mostafa <kamal@canonical.com>
---
 expression.c |    9 ++++++++-
 1 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/expression.c b/expression.c
index 7e06e60..07d6846 100644
--- a/expression.c
+++ b/expression.c
@@ -268,6 +268,13 @@ static struct token *string_expression(struct token *t=
oken, struct expression *e
 #define ULLONG_MAX (~0ULL)
 #endif
=20
+static unsigned long long parse_num(const char *nptr, char **end)
+{
+	if (nptr[0] =3D=3D '0' && tolower(nptr[1]) =3D=3D 'b')
+		return strtoull(&nptr[2], end, 2);
+	return strtoull(nptr, end, 0);
+}
+
 static void get_number_value(struct expression *expr, struct token *token)
 {
 	const char *str =3D token->number;
@@ -279,7 +286,7 @@ static void get_number_value(struct expression *expr, s=
truct token *token)
 	int bits;
=20
 	errno =3D 0;
-	value =3D strtoull(str, &end, 0);
+	value =3D parse_num(str, &end);
 	if (end =3D=3D str)
 		goto Float;
 	if (value =3D=3D ULLONG_MAX && errno =3D=3D ERANGE)
--=20
1.7.4.1



--=-vgG7aYFYh08E3Ust3OCa
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQIcBAABCAAGBQJOaP+vAAoJEOf3EFVUCeQiO+EP/0KZC8K7aPgluOt1pHUxuKqL
yiTyO1UtCsMvwyLVCPRYYS9thQvLME1YyQ1XKd33X2tPlR/uD4UDmIpNgyoAhDJE
UVVYbfIn+TYA97TpZ7PvZJ5tHKvSQSBHKnMEytLVK9pf+2hbQk4PTr3eH+IZMJbK
FcGjTsp6Bads71ziWtyKBmrQqa7CQC2vZiH0FCdj/H6lNYywrMrpc8Vyp7j9k4Yt
LRs9gy/MrJtGk7aWg8d275P5LBMZrAeDD6bDfqZ+BeOTGTMKx32wKkxrHL/4ZfjS
e3ekpkvYFCOpFi+xUCp172+6fs7gDQA+iNcHZLOmsFgmep0Bb5syRhHFIFHm2uAn
1C6znSiOWqTnpGZx73av/26wAhgY/Lm5NT2636rPPwSYBLvDsppSNzgrgFK9ie6W
2jL1FToouaqJEXLjFgqmaMmrrUED4FFVxYCjIHOIq2KheCzQRh490qyq9apdaBMY
U2bzFy9OMirdycmmToLGDkOxz/2MXCSMSvA8KzFSK0y39d/6pv+S7M4qKtVh/GCt
oAbBBll/ZCdshUSY7fCkhGm+L7eAopqEAnuillG7E/QJ7EnSD2RzsM7mtbWG87zY
li68fudZFEk3bVauQYc8X83sHTDXnZ98LEFm91FMrvu0iTwmqstxNLyIJULDL2M+
03Qkmzx0vyow27cK7nA0
=9j+n
-----END PGP SIGNATURE-----

--=-vgG7aYFYh08E3Ust3OCa--

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH] recognize binary constants
Date: Thu, 08 Sep 2011 18:11:30 +0000
Message-ID: <20110908181130.GC17041 () mwanda>
--------------------
On Thu, Sep 08, 2011 at 10:47:30AM -0700, Kamal Mostafa wrote:
> A small change to your patch, Dan:  I added a call to tolower(), since
> "0B11" is also a valid syntax.
> 

Doh...  Good point.  Thanks.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH] recognize binary constants
Date: Thu, 08 Sep 2011 18:11:30 +0000
Message-ID: <20110908181130.GC17041 () mwanda>
--------------------
On Thu, Sep 08, 2011 at 10:47:30AM -0700, Kamal Mostafa wrote:
> A small change to your patch, Dan:  I added a call to tolower(), since
> "0B11" is also a valid syntax.
> 

Doh...  Good point.  Thanks.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH] recognize binary constants
Date: Tue, 15 Nov 2011 19:35:35 +0000
Message-ID: <CA+_b7D+qrLK4EfDjf+gPM+291Khhz6EuJakT=N4N1R3HSHq+Nw () mail ! gmail ! com>
--------------------
On 9/8/11, Dan Carpenter <error27@gmail.com> wrote:
> Sparse doesn't parse binary constants properly so the following code
> generates an error:
>
> 	x = 0b11;
>
> test.c:5:17: error: constant 0b11 is not a valid number
>
> Reported-by: Kamal Mostafa <kamal@canonical.com>
> Signed-off-by: Dan Carpenter <error27@gmail.com>

I sent this patch before but the git tree was offline so everything
was dead.

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] recognize binary constants
Date: Thu, 17 Nov 2011 01:36:40 +0000
Message-ID: <CANeU7QnysJkdW0hdtYzGh5KNgVDy5y-8cX0o2q9oi1HiLBEoew () mail ! gmail ! com>
--------------------
On Tue, Nov 15, 2011 at 11:35 AM, Dan Carpenter <error27@gmail.com> wrote:
> On 9/8/11, Dan Carpenter <error27@gmail.com> wrote:
>> Sparse doesn't parse binary constants properly so the following code
>> generates an error:
>>
>>       x = 0b11;
>>
>> test.c:5:17: error: constant 0b11 is not a valid number
>>
>> Reported-by: Kamal Mostafa <kamal@canonical.com>
>> Signed-off-by: Dan Carpenter <error27@gmail.com>
>
> I sent this patch before but the git tree was offline so everything
> was dead.

Thanks for the reminder. The patch looks fine.

I will apply it.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] recognize binary constants
Date: Thu, 17 Nov 2011 01:36:40 +0000
Message-ID: <CANeU7QnysJkdW0hdtYzGh5KNgVDy5y-8cX0o2q9oi1HiLBEoew () mail ! gmail ! com>
--------------------
On Tue, Nov 15, 2011 at 11:35 AM, Dan Carpenter <error27@gmail.com> wrote:
> On 9/8/11, Dan Carpenter <error27@gmail.com> wrote:
>> Sparse doesn't parse binary constants properly so the following code
>> generates an error:
>>
>>       x = 0b11;
>>
>> test.c:5:17: error: constant 0b11 is not a valid number
>>
>> Reported-by: Kamal Mostafa <kamal@canonical.com>
>> Signed-off-by: Dan Carpenter <error27@gmail.com>
>
> I sent this patch before but the git tree was offline so everything
> was dead.

Thanks for the reminder. The patch looks fine.

I will apply it.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse, llvm: Add support for array types ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH] sparse, llvm: Add support for array types
Date: Tue, 25 Oct 2011 09:18:02 +0000
Message-ID: <1319534282-7768-1-git-send-email-penberg () kernel ! org>
--------------------
This patch adds support for SYM_ARRAY in symbol_type().

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c              |   17 +++++++++++++++++
 validation/backend/array.c |    6 ++++++
 2 files changed, 23 insertions(+), 0 deletions(-)
 create mode 100644 validation/backend/array.c

diff --git a/sparse-llvm.c b/sparse-llvm.c
index 9f4586f..52a487b 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -34,6 +34,20 @@ static inline bool symbol_is_fp_type(struct symbol *sym)
 
 static LLVMTypeRef symbol_type(LLVMModuleRef module, struct symbol *sym);
 
+static LLVMTypeRef sym_array_type(LLVMModuleRef module, struct symbol *sym)
+{
+	LLVMTypeRef elem_type, ret;
+	struct symbol *base_type;
+
+	base_type = sym->ctype.base_type;
+
+	elem_type = symbol_type(module, base_type);
+	if (!elem_type)
+		return NULL;
+
+	return LLVMArrayType(elem_type, sym->bit_size / 8);
+}
+
 #define MAX_STRUCT_MEMBERS 64
 
 static LLVMTypeRef sym_struct_type(LLVMModuleRef module, struct symbol *sym)
@@ -135,6 +149,9 @@ static LLVMTypeRef symbol_type(LLVMModuleRef module, struct symbol *sym)
 	case SYM_STRUCT:
 		ret = sym_struct_type(module, sym);
 		break;
+	case SYM_ARRAY:
+		ret = sym_array_type(module, sym);
+		break;
 	default:
 		assert(0);
 	}
diff --git a/validation/backend/array.c b/validation/backend/array.c
new file mode 100644
index 0000000..bd3ec59
--- /dev/null
+++ b/validation/backend/array.c
@@ -0,0 +1,6 @@
+static char array[128];
+
+/*
+ * check-name: Array code generation
+ * check-command: ./sparsec -c $file -o tmp.o
+ */
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse, llvm: Don't fail the build if LLVM is too old ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse, llvm: Don't fail the build if LLVM is too old
Date: Fri, 25 Nov 2011 19:50:14 +0000
Message-ID: <CANeU7Qkac78FrYJ4daC=Kq+gFnw67ih-Ho-RZe79P=8JoTqiYw () mail ! gmail ! com>
--------------------
First of all, I want to make the sparse-llvm works on release version as well,
if that is not too much trouble.


On Thu, Nov 24, 2011 at 11:06 PM, Pekka Enberg <penberg@kernel.org> wrote:
>  HAVE_LLVM:=$(shell llvm-config --version >/dev/null 2>&1 && echo 'yes')
> +HAVE_LLVM_VERSION:=$(shell llvm-config --version | grep "^[3-9].*" >/dev/null 2>&1 && echo yes)
> +LLVM_VERSION=$(shell llvm-config --version)
>
>  GCC_BASE = $(shell $(CC) --print-file-name=)
>  BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
> @@ -65,7 +67,13 @@ else
>  $(warning Your system does not have libgtk2, disabling test-inspect)
>  endif
>
> -ifeq ($(HAVE_LLVM),yes)
> +ifneq ($(HAVE_LLVM),yes)
> +$(warning Your system does not have llvm, disabling sparse-llvm)

Notice you use recursive assign here. It will cause "shell llvm-config
--version"
being execute every time $(LLVM_VERSION) is expanded. That slow down
the makefile. Because LLVM_VERSION don't change during the compile.
Better make it non-recursive assign so the llvm-config only evaluate once.

I also don't want to put the sparse-llvm rules section in nested if.
That is  makes it harder to read.

I am thinking some thing like this:

LLVM_VERSION := $(shell llvm-config --version 2>/dev/null)
LLVM_VERSION_LIST := $(subst ., ,$(LLVM_VERSION))
LLVM_VERSION_MAJOR := $(word 1, $(LLVM_VERSION_LIST))
HAVE_LLVM_V3 := $(shell [ "$(LLVM_VERSION_MAJOR)" -ge 3 ] > /dev/null
2>&1 && echo yes)

ifeq ($(HAVE_LLVM_V3),yes)

# rules to compile sparse-llvm

else

# warning of LLVM don't exist or too old

endif


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse, llvm: Fix 'void *' pointer code generation ===

From: Pekka Enberg <penberg@kernel.org>
To: Unknown
Subject: [PATCH] sparse, llvm: Fix 'void *' pointer code generation
Date: Mon, 24 Oct 2011 14:11:13 +0300
Message-ID: 
--------------------
Sparse front-end generates SYM_PTR with SYM_BASETYPE with bit_size set to -1
for "void *" pointers. We currently map that to LLVMVoidType() but that no
longer works with LLVM Subversion trunk:

   $ ./sparse-llvm validation/backend/struct.c
   sparse-llvm: Type.cpp:676: static llvm::PointerType* llvm::PointerType::get(llvm::Type*, unsigned int): Assertion `isValidElementType(EltTy) && "Invalid type for pointer element!"' failed.
Aborted

Fix the issue by treating 'void *' as 'char *' as suggested by Linus:

On Mon, 24 Oct 2011, Linus Torvalds wrote:
> Why bits_per_pointer? Isn't this the "base type" of void *? A more
> logical choice would seem to be to make it equivalent to "char *", and
> just make it fall through to the "case 8" case?

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
  sparse-llvm.c |    4 +---
  1 files changed, 1 insertions(+), 3 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index a85dfea..fc0c2e9 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -79,9 +79,7 @@ static LLVMTypeRef sym_basetype_type(struct symbol *sym)
  		}
  	} else {
  		switch (sym->bit_size) {
-		case -1:
-			ret = LLVMVoidType();
-			break;
+		case -1:	/* 'void *' is treated like 'char *' */
  		case 8:
  			ret = LLVMInt8Type();
  			break;
-- 
1.7.6.4

--8323328-866404354-1319459616=:14239--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse, llvm: Fix 'void *' pointer code generation
Date: Mon, 24 Oct 2011 11:52:50 +0000
Message-ID: <CA+55aFx1=9C_QDE2CfqLp1zg_t=x+VjKUPZgj2karJsS1FAZaA () mail ! gmail ! com>
--------------------
On Mon, Oct 24, 2011 at 1:43 PM, Pekka Enberg <penberg@kernel.org> wrote:
>
> Fix the issue by switching to LLVMIntType(bits_per_pointer) in
> sym_basetype_type().

Why bits_per_pointer? Isn't this the "base type" of void *? A more
logical choice would seem to be to make it equivalent to "char *", and
just make it fall through to the "case 8" case?

       Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jonathan =?utf-8?Q?Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: Re: [PATCH] sparse, llvm: Fix 'void *' pointer code generation
Date: Mon, 24 Oct 2011 12:14:26 +0000
Message-ID: <20111024121426.GA2021 () debian ! debian>
--------------------
On Mon, Oct 24, 2011 at 02:56:41PM +0300, Pekka Enberg wrote:
> Fix the issue by switching to LLVMIntType(bits_per_pointer) in
> sym_basetype_type().

You didn't update the commit message.

--
Jonathan NeuschÃ¤fer
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () cs ! helsinki ! fi>
To: linux-sparse
Subject: Re: [PATCH] sparse, llvm: Fix 'void *' pointer code generation
Date: Mon, 24 Oct 2011 12:33:26 +0000
Message-ID: <alpine.LFD.2.02.1110241532340.14239 () tux ! localdomain>
--------------------
  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--8323328-866404354-1319459616=:14239
Content-Type: TEXT/PLAIN; charset=utf-8; format=flowed
Content-Transfer-Encoding: 8BIT

> On Mon, Oct 24, 2011 at 02:56:41PM +0300, Pekka Enberg wrote:
>> Fix the issue by switching to LLVMIntType(bits_per_pointer) in
>> sym_basetype_type().

On Mon, 24 Oct 2011, Jonathan NeuschÃ¤fer wrote:
> You didn't update the commit message.

Thanks for pointing that out. Jeff, does this look OK?

 			Pekka


================================================================================


################################################################################

=== Thread: [PATCH] sparse, llvm: More comparison ops code generation ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH] sparse, llvm: More comparison ops code generation
Date: Tue, 22 Nov 2011 17:40:32 +0000
Message-ID: <1321983632-8458-1-git-send-email-penberg () kernel ! org>
--------------------
This patch implements LLVM code generation for OP_SET_LE, OP_SET_GE, OP_SET_BE,
and OP_SET_AE.

Cc: Christopher Li <sparse@chrisli.org>
Cc: Jeff Garzik <jgarzik@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 sparse-llvm.c                |    8 ++++----
 validation/backend/cmp-ops.c |   20 ++++++++++++++++++++
 2 files changed, 24 insertions(+), 4 deletions(-)

diff --git a/sparse-llvm.c b/sparse-llvm.c
index 6402666..700a7a4 100644
--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -502,10 +502,10 @@ static void output_op_binary(struct function *fn, struct instruction *insn)
 		target = LLVMBuildICmp(fn->builder, LLVMIntNE, lhs, rhs, target_name);
 		break;
 	case OP_SET_LE:
-		assert(0);
+		target = LLVMBuildICmp(fn->builder, LLVMIntSLE, lhs, rhs, target_name);
 		break;
 	case OP_SET_GE:
-		assert(0);
+		target = LLVMBuildICmp(fn->builder, LLVMIntSGE, lhs, rhs, target_name);
 		break;
 	case OP_SET_LT:
 		assert(!symbol_is_fp_type(insn->type));
@@ -522,10 +522,10 @@ static void output_op_binary(struct function *fn, struct instruction *insn)
 		target = LLVMBuildICmp(fn->builder, LLVMIntUGT, lhs, rhs, target_name);
 		break;
 	case OP_SET_BE:
-		assert(0);
+		target = LLVMBuildICmp(fn->builder, LLVMIntULE, lhs, rhs, target_name);
 		break;
 	case OP_SET_AE:
-		assert(0);
+		target = LLVMBuildICmp(fn->builder, LLVMIntUGE, lhs, rhs, target_name);
 		break;
 	default:
 		assert(0);
diff --git a/validation/backend/cmp-ops.c b/validation/backend/cmp-ops.c
index b1ad227..7bbc81c 100644
--- a/validation/backend/cmp-ops.c
+++ b/validation/backend/cmp-ops.c
@@ -18,6 +18,16 @@ static int setg(int x, int y)
 	return x > y;
 }
 
+static int setle(int x, int y)
+{
+	return x <= y;
+}
+
+static int setge(int x, int y)
+{
+	return x >= y;
+}
+
 static int setb(unsigned int x, unsigned int y)
 {
 	return x < y;
@@ -28,6 +38,16 @@ static int seta(unsigned int x, unsigned int y)
 	return x > y;
 }
 
+static int setbe(unsigned int x, unsigned int y)
+{
+	return x <= y;
+}
+
+static int setae(unsigned int x, unsigned int y)
+{
+	return x >= y;
+}
+
 /*
  * check-name: Comparison operator code generation
  * check-command: ./sparsec -c $file -o tmp.o
-- 
1.7.6.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse, llvm: More comparison ops code generation
Date: Tue, 22 Nov 2011 17:44:15 +0000
Message-ID: <CA+55aFwa1DWKaeKJri+Npf0O6jK3e1f5bU3WpdMZ5asfh+msog () mail ! gmail ! com>
--------------------
On Tue, Nov 22, 2011 at 9:40 AM, Pekka Enberg <penberg@kernel.org> wrote:
> This patch implements LLVM code generation for OP_SET_LE, OP_SET_GE, OP_SET_BE,
> and OP_SET_AE.

Ugh.

Can't you just do it with a single statement like

    target = LLVMBuildICmp(fn->builder, translate_op(op), lhs, rhs,
target_name);

instead of having that case-statement where every case does the same thing?

The translate_op() thing should be trivial too, just something like

   static int translate_op(int sparse_op)
   {
       static const int trans_tbl[] = {
           .[OP_SET_LE] = LLVMIntSLE,
       ...
        };
        return trans_tbl[sparse_op];
   }

or whatever. No?

                 Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse, llvm: Simplify comparison op code generation ===

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse, llvm: Simplify comparison op code generation
Date: Tue, 22 Nov 2011 20:04:28 +0000
Message-ID: <CA+55aFzPBK8V1HZ3JAVrpTaD2ZX8qLVH5kHMskuUbov2FiHBow () mail ! gmail ! com>
--------------------
On Tue, Nov 22, 2011 at 11:57 AM, Pekka Enberg <penberg@kernel.org> wrote:
>
> Unfortunately LLVM API requires LLVMBuildFCmp() for floats so it's not
> as simple as that. I sent an incremental patch as a separate email
> that adds FP support for comparison ops.

Yeah, saw that, and it looked sane to me.

                Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Reduce 'test-suite' run output ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: [PATCH] sparse: Reduce 'test-suite' run output
Date: Fri, 26 Aug 2011 13:50:21 +0000
Message-ID: <1314366621-29361-1-git-send-email-penberg () kernel ! org>
--------------------
There's more than 100 tests in the validation test suite. That makes it
cumbersome to notice test breakage in because the results don't fit on single
page.

We don't expect to see most tests to pass so it's much more convenient to
only be verbose for failing test cases. This patch changes the
'test-suite' output to report progress on a single line unless a test case
fails.

Current master 'make check' output looks as follows:

  Makefile:53: Your system does not have libxml, disabling c2xml
       TEST    preprocessor/preprocessor14.c ( Preprocessor #14)
  error: actual output text does not match expected output text.
  error: see preprocessor/preprocessor14.c.output.* for further investigation.
  --- preprocessor/preprocessor14.c.output.expected	2011-08-26 05:47:22.000000000 +0000
  +++ preprocessor/preprocessor14.c.output.got	2011-08-26 05:47:22.000000000 +0000
  @@ -1,2 +1,2 @@

  -
  +,
  info: test 'preprocessor/preprocessor14.c' is known to fail
       TEST    static-forward-decl.c ( static forward declaration)
  error: actual error text does not match expected error text.
  error: see static-forward-decl.c.error.* for further investigation.
  --- static-forward-decl.c.error.expected	2011-08-26 05:47:22.000000000 +0000
  +++ static-forward-decl.c.error.got	2011-08-26 05:47:22.000000000 +0000
  @@ -0,0 +1 @@
  +static-forward-decl.c:3:5: warning: symbol 'f' was not declared. Should it be static?
  info: test 'static-forward-decl.c' is known to fail
       TEST    varargs1.c ( Varargs bogus warning regression test #1)
  Out of 102 tests, 100 passed, 2 failed (2 of them are known to fail)

Cc: Christopher Li <sparse@chrisli.org>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Pekka Enberg <penberg@kernel.org>
---
 validation/test-suite |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/validation/test-suite b/validation/test-suite
index 3c011c6..513d785 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -95,7 +95,7 @@ do_test()
 	fi
 	test_name=$last_result
 
-	echo "     TEST    $test_name ($file)"
+	printf "\r     TEST    %-80s" "$file ($test_name)"
 
 	# does the test provide a specific command ?
 	cmd=`eval echo $default_path/$default_cmd`
@@ -128,6 +128,7 @@ do_test()
 	for stream in output error; do
 		diff -u "$file".$stream.expected "$file".$stream.got > "$file".$stream.diff
 		if [ "$?" -ne "0" ]; then
+			echo ""
 			error "actual $stream text does not match expected $stream text."
 			error  "see $file.$stream.* for further investigation."
 			cat "$file".$stream.diff
@@ -163,6 +164,7 @@ do_test_suite()
 
 	# prints some numbers
 	tests_nr=`expr $ok_tests + $ko_tests`
+	echo ""
 	echo -n "Out of $tests_nr tests, $ok_tests passed, $ko_tests failed"
 	echo " ($known_ko_tests of them are known to fail)"
 	if [ "$unhandled_tests" -ne "0" ]; then
-- 
1.7.4.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Reduce 'test-suite' run output
Date: Sat, 27 Aug 2011 02:11:04 +0000
Message-ID: <CANeU7Q=xTrKKCkuB4_RcA7L=99=psZAWQiawqSLMMyOUK6E-jQ () mail ! gmail ! com>
--------------------
On Fri, Aug 26, 2011 at 6:50 AM, Pekka Enberg <penberg@kernel.org> wrote:
> There's more than 100 tests in the validation test suite. That makes it
> cumbersome to notice test breakage in because the results don't fit on single
> page.

Looks good in a terminal. But if the output is piped to a file, it will be hard
to read that file. We shouldn't do it for a non-terminal output.


> +                       echo ""

Why not just "echo" instead. Without any argument, echo will just output "\n".

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Reduce 'test-suite' run output
Date: Sat, 27 Aug 2011 08:13:17 +0000
Message-ID: <alpine.DEB.2.00.1108271112110.2570 () localhost6 ! localdomain6>
--------------------
  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

---1463808768-2065544413-1314432799=:2570
Content-Type: TEXT/PLAIN; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8BIT

On Fri, 26 Aug 2011, Christopher Li wrote:

> On Fri, Aug 26, 2011 at 6:50 AM, Pekka Enberg <penberg@kernel.org> wrote:
>> There's more than 100 tests in the validation test suite. That makes it
>> cumbersome to notice test breakage in because the results don't fit on single
>> page.
>
> Looks good in a terminal. But if the output is piped to a file, it will be hard
> to read that file. We shouldn't do it for a non-terminal output.

Right. How can I check if we're outputting to non-terminal?

>> +                       echo ""
>
> Why not just "echo" instead. Without any argument, echo will just output "\n".

No reason, I'm just really bad at writing shell scripts. :-)

I'll fix that up!
---1463808768-2065544413-1314432799=:2570--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jonathan =?utf-8?Q?Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: Re: [PATCH] sparse: Reduce 'test-suite' run output
Date: Sat, 27 Aug 2011 11:39:59 +0000
Message-ID: <20110827113959.GA15022 () debian ! debian>
--------------------
On Sat, Aug 27, 2011 at 11:13:17AM +0300, Pekka Enberg wrote:
> On Fri, 26 Aug 2011, Christopher Li wrote:
> 
> >On Fri, Aug 26, 2011 at 6:50 AM, Pekka Enberg <penberg@kernel.org> wrote:
> >>There's more than 100 tests in the validation test suite. That makes it
> >>cumbersome to notice test breakage in because the results don't fit on single
> >>page.
> >
> >Looks good in a terminal. But if the output is piped to a file, it will be hard
> >to read that file. We shouldn't do it for a non-terminal output.
> 
> Right. How can I check if we're outputting to non-terminal?

You probably need a C helper, like this:

#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <errno.h>

int main(int argc, char **argv)
{
	int fd, tmp;

	if (argc < 2) {
		printf("usage: %s fd\n", argv[0]);
		return EXIT_FAILURE;
	}

	errno = 0;
	fd = (int) strtol(argv[1], NULL, 10);
	if (errno == ERANGE) {
		perror("bad fd");
		return EXIT_FAILURE;
	}

	tmp = isatty(fd);
	if (!tmp && errno == EBADF)
		perror("");

	return tmp ? EXIT_SUCCESS : EXIT_FAILURE;
}

HTH,
	Jonathan NeuschÃ¤fer
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jonathan =?utf-8?Q?Neusch=C3=A4fer?= <j.neuschaefer () gmx ! net>
To: linux-sparse
Subject: Re: [PATCH] sparse: Reduce 'test-suite' run output
Date: Sat, 27 Aug 2011 18:17:59 +0000
Message-ID: <20110827181759.GC15022 () debian ! debian>
--------------------
On Sat, Aug 27, 2011 at 08:15:44AM -0700, Ben Pfaff wrote:
> Pekka Enberg <penberg@kernel.org> writes:
> 
> > On Fri, 26 Aug 2011, Christopher Li wrote:
> >
> >> On Fri, Aug 26, 2011 at 6:50 AM, Pekka Enberg <penberg@kernel.org> wrote:
> >>> There's more than 100 tests in the validation test suite. That makes it
> >>> cumbersome to notice test breakage in because the results don't fit on single
> >>> page.
> >>
> >> Looks good in a terminal. But if the output is piped to a file, it will be hard
> >> to read that file. We shouldn't do it for a non-terminal output.
> >
> > Right. How can I check if we're outputting to non-terminal?
> 
> test -t 1

Okay, that's way better than my approach.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [RFC/PATCH 2/2] sparse: Use native sizes for data types ===

From: Pekka Enberg <penberg () cs ! helsinki ! fi>
To: linux-sparse
Subject: Re: [RFC/PATCH 2/2] sparse: Use native sizes for data types
Date: Mon, 24 Oct 2011 07:06:15 +0000
Message-ID: <CAOJsxLEg+jSZGs=2_Try5yUOpip6zfLAvzqXHXhoon7Mt0JqHQ () mail ! gmail ! com>
--------------------
On Sun, Oct 23, 2011 at 8:13 PM, Josh Triplett <josh@joshtriplett.org> wrote:
> On Sun, Oct 23, 2011 at 11:53:00AM -0400, Jeff Garzik wrote:
>> On 10/23/2011 08:37 AM, penberg@cs.helsinki.fi wrote:
>> >From: Pekka Enberg<penberg@kernel.org>
>> >
>> >This patch is needed to fix the sparsec LLVM backend data type sizes.
>> >
>> >Cc: Christopher Li<sparse@chrisli.org>
>> >Cc: Jeff Garzik<jgarzik@redhat.com>
>> >Cc: Linus Torvalds<torvalds@linux-foundation.org>
>> >Signed-off-by: Pekka Enberg<penberg@kernel.org>
>> >---
>> >  target.c |   10 +++++-----
>> >  1 files changed, 5 insertions(+), 5 deletions(-)
>> >
>> >diff --git a/target.c b/target.c
>> >index 6a535bc..009002f 100644
>> >--- a/target.c
>> >+++ b/target.c
>> >@@ -17,9 +17,9 @@ int max_alignment = 16;
>> >  int bits_in_bool = 8;
>> >  int bits_in_char = 8;
>> >  int bits_in_short = 16;
>> >-int bits_in_int = 32;
>> >-int bits_in_long = 32;
>> >-int bits_in_longlong = 64;
>> >+int bits_in_int = sizeof(int) * 8;
>> >+int bits_in_long = sizeof(long) * 8;
>> >+int bits_in_longlong = sizeof(long long) * 8;
>> >  int bits_in_longlonglong = 128;
>> >
>> >  int max_int_alignment = 4;
>> >@@ -36,8 +36,8 @@ int max_fp_alignment = 8;
>> >  /*
>> >   * Pointer data type
>> >   */
>> >-int bits_in_pointer = 32;
>> >-int pointer_alignment = 4;
>> >+int bits_in_pointer = sizeof(void *) * 8;
>> >+int pointer_alignment = sizeof(void *);
>>
>> No objection, but ideally we should select from a target template.
>>
>> We don't want to start down the road of making runtime target
>> switching (i386/x86-64) difficult.
>
> Agreed.  The platform that sparse checks code for should not necessarily
> correlate with what sparse observes at compile-time about the build
> platform.

Sure, I'm happy to implement this in some other way if you have an
idea how to do it cleanly. My patches don't make runtime switching
harder and I think using native data type sizes for plain sparse is a
better default.

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: bad asm goto ? ===

From: Dave Jones <davej () redhat ! com>
To: linux-sparse
Subject: bad asm goto ?
Date: Mon, 25 Oct 2010 21:31:45 +0000
Message-ID: <20101025213145.GA1822 () redhat ! com>
--------------------
I just ran sparse on a kernel tree for the first time in ages, and got
hundreds of warnings, many of which related to the tracepoint macros
in the kernel, which use the new asm goto feature.

Looking at the git log of sparse, I see there was some support added
for asm goto, but it seems to choke every time, printing ..

include/trace/events/kmem.h:45:1: error: bad asm output
include/trace/events/kmem.h:45:1: error: incompatible types in comparison expression (different address spaces)


(this is with a sparse built from git head from a few minutes ago)

	Dave

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Mon, 25 Oct 2010 22:10:29 +0000
Message-ID: <AANLkTikVt5BJ+2W3P+wYUR3DLzhTatXhAW45wdc0eoOe () mail ! gmail ! com>
--------------------
On Mon, Oct 25, 2010 at 2:31 PM, Dave Jones <davej@redhat.com> wrote:
> I just ran sparse on a kernel tree for the first time in ages, and got
> hundreds of warnings, many of which related to the tracepoint macros
> in the kernel, which use the new asm goto feature.
>
> Looking at the git log of sparse, I see there was some support added
> for asm goto, but it seems to choke every time, printing ..
>
> include/trace/events/kmem.h:45:1: error: bad asm output
> include/trace/events/kmem.h:45:1: error: incompatible types in comparison expression (different address spaces)
>
>
> (this is with a sparse built from git head from a few minutes ago)

Do you have a smaller test case to reproduce the error?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Mon, 25 Oct 2010 23:44:32 +0000
Message-ID: <AANLkTi=r6U3CVS5Br5ZTVVyNEfKzhqTcKkEk5+itwNe1 () mail ! gmail ! com>
--------------------
On Mon, Oct 25, 2010 at 3:39 PM, Dave Jones <davej@redhat.com> wrote:
> I tried unwinding some of the nested macros, and came up with ..
>
> # define __ASM_FORM(x)  " " #x " "
> # define JUMP_LABEL_INITIAL_NOP ".byte 0xe9 \n\t .long 0\n\t"
> # define __ASM_SEL(a,b) __ASM_FORM(b)
> #define _ASM_PTR        __ASM_SEL(.long, .quad)
>
> # define JUMP_LABEL(key, label)                                 \
>        do {                                                    \
>                asm goto("1:"                                   \
>                        JUMP_LABEL_INITIAL_NOP                  \
>                        ".pushsection __jump_table,  \"a\" \n\t"\
>                        _ASM_PTR "1b, %l[" #label "], %c0 \n\t" \
>                        ".popsection \n\t"                      \
>                        : :  "i" (key) :  : label);             \
>        } while (0)
>
> int main(int argc, char *argv[])
> {
>        JUMP_LABEL("1", do_trace );
>        return 1;
> do_trace:
>        return 0;
> }
>

Thanks, I got this example working for me too. You are right, sparse is
choking on it. Let me take a look tonight.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Tue, 26 Oct 2010 03:10:02 +0000
Message-ID: <AANLkTik3OLbW=sM1PFi8uazBHiJbPD06d0ns2z0DQzzN () mail ! gmail ! com>
--------------------
It seems that the error is not from the goto. It is from the malformed
asm_clobber.
For empty asm_clobber list, sparse currently add nil expr into the
list. Evaluate will
complain about the nil pointer thinking it has a bad type.

Any way, this patch should fix it.

Please let me know that help you or not. I am going to apply it after
the 0.4.3 release.

Chris

diff --git a/evaluate.c b/evaluate.c
index f8343c2..1fb03ed 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -3221,7 +3221,7 @@ static void evaluate_asm_statement(struct statement *stmt)

 	FOR_EACH_PTR(stmt->asm_clobbers, expr) {
 		if (!expr) {
-			sparse_error(stmt->pos, "bad asm output");
+			sparse_error(stmt->pos, "bad asm clobbers");
 			return;
 		}
 		if (expr->type == EXPR_STRING)
diff --git a/parse.c b/parse.c
index 537055f..6b7d656 100644
--- a/parse.c
+++ b/parse.c
@@ -1894,7 +1894,8 @@ static struct token *parse_asm_clobbers(struct
token *token, struct statement *s

 	do {
 		token = primary_expression(token->next, &expr);
-		add_expression(clobbers, expr);
+		if (expr)
+			add_expression(clobbers, expr);
 	} while (match_op(token, ','));
 	return token;
 }
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Harvey Harrison <harvey.harrison () gmail ! com>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Thu, 28 Oct 2010 02:45:31 +0000
Message-ID: <AANLkTim6DeB4BAxQv87-mjLjabGrHKY1z+roEuHDznbF () mail ! gmail ! com>
--------------------
On Mon, Oct 25, 2010 at 8:10 PM, Christopher Li <sparse@chrisli.org> wrote:
> It seems that the error is not from the goto. It is from the malformed
> asm_clobber.
> For empty asm_clobber list, sparse currently add nil expr into the
> list. Evaluate will
> complain about the nil pointer thinking it has a bad type.
>
> Any way, this patch should fix it.
>
> Please let me know that help you or not. I am going to apply it after
> the 0.4.3 release.
>

I'm afraid this didn't solve it for me when applying on top of v0.4.3,
if you have any other patches to try,
I'd be glad to test them out.

Harvey
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Thu, 28 Oct 2010 06:12:03 +0000
Message-ID: <AANLkTi=MJaTJ9qtispqhipRg615ojJmBTOg97d6Z5mZE () mail ! gmail ! com>
--------------------
On Wed, Oct 27, 2010 at 7:45 PM, Harvey Harrison
<harvey.harrison@gmail.com> wrote:
\>
> I'm afraid this didn't solve it for me when applying on top of v0.4.3,
> if you have any other patches to try,
> I'd be glad to test them out.

What is your test case? The patch does work for me on the small test
case provide by
Dave. I am just wondering if you are running the same thing.
If not, please let me know what you run and what is the error message.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Thu, 28 Oct 2010 07:06:25 +0000
Message-ID: <AANLkTin21wW4MDOWw9y_APup=xwF8TFozmDNM+oTBuS8 () mail ! gmail ! com>
--------------------
On Wed, Oct 27, 2010 at 11:33 PM, Harvey Harrison
<harvey.harrison@gmail.com> wrote:
> Sorry about that, just ran again and had a leftover binary elsewhere
> in my path, your patch does fix
> the error, all that's left is the:

No problem. Thanks for the testing.


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Harvey Harrison <harvey.harrison () gmail ! com>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Mon, 22 Aug 2011 04:01:27 +0000
Message-ID: <CAHLZz10y6-bxMRv=aJhza9EqT92gp=72f_w+7WopAL7GqPDP3A () mail ! gmail ! com>
--------------------
Ping, noticed you moving towards a 0.4.4 release and this was still not applied.

Harvey

On Mon, Oct 25, 2010 at 8:10 PM, Christopher Li <sparse@chrisli.org> wrote:
> It seems that the error is not from the goto. It is from the malformed
> asm_clobber.
> For empty asm_clobber list, sparse currently add nil expr into the
> list. Evaluate will
> complain about the nil pointer thinking it has a bad type.
>
> Any way, this patch should fix it.
>
> Please let me know that help you or not. I am going to apply it after
> the 0.4.3 release.
>
> Chris
>
> diff --git a/evaluate.c b/evaluate.c
> index f8343c2..1fb03ed 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -3221,7 +3221,7 @@ static void evaluate_asm_statement(struct statement *stmt)
>
> Â  Â  Â  Â FOR_EACH_PTR(stmt->asm_clobbers, expr) {
> Â  Â  Â  Â  Â  Â  Â  Â if (!expr) {
> - Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sparse_error(stmt->pos, "bad asm output");
> + Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sparse_error(stmt->pos, "bad asm clobbers");
> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return;
> Â  Â  Â  Â  Â  Â  Â  Â }
> Â  Â  Â  Â  Â  Â  Â  Â if (expr->type == EXPR_STRING)
> diff --git a/parse.c b/parse.c
> index 537055f..6b7d656 100644
> --- a/parse.c
> +++ b/parse.c
> @@ -1894,7 +1894,8 @@ static struct token *parse_asm_clobbers(struct
> token *token, struct statement *s
>
> Â  Â  Â  Â do {
> Â  Â  Â  Â  Â  Â  Â  Â token = primary_expression(token->next, &expr);
> - Â  Â  Â  Â  Â  Â  Â  add_expression(clobbers, expr);
> + Â  Â  Â  Â  Â  Â  Â  if (expr)
> + Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  add_expression(clobbers, expr);
> Â  Â  Â  Â } while (match_op(token, ','));
> Â  Â  Â  Â return token;
> Â }
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at Â http://vger.kernel.org/majordomo-info.html
>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: bad asm goto ?
Date: Tue, 23 Aug 2011 21:55:58 +0000
Message-ID: <CANeU7QkFrvRMjAo4m11tEhi9QMVjqu_bnNEHMkzbh_zKSvzWmQ () mail ! gmail ! com>
--------------------
On Sun, Aug 21, 2011 at 9:01 PM, Harvey Harrison
<harvey.harrison@gmail.com> wrote:
> Ping, noticed you moving towards a 0.4.4 release and this was still not applied.

It falls through the cracks. I just add a test case and commit the fix.

Thanks for the reminder.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: cannot size expression - exported array in kernel ===

From: Johannes Berg <johannes () sipsolutions ! net>
To: linux-sparse
Subject: cannot size expression - exported array in kernel
Date: Mon, 21 Nov 2011 10:06:57 +0000
Message-ID: <1321870017.3999.31.camel () jlt3 ! sipsolutions ! net>
--------------------
Here's some code from net/wireless/util.c, expressed as a test case. I
have no idea how to fix it. The actual output is:

+sizeof-external.c:11:16: error: cannot size expression

while none is expected.

johannes

/***** begin file validation/sizeof-external.c **** */
/* #include file that declares it */
extern const unsigned char bridge_tunnel_header[6];

/* define it */
const unsigned char bridge_tunnel_header[] = { 1, 2, 3, 4, 5, 6 };
/* EXPORT_SYMBOL it */
extern typeof(bridge_tunnel_header) bridge_tunnel_header; /* ... */

static int bth_size(void)
{
	return sizeof(bridge_tunnel_header);
}

/*
 * check-name: Check sizeof(kernel_exported_external_variable)
 *
 * check-error-start
 * check-error-end
 */


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: improper sparse warnings in linux kernel build? ===

From: H Hartley Sweeten <hartleys () visionengravers ! com>
To: linux-kernel
Subject: improper sparse warnings in linux kernel build?
Date: Fri, 09 Sep 2011 22:41:28 +0000
Message-ID: <201109091541.28395.hartleys () visionengravers ! com>
--------------------
Hello all,

I'm not sure if this is the correct place to post this.  Please let me know.

I am seeing a lot of sparse warnings when compiling the linux kernel that
look like this:

arch/x86/kernel/cpu/mcheck/mce_intel.c:25:8:
  warning: symbol 'mce_banks_owned' was not declared. Should it be static?

This line in the code is:

static DEFINE_PER_CPU(mce_banks_t, mce_banks_owned);

I'm not really sure what the DEFINE_PER_CPU macro expands to so I'm not
sure if the 'static' in front is actually getting used or if sparse is just
confused.

Is this an actual problem in the linux kernel or is sparse just getting
tripped up by the DEFINE_PER_CPU macro?

Thanks,
Hartley
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: improper sparse warnings in linux kernel build?
Date: Sat, 10 Sep 2011 05:27:19 +0000
Message-ID: <20110910052719.GC4807 () mwanda>
--------------------
On Fri, Sep 09, 2011 at 03:41:28PM -0700, H Hartley Sweeten wrote:
> I'm not really sure what the DEFINE_PER_CPU macro expands to so I'm not
> sure if the 'static' in front is actually getting used or if sparse is just
> confused.
> 
> Is this an actual problem in the linux kernel or is sparse just getting
> tripped up by the DEFINE_PER_CPU macro?
> 

I don't have a kernel git archive handy, but probably sparse is
correct.  Do a "make arch/x86/kernel/cpu/mcheck/mce_intel.i" and run
sparse on the .i file to find the line number that complains.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <error27 () gmail ! com>
To: linux-kernel
Subject: Re: improper sparse warnings in linux kernel build?
Date: Sat, 10 Sep 2011 05:27:19 +0000
Message-ID: <20110910052719.GC4807 () mwanda>
--------------------
On Fri, Sep 09, 2011 at 03:41:28PM -0700, H Hartley Sweeten wrote:
> I'm not really sure what the DEFINE_PER_CPU macro expands to so I'm not
> sure if the 'static' in front is actually getting used or if sparse is just
> confused.
> 
> Is this an actual problem in the linux kernel or is sparse just getting
> tripped up by the DEFINE_PER_CPU macro?
> 

I don't have a kernel git archive handy, but probably sparse is
correct.  Do a "make arch/x86/kernel/cpu/mcheck/mce_intel.i" and run
sparse on the .i file to find the line number that complains.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: H Hartley Sweeten <hartleys () visionengravers ! com>
To: linux-kernel
Subject: RE: improper sparse warnings in linux kernel build?
Date: Mon, 19 Sep 2011 17:49:48 +0000
Message-ID: <ADE657CA350FB648AAC2C43247A983F001F39DAED50B () AUSP01VMBX24 ! collaborationhost ! net>
--------------------
On Friday, September 09, 2011 10:27 PM, Dan Carpenter wrote:
> On Fri, Sep 09, 2011 at 03:41:28PM -0700, H Hartley Sweeten wrote:
>> I'm not really sure what the DEFINE_PER_CPU macro expands to so I'm not
>> sure if the 'static' in front is actually getting used or if sparse is just
>> confused.
>> 
>> Is this an actual problem in the linux kernel or is sparse just getting
>> tripped up by the DEFINE_PER_CPU macro?
>> 
>
> I don't have a kernel git archive handy, but probably sparse is
> correct.  Do a "make arch/x86/kernel/cpu/mcheck/mce_intel.i" and run
> sparse on the .i file to find the line number that complains.

Dan,

The DEFINE_PER_CPU line in that file gets expanded from:

static DEFINE_PER_CPU(mce_banks_t, mce_banks_owned);

To (line breaks added for readability):

static __attribute__((section(".discard"), unused)) char __pcpu_scope_mce_banks_owned;
extern __attribute__((section(".discard"), unused)) char __pcpu_unique_mce_banks_owned;
__attribute__((section(".discard"), unused)) char __pcpu_unique_mce_banks_owned;
__attribute__((section(".data..percpu" ""))) __attribute__((weak)) __typeof__(mce_banks_t) mce_banks_owned;


It looks like the static tag is getting correctly applied to the first variable,
__pcpu_scope_mce_banks_owned.  The second one, __pcpu_unique_mce_banks_owned, is
getting tagged extern by the macro so the next __pcpu_unique_mce_banks_owned is ok.
The last variable, mce_banks_owned, seems to be the problem.

mce_banks_owned appears to be the only variable actually used in the file. I'm not
sure what the other three are used for.

I think the only way to fix this is by creating a new DEFINE_PER_CPU macro 
(DEFINE_PER_CPU_STATIC or DEFINE_STATIC_PER_CPU?) that automatically adds the static
tags correctly.

Regards,
Hartley--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: H Hartley Sweeten <hartleys () visionengravers ! com>
To: linux-sparse
Subject: RE: improper sparse warnings in linux kernel build?
Date: Mon, 19 Sep 2011 17:49:48 +0000
Message-ID: <ADE657CA350FB648AAC2C43247A983F001F39DAED50B () AUSP01VMBX24 ! collaborationhost ! net>
--------------------
On Friday, September 09, 2011 10:27 PM, Dan Carpenter wrote:
> On Fri, Sep 09, 2011 at 03:41:28PM -0700, H Hartley Sweeten wrote:
>> I'm not really sure what the DEFINE_PER_CPU macro expands to so I'm not
>> sure if the 'static' in front is actually getting used or if sparse is just
>> confused.
>> 
>> Is this an actual problem in the linux kernel or is sparse just getting
>> tripped up by the DEFINE_PER_CPU macro?
>> 
>
> I don't have a kernel git archive handy, but probably sparse is
> correct.  Do a "make arch/x86/kernel/cpu/mcheck/mce_intel.i" and run
> sparse on the .i file to find the line number that complains.

Dan,

The DEFINE_PER_CPU line in that file gets expanded from:

static DEFINE_PER_CPU(mce_banks_t, mce_banks_owned);

To (line breaks added for readability):

static __attribute__((section(".discard"), unused)) char __pcpu_scope_mce_banks_owned;
extern __attribute__((section(".discard"), unused)) char __pcpu_unique_mce_banks_owned;
__attribute__((section(".discard"), unused)) char __pcpu_unique_mce_banks_owned;
__attribute__((section(".data..percpu" ""))) __attribute__((weak)) __typeof__(mce_banks_t) mce_banks_owned;


It looks like the static tag is getting correctly applied to the first variable,
__pcpu_scope_mce_banks_owned.  The second one, __pcpu_unique_mce_banks_owned, is
getting tagged extern by the macro so the next __pcpu_unique_mce_banks_owned is ok.
The last variable, mce_banks_owned, seems to be the problem.

mce_banks_owned appears to be the only variable actually used in the file. I'm not
sure what the other three are used for.

I think the only way to fix this is by creating a new DEFINE_PER_CPU macro 
(DEFINE_PER_CPU_STATIC or DEFINE_STATIC_PER_CPU?) that automatically adds the static
tags correctly.

Regards,
Hartley--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: linearize bug? ===

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: linearize bug?
Date: Sun, 28 Aug 2011 06:26:44 +0000
Message-ID: <CAOJsxLERqAvGkJPdwSqw-MA9yvaGACVzPGMSmY51cH5v9cho+Q () mail ! gmail ! com>
--------------------
On Sat, Aug 27, 2011 at 11:03 PM, Jeff Garzik <jeff@garzik.org> wrote:
>> I disagree - mainly because I don't think we're interested in the back
>> end, are we?
>>
>> If we were doing LLVM hacking, then I'd agree. But as it is, we're
>> supposed to improve sparse, not LLVM, so we should make sure that the
>> _sparse_ output makes sense, and LLVM is just a code generator, no?
>
> No idea Pekka's interest...
>
> In general, my own decade-long goal has been to be able to play with a
> kernel compiler other than gcc.

[snip]

I'm also interested in hopefully being able to eventually compile the
kernel with sparse.

I'm not that interested in LLVM and really only picked it because it
seems to be simplest solution for now. I do agree with Linus that we
should improve sparse rather than rely on LLVM for everything.

                        Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: more "unreplaced symbol" warnings ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: more "unreplaced symbol" warnings
Date: Tue, 31 May 2011 19:05:44 +0000
Message-ID: <BANLkTimVYAOub_EaUkYcudSVk-dgowvLhg () mail ! gmail ! com>
--------------------
On Tue, May 31, 2011 at 11:58 AM, Al Viro <viro@zeniv.linux.org.uk> wrote:
> Here's what is actually triggering that crap.  Have fun...

Thanks,

I will take a look.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: relicensing Sparse ===

From: Dan Carpenter <error27 () gmail ! com>
To: linux-sparse
Subject: Re: relicensing Sparse
Date: Sat, 26 Feb 2011 18:24:16 +0000
Message-ID: <20110226182416.GP18043 () bicker>
--------------------
On Sat, Feb 26, 2011 at 08:10:49PM +0200, Alexey Dobriyan wrote:
> On Sat, Feb 26, 2011 at 08:34:14PM +0300, Dan Carpenter wrote:
> > We trying to relicense Sparse.  The Open Software License isn't
> > compatible with the Debian Free Software Guidelines.  We're moving to
> > the MIT license.
> 
> It was done year ago?
> http://marc.info/?t=123974944800001&r=1&w=2

http://marc.info/?l=linux-sparse&m=123975412205548&w=2

That's only for Linus's copyrights.  There have been a lot of other
contributors.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: sparse and multiarch include paths ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: sparse and multiarch include paths
Date: Wed, 24 Aug 2011 21:42:46 +0000
Message-ID: <20110824214244.GA12248 () leaf>
--------------------
When trying to use sparse on some low-level userspace code, I ran into
the following error:

/usr/include/bits/socket.h:381:11: error: unable to open 'asm/socket.h'

It looks like that file lives in
/usr/include/x86_64-linux-gnu/asm/socket.h , and gcc has
/usr/include/x86_64-linux-gnu in its default include path.  This relates
to Debian's multiarch efforts, moving such headers to paths which
include the architecture to allow simultaneous installation of the
headers for multiple architectures.  I don't know how gcc ends up with
that directory in its include path, but sparse needs to follow suit to
compile any code which includes these architecture-specific
headers.

I've CCed the Debian GCC maintainers and multiarch developers, in the
hopes of getting some additional details that might help resolve this
problem.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Chris Forbes <chrisf () ijw ! co ! nz>
To: linux-sparse
Subject: Re: sparse and multiarch include paths
Date: Wed, 24 Aug 2011 21:48:26 +0000
Message-ID: <CAH3ygc3AsB4rcnd1onA8B6h2zRsCpXr=36oL2s71TuNuxXS12g () mail ! gmail ! com>
--------------------
I've hit this as well. The ubuntu-packaged sparse seems to get this
right; building from git sources gives busted paths -- suspect they
have patches that need to come upstream?

-- Chris

On Thu, Aug 25, 2011 at 9:42 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> When trying to use sparse on some low-level userspace code, I ran into
> the following error:
>
> /usr/include/bits/socket.h:381:11: error: unable to open 'asm/socket.h'
>
> It looks like that file lives in
> /usr/include/x86_64-linux-gnu/asm/socket.h , and gcc has
> /usr/include/x86_64-linux-gnu in its default include path.  This relates
> to Debian's multiarch efforts, moving such headers to paths which
> include the architecture to allow simultaneous installation of the
> headers for multiple architectures.  I don't know how gcc ends up with
> that directory in its include path, but sparse needs to follow suit to
> compile any code which includes these architecture-specific
> headers.
>
> I've CCed the Debian GCC maintainers and multiarch developers, in the
> hopes of getting some additional details that might help resolve this
> problem.
>
> - Josh Triplett
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ludovic Brenta <ludovic () ludovic-brenta ! org>
To: linux-sparse
Subject: Re: sparse and multiarch include paths
Date: Wed, 24 Aug 2011 22:43:37 +0000
Message-ID: <87zkiy1ld2.fsf () ludovic-brenta ! org>
--------------------
Josh Triplett <josh@joshtriplett.org> writes:
> When trying to use sparse on some low-level userspace code, I ran into
> the following error:
>
> /usr/include/bits/socket.h:381:11: error: unable to open 'asm/socket.h'

See http://bugs.debian.org/638418

Hope this helps

-- 
Ludovic Brenta.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: sparse considers LONG_MAX too big for long on x86-64 ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: sparse considers LONG_MAX too big for long on x86-64
Date: Thu, 25 Aug 2011 03:22:57 +0000
Message-ID: <20110825032257.GB1944 () leaf>
--------------------
sizeof(long) == 8 on x86-64, but sparse thinks LONG_MAX needs a long long:

/tmp$ uname -a
Linux leaf 3.0.0-1-amd64 #1 SMP Wed Aug 17 04:08:52 UTC 2011 x86_64 GNU/Linux
/tmp$ cat test.c
#include <limits.h>
#if LONG_MAX < 0
#endif
/tmp$ sparse test.c
test.c:2:5: warning: constant 9223372036854775807L is so big it is long long
/tmp$ cgcc -c test.c -o /dev/null
test.c:2:5: warning: constant 9223372036854775807L is so big it is long long
/tmp$ echo $((2**63 - 1))
9223372036854775807

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: suggestion for Merging LLVM ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 02:43:07 +0000
Message-ID: <CANeU7QkLTOaH7LNiyTEmUOrWb4Tb39+HKM0xPnowL5s0Qbbwyw () mail ! gmail ! com>
--------------------
Hi Pekka,

I already tag the sparse 0.4.4 release in git. Just waiting
for getting the release directory setup on kernel.org and it
is ready to go.

Now I am looking at your LLVM repository and the llvm patches.
I don't have a good sense for the later patch without looking at the
earlier changes.

I haven't done big repository merge before, this is the first one.
So I am looking for suggestion what is the best practice here.

Do we care about clean up the history and import the changes
step by step as patches or just a plain git merge of the LLVM
repository?

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 02:43:07 +0000
Message-ID: <CANeU7QkLTOaH7LNiyTEmUOrWb4Tb39+HKM0xPnowL5s0Qbbwyw () mail ! gmail ! com>
--------------------
Hi Pekka,

I already tag the sparse 0.4.4 release in git. Just waiting
for getting the release directory setup on kernel.org and it
is ready to go.

Now I am looking at your LLVM repository and the llvm patches.
I don't have a good sense for the later patch without looking at the
earlier changes.

I haven't done big repository merge before, this is the first one.
So I am looking for suggestion what is the best practice here.

Do we care about clean up the history and import the changes
step by step as patches or just a plain git merge of the LLVM
repository?

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 05:52:49 +0000
Message-ID: <4ECB38B1.8020803 () garzik ! org>
--------------------
On 11/21/2011 09:43 PM, Christopher Li wrote:
> Hi Pekka,
>
> I already tag the sparse 0.4.4 release in git. Just waiting
> for getting the release directory setup on kernel.org and it
> is ready to go.
>
> Now I am looking at your LLVM repository and the llvm patches.
> I don't have a good sense for the later patch without looking at the
> earlier changes.
>
> I haven't done big repository merge before, this is the first one.
> So I am looking for suggestion what is the best practice here.
>
> Do we care about clean up the history and import the changes
> step by step as patches or just a plain git merge of the LLVM
> repository?

I don't see any reason to import step-by-step as patches.

Either merge it as a single "add incomplete LLVM backend" commit, 
dropping all pre-upstream history, or git merge.

FWIW I am sorta stuck; cannot figure out how to make 'phi' operation in 
LLVM work the way we need it to.  That is a crucial hurdle needed for 
loops.  LLVM fundamentally should be able to do it, but I'm not sure 
this works within the C API.  I was thinking my next step would be to 
whine on the llvm list.

A workaround is to resuscitate unssa() call, and all that entails.

	Jeff





--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 05:52:49 +0000
Message-ID: <4ECB38B1.8020803 () garzik ! org>
--------------------
On 11/21/2011 09:43 PM, Christopher Li wrote:
> Hi Pekka,
>
> I already tag the sparse 0.4.4 release in git. Just waiting
> for getting the release directory setup on kernel.org and it
> is ready to go.
>
> Now I am looking at your LLVM repository and the llvm patches.
> I don't have a good sense for the later patch without looking at the
> earlier changes.
>
> I haven't done big repository merge before, this is the first one.
> So I am looking for suggestion what is the best practice here.
>
> Do we care about clean up the history and import the changes
> step by step as patches or just a plain git merge of the LLVM
> repository?

I don't see any reason to import step-by-step as patches.

Either merge it as a single "add incomplete LLVM backend" commit, 
dropping all pre-upstream history, or git merge.

FWIW I am sorta stuck; cannot figure out how to make 'phi' operation in 
LLVM work the way we need it to.  That is a crucial hurdle needed for 
loops.  LLVM fundamentally should be able to do it, but I'm not sure 
this works within the C API.  I was thinking my next step would be to 
whine on the llvm list.

A workaround is to resuscitate unssa() call, and all that entails.

	Jeff





--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 06:01:14 +0000
Message-ID: <1321941674.1428.124.camel () jaguar>
--------------------
On 11/21/2011 09:43 PM, Christopher Li wrote:
> > I already tag the sparse 0.4.4 release in git. Just waiting
> > for getting the release directory setup on kernel.org and it
> > is ready to go.
> >
> > Now I am looking at your LLVM repository and the llvm patches.
> > I don't have a good sense for the later patch without looking at the
> > earlier changes.
> >
> > I haven't done big repository merge before, this is the first one.
> > So I am looking for suggestion what is the best practice here.
> >
> > Do we care about clean up the history and import the changes
> > step by step as patches or just a plain git merge of the LLVM
> > repository?

On Tue, 2011-11-22 at 00:52 -0500, Jeff Garzik wrote:
> I don't see any reason to import step-by-step as patches.
> 
> Either merge it as a single "add incomplete LLVM backend" commit, 
> dropping all pre-upstream history, or git merge.

Agreed.

I'd actually prefer that we keep the full history for one simple reason:
the commit changelogs. They provide valuable information on why we've
implemented the things the way we have.

> FWIW I am sorta stuck; cannot figure out how to make 'phi' operation in 
> LLVM work the way we need it to.  That is a crucial hurdle needed for 
> loops.  LLVM fundamentally should be able to do it, but I'm not sure 
> this works within the C API.  I was thinking my next step would be to 
> whine on the llvm list.
> 
> A workaround is to resuscitate unssa() call, and all that entails.

Did you check what kind of code http://llvm.org/demo/ generates for your
test case? I've noticed that LLVM is really picky sometime in what it
accepts as input. IIRC last time I looked at loops, there were some
significant differences in the asm we generate.

			Pekka

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 20:32:55 +0000
Message-ID: <4ECC06F7.8040006 () garzik ! org>
--------------------
On 11/22/2011 01:01 AM, Pekka Enberg wrote:
> On 11/21/2011 09:43 PM, Christopher Li wrote:
>> FWIW I am sorta stuck; cannot figure out how to make 'phi' operation in
>> LLVM work the way we need it to.  That is a crucial hurdle needed for
>> loops.  LLVM fundamentally should be able to do it, but I'm not sure
>> this works within the C API.  I was thinking my next step would be to
>> whine on the llvm list.
>>
>> A workaround is to resuscitate unssa() call, and all that entails.
>
> Did you check what kind of code http://llvm.org/demo/ generates for your
> test case? I've noticed that LLVM is really picky sometime in what it
> accepts as input. IIRC last time I looked at loops, there were some
> significant differences in the asm we generate.


The disassembler output is certainly sane and understandable.  Here's an 
example test case:

	extern int bar(int x);
	
	int foo (int x)
	{
	  int y = 0;
	  while (y < 1000) {
	    y += bar(x);
	  }
	
	  return y;
	}

The PHI operation in SSA being a union of control flows, we need to 
reference all input pseudos ... including pseudos generated by 
operations further down the in the code (i.e. pseudos not yet generated).

A classic forward reference is needed, and I cannot figure out how to do 
that in the LLVM C API, even though the forward reference is plain and 
obvious in the LLVM text disassembly.  My next step was going to trace 
through the front end to see how it generates forward refs, or be lazy 
and brain dump on an llvm mailing list somewhere.

Problems like this were the original motivation for my earlier LLVM 
backend to generate ASCII text.  I could work around this problem with 
an ugly string-based hack, if not using the C API... ;)

	Jeff




--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 20:38:13 +0000
Message-ID: <CAOJsxLGqsH9vbE9AQO2chV28Wx=iw5hA9dJzR3X1Cvrd5Sv6Eg () mail ! gmail ! com>
--------------------
On Tue, Nov 22, 2011 at 10:32 PM, Jeff Garzik <jeff@garzik.org> wrote:
> The disassembler output is certainly sane and understandable.  Here's an
> example test case:
>
>        extern int bar(int x);
>
>        int foo (int x)
>        {
>          int y = 0;
>          while (y < 1000) {
>            y += bar(x);
>          }
>
>          return y;
>        }
>
> The PHI operation in SSA being a union of control flows, we need to
> reference all input pseudos ... including pseudos generated by operations
> further down the in the code (i.e. pseudos not yet generated).
>
> A classic forward reference is needed, and I cannot figure out how to do
> that in the LLVM C API, even though the forward reference is plain and
> obvious in the LLVM text disassembly.  My next step was going to trace
> through the front end to see how it generates forward refs, or be lazy and
> brain dump on an llvm mailing list somewhere.

So pasting the above test program to http://llvm.org/demo/ and
switching to "LLVM C++ API code" target seems to suggest you're
interested in the LLVMReplaceAllUsesWith() API for forward references.

                                 Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 22 Nov 2011 20:38:13 +0000
Message-ID: <CAOJsxLGqsH9vbE9AQO2chV28Wx=iw5hA9dJzR3X1Cvrd5Sv6Eg () mail ! gmail ! com>
--------------------
On Tue, Nov 22, 2011 at 10:32 PM, Jeff Garzik <jeff@garzik.org> wrote:
> The disassembler output is certainly sane and understandable.  Here's an
> example test case:
>
>        extern int bar(int x);
>
>        int foo (int x)
>        {
>          int y = 0;
>          while (y < 1000) {
>            y += bar(x);
>          }
>
>          return y;
>        }
>
> The PHI operation in SSA being a union of control flows, we need to
> reference all input pseudos ... including pseudos generated by operations
> further down the in the code (i.e. pseudos not yet generated).
>
> A classic forward reference is needed, and I cannot figure out how to do
> that in the LLVM C API, even though the forward reference is plain and
> obvious in the LLVM text disassembly.  My next step was going to trace
> through the front end to see how it generates forward refs, or be lazy and
> brain dump on an llvm mailing list somewhere.

So pasting the above test program to http://llvm.org/demo/ and
switching to "LLVM C++ API code" target seems to suggest you're
interested in the LLVMReplaceAllUsesWith() API for forward references.

                                 Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Wed, 23 Nov 2011 04:11:25 +0000
Message-ID: <4ECC726D.8060406 () garzik ! org>
--------------------
On 11/22/2011 03:38 PM, Pekka Enberg wrote:
> So pasting the above test program tohttp://llvm.org/demo/  and
> switching to "LLVM C++ API code" target seems to suggest you're
> interested in the LLVMReplaceAllUsesWith() API for forward references.

Cute trick, outputting C++ API code.  I think LLVMReplaceAllUsesWith() 
may indeed be precisely what I needed.

Thanks,

	Jeff


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Wed, 23 Nov 2011 06:01:07 +0000
Message-ID: <4ECC8C23.4080909 () garzik ! org>
--------------------
On 11/22/2011 03:38 PM, Pekka Enberg wrote:
> So pasting the above test program tohttp://llvm.org/demo/  and
> switching to "LLVM C++ API code" target seems to suggest you're
> interested in the LLVMReplaceAllUsesWith() API for forward references.

Sent pull req via github.

List implementation is cheesy (inefficient if list ever gets woefully 
large) singly-linked list, but it is pretty simple.  Turned out that 
postponing LLVMAddIncoming() call works better than 
LLVMReplaceAllUsesWith() API:


(warning: do not apply directly, patch is unfortunately word-wrapped; 
see pull request)

--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -17,11 +17,21 @@
  #include "linearize.h"
  #include "flow.h"

+struct phi_fwd {
+       struct phi_fwd                  *next;
+
+       LLVMValueRef                    phi;
+       pseudo_t                        pseudo;
+       bool                            resolved;
+};
+
  struct function {
         LLVMBuilderRef                  builder;
         LLVMTypeRef                     type;
         LLVMValueRef                    fn;
         LLVMModuleRef                   module;
+
+       struct phi_fwd                  *fwd_list;
  };

  static inline bool symbol_is_fp_type(struct symbol *sym)
@@ -794,6 +804,67 @@ static void output_op_call(struct function *fn, 
struct instruction *insn)
         insn->target->priv = target;
  }

+static void store_phi_fwd(struct function *fn, LLVMValueRef phi,
+                         pseudo_t pseudo)
+{
+       struct phi_fwd *fwd;
+
+       fwd = calloc(1, sizeof(*fwd));
+       fwd->phi = phi;
+       fwd->pseudo = pseudo;
+
+       /* append fwd ref to function-wide list */
+       if (!fn->fwd_list)
+               fn->fwd_list = fwd;
+       else {
+               struct phi_fwd *last = fn->fwd_list;
+
+               while (last->next)
+                       last = last->next;
+               last->next = fwd;
+       }
+}
+
+static void output_phi_fwd(struct function *fn, pseudo_t pseudo, 
LLVMValueRef v)
+{
+       struct phi_fwd *fwd = fn->fwd_list;
+
+       while (fwd) {
+               struct phi_fwd *tmp;
+
+               tmp = fwd;
+               fwd = fwd->next;
+
+               if (tmp->pseudo == pseudo && !tmp->resolved) {
+                       LLVMValueRef phi_vals[1];
+                       LLVMBasicBlockRef phi_blks[1];
+
+                       phi_vals[0] = v;
+                       phi_blks[0] = pseudo->def->bb->priv;
+
+                       LLVMAddIncoming(tmp->phi, phi_vals, phi_blks, 1);
+
+                       tmp->resolved = true;
+               }
+       }
+}
+
+static void output_op_phisrc(struct function *fn, struct instruction *insn)
+{
+       LLVMValueRef v;
+
+       assert(insn->target->priv == NULL);
+
+       /* target = src */
+       v = pseudo_to_value(fn, insn, insn->phi_src);
+       insn->target->priv = v;
+
+       assert(insn->target->priv != NULL);
+
+       /* resolve forward references to this phi source, if present */
+       output_phi_fwd(fn, insn->target, v);
+}
+
  static void output_op_phi(struct function *fn, struct instruction *insn)
  {
         pseudo_t phi;
@@ -803,7 +874,7 @@ static void output_op_phi(struct function *fn, 
struct instruction *insn)
                                 "phi");
         int pll = 0;
         FOR_EACH_PTR(insn->phi_list, phi) {
-               if (pseudo_to_value(fn, insn, phi))     /* skip VOID */
+               if (pseudo_to_value(fn, insn, phi))     /* skip VOID, 
fwd refs*/
                         pll++;
         } END_FOR_EACH_PTR(phi);

@@ -815,11 +886,13 @@ static void output_op_phi(struct function *fn, 
struct instruction *insn)
                 LLVMValueRef v;

                 v = pseudo_to_value(fn, insn, phi);
-               if (v) {                        /* skip VOID */
+               if (v) {                        /* skip VOID, fwd refs */
                         phi_vals[idx] = v;
                         phi_blks[idx] = phi->def->bb->priv;
                         idx++;
                 }
+               else if (phi->type == PSEUDO_PHI)       /* fwd ref */
+                       store_phi_fwd(fn, target, phi);
         } END_FOR_EACH_PTR(phi);

         LLVMAddIncoming(target, phi_vals, phi_blks, pll);
@@ -916,8 +989,7 @@ static void output_insn(struct function *fn, struct 
instruction *insn)
                 assert(0);
                 break;
         case OP_PHISOURCE:
-               /* target = src */
-               insn->target->priv = pseudo_to_value(fn, insn, 
insn->phi_src);
+               output_op_phisrc(fn, insn);
                 break;
         case OP_PHI:
                 output_op_phi(fn, insn);
@@ -1026,7 +1098,7 @@ static void output_fn(LLVMModuleRef module, struct 
entrypoint *ep)
         struct symbol *ret_type = sym->ctype.base_type->ctype.base_type;
         LLVMTypeRef arg_types[MAX_ARGS];
         LLVMTypeRef return_type;
-       struct function function;
+       struct function function = { .module = module };
         struct basic_block *bb;
         struct symbol *arg;
         const char *name;
@@ -1043,8 +1115,6 @@ static void output_fn(LLVMModuleRef module, struct 
entrypoint *ep)

         return_type = symbol_type(module, ret_type);

-       function.module = module;
-
         function.type = LLVMFunctionType(return_type, arg_types, 
nr_args, 0);

         function.fn = LLVMAddFunction(module, name, function.type);
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Wed, 23 Nov 2011 06:01:07 +0000
Message-ID: <4ECC8C23.4080909 () garzik ! org>
--------------------
On 11/22/2011 03:38 PM, Pekka Enberg wrote:
> So pasting the above test program tohttp://llvm.org/demo/  and
> switching to "LLVM C++ API code" target seems to suggest you're
> interested in the LLVMReplaceAllUsesWith() API for forward references.

Sent pull req via github.

List implementation is cheesy (inefficient if list ever gets woefully 
large) singly-linked list, but it is pretty simple.  Turned out that 
postponing LLVMAddIncoming() call works better than 
LLVMReplaceAllUsesWith() API:


(warning: do not apply directly, patch is unfortunately word-wrapped; 
see pull request)

--- a/sparse-llvm.c
+++ b/sparse-llvm.c
@@ -17,11 +17,21 @@
  #include "linearize.h"
  #include "flow.h"

+struct phi_fwd {
+       struct phi_fwd                  *next;
+
+       LLVMValueRef                    phi;
+       pseudo_t                        pseudo;
+       bool                            resolved;
+};
+
  struct function {
         LLVMBuilderRef                  builder;
         LLVMTypeRef                     type;
         LLVMValueRef                    fn;
         LLVMModuleRef                   module;
+
+       struct phi_fwd                  *fwd_list;
  };

  static inline bool symbol_is_fp_type(struct symbol *sym)
@@ -794,6 +804,67 @@ static void output_op_call(struct function *fn, 
struct instruction *insn)
         insn->target->priv = target;
  }

+static void store_phi_fwd(struct function *fn, LLVMValueRef phi,
+                         pseudo_t pseudo)
+{
+       struct phi_fwd *fwd;
+
+       fwd = calloc(1, sizeof(*fwd));
+       fwd->phi = phi;
+       fwd->pseudo = pseudo;
+
+       /* append fwd ref to function-wide list */
+       if (!fn->fwd_list)
+               fn->fwd_list = fwd;
+       else {
+               struct phi_fwd *last = fn->fwd_list;
+
+               while (last->next)
+                       last = last->next;
+               last->next = fwd;
+       }
+}
+
+static void output_phi_fwd(struct function *fn, pseudo_t pseudo, 
LLVMValueRef v)
+{
+       struct phi_fwd *fwd = fn->fwd_list;
+
+       while (fwd) {
+               struct phi_fwd *tmp;
+
+               tmp = fwd;
+               fwd = fwd->next;
+
+               if (tmp->pseudo == pseudo && !tmp->resolved) {
+                       LLVMValueRef phi_vals[1];
+                       LLVMBasicBlockRef phi_blks[1];
+
+                       phi_vals[0] = v;
+                       phi_blks[0] = pseudo->def->bb->priv;
+
+                       LLVMAddIncoming(tmp->phi, phi_vals, phi_blks, 1);
+
+                       tmp->resolved = true;
+               }
+       }
+}
+
+static void output_op_phisrc(struct function *fn, struct instruction *insn)
+{
+       LLVMValueRef v;
+
+       assert(insn->target->priv == NULL);
+
+       /* target = src */
+       v = pseudo_to_value(fn, insn, insn->phi_src);
+       insn->target->priv = v;
+
+       assert(insn->target->priv != NULL);
+
+       /* resolve forward references to this phi source, if present */
+       output_phi_fwd(fn, insn->target, v);
+}
+
  static void output_op_phi(struct function *fn, struct instruction *insn)
  {
         pseudo_t phi;
@@ -803,7 +874,7 @@ static void output_op_phi(struct function *fn, 
struct instruction *insn)
                                 "phi");
         int pll = 0;
         FOR_EACH_PTR(insn->phi_list, phi) {
-               if (pseudo_to_value(fn, insn, phi))     /* skip VOID */
+               if (pseudo_to_value(fn, insn, phi))     /* skip VOID, 
fwd refs*/
                         pll++;
         } END_FOR_EACH_PTR(phi);

@@ -815,11 +886,13 @@ static void output_op_phi(struct function *fn, 
struct instruction *insn)
                 LLVMValueRef v;

                 v = pseudo_to_value(fn, insn, phi);
-               if (v) {                        /* skip VOID */
+               if (v) {                        /* skip VOID, fwd refs */
                         phi_vals[idx] = v;
                         phi_blks[idx] = phi->def->bb->priv;
                         idx++;
                 }
+               else if (phi->type == PSEUDO_PHI)       /* fwd ref */
+                       store_phi_fwd(fn, target, phi);
         } END_FOR_EACH_PTR(phi);

         LLVMAddIncoming(target, phi_vals, phi_blks, pll);
@@ -916,8 +989,7 @@ static void output_insn(struct function *fn, struct 
instruction *insn)
                 assert(0);
                 break;
         case OP_PHISOURCE:
-               /* target = src */
-               insn->target->priv = pseudo_to_value(fn, insn, 
insn->phi_src);
+               output_op_phisrc(fn, insn);
                 break;
         case OP_PHI:
                 output_op_phi(fn, insn);
@@ -1026,7 +1098,7 @@ static void output_fn(LLVMModuleRef module, struct 
entrypoint *ep)
         struct symbol *ret_type = sym->ctype.base_type->ctype.base_type;
         LLVMTypeRef arg_types[MAX_ARGS];
         LLVMTypeRef return_type;
-       struct function function;
+       struct function function = { .module = module };
         struct basic_block *bb;
         struct symbol *arg;
         const char *name;
@@ -1043,8 +1115,6 @@ static void output_fn(LLVMModuleRef module, struct 
entrypoint *ep)

         return_type = symbol_type(module, ret_type);

-       function.module = module;
-
         function.type = LLVMFunctionType(return_type, arg_types, 
nr_args, 0);

         function.fn = LLVMAddFunction(module, name, function.type);
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Wed, 23 Nov 2011 06:58:12 +0000
Message-ID: <CAOJsxLFc6Qq3ThiX6AOJ6GmnSUSJP5Ft-ySUXk3KGSdfHNZuEw () mail ! gmail ! com>
--------------------
On Wed, Nov 23, 2011 at 8:01 AM, Jeff Garzik <jeff@garzik.org> wrote:
> On 11/22/2011 03:38 PM, Pekka Enberg wrote:
>>
>> So pasting the above test program tohttp://llvm.org/demo/  and
>> switching to "LLVM C++ API code" target seems to suggest you're
>> interested in the LLVMReplaceAllUsesWith() API for forward references.
>
> Sent pull req via github.
>
> List implementation is cheesy (inefficient if list ever gets woefully large)
> singly-linked list, but it is pretty simple.  Turned out that postponing
> LLVMAddIncoming() call works better than LLVMReplaceAllUsesWith() API:
>
>
> (warning: do not apply directly, patch is unfortunately word-wrapped; see
> pull request)

Pulled, thanks!

P.S. Could you please put your test cases under validation/backend?
It's really easy to make them part of regular "make check".
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Wed, 23 Nov 2011 06:58:12 +0000
Message-ID: <CAOJsxLFc6Qq3ThiX6AOJ6GmnSUSJP5Ft-ySUXk3KGSdfHNZuEw () mail ! gmail ! com>
--------------------
On Wed, Nov 23, 2011 at 8:01 AM, Jeff Garzik <jeff@garzik.org> wrote:
> On 11/22/2011 03:38 PM, Pekka Enberg wrote:
>>
>> So pasting the above test program tohttp://llvm.org/demo/  and
>> switching to "LLVM C++ API code" target seems to suggest you're
>> interested in the LLVMReplaceAllUsesWith() API for forward references.
>
> Sent pull req via github.
>
> List implementation is cheesy (inefficient if list ever gets woefully large)
> singly-linked list, but it is pretty simple.  Turned out that postponing
> LLVMAddIncoming() call works better than LLVMReplaceAllUsesWith() API:
>
>
> (warning: do not apply directly, patch is unfortunately word-wrapped; see
> pull request)

Pulled, thanks!

P.S. Could you please put your test cases under validation/backend?
It's really easy to make them part of regular "make check".
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 01:45:15 +0000
Message-ID: <CANeU7Q=4e_jtdE5OXpat9VFU_KpsLrGe4LYpmy=y9L3QyBQ3sg () mail ! gmail ! com>
--------------------
On Mon, Nov 21, 2011 at 10:01 PM, Pekka Enberg <penberg@kernel.org> wrote:
> Agreed.
>
> I'd actually prefer that we keep the full history for one simple reason:
> the commit changelogs. They provide valuable information on why we've
> implemented the things the way we have.

OKï¼ I will just do the git merge then. Can you generate a pull request?

I just check out the sparse-llvm, the tip of the tree is broken for me:

     CC       sparse-llvm.o
sparse-llvm.c: In function âsym_struct_typeâ:
sparse-llvm.c:117:2: warning: implicit declaration of function
âLLVMStructCreateNamedâ [-Wimplicit-function-declaration]
sparse-llvm.c:117:6: warning: assignment makes pointer from integer
without a cast [enabled by default]
sparse-llvm.c:129:2: warning: implicit declaration of function
âLLVMStructSetBodyâ [-Wimplicit-function-declaration]
     LINK     sparse-llvm
sparse-llvm.o: In function `sym_struct_type':
/export/git/sparse-llvm/sparse-llvm.c:117: undefined reference to
`LLVMStructCreateNamed'
/export/git/sparse-llvm/sparse-llvm.c:129: undefined reference to
`LLVMStructSetBody'
collect2: ld returned 1 exit status

I am using llvm 2.9, I guess my llvm is too new?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 02:25:02 +0000
Message-ID: <4ECEFC7E.5060905 () garzik ! org>
--------------------
On 11/24/2011 08:45 PM, Christopher Li wrote:
> I am using llvm 2.9, I guess my llvm is too new?

I would guess too-old.  I use a git checkout from the LLVM repo.

	Jeff


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 02:25:02 +0000
Message-ID: <4ECEFC7E.5060905 () garzik ! org>
--------------------
On 11/24/2011 08:45 PM, Christopher Li wrote:
> I am using llvm 2.9, I guess my llvm is too new?

I would guess too-old.  I use a git checkout from the LLVM repo.

	Jeff


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 05:52:28 +0000
Message-ID: <1322200349.1428.127.camel () jaguar>
--------------------
> On 11/24/2011 08:45 PM, Christopher Li wrote:
> > I am using llvm 2.9, I guess my llvm is too new?

On Thu, 2011-11-24 at 21:25 -0500, Jeff Garzik wrote:
> I would guess too-old.  I use a git checkout from the LLVM repo.

We require LLVM 3.0 which hasn't been released because of this API:

https://github.com/penberg/sparse-llvm/commit/ea97bb4c5221a9be275b2d93dc90354bd6081a8c

			Pekka

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 06:28:17 +0000
Message-ID: <CANeU7Qn9Psd39taY-fRAZ_AJs2JgToZUD5Kq+fo-=i5M90FDdg () mail ! gmail ! com>
--------------------
On Thu, Nov 24, 2011 at 9:52 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> On 11/24/2011 08:45 PM, Christopher Li wrote:
>> > I am using llvm 2.9, I guess my llvm is too new?
>
> On Thu, 2011-11-24 at 21:25 -0500, Jeff Garzik wrote:
>> I would guess too-old.  I use a git checkout from the LLVM repo.
>
> We require LLVM 3.0 which hasn't been released because of this API:

Hmm, how does older version of LLVM deal with structure refering themself?

I hope there is a way so I can at least have an option to use the
released version of LLVM.  I don't mind using LLVM 3.0 if it is there,
but requiring unreleased version of LLVM seems too bleeding edge.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 06:28:17 +0000
Message-ID: <CANeU7Qn9Psd39taY-fRAZ_AJs2JgToZUD5Kq+fo-=i5M90FDdg () mail ! gmail ! com>
--------------------
On Thu, Nov 24, 2011 at 9:52 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> On 11/24/2011 08:45 PM, Christopher Li wrote:
>> > I am using llvm 2.9, I guess my llvm is too new?
>
> On Thu, 2011-11-24 at 21:25 -0500, Jeff Garzik wrote:
>> I would guess too-old.  I use a git checkout from the LLVM repo.
>
> We require LLVM 3.0 which hasn't been released because of this API:

Hmm, how does older version of LLVM deal with structure refering themself?

I hope there is a way so I can at least have an option to use the
released version of LLVM.  I don't mind using LLVM 3.0 if it is there,
but requiring unreleased version of LLVM seems too bleeding edge.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 06:43:01 +0000
Message-ID: <CAOJsxLHyX9-v2JZcXp+otH+-54UJjURXY_XmG3ndEmXM56U=bw () mail ! gmail ! com>
--------------------
On Thu, Nov 24, 2011 at 9:52 PM, Pekka Enberg <penberg@kernel.org> wrote:
>>> On 11/24/2011 08:45 PM, Christopher Li wrote:
>>> > I am using llvm 2.9, I guess my llvm is too new?
>>
>> On Thu, 2011-11-24 at 21:25 -0500, Jeff Garzik wrote:
>>> I would guess too-old.  I use a git checkout from the LLVM repo.
>>
>> We require LLVM 3.0 which hasn't been released because of this API:

On Fri, Nov 25, 2011 at 8:28 AM, Christopher Li <sparse@chrisli.org> wrote:
> Hmm, how does older version of LLVM deal with structure refering themself?
>
> I hope there is a way so I can at least have an option to use the
> released version of LLVM.  I don't mind using LLVM 3.0 if it is there,
> but requiring unreleased version of LLVM seems too bleeding edge.

I wasn't able to find out any C API for that and assume it was only
possible with the C++ API. That said, I'd also be happy to use
something else to be compatible with older versions if there is one.
Any LLVM experts on the list?

LLVM 3.0 is going to be released "real soon now" so I don't think it's
a problem in practice. We'd need to add a version check, though so we
don't break build on machines that have older LLVM installed.

                                 Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 06:43:01 +0000
Message-ID: <CAOJsxLHyX9-v2JZcXp+otH+-54UJjURXY_XmG3ndEmXM56U=bw () mail ! gmail ! com>
--------------------
On Thu, Nov 24, 2011 at 9:52 PM, Pekka Enberg <penberg@kernel.org> wrote:
>>> On 11/24/2011 08:45 PM, Christopher Li wrote:
>>> > I am using llvm 2.9, I guess my llvm is too new?
>>
>> On Thu, 2011-11-24 at 21:25 -0500, Jeff Garzik wrote:
>>> I would guess too-old.  I use a git checkout from the LLVM repo.
>>
>> We require LLVM 3.0 which hasn't been released because of this API:

On Fri, Nov 25, 2011 at 8:28 AM, Christopher Li <sparse@chrisli.org> wrote:
> Hmm, how does older version of LLVM deal with structure refering themself?
>
> I hope there is a way so I can at least have an option to use the
> released version of LLVM.  I don't mind using LLVM 3.0 if it is there,
> but requiring unreleased version of LLVM seems too bleeding edge.

I wasn't able to find out any C API for that and assume it was only
possible with the C++ API. That said, I'd also be happy to use
something else to be compatible with older versions if there is one.
Any LLVM experts on the list?

LLVM 3.0 is going to be released "real soon now" so I don't think it's
a problem in practice. We'd need to add a version check, though so we
don't break build on machines that have older LLVM installed.

                                 Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 08:05:42 +0000
Message-ID: <CANeU7QkiPcdzQYf9QBdSZ0UmOJGNE2ijk1Ys0dAVeS6tGaS+Zw () mail ! gmail ! com>
--------------------
On Thu, Nov 24, 2011 at 10:43 PM, Pekka Enberg <penberg@kernel.org> wrote:
> I wasn't able to find out any C API for that and assume it was only
> possible with the C++ API. That said, I'd also be happy to use
> something else to be compatible with older versions if there is one.
> Any LLVM experts on the list?

If it just need to use the C++ API, we can compile a bridge c++ file
to export the missing C++ API to C file. It is actually pretty common praticse
if you play with LLVM internal a lot, some API just don't exist in C yet.
We are already using g++ to link llvm, one more c++ file could not hurt.
If we need some C++ only API later, we can add it there as well.

What do you say?

> LLVM 3.0 is going to be released "real soon now" so I don't think it's
> a problem in practice. We'd need to add a version check, though so we
> don't break build on machines that have older LLVM installed.

Still, it will take a while for the distribution to update to the new version.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 08:29:51 +0000
Message-ID: <CAOJsxLEp0j2xinKPRecDF6fB3cBq0NuVg7btb_VMECEptqQtgA () mail ! gmail ! com>
--------------------
Hi Chris,

On Thu, Nov 24, 2011 at 10:43 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> I wasn't able to find out any C API for that and assume it was only
>> possible with the C++ API. That said, I'd also be happy to use
>> something else to be compatible with older versions if there is one.
>> Any LLVM experts on the list?

On Fri, Nov 25, 2011 at 10:05 AM, Christopher Li <sparse@chrisli.org> wrote:
> If it just need to use the C++ API, we can compile a bridge c++ file
> to export the missing C++ API to C file. It is actually pretty common praticse
> if you play with LLVM internal a lot, some API just don't exist in C yet.
> We are already using g++ to link llvm, one more c++ file could not hurt.
> If we need some C++ only API later, we can add it there as well.
>
> What do you say?

Well, sure, that would be the perfect solution.

Unfortunately, I'm not at all familiar with the C++ API. I did look at
just adding the LLVM 3.0 LLVMStructCreateNamed() and
LLVMStructSetBody() wrappers on top of LLVM 2.8 but they don't compile
because StructType API changed. So it's not going to be as simple as
copy-pasting the missing functions to sparse.git.

On Thu, Nov 24, 2011 at 10:43 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> LLVM 3.0 is going to be released "real soon now" so I don't think it's
>> a problem in practice. We'd need to add a version check, though so we
>> don't break build on machines that have older LLVM installed.

On Fri, Nov 25, 2011 at 10:05 AM, Christopher Li <sparse@chrisli.org> wrote:
> Still, it will take a while for the distribution to update to the new version.

Sure.

Do you consider this to be a merge blocker? I'd personally just go
forward with LLVM 3.0 and add the compat wrappers along the way if
there are people who actually care about it.

                                Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 08:29:51 +0000
Message-ID: <CAOJsxLEp0j2xinKPRecDF6fB3cBq0NuVg7btb_VMECEptqQtgA () mail ! gmail ! com>
--------------------
Hi Chris,

On Thu, Nov 24, 2011 at 10:43 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> I wasn't able to find out any C API for that and assume it was only
>> possible with the C++ API. That said, I'd also be happy to use
>> something else to be compatible with older versions if there is one.
>> Any LLVM experts on the list?

On Fri, Nov 25, 2011 at 10:05 AM, Christopher Li <sparse@chrisli.org> wrote:
> If it just need to use the C++ API, we can compile a bridge c++ file
> to export the missing C++ API to C file. It is actually pretty common praticse
> if you play with LLVM internal a lot, some API just don't exist in C yet.
> We are already using g++ to link llvm, one more c++ file could not hurt.
> If we need some C++ only API later, we can add it there as well.
>
> What do you say?

Well, sure, that would be the perfect solution.

Unfortunately, I'm not at all familiar with the C++ API. I did look at
just adding the LLVM 3.0 LLVMStructCreateNamed() and
LLVMStructSetBody() wrappers on top of LLVM 2.8 but they don't compile
because StructType API changed. So it's not going to be as simple as
copy-pasting the missing functions to sparse.git.

On Thu, Nov 24, 2011 at 10:43 PM, Pekka Enberg <penberg@kernel.org> wrote:
>> LLVM 3.0 is going to be released "real soon now" so I don't think it's
>> a problem in practice. We'd need to add a version check, though so we
>> don't break build on machines that have older LLVM installed.

On Fri, Nov 25, 2011 at 10:05 AM, Christopher Li <sparse@chrisli.org> wrote:
> Still, it will take a while for the distribution to update to the new version.

Sure.

Do you consider this to be a merge blocker? I'd personally just go
forward with LLVM 3.0 and add the compat wrappers along the way if
there are people who actually care about it.

                                Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 17:52:09 +0000
Message-ID: <4ECFD5C9.20702 () garzik ! org>
--------------------
On 11/25/2011 03:05 AM, Christopher Li wrote:
> On Thu, Nov 24, 2011 at 10:43 PM, Pekka Enberg<penberg@kernel.org>  wrote:
>> I wasn't able to find out any C API for that and assume it was only
>> possible with the C++ API. That said, I'd also be happy to use
>> something else to be compatible with older versions if there is one.
>> Any LLVM experts on the list?
>
> If it just need to use the C++ API, we can compile a bridge c++ file
> to export the missing C++ API to C file. It is actually pretty common praticse
> if you play with LLVM internal a lot, some API just don't exist in C yet.
> We are already using g++ to link llvm, one more c++ file could not hurt.
> If we need some C++ only API later, we can add it there as well.
>
> What do you say?
>
>> LLVM 3.0 is going to be released "real soon now" so I don't think it's
>> a problem in practice. We'd need to add a version check, though so we
>> don't break build on machines that have older LLVM installed.
>
> Still, it will take a while for the distribution to update to the new version.

Pulling in bits of LLVM itself into sparse, to make older versions work, 
seems like a mess of work and maintenance without a driving need.   Just 
note that 3.0 is required, and things will sort themselves out in time.

	Jeff




--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 19:13:57 +0000
Message-ID: <CANeU7Qm6Q3hxeEUFKJieapfXrZ1PGSJ_4oGbZ4CG7s1ccbbPPQ () mail ! gmail ! com>
--------------------
On Fri, Nov 25, 2011 at 9:52 AM, Jeff Garzik <jeff@garzik.org> wrote:
>
> Pulling in bits of LLVM itself into sparse, to make older versions work,
> seems like a mess of work and maintenance without a driving need.   Just
> note that 3.0 is required, and things will sort themselves out in time.

I hate big mess too. However I have a strong motivation to support the
released version of LLVM (if it does make a big mess in the process).

I am not asking to back port the LLVM 3.0 code to the 2.x series.
That is wrong.  If 2.x does not have not provide this features, I am fine
with not supporting 2.x LLVM and require 3.0 only.

However if it is just C vs C++ API, I don't mind accessing the C++ API in 2.x.
I believe we need to have a mechanism to use the LLVM C++ API any way.
The LLVM C API is only a subset of the C++ API. I draw the line at
accessing the API vs backing the LLVM code.

In the long way, sparse will have to deal with different version of
LLVM any way.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 20:18:45 +0000
Message-ID: <4ECFF825.2010906 () garzik ! org>
--------------------
On 11/25/2011 02:13 PM, Christopher Li wrote:
> On Fri, Nov 25, 2011 at 9:52 AM, Jeff Garzik<jeff@garzik.org>  wrote:
>>
>> Pulling in bits of LLVM itself into sparse, to make older versions work,
>> seems like a mess of work and maintenance without a driving need.   Just
>> note that 3.0 is required, and things will sort themselves out in time.
>
> I hate big mess too. However I have a strong motivation to support the
> released version of LLVM (if it does make a big mess in the process).
>
> I am not asking to back port the LLVM 3.0 code to the 2.x series.
> That is wrong.  If 2.x does not have not provide this features, I am fine
> with not supporting 2.x LLVM and require 3.0 only.
>
> However if it is just C vs C++ API, I don't mind accessing the C++ API in 2.x.
> I believe we need to have a mechanism to use the LLVM C++ API any way.
> The LLVM C API is only a subset of the C++ API. I draw the line at
> accessing the API vs backing the LLVM code.

According to http://llvm.org/ the release date for 3.0 is November 30, 
downgrading due to impatience.  If Pekka wants to get it going on 2.x 
I've no objection, but I am lazy and see no reason to do any extra work 
with 3.0 release so close.

	Jeff


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Garzik <jeff () garzik ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 20:18:45 +0000
Message-ID: <4ECFF825.2010906 () garzik ! org>
--------------------
On 11/25/2011 02:13 PM, Christopher Li wrote:
> On Fri, Nov 25, 2011 at 9:52 AM, Jeff Garzik<jeff@garzik.org>  wrote:
>>
>> Pulling in bits of LLVM itself into sparse, to make older versions work,
>> seems like a mess of work and maintenance without a driving need.   Just
>> note that 3.0 is required, and things will sort themselves out in time.
>
> I hate big mess too. However I have a strong motivation to support the
> released version of LLVM (if it does make a big mess in the process).
>
> I am not asking to back port the LLVM 3.0 code to the 2.x series.
> That is wrong.  If 2.x does not have not provide this features, I am fine
> with not supporting 2.x LLVM and require 3.0 only.
>
> However if it is just C vs C++ API, I don't mind accessing the C++ API in 2.x.
> I believe we need to have a mechanism to use the LLVM C++ API any way.
> The LLVM C API is only a subset of the C++ API. I draw the line at
> accessing the API vs backing the LLVM code.

According to http://llvm.org/ the release date for 3.0 is November 30, 
downgrading due to impatience.  If Pekka wants to get it going on 2.x 
I've no objection, but I am lazy and see no reason to do any extra work 
with 3.0 release so close.

	Jeff


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 20:30:14 +0000
Message-ID: <CANeU7QnXWEFFBsHs4V6Z_Mbpq4R+y=f_Ot5CL95WiE49ehDdOA () mail ! gmail ! com>
--------------------
On Fri, Nov 25, 2011 at 12:18 PM, Jeff Garzik <jeff@garzik.org> wrote:
>
> According to http://llvm.org/ the release date for 3.0 is November 30,
> downgrading due to impatience.  If Pekka wants to get it going on 2.x I've
> no objection, but I am lazy and see no reason to do any extra work with 3.0
> release so close.
>

I will take a look how hard it is hard to support llvm 2.9. Don't know when the
3.0 will be available in Fedora.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Fri, 25 Nov 2011 20:30:14 +0000
Message-ID: <CANeU7QnXWEFFBsHs4V6Z_Mbpq4R+y=f_Ot5CL95WiE49ehDdOA () mail ! gmail ! com>
--------------------
On Fri, Nov 25, 2011 at 12:18 PM, Jeff Garzik <jeff@garzik.org> wrote:
>
> According to http://llvm.org/ the release date for 3.0 is November 30,
> downgrading due to impatience.  If Pekka wants to get it going on 2.x I've
> no objection, but I am lazy and see no reason to do any extra work with 3.0
> release so close.
>

I will take a look how hard it is hard to support llvm 2.9. Don't know when the
3.0 will be available in Fedora.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 13 Dec 2011 20:29:42 +0000
Message-ID: <1323808182.1428.309.camel () jaguar>
--------------------
On Fri, Nov 25, 2011 at 12:18 PM, Jeff Garzik <jeff@garzik.org> wrote:
> > According to http://llvm.org/ the release date for 3.0 is November 30,
> > downgrading due to impatience.  If Pekka wants to get it going on 2.x I've
> > no objection, but I am lazy and see no reason to do any extra work with 3.0
> > release so close.

On Fri, 2011-11-25 at 12:30 -0800, Christopher Li wrote:
> I will take a look how hard it is hard to support llvm 2.9. Don't know when the
> 3.0 will be available in Fedora.

Ping? LLVM 3.0 is out now officially.

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Thu, 15 Dec 2011 21:34:36 +0000
Message-ID: <CANeU7QnTxJbKGq-RE87VHm8BYB_4uw6HXJou9DaZr1Uua7rdKQ () mail ! gmail ! com>
--------------------
On Tue, Dec 13, 2011 at 12:29 PM, Pekka Enberg <penberg@kernel.org> wrote:
>
> Ping? LLVM 3.0 is out now officially.


Glad to heard that LLVM 3.0 is out. I haven't able to make the llvm
2.x work yet.
I am fine with LLVM 3.0 for now.

I have one question regarding this change:
2ded1e7406914eda77abde035416140849d76f68

    sparse: Bump up sizeof(_Bool) to 8 bits

    We need sizeof(_Bool) to be one byte to generate code for boolean
expressions
    in the LLVM backend.

Sparse already evaluate sizeof(_Bool) as 8 bits. It current just give warnings.
Will remove the warning sufficient to make sparse-llvm happy?
I take a look at the code LLVM generate, It seem LLVM treat _Bool as 1
bit integer
as well. Can we not change the internal representation of _Bool, only
the sizeof(_Bool)?

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Thu, 15 Dec 2011 21:34:36 +0000
Message-ID: <CANeU7QnTxJbKGq-RE87VHm8BYB_4uw6HXJou9DaZr1Uua7rdKQ () mail ! gmail ! com>
--------------------
On Tue, Dec 13, 2011 at 12:29 PM, Pekka Enberg <penberg@kernel.org> wrote:
>
> Ping? LLVM 3.0 is out now officially.


Glad to heard that LLVM 3.0 is out. I haven't able to make the llvm
2.x work yet.
I am fine with LLVM 3.0 for now.

I have one question regarding this change:
2ded1e7406914eda77abde035416140849d76f68

    sparse: Bump up sizeof(_Bool) to 8 bits

    We need sizeof(_Bool) to be one byte to generate code for boolean
expressions
    in the LLVM backend.

Sparse already evaluate sizeof(_Bool) as 8 bits. It current just give warnings.
Will remove the warning sufficient to make sparse-llvm happy?
I take a look at the code LLVM generate, It seem LLVM treat _Bool as 1
bit integer
as well. Can we not change the internal representation of _Bool, only
the sizeof(_Bool)?

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 20 Dec 2011 08:53:14 +0000
Message-ID: <CAOJsxLEABU-9sJEHD3V=9ugGkMtnufX5LrxhLg5VfbsysA447g () mail ! gmail ! com>
--------------------
On Thu, Dec 15, 2011 at 11:34 PM, Christopher Li <sparse@chrisli.org> wrote:
> I have one question regarding this change:
> 2ded1e7406914eda77abde035416140849d76f68
>
>    sparse: Bump up sizeof(_Bool) to 8 bits
>
>    We need sizeof(_Bool) to be one byte to generate code for boolean
> expressions
>    in the LLVM backend.
>
> Sparse already evaluate sizeof(_Bool) as 8 bits. It current just give warnings.
> Will remove the warning sufficient to make sparse-llvm happy?
> I take a look at the code LLVM generate, It seem LLVM treat _Bool as 1
> bit integer
> as well. Can we not change the internal representation of _Bool, only
> the sizeof(_Bool)?

No, it's not sufficient right now. For something like this:

#include <stdbool.h>

bool is_zero(int x)
{
	return !x;
}

you'd get:

[penberg@tux sparse]$ ./sparse-llvm bool.c
bool.c:3:6: warning: symbol 'is_zero' was not declared. Should it be static?
invalid bit size 1 for type 2

if you revert the commit. However, LLVM 3.0 seems to support 1 bit
integer types so we can probably clean that up.

                                Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pekka Enberg <penberg () kernel ! org>
To: linux-sparse
Subject: Re: suggestion for Merging LLVM
Date: Tue, 20 Dec 2011 08:53:14 +0000
Message-ID: <CAOJsxLEABU-9sJEHD3V=9ugGkMtnufX5LrxhLg5VfbsysA447g () mail ! gmail ! com>
--------------------
On Thu, Dec 15, 2011 at 11:34 PM, Christopher Li <sparse@chrisli.org> wrote:
> I have one question regarding this change:
> 2ded1e7406914eda77abde035416140849d76f68
>
>    sparse: Bump up sizeof(_Bool) to 8 bits
>
>    We need sizeof(_Bool) to be one byte to generate code for boolean
> expressions
>    in the LLVM backend.
>
> Sparse already evaluate sizeof(_Bool) as 8 bits. It current just give warnings.
> Will remove the warning sufficient to make sparse-llvm happy?
> I take a look at the code LLVM generate, It seem LLVM treat _Bool as 1
> bit integer
> as well. Can we not change the internal representation of _Bool, only
> the sizeof(_Bool)?

No, it's not sufficient right now. For something like this:

#include <stdbool.h>

bool is_zero(int x)
{
	return !x;
}

you'd get:

[penberg@tux sparse]$ ./sparse-llvm bool.c
bool.c:3:6: warning: symbol 'is_zero' was not declared. Should it be static?
invalid bit size 1 for type 2

if you revert the commit. However, LLVM 3.0 seems to support 1 bit
integer types so we can probably clean that up.

                                Pekka
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: variable size array declarations ===

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: variable size array declarations
Date: Mon, 31 Oct 2011 14:08:29 +0000
Message-ID: <20111031140829.GD15494 () mwanda>
--------------------

--vni90+aGYgRvsTuO
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

I am trying to check something in Smatch with variable size arrays
and I'm running into problems.  Here is the function I'm trying to
parse.

void func(int x)
{
	char buf[x];
}

Array symbols have an ->array_size.  It gets set correctly in parse.c
to expression of type EXPR_SYMBOL.  But by the time I parse it in
Smatch the ->array_size is now an EXPR_PREOP (a dereference).  In
fact all the variables seem to get change to dereferences of the
variables.

So if I have:
	char buf[a + b + *c + 4];
Smatch gets:
	char buf[*a + *b + **c + 4];

I'm not sure where this is getting changed or why.

regards,
dan carpenter


--vni90+aGYgRvsTuO
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.11 (GNU/Linux)

iQIcBAEBAgAGBQJOrqvdAAoJEOnZkXI/YHqRbTcQAIgZaTq15hQcjEhjDftczcac
06XuLNT3vanZU5+/QusE2pEBj4lCioDK7nLk1fYZCynhsJ/hcIHHqnQ20bwa9b/K
9YS5nolAzZtPiwGmKL6Dr9v9kowMW7S0htVHKUqrMVOo8pfQ2ykBRUdMddjAUm08
GzHtwqCwcX/p+qLZ9a1ZsvKrNPNTxrBj8jUaDDoURIQEQ3GGTGay77zui5pSOAKb
A1CgLzdMLjGC7tiAPK2ip/5je64We0+syJg9NfAzyf0CIkga/5T3dLPB8fiRi/AV
U/nbneXDasJN2VOxmWyLxy1gx9r7hBRV/RebRQyXQig+q7wBqVonzhNeeIIR/aPM
TSFg27xA5ay+21KVES+dsi6P8lTTw7HrqgPEb5ItyG9yHTK9eMV1PDvO/z+FwJc5
Dc+1BbSug2uBUM+Boy80cQe/LodTPtqdOym2jBdNPHQLnvX3yxrrRB6VgeZ7QJA0
E3KjrPQQ2041iYtZtNWTvOfwJu5vBuJu6AznajL0adoR7KhqjhWAbp1jhnSz9mzH
Pa+OOIPoeRx3NkQqHAtErnTCNtqIujf8Bf/4wHCPtFiC3/JI726NabZxH+Nm67qV
p47R7ZUdmxxWIDRLbAFQkIJo2Zi0r24orWSlTu1Burh4b47MWI55npf0SAvd5MwS
6YwLvlgt1gY88fHPZyMr
=qYhZ
-----END PGP SIGNATURE-----

--vni90+aGYgRvsTuO--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: vector_size attribute? ===

From: Avi Kivity <avi () redhat ! com>
To: linux-sparse
Subject: Re: vector_size attribute?
Date: Sun, 29 May 2011 16:26:24 +0000
Message-ID: <4DE273B0.7000800 () redhat ! com>
--------------------
On 05/29/2011 06:57 PM, Randy Dunlap wrote:
> Current Linux mainline generates a ton of sparse warnings like
>
> arch/x86/include/asm/kvm_emulate.h:194:28: error: attribute 'vector_size': unknown attribute
>
> from this source line:
>
> typedef u32 __attribute__((vector_size(16))) sse128_t;

I guess sparse should be taught about it.  It's needed so that gcc asm 
constraints are aware of what memory is touched when running an sse 
instruction.

(probably ignoring it for now should be sufficient)

-- 
error compiling committee.c: too many arguments to function

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Randy Dunlap <rdunlap () xenotime ! net>
To: linux-sparse
Subject: Re: vector_size attribute?
Date: Tue, 31 May 2011 18:31:28 +0000
Message-ID: <20110531113128.12fbabee.rdunlap () xenotime ! net>
--------------------
On Tue, 31 May 2011 04:22:37 -0700 Christopher Li wrote:

> On Sun, May 29, 2011 at 9:26 AM, Avi Kivity <avi@redhat.com> wrote:
> > On 05/29/2011 06:57 PM, Randy Dunlap wrote:
> >> typedef u32 __attribute__((vector_size(16))) sse128_t;
> >
> > I guess sparse should be taught about it.  It's needed so that gcc asm
> > constraints are aware of what memory is touched when running an sse
> > instruction.
> >
> > (probably ignoring it for now should be sufficient)
> 
> I just submit a change to ignore that attribute. Works fine with
> the trivial test case.

Works on kernel source tree also (of course).  Thanks.


> Chris
> 
> commit d8b20ec2324b09b164b298fbab6b4265b6886929
> Author: Christopher Li <sparse@chrisli.org>
> Date:   Tue May 31 04:05:37 2011 -0700
> 
>     Ignore attribute vector_size
> 
>     Report by Randy Dunlap, attribute vector_size is causing
>     error. Ignore it for now.
> 
>     Signed-off-by: Christopher Li <sparse@chrisli.org>
> 
> diff --git a/parse.c b/parse.c
> index 9e79ef0..57f369b 100644
> --- a/parse.c
> +++ b/parse.c
> @@ -563,6 +563,7 @@ const char *ignored_attributes[] = {
>         "__unused__",
>         "used",
>         "__used__",
> +       "vector_size",
>         "visibility",
>         "__visibility__",
>         "warn_unused_result",
> diff --git a/validation/attr_vector_size.c b/validation/attr_vector_size.c
> new file mode 100644
> index 0000000..6982922
> --- /dev/null
> +++ b/validation/attr_vector_size.c
> @@ -0,0 +1,7 @@
> +typedef unsigned int u32;
> +typedef u32 __attribute__((vector_size(16))) sse128_t;
> +
> +/*
> + * check-name: attribute vector_size
> + */
> +


---
~Randy
*** Remember to use Documentation/SubmitChecklist when testing your code ***
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

