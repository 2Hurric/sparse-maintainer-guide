--- Emails for Year 2014 ---

=== Thread: [No Subject] ===

From: Unknown
To: Unknown
Subject: 
Date: 
Message-ID: 
--------------------
change in LLVM[2] which requires the new "--system-libs" option to llvm-
config to get the list of link flags for correct linking of system 
libraries (including "-lpthread") needed by the LLVM libraries.

Kind regards,

Alain

[1]: https://bugs.archlinux.org/task/42053
[2]: http://reviews.llvm.org/rL197664

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: MRS GRACE MANDA <mrsgracem692 () gmail ! com>
To: linux-sparse
Subject: 
Date: Sun, 02 Nov 2014 19:54:23 +0000
Message-ID: <114123003.144460.1414958063497.JavaMail.yahoo () jws10093 ! mail ! ne1 ! yahoo ! com>
--------------------
------=_Part_144459_638505723.1414958063497
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit






This is Mrs Grace Manda (  Please I need your Help is Urgent).






This is Mrs Grace Manda (  Please I need your Help is Urgent). 
------=_Part_144459_638505723.1414958063497
Content-Type: application/rtf
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="Mrs Grace Manda.rtf"
Content-ID: <a694848b-a372-b37f-7b1f-7487bb17f8a1@yahoo.com>

e1xydGYxXGFkZWZsYW5nMTAyNVxhbnNpXGFuc2ljcGcxMjUyXHVjMVxhZGVmZjMxNTA3XGRlZmYw
XHN0c2hmZGJjaDMxNTA1XHN0c2hmbG9jaDMxNTA2XHN0c2hmaGljaDMxNTA2XHN0c2hmYmkwXGRl
ZmxhbmcxMDMzXGRlZmxhbmdmZTEwMzNcdGhlbWVsYW5nMTAzM1x0aGVtZWxhbmdmZTBcdGhlbWVs
YW5nY3Mwe1xmb250dGJse1xmMFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MFxmcHJxMntcKlxwYW5v
c2UgMDIwMjA2MDMwNTA0MDUwMjAzMDR9VGltZXMgTmV3IFJvbWFuO317XGYxXGZiaWRpIFxmc3dp
c3NcZmNoYXJzZXQwXGZwcnEye1wqXHBhbm9zZSAwMjBiMDYwNDAyMDIwMjAyMDIwNH1BcmlhbDt9
DQp7XGYzNFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MFxmcHJxMntcKlxwYW5vc2UgMDIwNDA1MDMw
NTA0MDYwMzAyMDR9Q2FtYnJpYSBNYXRoO317XGYzN1xmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MFxm
cHJxMntcKlxwYW5vc2UgMDIwZjA1MDIwMjAyMDQwMzAyMDR9Q2FsaWJyaTt9e1xmbG9tYWpvclxm
MzE1MDBcZmJpZGkgXGZyb21hblxmY2hhcnNldDBcZnBycTJ7XCpccGFub3NlIDAyMDIwNjAzMDUw
NDA1MDIwMzA0fVRpbWVzIE5ldyBSb21hbjt9DQp7XGZkYm1ham9yXGYzMTUwMVxmYmlkaSBcZnJv
bWFuXGZjaGFyc2V0MFxmcHJxMntcKlxwYW5vc2UgMDIwMjA2MDMwNTA0MDUwMjAzMDR9VGltZXMg
TmV3IFJvbWFuO317XGZoaW1ham9yXGYzMTUwMlxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MFxmcHJx
MntcKlxwYW5vc2UgMDIwNDA1MDMwNTA0MDYwMzAyMDR9Q2FtYnJpYTt9DQp7XGZiaW1ham9yXGYz
MTUwM1xmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MFxmcHJxMntcKlxwYW5vc2UgMDIwMjA2MDMwNTA0
MDUwMjAzMDR9VGltZXMgTmV3IFJvbWFuO317XGZsb21pbm9yXGYzMTUwNFxmYmlkaSBcZnJvbWFu
XGZjaGFyc2V0MFxmcHJxMntcKlxwYW5vc2UgMDIwMjA2MDMwNTA0MDUwMjAzMDR9VGltZXMgTmV3
IFJvbWFuO30NCntcZmRibWlub3JcZjMxNTA1XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQwXGZwcnEy
e1wqXHBhbm9zZSAwMjAyMDYwMzA1MDQwNTAyMDMwNH1UaW1lcyBOZXcgUm9tYW47fXtcZmhpbWlu
b3JcZjMxNTA2XGZiaWRpIFxmc3dpc3NcZmNoYXJzZXQwXGZwcnEye1wqXHBhbm9zZSAwMjBmMDUw
MjAyMDIwNDAzMDIwNH1DYWxpYnJpO30NCntcZmJpbWlub3JcZjMxNTA3XGZiaWRpIFxmcm9tYW5c
ZmNoYXJzZXQwXGZwcnEye1wqXHBhbm9zZSAwMjAyMDYwMzA1MDQwNTAyMDMwNH1UaW1lcyBOZXcg
Um9tYW47fXtcZjM5XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQyMzhcZnBycTIgVGltZXMgTmV3IFJv
bWFuIENFO317XGY0MFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MjA0XGZwcnEyIFRpbWVzIE5ldyBS
b21hbiBDeXI7fQ0Ke1xmNDJcZmJpZGkgXGZyb21hblxmY2hhcnNldDE2MVxmcHJxMiBUaW1lcyBO
ZXcgUm9tYW4gR3JlZWs7fXtcZjQzXGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNjJcZnBycTIgVGlt
ZXMgTmV3IFJvbWFuIFR1cjt9e1xmNDRcZmJpZGkgXGZyb21hblxmY2hhcnNldDE3N1xmcHJxMiBU
aW1lcyBOZXcgUm9tYW4gKEhlYnJldyk7fXtcZjQ1XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNzhc
ZnBycTIgVGltZXMgTmV3IFJvbWFuIChBcmFiaWMpO30NCntcZjQ2XGZiaWRpIFxmcm9tYW5cZmNo
YXJzZXQxODZcZnBycTIgVGltZXMgTmV3IFJvbWFuIEJhbHRpYzt9e1xmNDdcZmJpZGkgXGZyb21h
blxmY2hhcnNldDE2M1xmcHJxMiBUaW1lcyBOZXcgUm9tYW4gKFZpZXRuYW1lc2UpO317XGY0OVxm
YmlkaSBcZnN3aXNzXGZjaGFyc2V0MjM4XGZwcnEyIEFyaWFsIENFO317XGY1MFxmYmlkaSBcZnN3
aXNzXGZjaGFyc2V0MjA0XGZwcnEyIEFyaWFsIEN5cjt9DQp7XGY1MlxmYmlkaSBcZnN3aXNzXGZj
aGFyc2V0MTYxXGZwcnEyIEFyaWFsIEdyZWVrO317XGY1M1xmYmlkaSBcZnN3aXNzXGZjaGFyc2V0
MTYyXGZwcnEyIEFyaWFsIFR1cjt9e1xmNTRcZmJpZGkgXGZzd2lzc1xmY2hhcnNldDE3N1xmcHJx
MiBBcmlhbCAoSGVicmV3KTt9e1xmNTVcZmJpZGkgXGZzd2lzc1xmY2hhcnNldDE3OFxmcHJxMiBB
cmlhbCAoQXJhYmljKTt9DQp7XGY1NlxmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MTg2XGZwcnEyIEFy
aWFsIEJhbHRpYzt9e1xmNTdcZmJpZGkgXGZzd2lzc1xmY2hhcnNldDE2M1xmcHJxMiBBcmlhbCAo
VmlldG5hbWVzZSk7fXtcZjM3OVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MjM4XGZwcnEyIENhbWJy
aWEgTWF0aCBDRTt9e1xmMzgwXGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQyMDRcZnBycTIgQ2FtYnJp
YSBNYXRoIEN5cjt9DQp7XGYzODJcZmJpZGkgXGZyb21hblxmY2hhcnNldDE2MVxmcHJxMiBDYW1i
cmlhIE1hdGggR3JlZWs7fXtcZjM4M1xmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYyXGZwcnEyIENh
bWJyaWEgTWF0aCBUdXI7fXtcZjM4NlxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTg2XGZwcnEyIENh
bWJyaWEgTWF0aCBCYWx0aWM7fXtcZjQwOVxmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MjM4XGZwcnEy
IENhbGlicmkgQ0U7fQ0Ke1xmNDEwXGZiaWRpIFxmc3dpc3NcZmNoYXJzZXQyMDRcZnBycTIgQ2Fs
aWJyaSBDeXI7fXtcZjQxMlxmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MTYxXGZwcnEyIENhbGlicmkg
R3JlZWs7fXtcZjQxM1xmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MTYyXGZwcnEyIENhbGlicmkgVHVy
O317XGY0MTZcZmJpZGkgXGZzd2lzc1xmY2hhcnNldDE4NlxmcHJxMiBDYWxpYnJpIEJhbHRpYzt9
DQp7XGZsb21ham9yXGYzMTUwOFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MjM4XGZwcnEyIFRpbWVz
IE5ldyBSb21hbiBDRTt9e1xmbG9tYWpvclxmMzE1MDlcZmJpZGkgXGZyb21hblxmY2hhcnNldDIw
NFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQ3lyO317XGZsb21ham9yXGYzMTUxMVxmYmlkaSBcZnJv
bWFuXGZjaGFyc2V0MTYxXGZwcnEyIFRpbWVzIE5ldyBSb21hbiBHcmVlazt9DQp7XGZsb21ham9y
XGYzMTUxMlxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYyXGZwcnEyIFRpbWVzIE5ldyBSb21hbiBU
dXI7fXtcZmxvbWFqb3JcZjMxNTEzXGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNzdcZnBycTIgVGlt
ZXMgTmV3IFJvbWFuIChIZWJyZXcpO317XGZsb21ham9yXGYzMTUxNFxmYmlkaSBcZnJvbWFuXGZj
aGFyc2V0MTc4XGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoQXJhYmljKTt9DQp7XGZsb21ham9yXGYz
MTUxNVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTg2XGZwcnEyIFRpbWVzIE5ldyBSb21hbiBCYWx0
aWM7fXtcZmxvbWFqb3JcZjMxNTE2XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNjNcZnBycTIgVGlt
ZXMgTmV3IFJvbWFuIChWaWV0bmFtZXNlKTt9e1xmZGJtYWpvclxmMzE1MThcZmJpZGkgXGZyb21h
blxmY2hhcnNldDIzOFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQ0U7fQ0Ke1xmZGJtYWpvclxmMzE1
MTlcZmJpZGkgXGZyb21hblxmY2hhcnNldDIwNFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQ3lyO317
XGZkYm1ham9yXGYzMTUyMVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYxXGZwcnEyIFRpbWVzIE5l
dyBSb21hbiBHcmVlazt9e1xmZGJtYWpvclxmMzE1MjJcZmJpZGkgXGZyb21hblxmY2hhcnNldDE2
MlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gVHVyO30NCntcZmRibWFqb3JcZjMxNTIzXGZiaWRpIFxm
cm9tYW5cZmNoYXJzZXQxNzdcZnBycTIgVGltZXMgTmV3IFJvbWFuIChIZWJyZXcpO317XGZkYm1h
am9yXGYzMTUyNFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTc4XGZwcnEyIFRpbWVzIE5ldyBSb21h
biAoQXJhYmljKTt9e1xmZGJtYWpvclxmMzE1MjVcZmJpZGkgXGZyb21hblxmY2hhcnNldDE4Nlxm
cHJxMiBUaW1lcyBOZXcgUm9tYW4gQmFsdGljO30NCntcZmRibWFqb3JcZjMxNTI2XGZiaWRpIFxm
cm9tYW5cZmNoYXJzZXQxNjNcZnBycTIgVGltZXMgTmV3IFJvbWFuIChWaWV0bmFtZXNlKTt9e1xm
aGltYWpvclxmMzE1MjhcZmJpZGkgXGZyb21hblxmY2hhcnNldDIzOFxmcHJxMiBDYW1icmlhIENF
O317XGZoaW1ham9yXGYzMTUyOVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MjA0XGZwcnEyIENhbWJy
aWEgQ3lyO30NCntcZmhpbWFqb3JcZjMxNTMxXGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNjFcZnBy
cTIgQ2FtYnJpYSBHcmVlazt9e1xmaGltYWpvclxmMzE1MzJcZmJpZGkgXGZyb21hblxmY2hhcnNl
dDE2MlxmcHJxMiBDYW1icmlhIFR1cjt9e1xmaGltYWpvclxmMzE1MzVcZmJpZGkgXGZyb21hblxm
Y2hhcnNldDE4NlxmcHJxMiBDYW1icmlhIEJhbHRpYzt9DQp7XGZiaW1ham9yXGYzMTUzOFxmYmlk
aSBcZnJvbWFuXGZjaGFyc2V0MjM4XGZwcnEyIFRpbWVzIE5ldyBSb21hbiBDRTt9e1xmYmltYWpv
clxmMzE1MzlcZmJpZGkgXGZyb21hblxmY2hhcnNldDIwNFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4g
Q3lyO317XGZiaW1ham9yXGYzMTU0MVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYxXGZwcnEyIFRp
bWVzIE5ldyBSb21hbiBHcmVlazt9DQp7XGZiaW1ham9yXGYzMTU0MlxmYmlkaSBcZnJvbWFuXGZj
aGFyc2V0MTYyXGZwcnEyIFRpbWVzIE5ldyBSb21hbiBUdXI7fXtcZmJpbWFqb3JcZjMxNTQzXGZi
aWRpIFxmcm9tYW5cZmNoYXJzZXQxNzdcZnBycTIgVGltZXMgTmV3IFJvbWFuIChIZWJyZXcpO317
XGZiaW1ham9yXGYzMTU0NFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTc4XGZwcnEyIFRpbWVzIE5l
dyBSb21hbiAoQXJhYmljKTt9DQp7XGZiaW1ham9yXGYzMTU0NVxmYmlkaSBcZnJvbWFuXGZjaGFy
c2V0MTg2XGZwcnEyIFRpbWVzIE5ldyBSb21hbiBCYWx0aWM7fXtcZmJpbWFqb3JcZjMxNTQ2XGZi
aWRpIFxmcm9tYW5cZmNoYXJzZXQxNjNcZnBycTIgVGltZXMgTmV3IFJvbWFuIChWaWV0bmFtZXNl
KTt9e1xmbG9taW5vclxmMzE1NDhcZmJpZGkgXGZyb21hblxmY2hhcnNldDIzOFxmcHJxMiBUaW1l
cyBOZXcgUm9tYW4gQ0U7fQ0Ke1xmbG9taW5vclxmMzE1NDlcZmJpZGkgXGZyb21hblxmY2hhcnNl
dDIwNFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQ3lyO317XGZsb21pbm9yXGYzMTU1MVxmYmlkaSBc
ZnJvbWFuXGZjaGFyc2V0MTYxXGZwcnEyIFRpbWVzIE5ldyBSb21hbiBHcmVlazt9e1xmbG9taW5v
clxmMzE1NTJcZmJpZGkgXGZyb21hblxmY2hhcnNldDE2MlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4g
VHVyO30NCntcZmxvbWlub3JcZjMxNTUzXGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNzdcZnBycTIg
VGltZXMgTmV3IFJvbWFuIChIZWJyZXcpO317XGZsb21pbm9yXGYzMTU1NFxmYmlkaSBcZnJvbWFu
XGZjaGFyc2V0MTc4XGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoQXJhYmljKTt9e1xmbG9taW5vclxm
MzE1NTVcZmJpZGkgXGZyb21hblxmY2hhcnNldDE4NlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQmFs
dGljO30NCntcZmxvbWlub3JcZjMxNTU2XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQxNjNcZnBycTIg
VGltZXMgTmV3IFJvbWFuIChWaWV0bmFtZXNlKTt9e1xmZGJtaW5vclxmMzE1NThcZmJpZGkgXGZy
b21hblxmY2hhcnNldDIzOFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQ0U7fXtcZmRibWlub3JcZjMx
NTU5XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQyMDRcZnBycTIgVGltZXMgTmV3IFJvbWFuIEN5cjt9
DQp7XGZkYm1pbm9yXGYzMTU2MVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYxXGZwcnEyIFRpbWVz
IE5ldyBSb21hbiBHcmVlazt9e1xmZGJtaW5vclxmMzE1NjJcZmJpZGkgXGZyb21hblxmY2hhcnNl
dDE2MlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gVHVyO317XGZkYm1pbm9yXGYzMTU2M1xmYmlkaSBc
ZnJvbWFuXGZjaGFyc2V0MTc3XGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoSGVicmV3KTt9DQp7XGZk
Ym1pbm9yXGYzMTU2NFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTc4XGZwcnEyIFRpbWVzIE5ldyBS
b21hbiAoQXJhYmljKTt9e1xmZGJtaW5vclxmMzE1NjVcZmJpZGkgXGZyb21hblxmY2hhcnNldDE4
NlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQmFsdGljO317XGZkYm1pbm9yXGYzMTU2NlxmYmlkaSBc
ZnJvbWFuXGZjaGFyc2V0MTYzXGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoVmlldG5hbWVzZSk7fQ0K
e1xmaGltaW5vclxmMzE1NjhcZmJpZGkgXGZzd2lzc1xmY2hhcnNldDIzOFxmcHJxMiBDYWxpYnJp
IENFO317XGZoaW1pbm9yXGYzMTU2OVxmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MjA0XGZwcnEyIENh
bGlicmkgQ3lyO317XGZoaW1pbm9yXGYzMTU3MVxmYmlkaSBcZnN3aXNzXGZjaGFyc2V0MTYxXGZw
cnEyIENhbGlicmkgR3JlZWs7fXtcZmhpbWlub3JcZjMxNTcyXGZiaWRpIFxmc3dpc3NcZmNoYXJz
ZXQxNjJcZnBycTIgQ2FsaWJyaSBUdXI7fQ0Ke1xmaGltaW5vclxmMzE1NzVcZmJpZGkgXGZzd2lz
c1xmY2hhcnNldDE4NlxmcHJxMiBDYWxpYnJpIEJhbHRpYzt9e1xmYmltaW5vclxmMzE1NzhcZmJp
ZGkgXGZyb21hblxmY2hhcnNldDIzOFxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQ0U7fXtcZmJpbWlu
b3JcZjMxNTc5XGZiaWRpIFxmcm9tYW5cZmNoYXJzZXQyMDRcZnBycTIgVGltZXMgTmV3IFJvbWFu
IEN5cjt9DQp7XGZiaW1pbm9yXGYzMTU4MVxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYxXGZwcnEy
IFRpbWVzIE5ldyBSb21hbiBHcmVlazt9e1xmYmltaW5vclxmMzE1ODJcZmJpZGkgXGZyb21hblxm
Y2hhcnNldDE2MlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gVHVyO317XGZiaW1pbm9yXGYzMTU4M1xm
YmlkaSBcZnJvbWFuXGZjaGFyc2V0MTc3XGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoSGVicmV3KTt9
DQp7XGZiaW1pbm9yXGYzMTU4NFxmYmlkaSBcZnJvbWFuXGZjaGFyc2V0MTc4XGZwcnEyIFRpbWVz
IE5ldyBSb21hbiAoQXJhYmljKTt9e1xmYmltaW5vclxmMzE1ODVcZmJpZGkgXGZyb21hblxmY2hh
cnNldDE4NlxmcHJxMiBUaW1lcyBOZXcgUm9tYW4gQmFsdGljO317XGZiaW1pbm9yXGYzMTU4Nlxm
YmlkaSBcZnJvbWFuXGZjaGFyc2V0MTYzXGZwcnEyIFRpbWVzIE5ldyBSb21hbiAoVmlldG5hbWVz
ZSk7fX0NCntcY29sb3J0Ymw7XHJlZDBcZ3JlZW4wXGJsdWUwO1xyZWQwXGdyZWVuMFxibHVlMjU1
O1xyZWQwXGdyZWVuMjU1XGJsdWUyNTU7XHJlZDBcZ3JlZW4yNTVcYmx1ZTA7XHJlZDI1NVxncmVl
bjBcYmx1ZTI1NTtccmVkMjU1XGdyZWVuMFxibHVlMDtccmVkMjU1XGdyZWVuMjU1XGJsdWUwO1xy
ZWQyNTVcZ3JlZW4yNTVcYmx1ZTI1NTtccmVkMFxncmVlbjBcYmx1ZTEyODtccmVkMFxncmVlbjEy
OFxibHVlMTI4O1xyZWQwXGdyZWVuMTI4XGJsdWUwOw0KXHJlZDEyOFxncmVlbjBcYmx1ZTEyODtc
cmVkMTI4XGdyZWVuMFxibHVlMDtccmVkMTI4XGdyZWVuMTI4XGJsdWUwO1xyZWQxMjhcZ3JlZW4x
MjhcYmx1ZTEyODtccmVkMTkyXGdyZWVuMTkyXGJsdWUxOTI7fXtcKlxkZWZjaHAgXGZzMjJcbG9j
aFxhZjMxNTA2XGhpY2hcYWYzMTUwNlxkYmNoXGFmMzE1MDUgfXtcKlxkZWZwYXAgXHFsIFxsaTBc
cmkwXHNhMjAwXHNsMjc2XHNsbXVsdDENClx3aWRjdGxwYXJcd3JhcGRlZmF1bHRcYXNwYWxwaGFc
YXNwbnVtXGZhYXV0b1xhZGp1c3RyaWdodFxyaW4wXGxpbjBcaXRhcDAgfVxub3FmcHJvbW90ZSB7
XHN0eWxlc2hlZXR7XHFsIFxsaTBccmkwXHNhMjAwXHNsMjc2XHNsbXVsdDFcd2lkY3RscGFyXHdy
YXBkZWZhdWx0XGFzcGFscGhhXGFzcG51bVxmYWF1dG9cYWRqdXN0cmlnaHRccmluMFxsaW4wXGl0
YXAwIFxydGxjaFxmY3MxIFxhZjMxNTA3XGFmczIyXGFsYW5nMTAyNSANClxsdHJjaFxmY3MwIFxm
czIyXGxhbmcxMDMzXGxhbmdmZTEwMzNcbG9jaFxmMzE1MDZcaGljaFxhZjMxNTA2XGRiY2hcYWYz
MTUwNVxjZ3JpZFxsYW5nbnAxMDMzXGxhbmdmZW5wMTAzMyBcc25leHQwIFxzcWZvcm1hdCBcc3By
aW9yaXR5MCBOb3JtYWw7fXtcKlxjczEwIFxhZGRpdGl2ZSBcc3NlbWloaWRkZW4gXHN1bmhpZGV1
c2VkIFxzcHJpb3JpdHkxIERlZmF1bHQgUGFyYWdyYXBoIEZvbnQ7fXtcKg0KXHRzMTFcdHNyb3dk
XHRyZnRzV2lkdGhCM1x0cnBhZGRsMTA4XHRycGFkZHIxMDhcdHJwYWRkZmwzXHRycGFkZGZ0M1x0
cnBhZGRmYjNcdHJwYWRkZnIzXHRyY2JwYXQxXHRyY2ZwYXQxXHRibGluZDBcdGJsaW5kdHlwZTNc
dHNjZWxsd2lkdGhmdHMwXHRzdmVydGFsdFx0c2JyZHJ0XHRzYnJkcmxcdHNicmRyYlx0c2JyZHJy
XHRzYnJkcmRnbFx0c2JyZHJkZ3JcdHNicmRyaFx0c2JyZHJ2IFxxbCBcbGkwXHJpMFxzYTIwMFxz
bDI3NlxzbG11bHQxDQpcd2lkY3RscGFyXHdyYXBkZWZhdWx0XGFzcGFscGhhXGFzcG51bVxmYWF1
dG9cYWRqdXN0cmlnaHRccmluMFxsaW4wXGl0YXAwIFxydGxjaFxmY3MxIFxhZjBcYWZzMjJcYWxh
bmcxMDI1IFxsdHJjaFxmY3MwIFxmczIyXGxhbmcxMDMzXGxhbmdmZTEwMzNcbG9jaFxmMzE1MDZc
aGljaFxhZjMxNTA2XGRiY2hcYWYzMTUwNVxjZ3JpZFxsYW5nbnAxMDMzXGxhbmdmZW5wMTAzMyAN
ClxzbmV4dDExIFxzc2VtaWhpZGRlbiBcc3VuaGlkZXVzZWQgXHNxZm9ybWF0IE5vcm1hbCBUYWJs
ZTt9fXtcKlxyc2lkdGJsIFxyc2lkMjk2NTk5OFxyc2lkODUzNTU3OFxyc2lkMTQ2NDYzMDN9e1xt
bWF0aFByXG1tYXRoRm9udDM0XG1icmtCaW4wXG1icmtCaW5TdWIwXG1zbWFsbEZyYWMwXG1kaXNw
RGVmMVxtbE1hcmdpbjBcbXJNYXJnaW4wXG1kZWZKYzFcbXdyYXBJbmRlbnQxNDQwXG1pbnRMaW0w
XG1uYXJ5TGltMX17XGluZm8NCntcYXV0aG9yIFVzZXJ9e1xvcGVyYXRvciBVc2VyfXtcY3JlYXRp
bVx5cjIwMTRcbW8xMFxkeTlcaHIyMVxtaW4zfXtccmV2dGltXHlyMjAxNFxtbzEwXGR5MThcaHIy
MVxtaW4xfXtcdmVyc2lvbjN9e1xlZG1pbnMxfXtcbm9mcGFnZXMxfXtcbm9md29yZHM1OTV9e1xu
b2ZjaGFyczI2NjF9e1xub2ZjaGFyc3dzMzI1MH17XHZlcm4zMjg1OX19e1wqXHhtbG5zdGJsIHtc
eG1sbnMxIGh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vb2ZmaWNlL3dvcg0KZC8yMDAzL3dv
cmRtbH19XHBhcGVydzEyMjQwXHBhcGVyaDE1ODQwXG1hcmdsMTQ0MFxtYXJncjE0NDBcbWFyZ3Qx
NDQwXG1hcmdiMTQ0MFxndXR0ZXIwXGx0cnNlY3QgDQpcd2lkb3djdHJsXGZ0bmJqXGFlbmRkb2Nc
dHJhY2ttb3ZlczFcdHJhY2tmb3JtYXR0aW5nMVxkb25vdGVtYmVkc3lzZm9udDBccmVseW9udm1s
MFxkb25vdGVtYmVkbGluZ2RhdGExXGdyZmRvY2V2ZW50czBcdmFsaWRhdGV4bWwwXHNob3dwbGFj
ZWhvbGR0ZXh0MFxpZ25vcmVtaXhlZGNvbnRlbnQwXHNhdmVpbnZhbGlkeG1sMFxzaG93eG1sZXJy
b3JzMFxob3J6ZG9jXGRnaHNwYWNlMTIwXGRndnNwYWNlMTIwXGRnaG9yaWdpbjE3MDENClxkZ3Zv
cmlnaW4xOTg0XGRnaHNob3cwXGRndnNob3czXGpjb21wcmVzc1x2aWV3a2luZDFcdmlld3NjYWxl
MTAwXHJzaWRyb290MTQ2NDYzMDMgXGZldDB7XCpcd2dyZmZtdGZpbHRlciAyNDUwfVxpbGZvbWFj
YXRjbG51cDBcbHRycGFyIFxzZWN0ZCBcbHRyc2VjdFxsaW5leDBcc2VjdGRlZmF1bHRjbFxzZnRu
Ymoge1wqXHBuc2VjbHZsMVxwbnVjcm1ccG5zdGFydDFccG5pbmRlbnQ3MjBccG5oYW5nIHtccG50
eHRhIC59fXtcKlxwbnNlY2x2bDINClxwbnVjbHRyXHBuc3RhcnQxXHBuaW5kZW50NzIwXHBuaGFu
ZyB7XHBudHh0YSAufX17XCpccG5zZWNsdmwzXHBuZGVjXHBuc3RhcnQxXHBuaW5kZW50NzIwXHBu
aGFuZyB7XHBudHh0YSAufX17XCpccG5zZWNsdmw0XHBubGNsdHJccG5zdGFydDFccG5pbmRlbnQ3
MjBccG5oYW5nIHtccG50eHRhICl9fXtcKlxwbnNlY2x2bDVccG5kZWNccG5zdGFydDFccG5pbmRl
bnQ3MjBccG5oYW5nIHtccG50eHRiICh9e1xwbnR4dGEgKX19e1wqXHBuc2VjbHZsNg0KXHBubGNs
dHJccG5zdGFydDFccG5pbmRlbnQ3MjBccG5oYW5nIHtccG50eHRiICh9e1xwbnR4dGEgKX19e1wq
XHBuc2VjbHZsN1xwbmxjcm1ccG5zdGFydDFccG5pbmRlbnQ3MjBccG5oYW5nIHtccG50eHRiICh9
e1xwbnR4dGEgKX19e1wqXHBuc2VjbHZsOFxwbmxjbHRyXHBuc3RhcnQxXHBuaW5kZW50NzIwXHBu
aGFuZyB7XHBudHh0YiAofXtccG50eHRhICl9fXtcKlxwbnNlY2x2bDlccG5sY3JtXHBuc3RhcnQx
XHBuaW5kZW50NzIwXHBuaGFuZyANCntccG50eHRiICh9e1xwbnR4dGEgKX19XHBhcmRccGxhaW4g
XGx0cnBhclxxbCBcbGkwXHJpMFxub3dpZGN0bHBhclx3cmFwZGVmYXVsdFxmYWF1dG9ccmluMFxs
aW4wXGl0YXAwIFxydGxjaFxmY3MxIFxhZjMxNTA3XGFmczIyXGFsYW5nMTAyNSBcbHRyY2hcZmNz
MCBcZnMyMlxsYW5nMTAzM1xsYW5nZmUxMDMzXGxvY2hcYWYzMTUwNlxoaWNoXGFmMzE1MDZcZGJj
aFxhZjMxNTA1XGNncmlkXGxhbmducDEwMzNcbGFuZ2ZlbnAxMDMzIHsNClxydGxjaFxmY3MxIFxh
YlxhZjFcYWZzMjAgXGx0cmNoXGZjczAgXGJcZjFcZnMyMFxpbnNyc2lkMTQ2NDYzMDMgXGhpY2hc
YWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxIEZyb20gTXJzLiBHcmFjZSBNYW5kYQ0KXHBhciBcaGlj
aFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgRm9ybWFsIHdvcmtlciBpbiBTb3V0aCBBZnJpY2EN
ClxwYXIgXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxIEdvbGQgcGFubmluZyBhc3NvY2lh
dGlvbg0KXHBhciANClxwYXIgXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxIE15IERlYXJl
c3QgaW4gY2hyaXN0LA0KXHBhciANClxwYXIgXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYx
IA0KRmlyc3QsIGxldCBtZSBzdGFydCBieSBpbnRyb2R1Y2luZyBteXNlbGYgTXkgbmFtZSBpcyBN
cnMuIEdyYWNlIE1hbmRhIGEgbmF0aW9uYWxpdHkgb2Ygc291dGggQWZyaWNhICxJIHdhcyB3b3Jr
aW5nIHdpdGggU291dGggQWZyaWNhIGdvbGQgcGFubmluZyBhc3NvY2lhdGlvbi4gWW91IGNhbiB2
aWV3IHRoZSBwcm9maWxlIG9mIFNvdXRoIEFmcmljYSBnb2xkIHBhbm5pbmcgYXNzb2NpYXRpb24g
YXQgKGh0dHA6Ly93d3cuc2Fnb2xkcGFubmluZy5jDQpcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxv
Y2hcZjEgb1xoaWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSAuemEvaGlzdG9yeS5odG0pIGFu
ZCByZWFkIGFib3V0IHVzLiAgSSBhbSBtYXJyaWVkIHRvIGxhdGUgTXIuQm9uZ2FuaSBNYW5kYTsg
d2Ugd2VyZQ0KXHBhciBcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgbWFycmllZCBmb3Ig
dHdlbnR5IHllYXJzIHdpdGggYSBjaGlsZC4gSGUgZGllZCBhZnRlciBhbiBpbGxuZXNzIHRoYXQg
bGFzdGVkIGZvciBmb3VyIHdlZWtzLiBQbGVhc2UgSSBrbm93IHRoaXMgbWF5IGNvbWUgdG8geW91
IGJ5IHN1cnByaXNlLCBiZWNhdXNlIHlvdSBkaWQgbm90IGtub3cgbWUsIEkgblxoaWNoXGFmMVxk
YmNoXGFmMzE1MDVcbG9jaFxmMSANCmVlZGVkIHlvdXIgYXNzaXN0YW5jZSB0aGF0IHdhcyB3aHkg
SSB3cml0ZSB5b3UgdGhyb3VnaCBkaXZpbmUgZGlyZWN0aW9uLCBpdCBpcyBteSBkZXNpcmUgb2Yg
Z29pbmcgaW50bw0KXHBhciBcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgcmVsYXRpb25z
aGlwIHdpdGggeW91Lg0KXHBhciANClxwYXIgXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYx
IEJlZm9yZSBoaXMgZGVhdGggd2Ugd2VyZSBib3RoIGJvcm4gYWdhaW4gQ2hyaXN0aWFucy4gV2hl
biBteSBsYXRlIGh1c2JhbmQgd2FzIGFsaXZlIHdlIGRlcG9zaXRlZCB0aGUgc3VtIG9mIFVTRCQz
MC41TSAoVGhpcnR5IE1pbFxoaWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSANCmxpb24gRml2
ZSBIdW5kcmVkIFRob3VzYW5kIFUuUy5Eb2xsYXJzKSB3aXRoIEZpbmFuY2UvYmFuayBQcmVzZW50
bHksIFRoaXMgZnVuZCBlbWFuYXRlZCBhcyBhIHJlc3VsdCBvZiBhbiBvdmVyLWludm9pY2VkIGNv
bnRyYWN0IHdoaWNoIGhlIGV4ZWN1dGVkIHdpdGggdGhlIFNvdXRoIEFmcmljYSBnb2xkIHBhbm5p
bmcgYXNzb2NpYXRpb24uIFRob3VnaCBJIHNzaXN0ZWQgaGltIGluIGdldHRpbmcgdGhpcyBjb250
cmFjdCBidXQgSSBuZXZlciBrbg0KXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxIGVcaGlj
aFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgDQp3IHRoYXQgaXQgd2FzIG92ZXItaW52b2ljZWQg
YnkgaGltLiBJIGFtIGFmcmFpZCB0aGF0IHRoZSBnb3Zlcm5tZW50IG9mIFNvdXRoIEFmcmljYSBt
aWdodCBzdGFydCB0byBpbnZlc3RpZ2F0ZSBvbiBjb250cmFjdHMgYXdhcmRlZCBmcm9tIFNvdXRo
IEFmcmljYSBnb2xkIHBhbm5pbmcgYXNzb2NpYXRpb24uIFRoaXMgbW9uZXkgaXMgc3RpbGwgd2l0
aCB0aGUgYmFuay4gUmVjZW50bHkgbXkgRG9jdG9yIHRvbGQgbWUgdGhhdCBJIHdvdWxkIG5vdCAN
ClxoaWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSBsXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxs
b2NoXGYxIA0KYXN0IGZvciB0aGUgbmV4dCB0aHJlZSBtb250aHMgZHVlIHRvIG15IGNhbmNlciBw
cm9ibGVtLCB0aG91Z2ggd2hhdCBkaXN0dXJicyBtZSBtb3N0IGlzIG15IHN0cm9rZS4gSGF2aW5n
IGtub3duIG15IGNvbmRpdGlvbiBJIGRlY2lkZWQgdG8gZG9uYXRlIHRoaXMgZnVuZCB0byBjaHVy
Y2ggb3IgYmV0dGVyIHN0aWxsIGEgQ2hyaXN0aWFuIGluZGl2aWR1YWwgdGhhdCB3aWxsIHV0aWxp
emUgdGhpcyBtb25leSB0aGUgd2F5IEkgYW0gZ29pbmcgdG8gDQpcaGljaFxhZjFcZGJjaFxhZjMx
NTA1XGxvY2hcZjEgaVxoaWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSBuc3RydWN0IGhlcmUg
aW4uIEkgd2FudCBhIHBlcnNvbiBvciBjaHVyY2ggdGhhdCB3aWxsIHVzZSB0aGlzIGZ1bmQgdG8g
Y2h1cmNoZXMsIG9ycGhhbmFnZXMsIHJlc2VhcmNoIGNlbnRyZXMgYW5kIHdpZG93cw0KXHBhciBc
aGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgcHJvcGFnYXRpbmcgdGhlIHdvcmQgb2YgR29k
IGFuZCB0byBlbnN1cmUgdGhhdCB0aGUgaG91c2Ugb2YgR29kIGlzIG1haW50YWluZWQuDQpccGFy
IA0KXHBhciANClxwYXIgXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxIFRoZSBCaWJsZSBt
YWRlIHVzIHRvIHVuZGVyc3RhbmQgdGhhdCBibGVzc2VkIGlzIHRoZSBoYW5caGljaFxhZjFcZGJj
aFxhZjMxNTA1XGxvY2hcZjEgDQpkIHRoYXQgZ3JpdmV0LiBJIHRvb2sgdGhpcyBkZWNpc2lvbiBi
ZWNhdXNlIEkgaGF2ZSBhIGNoaWxkIHRoYXQgd2lsbCBpbmhlcml0IHRoaXMgbW9uZXkgYnV0IG15
IHNvbiBjYW4gbm90IGNhcnJ5IG91dCB0aGlzIHdvcmsgb25seSBiZWNhdXNlIEkgYW5kIG15IGxh
dGUgaHVzYmFuZCBkZWNpZGUgdG8gdXNlIHNvbWUgb2YgdGhlIG1vbmV5IHRvIHdvcmsgZm9yIEdv
ZCBhbmQgbGl2ZSBzb21lIGZvciBvdXIgc29uIHRvIGhhdmUgYSBiZXR0ZXIgbGkNClxoaWNoXGFm
MVxkYmNoXGFmMzE1MDVcbG9jaFxmMSB2XGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxIGUu
IE91ciBzb24gaXMganVzdCAxN3llYXIgb2xkIG5vdyBhbmQNClxwYXIgXGhpY2hcYWYxXGRiY2hc
YWYzMTUwNVxsb2NoXGYxIGJlZW4gZ3JvdyB1cCBpbiBBZnJpY2EsIGhlIGhhdmUgbG93IG1hdHVy
aXR5IEhlbmNlIHRoZSByZWFzb24gZm9yIHRha2luZyB0aGlzIGJvbGQgZGVjaXNpb24uIEkgYW0g
bm90IGFmcmFpZCBvZiBkZWF0aCBoZW5jZSBJIGtub3cgdGhhdCBJIGFtIGdvaW5nIHRvIGJlIGlu
IHRoZSBib3NvbSBvZiB0aGUgTG9yZC4gRXhvZHVzIDE0IFZTIDE0IHNheXMgdGhhdCB0aGUgbG9y
ZCB3aWxsDQpcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgIGZpZ2h0IG15IGNhc2UgYW5k
IEkgc2hhbGwgaG9sZCBteSBwZWFjZS4NClxwYXIgDQpccGFyIFxoaWNoXGFmMVxkYmNoXGFmMzE1
MDVcbG9jaFxmMSBJIHdpbGwgbGlrZSB5b3UgdG8gdW5kZXJzdGFuZCB0aGF0IG15IGNvbnRhY3Qg
dG8geW91IGlzIGEgZGl2aW5lIGRpcmVjdGlvbiBmcm9tIEdvZDsgQXMgc29vbiBhcyBJIHJlY2Vp
dmUgeW91ciByZXBseSBJIHNoYWxsIGdpdmUgeW91IHRoZSBjb250YWN0IG9mIHRoZSBGaW5hbmNl
L2JhbmsuIEkgd2lsbCBhbHNvIGlzc3VlIHlvdSBhIGxldHRlciBvZiBhdXRob3JpdHkgdGgNClxo
aWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSBhdCB3aWxsIGVtcG93ZXIgeW91IGFzIHRoZSBu
ZXcgYmVuZWZpY2lhcnkgb2YgdGhpcyBmdW5kLg0KXHBhciBcaGljaFxhZjFcZGJjaFxhZjMxNTA1
XGxvY2hcZjEgTXkgaGFwcGluZXNzIGlzIHRoYXQgSSBsaXZlIGEgbGlmZSBvZiBhIHdvcnRoeSBD
aHJpc3RpYW4uIEFueSBkZWxheSBpbiB5b3VyIHJlcGx5IHdpbGwgZ2l2ZSBtZSByb29tIGluIHNv
dXJjaW5nIGZvciBhIGNodXJjaCBvciBDaHJpc3RpYW4gaW5kaXZpZHVhbCBmb3IgdGhpcyBzYW1l
IHB1cnBvc2UuDQpccGFyIA0KXHBhciBcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgUGxl
YXNlIGFzc3VyZSBtZSB0aGF0IHlvdSBcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgDQp3
aWxsIGFjdCBhY2NvcmRpbmdseSBhcyBJIHN0YXRlZCBoZXJlIGFuZCBQbGVhc2UgSSB3aWxsIGxp
a2UgeW91IHRvIGNvbnRhY3QgbWUgaW1tZWRpYXRlbHkgeW91IHJlY2VpdmUgdGhpcyBtYWlsIHNv
IHRoYXQgSSB3aWxsIGluc3RydWN0IHRoZSBGaW5hbmNlL2JhbmsgdG8hIFRyYW5zZmVyIHRoaXMg
ZnVuZCBpbnRvDQpccGFyIFxoaWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSB5b3VyIGFjY291
bnQufXtccnRsY2hcZmNzMSBcYWJcYWYxXGFmczIwIFxsdHJjaFxmY3MwIFxiXGYxXGZzMjBcaW5z
cnNpZDg1MzU1NzggXGhpY2hcYWYxXGRiY2hcYWYzMTUwNVxsb2NoXGYxICBcaGljaFxhZjFcZGJj
aFxhZjMxNTA1XGxvY2hcZjEgTXlcaGljaFxhZjFcZGJjaFxhZjMxNTA1XGxvY2hcZjEgIFxoaWNo
XGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSBQcml2YXRlIE51bWJlcjogfQ0Ke1xydGxjaFxmY3Mx
IFxhZjMxNTA3IFxsdHJjaFxmY3MwIFxiXGluc3JzaWQ4NTM1NTc4XGNoYXJyc2lkODUzNTU3OCBc
aGljaFxhZjMxNTA2XGRiY2hcYWYzMTUwNVxsb2NoXGYzMTUwNiBUZWw6ICsyNzYxNzY1MzM5Mn17
XHJ0bGNoXGZjczEgXGFiXGFmMVxhZnMyMCBcbHRyY2hcZmNzMCBcYlxmMVxmczIwXGluc3JzaWQx
NDY0NjMwMyANClxwYXIgDQpccGFyIFxoaWNoXGFmMVxkYmNoXGFmMzE1MDVcbG9jaFxmMSBSZW1h
aW4gYmxlc3NlZCBpbiB0aGUgbmFtZSBvZiB0aGUgTG9yZC4NClxwYXIgDQpccGFyIFxoaWNoXGFm
MVxkYmNoXGFmMzE1MDVcbG9jaFxmMSBNcnMuIEdyYWNlIE1hbmRhIGFcaGljaFxhZjFcZGJjaFxh
ZjMxNTA1XGxvY2hcZjEgbmQgU29uIEJyaWFuDQpccGFyIFxoaWNoXGFmMVxkYmNoXGFmMzE1MDVc
bG9jaFxmMSBHb2RcaGljaFxmMSBccnF1b3RlIFxsb2NoXGYxIHMgZ3JhY2UgaXMgc3VmZmljaWVu
dCBmb3IgbWUNClxwYXIgfXtcKlx0aGVtZWRhdGEgNTA0YjAzMDQxNDAwMDYwMDA4MDAwMDAwMjEw
MDgyOGFiYzEzZmEwMDAwMDAxYzAyMDAwMDEzMDAwMDAwNWI0MzZmNmU3NDY1NmU3NDVmNTQ3OTcw
NjU3MzVkMmU3ODZkNmNhYzkxY2I2YWMzMzAxMDQ1Zjc4NWZlODNkMGI2ZDgNCjcyYmEyOGE1ZDhj
ZWEyNDk3NzdkMmNkMjBmMThlNGIxMmQ2YThmODQzNDA5YzlkZjc3ZWNiODUwYmEwODJkNzQyMzEw
NjJjZTk5N2I1NWFlOGZlM2EwMGUxODkzZjM1NGU5NTU1ZTY4ODU2NDdkZTNhOGFiZjRmYmVlMjli
YmQ3DQoyYTMxNTAwMzgzMjdhY2Y0MDk5MzVlZDdkNzU3ZTVlZTE0MzAyOTk5YTY1NGU5OWUzOTNj
MTg5MzZjOGYyM2E0ZGMwNzI0Nzk2OTdkMWM4MWU1MWEzYjEzYzA3ZTQwODdlNmI2MjhlZThjZjVj
NDQ4OWNmMWM0ZDA3NWY5MmEwYg0KNDRkN2EwN2E4M2M4MmYzMDhhYzdiMGEwZjBmYmY5MGMyNDgw
OTgwYjU4YWJjNzMzNjE1YWEyZDIxMGMyZTAyY2IwNDQzMDA3NmE3ZWU4MzNkZmI2Y2U2MmUzZWQ3
ZTE0NjkzZTgzMTdkOGNkMDQzM2JmNWM2MGY1M2ZlYTJmZTcNCjA2NWJkODBmYWNiNjQ3ZTllMjVj
N2ZjNDIxZmQyZGRiNTI2YjJlOTM3M2ZlZDRiYjkwMmUxODJlOTdiN2I0NjFlNmJmYWQzZjAxMDAw
MGZmZmYwMzAwNTA0YjAzMDQxNDAwMDYwMDA4MDAwMDAwMjEwMGE1ZDZhN2U3YzAwMDAwDQowMDM2
MDEwMDAwMGIwMDAwMDA1ZjcyNjU2YzczMmYyZTcyNjU2YzczODQ4ZmNmNmFjMzMwMGM4N2VmODVi
ZDgzZDE3ZDUxZDJjMzE4MjU3NjJmYTU5MDQzMmZhMzdkMDBlMTI4N2Y2ODIyMWJkYjFiZWJkYjRm
YzcwNjBhYmIwOA0KODRhNGVmZjdhOTNkZmVhZThiZjllMTk0ZTcyMDE2OWFhYTA2YzNlMjQzM2Zj
YjY4ZTE3NjNkYmY3ZjgyYzk4NWE0YTcyNTA4NWI3ODcwODZhMzdiZGJiNTVmYmM1MGQxYTMzY2Nk
MzExYmE1NDhiNjMwOTUxMjBmODhkOTRmYmMNCjUyYWU0MjY0ZDFjOTEwZDI0YTQ1ZGIzNDYyMjQ3
ZmE3OTE3MTVmZDcxZjk4OWUxOWUwMzY0Y2QzZjUxNjUyZDczNzYwYWU4ZmE4YzlmZmIzYzMzMGNj
OWU0ZmMxN2ZhZjJjZTU0NTA0NmUzNzk0NGM2OWU0NjJhMWE4MmZlMzUzDQpiZDkwYTg2NWFhZDQx
ZWQwYjViOGY5ZDZmZDAxMDAwMGZmZmYwMzAwNTA0YjAzMDQxNDAwMDYwMDA4MDAwMDAwMjEwMDZi
Nzk5NjE2ODMwMDAwMDA4YTAwMDAwMDFjMDAwMDAwNzQ2ODY1NmQ2NTJmNzQ2ODY1NmQ2NTJmNzQ2
OA0KNjU2ZDY1NGQ2MTZlNjE2NzY1NzIyZTc4NmQ2YzBjY2M0ZDBhYzMyMDEwNDBlMTdkYTE3Nzkw
ZDkzNzYzYmIyODQ1NjJiMmNiYWViYmY2MDA0MzljMWE0MWM3YTBkMjlmZGJkN2U1ZTM4MzM3Y2Vk
ZjE0ZDU5YjRiMGQ1OTJjOWMNCjA3MGQ4YTY1Y2QyZTg4YjdmMDdjMmNhNzFiYThkYTQ4MWNjNTJj
NmNlMWM3MTVlNmU5NzgxOGM5YjQ4ZDEzZGY0OWM4NzM1MTdkMjNkNTkwODVhZGI1ZGQyMGQ2YjUy
YmQ1MjFlZjJjZGQ1ZWI5MjQ2YTNkOGI0NzU3ZThkM2Y3DQoyOWUyNDVlYjJiMjYwYTAyMzhmZDAx
MDAwMGZmZmYwMzAwNTA0YjAzMDQxNDAwMDYwMDA4MDAwMDAwMjEwMDk2YjVhZGUyOTYwNjAwMDA1
MDFiMDAwMDE2MDAwMDAwNzQ2ODY1NmQ2NTJmNzQ2ODY1NmQ2NTJmNzQ2ODY1NmQ2NQ0KMzEyZTc4
NmQ2Y2VjNTk0ZjZmZGIzNjE0YmYwZmQ4NzcyMDc0NmY2MzI3NzYxYTA3NzU4YWQ4YjE5YjJkNGQx
YmM0NmU4NzFlNjk4OTk2ZDg1MGEyNDBkMjQ5N2QxYmRhZTM4MDAxYzNiYTYxODcxNWQ4NmQ4NzYx
NWI4MTE2ZDgNCmE1ZmIzNGQ5M2E2YzFkZDBhZmIwNDc1MjkyYzU1ODVlOTIzNmQ4OGFhZDNlMjQx
MmY5ZTNmYmZmMWUxZmE5YWJkN2VlYzcwYzFkMTIyMTI5NGZkYTVlZmQ3MmNkNDMyNGYxNzk0MDkz
YjBlZGRkMWVmNjJmYWQ3OTQ4MmE5YzA0DQo5OGYxODRiNGJkMjk5MWRlYjU4ZGY3ZGZiYjhhZDc1
NTQ0NjI4MjYwN2QyMmQ3NzFkYjhiOTQ0YWQ3OTc5NmE0MGZjMzU4NWVlNjI5NDk2MDZlY2M0NThj
MTViYzhhNzAyOTEwZjgwOGU4YzY2YzY5Yjk1NjViNWQ4YTMxNGQzYw0KOTRlMDE4YzhkZTFhOGZh
OTRmZDA1MDkzZjQzNjcyZTIzZDA2YWY4OTkyN2FjMDY3NjJhMDQ5MTM2Nzg1YzEwNjA3NzU4ZDkw
NTNkOTY1MDIxZDYyZDZmNjgwNGZjMDhmODZlNGJlZjIxMGMzNTJjMTQ0ZGJhYjk5OWZiN2I0NzEN
Cjc1MDlhZjY3OGI5ODVhYjBiNmI0YWU2ZjdlZDliYTZjNDE3MGIwNmM3ODhhNzA1NDMwYWRmNzFi
YWQyYjViMDU3ZDAzNjA2YTFlZDdlYmY1YmFiZDdhNDFjZjAwYjBlZjgzYTY1Njk2MzJjZDQ2N2Zh
ZGRlYzk2OTk2NDBmNjcxDQo5ZTc2YjdkNmFjMzU1YzdjODlmZWNhOWNjY2FkNGVhN2QzNmM2NWIy
NThhMjA2NjQxZjFiNzNmOGI1ZGE2YTYzNzNkOWMxMWI5MGM1MzdlN2YwOGRjZTY2YjdiYmVhZTAw
ZGM4ZTI1N2U3ZjBmZDJiYWRkNTg2OGIzN2EwODhkMQ0KZTQ2MDBlYWQxZGRhZWY2N2Q0MGJjODk4
YjNlZDRhZjgxYWMwZDc2YTE5N2M4NjgyNjgyOGEyNGJiMzE4ZjM0NDJkOGFiNTE4ZGZlM2EyMGYw
MDBkNjQ1OGQxMDRhOTY5NGFjNmQ4ODcyOGVlZTI3ODI0MjhkNjBjZjAzYWMxYTUNCjE5M2JlNGNi
YjkyMWNkMGI0OTVmZDA1NGI1YmQwZjUzMGMxOTMxYTNmN2VhZjlmN2FmOWUzZjQ1YzcwZjllMWQz
ZmY4ZTlmOGUxYzNlMzA3M2Y1YTQyY2VhYTZkOWM4NGU1NTUyZmJmZmRlY2NmYzcxZmEzM2Y5ZTdl
ZjNmMmQxDQoxN2Q1Nzg1OWM2ZmZmYWMzMjdiZmZjZmM3OTM1MTBkMjY3MjZjZThiMmY5ZmZjZjZl
Y2M5OGJhZjNlZmRmZGJiNDcxNWYwNGQ4MTQ3NjVmODkwYzY0NGEyOWJlNDA4ZWRmMzE4MTQzMzU2
NzEyNTI3MjM3MWJlMTVjMzA4ZDNmMg0KOGFjZDI0OTQzOGMxOWE0YjA1ZmQ5ZThhMWNmNGNkMjk2
Njk5NzcxYzM5M2FjNGI1ZTAxZDAxZTVhMzBhNzg3ZDcyY2YxMTc4MTA4OTg5YTIxNTljNzdhMmQ4
MDFlZTcyY2UzYTVjNTQ1YTYxNDdmMzJhOTk3OTM4NDljMjZhZTYNCjYyNTJjNmVkNjM3YzU4YzVi
YjhiMTNjN2JmYmQ0OTBhNzUzMzBmNGI0N2YxNmU0NDFjMzFmNzE4NGUxNDBlNDk0MjE0ZDI3M2Zj
ODA5MDBhZWRlZTUyZWFkODc1OTdmYTgyNGIzZTU2ZTgyZTQ1MWQ0YzJiNGQzMmE0MjMyNzlhDQo2
NjhiYjY2OTBjN2U5OTU2ZTkwY2ZlNzY2Y2IzN2IwNzc1MzhhYmQyN2E4YjFjYmE0OGM4MGFjYzJh
ODQxZjEyZTY5OGYxM2E5ZTI4MWM1NzkxMWNlMjk4OTUwZDdlMDNhYmE4NGFjOGMxNTRmODY1NWM0
ZjJhZjA3NDQ4MTg0Nw0KYmQ4MDQ4NTliNWU2OTYwMDdkNGI0ZWRmYzE1MGIxMmFkZGJlY2JhNmIx
OGIxNDhhMWU1NGQxYmM4MTM5MmYyM2I3Zjg0MTM3YzI3MTVhODUxZGQwMjQyYTYzM2Y5MDA3MTBh
MjE4ZWQ3MTU1MDVkZmU1NmU4NmU4NzdmMDAzNGUNCjE2YmFmYjBlMjU4ZWJiNGZhZjA2Yjc2OWU4
ODgzNDBiMTAzZDMzMTFkYTk3NTBhYTlkMGExY2QzZTRlZmNhMzFhMzUwOGY2ZDBjNWM1YzM5ODYw
MmY4ZTJlYmM3MTU5MWY1YjYxNmUyNGRkODkzYWEzMjYxZmI0NGY5NWQ4NDNiDQo1OTc0YmI1YzA0
ZjRlZGFmYjk1Yjc4OTJlYzExMDhmM2Y5OGRlNzVkYzk3ZDU3NzJiZGZmN2NjOTVkOTRjZjY3MmRi
NGIzZGEwYTY1NTdmNzBkYjYyOTM2MmQ3MmJjYjA0MzFlNTNjNjA2NmFjYWM4MGQ2OTlhNjQwOWZi
NDRkMA0KODc0MWJkY2U5YzBlNDk3MTYyNGEyMzc4Y2NlYWJhODMwYjA1MzY2YjkwZTBlYTIzYWFh
MjQxODQ1MzY4YjBlYjllMjYxMmNhOGM3NDI4NTFjYTI1MWNlY2NjNzAyNTZkOGQ4NzI2NWRkOTYz
NjE1MzFmMTg2YzNkOTA1OGVkZjINCmMwMGVhZmU4ZTFmYzVjNTA5MDMxYmI0ZDY4MGU5ZjM5YTMx
NTRkZTBhY2NjNTZhZTY0NDQ0MWVkZDc2MTU2ZDc0MjlkOTk1YmRkODg2NjRhOWRjM2FkNTAxOTdj
MzhhZjFhMGMxNmQ2ODQwNjA0NDFkYjAyNTY1ZTg1ZjNiOTY2DQowZDA3MTNjYzQ4YTBlZDZlZjdk
ZWRjMmRjNjBiMTdlOTIyMTllMTgwNjQzZWQyN2FjZmZiYTg2ZTljOTRjNzhhYjkwOTgwZDhhOWYw
OTEzZWU0OWQ2MmI1MTJiNzk2MjZmYjA2ZGNjZWUyYTQzMmJiYzYwMjc2YjlmN2RlYzQ0Yg0KNzkw
NGNmYmNhNGYzZjY0NDNhYjJhNDljOWMyYzQxNDc2ZGFmZDU1YzZlN2FjOGM3NjlkYjFiYzM5OTE2
MWVlMzE0YmMyZTc1Y2Y4NzU5MDgxNzQzYmUxMjM2ZWM0ZjRkNjY5M2U1MzM2ZmI2NzJjNWRjMjRh
OGMzMzU4NWI1ZmINCjljYzI0ZTFkNDg4NTU0NWI1ODQ2MzYzNGNjNTQxNjAyMmNkMTljYWNmY2Ni
NGQzMGViNDUyOTYwMjNmZDM1YTQ1ODU5ODM2MGY4ZDdhNDAwM2JiYWFlMjVlMzMxZjE1NWQ5ZDlh
NTExNmQzYmZiOWE5NTUyM2U1MTQ0MGNhMmUwDQowODhkZDg0NGVjNjM3MGJmMGU1NWQwMjdhMDEy
YWUyNjRjNDVkMDJmNzA4ZmE2YWQ2ZGE2ZGNlMjljMjU1ZGY5ZjZjYWUwZWMzODY2Njk4NGIzNzJh
YjUzMzRjZjY0MGIzNzc5NWNjODYwZGU0YWUyODE2ZTk1YjIxYmU1Y2VhZg0KOGE0OWY5MGI1MmE1
MWNjNmZmMzM1NWY0N2UwMjM3MDUyYjgxZjY4MDBmZDdiODAyMjM5ZGFmNmQ4ZjBiMTU3MWE4NDI2
OTQ0ZmRiZTgwYzZjMWQ0MGU4ODE2Yjg4Yjg1NjkwODJhYjg0YzM2ZmYwNTM5ZDRmZjZkY2U1OTFh
MjYNCmFkZTFjMGE3ZjY2OTg4MDQ4NWZkNDg0NTgyOTAzZDI4NGIyNmZhNGUyMTU2Y2ZmNjJlNGI5
MjY1ODQ0YzQ0OTVjNDk1YTkxNTdiNDQwZTA5MWJlYTFhYjhhYWY3NzYwZjQ1MTBlYWE2OWE2NDY1
YzBlMDRlYzY5ZmZiOWU2NWQwDQoyOGQ0NGQ0ZTM5ZGY5YzFhNTJlY2JkMzYwN2ZlZTljZWM3MjYz
MzI4ZTVkNjYxZDNkMGU0ZjYyZjQ0YWNkODU1ZWQ3YWIzM2NkZjdiY2I4YWU4ODk1OTliZDVjOGIz
MDI5ODk1YjY4MjU2OTZmNmFmMjljMjM5Yjc1YTViYjFlNg0KMzQ1ZTZlZTZjMjgxMTdlNzM1ODZj
MWEyMjE0YWUxYmUwN2U5M2ZiMGZmNTFlMTMzZmI2NTQyNmZhODQzYmUwZmI1MTVjMTg3MDY0ZDBj
YzIwNmEyZmE5MjZkM2M5MDJlOTA3NjcwMDQ4ZDkzMWRiNGMxYTQ0OTU5ZDM2NmFkOTMNCmI2NWFi
ZTU5NWY3MGE3NWJmMDNkNjE2YzJkZDk1OWZjN2Q0ZTYzMTdjZDk5Y2JjZWM5YzU4YjM0NzY2NjYx
YzdkNjc2NmNhMWE5YzFiMzI3NTMxNDg2YzZmOTQxYzYzOGM2N2NkMjJhN2Y3NWUyYTM3YmUwZTgy
ZGI4ZGY5ZjMwDQoyNTRkMzBjMTM3MjU4MWExZjUxYzk4M2M4MGU0YjcxY2NkZDI4ZGJmMDAwMDAw
ZmZmZjAzMDA1MDRiMDMwNDE0MDAwNjAwMDgwMDAwMDAyMTAwMGRkMTkwOWZiNjAwMDAwMDFiMDEw
MDAwMjcwMDAwMDA3NDY4NjU2ZDY1MmY3NA0KNjg2NTZkNjUyZjVmNzI2NTZjNzMyZjc0Njg2NTZk
NjU0ZDYxNmU2MTY3NjU3MjJlNzg2ZDZjMmU3MjY1NmM3Mzg0OGY0ZDBhYzIzMDE0ODRmNzgyNzcw
ODZmNmZkM2JhMTA5MTI2ZGQ4OGQwYWRkNDAzODRlNDM1MGQzNjNmMjQNCjUxZWNlZDBkYWUyYzA4
MmU4NzYxYmU5OTY5YmI5NzlkYzkxMzYzMzJkZTMxNjhhYTFhMDgzYWU5OTU3MTlhYzE2ZGI4ZWM4
ZTQwNTIxNjRlODlkOTNiNjRiMDYwODI4ZTZmMzdlZDE1Njc5MTRiMjg0ZDI2MjQ1MjI4MmUzMTk4
DQo3MjBlMjc0YTkzOWNkMDhhNTRmOTgwYWUzOGEzOGY1NmU0MjJhM2E2NDFjOGJiZDA0OGY3NzU3
ZGEwZjE5YjAxN2NjNTI0YmQ2MjEwN2JkNTAwMTk5NjUwOWFmZmIzZmQzODFhODk2NzJmMWYxNjVk
ZmU1MTQxNzNkOTg1MDUyOA0KYTJjNmNjZTAyMzliYWE0YzA0Y2E1YmJhYmFjNGRmMDAwMDAwZmZm
ZjAzMDA1MDRiMDEwMjJkMDAxNDAwMDYwMDA4MDAwMDAwMjEwMDgyOGFiYzEzZmEwMDAwMDAxYzAy
MDAwMDEzMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwNWI0MzZmNmU3NDY1NmU3
NDVmNTQ3OTcwNjU3MzVkMmU3ODZkNmM1MDRiMDEwMjJkMDAxNDAwMDYwMDA4MDAwMDAwMjEwMGE1
ZDZhN2U3YzAwMDAwMDAzNjAxMDAwMDBiMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDJiMDEw
MDAwNWY3MjY1NmM3MzJmMmU3MjY1NmM3MzUwNGIwMTAyMmQwMDE0MDAwNjAwMDgwMDAwMDAyMTAw
NmI3OTk2MTY4MzAwMDAwMDhhMDAwMDAwMWMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDE0MDIw
MDAwNzQ2OA0KNjU2ZDY1MmY3NDY4NjU2ZDY1MmY3NDY4NjU2ZDY1NGQ2MTZlNjE2NzY1NzIyZTc4
NmQ2YzUwNGIwMTAyMmQwMDE0MDAwNjAwMDgwMDAwMDAyMTAwOTZiNWFkZTI5NjA2MDAwMDUwMWIw
MDAwMTYwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwZDEwMjAwMDA3NDY4NjU2ZDY1MmY3NDY4
NjU2ZDY1MmY3NDY4NjU2ZDY1MzEyZTc4NmQ2YzUwNGIwMTAyMmQwMDE0MDAwNjAwMDgwMDAwMDAy
MTAwMGRkMTkwOWZiNjAwMDAwMDFiMDEwMDAwMjcwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAw
OWIwOTAwMDA3NDY4NjU2ZDY1MmY3NDY4NjU2ZDY1MmY1ZjcyNjU2YzczMmY3NDY4NjU2ZDY1NGQ2
MTZlNjE2NzY1NzIyZTc4NmQ2YzJlNzI2NTZjNzM1MDRiMDUwNjAwMDAwMDAwMDUwMDA1MDA1ZDAx
MDAwMDk2MGEwMDAwMDAwMH0NCntcKlxjb2xvcnNjaGVtZW1hcHBpbmcgM2MzZjc4NmQ2YzIwNzY2
NTcyNzM2OTZmNmUzZDIyMzEyZTMwMjIyMDY1NmU2MzZmNjQ2OTZlNjczZDIyNTU1NDQ2MmQzODIy
MjA3Mzc0NjE2ZTY0NjE2YzZmNmU2NTNkMjI3OTY1NzMyMjNmM2UwZDBhM2M2MTNhNjM2YzcyNGQN
CjYxNzAyMDc4NmQ2YzZlNzMzYTYxM2QyMjY4NzQ3NDcwM2EyZjJmNzM2MzY4NjU2ZDYxNzMyZTZm
NzA2NTZlNzg2ZDZjNjY2ZjcyNmQ2MTc0NzMyZTZmNzI2NzJmNjQ3MjYxNzc2OTZlNjc2ZDZjMmYz
MjMwMzAzNjJmNmQ2MTY5DQo2ZTIyMjA2MjY3MzEzZDIyNmM3NDMxMjIyMDc0NzgzMTNkMjI2NDZi
MzEyMjIwNjI2NzMyM2QyMjZjNzQzMjIyMjA3NDc4MzIzZDIyNjQ2YjMyMjIyMDYxNjM2MzY1NmU3
NDMxM2QyMjYxNjM2MzY1NmU3NDMxMjIyMDYxNjM2Mw0KNjU2ZTc0MzIzZDIyNjE2MzYzNjU2ZTc0
MzIyMjIwNjE2MzYzNjU2ZTc0MzMzZDIyNjE2MzYzNjU2ZTc0MzMyMjIwNjE2MzYzNjU2ZTc0MzQz
ZDIyNjE2MzYzNjU2ZTc0MzQyMjIwNjE2MzYzNjU2ZTc0MzUzZDIyNjE2MzYzNjU2ZTc0MzUyMjIw
NjE2MzYzNjU2ZTc0MzYzZDIyNjE2MzYzNjU2ZTc0MzYyMjIwNjg2YzY5NmU2YjNkMjI2ODZjNjk2
ZTZiMjIyMDY2NmY2YzQ4NmM2OTZlNmIzZDIyNjY2ZjZjNDg2YzY5NmU2YjIyMmYzZX0NCntcKlxs
YXRlbnRzdHlsZXNcbHNkc3RpbWF4MjY3XGxzZGxvY2tlZGRlZjBcbHNkc2VtaWhpZGRlbmRlZjFc
bHNkdW5oaWRldXNlZGRlZjFcbHNkcWZvcm1hdGRlZjBcbHNkcHJpb3JpdHlkZWY5OXtcbHNkbG9j
a2VkZXhjZXB0IFxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHFmb3JtYXQxIFxs
c2Rwcmlvcml0eTAgXGxzZGxvY2tlZDAgTm9ybWFsOw0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhp
ZGV1c2VkMCBcbHNkcWZvcm1hdDEgXGxzZHByaW9yaXR5OSBcbHNkbG9ja2VkMCBoZWFkaW5nIDE7
XGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTkgXGxzZGxvY2tlZDAgaGVhZGluZyAyO1xsc2RxZm9y
bWF0MSBcbHNkcHJpb3JpdHk5IFxsc2Rsb2NrZWQwIGhlYWRpbmcgMztcbHNkcWZvcm1hdDEgXGxz
ZHByaW9yaXR5OSBcbHNkbG9ja2VkMCBoZWFkaW5nIDQ7DQpcbHNkcWZvcm1hdDEgXGxzZHByaW9y
aXR5OSBcbHNkbG9ja2VkMCBoZWFkaW5nIDU7XGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTkgXGxz
ZGxvY2tlZDAgaGVhZGluZyA2O1xsc2RxZm9ybWF0MSBcbHNkcHJpb3JpdHk5IFxsc2Rsb2NrZWQw
IGhlYWRpbmcgNztcbHNkcWZvcm1hdDEgXGxzZHByaW9yaXR5OSBcbHNkbG9ja2VkMCBoZWFkaW5n
IDg7XGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTkgXGxzZGxvY2tlZDAgaGVhZGluZyA5Ow0KXGxz
ZHByaW9yaXR5MzkgXGxzZGxvY2tlZDAgdG9jIDE7XGxzZHByaW9yaXR5MzkgXGxzZGxvY2tlZDAg
dG9jIDI7XGxzZHByaW9yaXR5MzkgXGxzZGxvY2tlZDAgdG9jIDM7XGxzZHByaW9yaXR5MzkgXGxz
ZGxvY2tlZDAgdG9jIDQ7XGxzZHByaW9yaXR5MzkgXGxzZGxvY2tlZDAgdG9jIDU7XGxzZHByaW9y
aXR5MzkgXGxzZGxvY2tlZDAgdG9jIDY7XGxzZHByaW9yaXR5MzkgXGxzZGxvY2tlZDAgdG9jIDc7
DQpcbHNkcHJpb3JpdHkzOSBcbHNkbG9ja2VkMCB0b2MgODtcbHNkcHJpb3JpdHkzOSBcbHNkbG9j
a2VkMCB0b2MgOTtcbHNkcWZvcm1hdDEgXGxzZHByaW9yaXR5MzUgXGxzZGxvY2tlZDAgY2FwdGlv
bjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2RxZm9ybWF0MSBcbHNkcHJpb3Jp
dHkxMCBcbHNkbG9ja2VkMCBUaXRsZTtcbHNkcHJpb3JpdHkxIFxsc2Rsb2NrZWQwIERlZmF1bHQg
UGFyYWdyYXBoIEZvbnQ7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2RxZm9y
bWF0MSBcbHNkcHJpb3JpdHkxMSBcbHNkbG9ja2VkMCBTdWJ0aXRsZTtcbHNkc2VtaWhpZGRlbjAg
XGxzZHVuaGlkZXVzZWQwIFxsc2RxZm9ybWF0MSBcbHNkcHJpb3JpdHkyMiBcbHNkbG9ja2VkMCBT
dHJvbmc7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcWZvcm1hdDEgXGxzZHBy
aW9yaXR5MjAgXGxzZGxvY2tlZDAgRW1waGFzaXM7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlk
ZXVzZWQwIFxsc2Rwcmlvcml0eTU5IFxsc2Rsb2NrZWQwIFRhYmxlIEdyaWQ7XGxzZHVuaGlkZXVz
ZWQwIFxsc2Rsb2NrZWQwIFBsYWNlaG9sZGVyIFRleHQ7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhp
ZGV1c2VkMCBcbHNkcWZvcm1hdDEgXGxzZHByaW9yaXR5MSBcbHNkbG9ja2VkMCBObyBTcGFjaW5n
Ow0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2MCBcbHNkbG9j
a2VkMCBMaWdodCBTaGFkaW5nO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHBy
aW9yaXR5NjEgXGxzZGxvY2tlZDAgTGlnaHQgTGlzdDtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlk
ZXVzZWQwIFxsc2Rwcmlvcml0eTYyIFxsc2Rsb2NrZWQwIExpZ2h0IEdyaWQ7DQpcbHNkc2VtaWhp
ZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTYzIFxsc2Rsb2NrZWQwIE1lZGl1bSBT
aGFkaW5nIDE7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2NCBc
bHNkbG9ja2VkMCBNZWRpdW0gU2hhZGluZyAyO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNl
ZDAgXGxzZHByaW9yaXR5NjUgXGxzZGxvY2tlZDAgTWVkaXVtIExpc3QgMTsNClxsc2RzZW1paGlk
ZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjYgXGxzZGxvY2tlZDAgTWVkaXVtIExp
c3QgMjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY3IFxsc2Rs
b2NrZWQwIE1lZGl1bSBHcmlkIDE7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNk
cHJpb3JpdHk2OCBcbHNkbG9ja2VkMCBNZWRpdW0gR3JpZCAyOw0KXGxzZHNlbWloaWRkZW4wIFxs
c2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2OSBcbHNkbG9ja2VkMCBNZWRpdW0gR3JpZCAzO1xs
c2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NzAgXGxzZGxvY2tlZDAg
RGFyayBMaXN0O1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NzEg
XGxzZGxvY2tlZDAgQ29sb3JmdWwgU2hhZGluZzsNClxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRl
dXNlZDAgXGxzZHByaW9yaXR5NzIgXGxzZGxvY2tlZDAgQ29sb3JmdWwgTGlzdDtcbHNkc2VtaWhp
ZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTczIFxsc2Rsb2NrZWQwIENvbG9yZnVs
IEdyaWQ7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2MCBcbHNk
bG9ja2VkMCBMaWdodCBTaGFkaW5nIEFjY2VudCAxOw0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhp
ZGV1c2VkMCBcbHNkcHJpb3JpdHk2MSBcbHNkbG9ja2VkMCBMaWdodCBMaXN0IEFjY2VudCAxO1xs
c2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjIgXGxzZGxvY2tlZDAg
TGlnaHQgR3JpZCBBY2NlbnQgMTtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rw
cmlvcml0eTYzIFxsc2Rsb2NrZWQwIE1lZGl1bSBTaGFkaW5nIDEgQWNjZW50IDE7DQpcbHNkc2Vt
aWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY0IFxsc2Rsb2NrZWQwIE1lZGl1
bSBTaGFkaW5nIDIgQWNjZW50IDE7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNk
cHJpb3JpdHk2NSBcbHNkbG9ja2VkMCBNZWRpdW0gTGlzdCAxIEFjY2VudCAxO1xsc2R1bmhpZGV1
c2VkMCBcbHNkbG9ja2VkMCBSZXZpc2lvbjsNClxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNl
ZDAgXGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTM0IFxsc2Rsb2NrZWQwIExpc3QgUGFyYWdyYXBo
O1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0
eTI5IFxsc2Rsb2NrZWQwIFF1b3RlO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxz
ZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTMwIFxsc2Rsb2NrZWQwIEludGVuc2UgUXVvdGU7DQpcbHNk
c2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY2IFxsc2Rsb2NrZWQwIE1l
ZGl1bSBMaXN0IDIgQWNjZW50IDE7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNk
cHJpb3JpdHk2NyBcbHNkbG9ja2VkMCBNZWRpdW0gR3JpZCAxIEFjY2VudCAxO1xsc2RzZW1paGlk
ZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjggXGxzZGxvY2tlZDAgTWVkaXVtIEdy
aWQgMiBBY2NlbnQgMTsNClxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9y
aXR5NjkgXGxzZGxvY2tlZDAgTWVkaXVtIEdyaWQgMyBBY2NlbnQgMTtcbHNkc2VtaWhpZGRlbjAg
XGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcwIFxsc2Rsb2NrZWQwIERhcmsgTGlzdCBBY2Nl
bnQgMTtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcxIFxsc2Rs
b2NrZWQwIENvbG9yZnVsIFNoYWRpbmcgQWNjZW50IDE7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVu
aGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcyIFxsc2Rsb2NrZWQwIENvbG9yZnVsIExpc3QgQWNjZW50
IDE7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk3MyBcbHNkbG9j
a2VkMCBDb2xvcmZ1bCBHcmlkIEFjY2VudCAxO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNl
ZDAgXGxzZHByaW9yaXR5NjAgXGxzZGxvY2tlZDAgTGlnaHQgU2hhZGluZyBBY2NlbnQgMjsNClxs
c2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjEgXGxzZGxvY2tlZDAg
TGlnaHQgTGlzdCBBY2NlbnQgMjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rw
cmlvcml0eTYyIFxsc2Rsb2NrZWQwIExpZ2h0IEdyaWQgQWNjZW50IDI7XGxzZHNlbWloaWRkZW4w
IFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2MyBcbHNkbG9ja2VkMCBNZWRpdW0gU2hhZGlu
ZyAxIEFjY2VudCAyOw0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3Jp
dHk2NCBcbHNkbG9ja2VkMCBNZWRpdW0gU2hhZGluZyAyIEFjY2VudCAyO1xsc2RzZW1paGlkZGVu
MCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjUgXGxzZGxvY2tlZDAgTWVkaXVtIExpc3Qg
MSBBY2NlbnQgMjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY2
IFxsc2Rsb2NrZWQwIE1lZGl1bSBMaXN0IDIgQWNjZW50IDI7DQpcbHNkc2VtaWhpZGRlbjAgXGxz
ZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY3IFxsc2Rsb2NrZWQwIE1lZGl1bSBHcmlkIDEgQWNj
ZW50IDI7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2OCBcbHNk
bG9ja2VkMCBNZWRpdW0gR3JpZCAyIEFjY2VudCAyO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRl
dXNlZDAgXGxzZHByaW9yaXR5NjkgXGxzZGxvY2tlZDAgTWVkaXVtIEdyaWQgMyBBY2NlbnQgMjsN
Clxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NzAgXGxzZGxvY2tl
ZDAgRGFyayBMaXN0IEFjY2VudCAyO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxz
ZHByaW9yaXR5NzEgXGxzZGxvY2tlZDAgQ29sb3JmdWwgU2hhZGluZyBBY2NlbnQgMjtcbHNkc2Vt
aWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcyIFxsc2Rsb2NrZWQwIENvbG9y
ZnVsIExpc3QgQWNjZW50IDI7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rw
cmlvcml0eTczIFxsc2Rsb2NrZWQwIENvbG9yZnVsIEdyaWQgQWNjZW50IDI7XGxzZHNlbWloaWRk
ZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2MCBcbHNkbG9ja2VkMCBMaWdodCBTaGFk
aW5nIEFjY2VudCAzO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5
NjEgXGxzZGxvY2tlZDAgTGlnaHQgTGlzdCBBY2NlbnQgMzsNClxsc2RzZW1paGlkZGVuMCBcbHNk
dW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjIgXGxzZGxvY2tlZDAgTGlnaHQgR3JpZCBBY2NlbnQg
MztcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTYzIFxsc2Rsb2Nr
ZWQwIE1lZGl1bSBTaGFkaW5nIDEgQWNjZW50IDM7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1
c2VkMCBcbHNkcHJpb3JpdHk2NCBcbHNkbG9ja2VkMCBNZWRpdW0gU2hhZGluZyAyIEFjY2VudCAz
Ow0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2NSBcbHNkbG9j
a2VkMCBNZWRpdW0gTGlzdCAxIEFjY2VudCAzO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNl
ZDAgXGxzZHByaW9yaXR5NjYgXGxzZGxvY2tlZDAgTWVkaXVtIExpc3QgMiBBY2NlbnQgMztcbHNk
c2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY3IFxsc2Rsb2NrZWQwIE1l
ZGl1bSBHcmlkIDEgQWNjZW50IDM7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxs
c2Rwcmlvcml0eTY4IFxsc2Rsb2NrZWQwIE1lZGl1bSBHcmlkIDIgQWNjZW50IDM7XGxzZHNlbWlo
aWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2OSBcbHNkbG9ja2VkMCBNZWRpdW0g
R3JpZCAzIEFjY2VudCAzO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9y
aXR5NzAgXGxzZGxvY2tlZDAgRGFyayBMaXN0IEFjY2VudCAzOw0KXGxzZHNlbWloaWRkZW4wIFxs
c2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk3MSBcbHNkbG9ja2VkMCBDb2xvcmZ1bCBTaGFkaW5n
IEFjY2VudCAzO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NzIg
XGxzZGxvY2tlZDAgQ29sb3JmdWwgTGlzdCBBY2NlbnQgMztcbHNkc2VtaWhpZGRlbjAgXGxzZHVu
aGlkZXVzZWQwIFxsc2Rwcmlvcml0eTczIFxsc2Rsb2NrZWQwIENvbG9yZnVsIEdyaWQgQWNjZW50
IDM7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTYwIFxsc2Rs
b2NrZWQwIExpZ2h0IFNoYWRpbmcgQWNjZW50IDQ7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1
c2VkMCBcbHNkcHJpb3JpdHk2MSBcbHNkbG9ja2VkMCBMaWdodCBMaXN0IEFjY2VudCA0O1xsc2Rz
ZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjIgXGxzZGxvY2tlZDAgTGln
aHQgR3JpZCBBY2NlbnQgNDsNClxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHBy
aW9yaXR5NjMgXGxzZGxvY2tlZDAgTWVkaXVtIFNoYWRpbmcgMSBBY2NlbnQgNDtcbHNkc2VtaWhp
ZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY0IFxsc2Rsb2NrZWQwIE1lZGl1bSBT
aGFkaW5nIDIgQWNjZW50IDQ7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJp
b3JpdHk2NSBcbHNkbG9ja2VkMCBNZWRpdW0gTGlzdCAxIEFjY2VudCA0Ow0KXGxzZHNlbWloaWRk
ZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2NiBcbHNkbG9ja2VkMCBNZWRpdW0gTGlz
dCAyIEFjY2VudCA0O1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5
NjcgXGxzZGxvY2tlZDAgTWVkaXVtIEdyaWQgMSBBY2NlbnQgNDtcbHNkc2VtaWhpZGRlbjAgXGxz
ZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY4IFxsc2Rsb2NrZWQwIE1lZGl1bSBHcmlkIDIgQWNj
ZW50IDQ7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY5IFxs
c2Rsb2NrZWQwIE1lZGl1bSBHcmlkIDMgQWNjZW50IDQ7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhp
ZGV1c2VkMCBcbHNkcHJpb3JpdHk3MCBcbHNkbG9ja2VkMCBEYXJrIExpc3QgQWNjZW50IDQ7XGxz
ZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk3MSBcbHNkbG9ja2VkMCBD
b2xvcmZ1bCBTaGFkaW5nIEFjY2VudCA0Ow0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2Vk
MCBcbHNkcHJpb3JpdHk3MiBcbHNkbG9ja2VkMCBDb2xvcmZ1bCBMaXN0IEFjY2VudCA0O1xsc2Rz
ZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NzMgXGxzZGxvY2tlZDAgQ29s
b3JmdWwgR3JpZCBBY2NlbnQgNDtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rw
cmlvcml0eTYwIFxsc2Rsb2NrZWQwIExpZ2h0IFNoYWRpbmcgQWNjZW50IDU7DQpcbHNkc2VtaWhp
ZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTYxIFxsc2Rsb2NrZWQwIExpZ2h0IExp
c3QgQWNjZW50IDU7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2
MiBcbHNkbG9ja2VkMCBMaWdodCBHcmlkIEFjY2VudCA1O1xsc2RzZW1paGlkZGVuMCBcbHNkdW5o
aWRldXNlZDAgXGxzZHByaW9yaXR5NjMgXGxzZGxvY2tlZDAgTWVkaXVtIFNoYWRpbmcgMSBBY2Nl
bnQgNTsNClxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjQgXGxz
ZGxvY2tlZDAgTWVkaXVtIFNoYWRpbmcgMiBBY2NlbnQgNTtcbHNkc2VtaWhpZGRlbjAgXGxzZHVu
aGlkZXVzZWQwIFxsc2Rwcmlvcml0eTY1IFxsc2Rsb2NrZWQwIE1lZGl1bSBMaXN0IDEgQWNjZW50
IDU7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2NiBcbHNkbG9j
a2VkMCBNZWRpdW0gTGlzdCAyIEFjY2VudCA1Ow0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1
c2VkMCBcbHNkcHJpb3JpdHk2NyBcbHNkbG9ja2VkMCBNZWRpdW0gR3JpZCAxIEFjY2VudCA1O1xs
c2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjggXGxzZGxvY2tlZDAg
TWVkaXVtIEdyaWQgMiBBY2NlbnQgNTtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxs
c2Rwcmlvcml0eTY5IFxsc2Rsb2NrZWQwIE1lZGl1bSBHcmlkIDMgQWNjZW50IDU7DQpcbHNkc2Vt
aWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcwIFxsc2Rsb2NrZWQwIERhcmsg
TGlzdCBBY2NlbnQgNTtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0
eTcxIFxsc2Rsb2NrZWQwIENvbG9yZnVsIFNoYWRpbmcgQWNjZW50IDU7XGxzZHNlbWloaWRkZW4w
IFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk3MiBcbHNkbG9ja2VkMCBDb2xvcmZ1bCBMaXN0
IEFjY2VudCA1Ow0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk3
MyBcbHNkbG9ja2VkMCBDb2xvcmZ1bCBHcmlkIEFjY2VudCA1O1xsc2RzZW1paGlkZGVuMCBcbHNk
dW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjAgXGxzZGxvY2tlZDAgTGlnaHQgU2hhZGluZyBBY2Nl
bnQgNjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTYxIFxsc2Rs
b2NrZWQwIExpZ2h0IExpc3QgQWNjZW50IDY7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVz
ZWQwIFxsc2Rwcmlvcml0eTYyIFxsc2Rsb2NrZWQwIExpZ2h0IEdyaWQgQWNjZW50IDY7XGxzZHNl
bWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2MyBcbHNkbG9ja2VkMCBNZWRp
dW0gU2hhZGluZyAxIEFjY2VudCA2O1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxz
ZHByaW9yaXR5NjQgXGxzZGxvY2tlZDAgTWVkaXVtIFNoYWRpbmcgMiBBY2NlbnQgNjsNClxsc2Rz
ZW1paGlkZGVuMCBcbHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjUgXGxzZGxvY2tlZDAgTWVk
aXVtIExpc3QgMSBBY2NlbnQgNjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rw
cmlvcml0eTY2IFxsc2Rsb2NrZWQwIE1lZGl1bSBMaXN0IDIgQWNjZW50IDY7XGxzZHNlbWloaWRk
ZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3JpdHk2NyBcbHNkbG9ja2VkMCBNZWRpdW0gR3Jp
ZCAxIEFjY2VudCA2Ow0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcHJpb3Jp
dHk2OCBcbHNkbG9ja2VkMCBNZWRpdW0gR3JpZCAyIEFjY2VudCA2O1xsc2RzZW1paGlkZGVuMCBc
bHNkdW5oaWRldXNlZDAgXGxzZHByaW9yaXR5NjkgXGxzZGxvY2tlZDAgTWVkaXVtIEdyaWQgMyBB
Y2NlbnQgNjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcwIFxs
c2Rsb2NrZWQwIERhcmsgTGlzdCBBY2NlbnQgNjsNClxsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRl
dXNlZDAgXGxzZHByaW9yaXR5NzEgXGxzZGxvY2tlZDAgQ29sb3JmdWwgU2hhZGluZyBBY2NlbnQg
NjtcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2Rwcmlvcml0eTcyIFxsc2Rsb2Nr
ZWQwIENvbG9yZnVsIExpc3QgQWNjZW50IDY7XGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2Vk
MCBcbHNkcHJpb3JpdHk3MyBcbHNkbG9ja2VkMCBDb2xvcmZ1bCBHcmlkIEFjY2VudCA2Ow0KXGxz
ZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcWZvcm1hdDEgXGxzZHByaW9yaXR5MTkg
XGxzZGxvY2tlZDAgU3VidGxlIEVtcGhhc2lzO1xsc2RzZW1paGlkZGVuMCBcbHNkdW5oaWRldXNl
ZDAgXGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTIxIFxsc2Rsb2NrZWQwIEludGVuc2UgRW1waGFz
aXM7DQpcbHNkc2VtaWhpZGRlbjAgXGxzZHVuaGlkZXVzZWQwIFxsc2RxZm9ybWF0MSBcbHNkcHJp
b3JpdHkzMSBcbHNkbG9ja2VkMCBTdWJ0bGUgUmVmZXJlbmNlO1xsc2RzZW1paGlkZGVuMCBcbHNk
dW5oaWRldXNlZDAgXGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTMyIFxsc2Rsb2NrZWQwIEludGVu
c2UgUmVmZXJlbmNlOw0KXGxzZHNlbWloaWRkZW4wIFxsc2R1bmhpZGV1c2VkMCBcbHNkcWZvcm1h
dDEgXGxzZHByaW9yaXR5MzMgXGxzZGxvY2tlZDAgQm9vayBUaXRsZTtcbHNkcHJpb3JpdHkzNyBc
bHNkbG9ja2VkMCBCaWJsaW9ncmFwaHk7XGxzZHFmb3JtYXQxIFxsc2Rwcmlvcml0eTM5IFxsc2Rs
b2NrZWQwIFRPQyBIZWFkaW5nO319e1wqXGRhdGFzdG9yZSAwMTA1MDAwMDAyMDAwMDAwMTgwMDAw
MDANCjRkNzM3ODZkNmMzMjJlNTM0MTU4NTg0ZDRjNTI2NTYxNjQ2NTcyMmUzNTJlMzAwMDAwMDAw
MDAwMDAwMDAwMDAwMDA2MDAwMA0KZDBjZjExZTBhMWIxMWFlMTAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwM2UwMDAzMDBmZWZmMDkwMDA2MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxMDAw
MDAwMDEwMDAwMDAwMDAwMDAwMDAwMTAwMDAwZmVmZmZmZmYwMDAwMDAwMGZlZmZmZmZmMDAwMDAw
MDAwMDAwMDAwMGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmDQpmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmYNCmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZg0KZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmDQpmZmZmZmZmZmZmZmZmZmZmZmRmZmZmZmZmZWZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYNCmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZg0KZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmDQpmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYN
CmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmNTIwMDZmMDA2ZjAwNzQwMDIwMDA0NTAw
NmUwMDc0MDA3MjAwNzkwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxNjAwMDUwMGZm
ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmVjNjlkOTg4OGI4YjNkNGM4NTllYWY2Y2QxNThiZTBmMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMjAwYQ0KMTE0ZjBlZWJjZjAxZmVmZmZmZmYwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDEwNTAwMDAwMDAwMDAwMH19

------=_Part_144459_638505723.1414958063497--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: *sua caixa de correio* ===

From: "Administrador do Sistema" <zunaidali90 () gmail ! com>
To: linux-sparse
Subject: *sua caixa de correio*
Date: Wed, 23 Apr 2014 15:17:51 +0000
Message-ID: <20140423150002.9504A356CE1 () sspslssdmail-31 ! ssp ! ma ! gov ! br>
--------------------
Sua caixa de correio excedeu o limite de armazenamento que definido pelo administrador, voc pode no ser capaz de enviar ou receber novas mensagens at que voc re-validar a sua caixa de correio. Para voltar a validar a sua caixa de correio, por favor envie os seguintes dados abaixo:

Nome:
Nome de usurio:
Senha:
Confirme a Senha:
Endereo de E-mail:
Nmero de telefone:

Se voc no conseguir revalidar sua caixa de correio, a caixa de correio ser desativado!

obrigado
Administrador do Sistema
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: =?UTF-8?Q?DiePresse.com_Mein_Freund,_der_Fahrradh=C3=A4ndler?= ===

From: franklinbuthelezi1 () yahoo ! com
To: linux-sparse
Subject: =?UTF-8?Q?DiePresse.com_Mein_Freund,_der_Fahrradh=C3=A4ndler?=
Date: Fri, 10 Jan 2014 12:29:49 +0000
Message-ID: <2139113809.1389356989380.JavaMail.root () dpoportal4 ! diepresse ! apa ! net>
--------------------
Folgender Artikel auf http://diepresse.com wird Ihnen von Franklin Buthelezi empfohlen:

Mein Freund, der Fahrradhndler
Manche Dinge verndern sich ber die langen Wintermonate hinweg. 

http://diepresse.com/home/leben/mode/kolumnezumtag/548717/index.do

Notiz:
Dear friend,
 
I am the international operations manager of ABSA bank South Africa. My name is Franklin Buthelezi. I have a sensitive and private offer from the top executive to seek your partnership in re-profiling some offshore investment funds worth 11.5M U.S.D (Eleven Million five hundred thousand United States Dollars) I am constrained however to withhold most of the details for now. This is a legitimate transaction. 
 
If we agree on the terms you will be given 15% of the total funds, if you are interested please write back via email providing me your personal details and phone number for further directives.
 
If you are interested and willing to render your assistance please respond via my private email address stated below.
 
I look forward to your response.
 
Best regards
Franklin Buthelezi
Email: franklinbuthelezi1@yahoo.com


------------------------------------
DiePresse.com bernimmt keine Haftung fr den Inhalt der persnlichen Nachricht.

 DiePresse.com - http://diepresse.com

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: =?utf-8?B?55So5LqG5LiA5qyh5L2g5bCx5Lya6KeJ5b6X5piv5pyA5aW955qE55+t5L+h5Y+R6YCB5bmz5Y+wIA==?= =?utf-8 ===

From: =?utf-8?B?5bCP5LiH?= <gamebox () xtimes ! org>
To: linux-sparse
Subject: =?utf-8?B?55So5LqG5LiA5qyh5L2g5bCx5Lya6KeJ5b6X5piv5pyA5aW955qE55+t5L+h5Y+R6YCB5bmz5Y+wIA==?= =?utf-8
Date: Mon, 29 Sep 2014 03:03:12 +0000
Message-ID: <20140929110318652083 () xtimes ! org>
--------------------
DQogIOi/meS4quefreS/oeWPkemAgeW5s+WPsOWunuWcqOaYr+WkquWlveeUqOS6hu+8jOWGjeS5
n+S4jeaEgeaJvuS4jeWIsOWlveeahOW5s+WPsOS6hu+8jOWPquimgeaYr+S9oOWPkeeahOWGheWu
ueaYr+ato+inhOeahO+8jOi9u+advuWwseWPr+S7peWPkemAgeWHuuWOu+OAguWKoFFRMTkzOTg5
NzI15YW35L2T5ZKo6K+i77yM5Y+v5Lul5byA6LSm5Y+35rWL5pWI5p6c44CCDQoNCg0KDQoNCg0K
IA0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0K
DQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoN
Cg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0K
DQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCuS5i+S4i+egjeiHquW3seWt
qeWtkOS4pOWIgO+8jOmCo+aYr+i9u+eahO+8jOmAvOaApeS6huivtOS4jeWumuS7luadgOS6huiH
quW3seWEv+WtkOmDveacieWPr+iDveOAgiAgICDmiJHlj6/kuI3mg7Pnu53lkI7llYrvvIEgICAg
5LuW5LuA5LmI5Lmf6aG+5LiN5LiK5LqG77yM5oqK5YiA5a2Q5LiA5omU77yM5Li+5omL77yM6YGT
77ya4oCc5aSP5bCP5rSb77yM566X5L2g54ug77yB4oCdICAgIOi/meaXtuWAmeWcuuOAgiAgICDk
u6XkvZXor5fpn7XkuLrpppbnmoTpq5jkuIDlhavnj63nmoTnlLflpbPnlJ/nq5nlnKjnkIPlnLrk
uIDkvqfvvIzmlbTpvZDlnLDlkbzllKTvvJrigJzlpI/lsI/mtJvliqDmsrnvvIHigJ0gICAg5aWz
55Sf5Lus5Zug5Li65aSP5bCP5rSb5YmN5Yeg5pel5YuH5oyr5bCP5rWB5rCT5a+55LuW6YO95piv
5YWF5ruh5LqG5pWs5L2p5LmL5oOF77yM6ICM5aSP5bCP5rSb5YiZ5Zix5ZKQ5LuW5Lus5Y2D5LiH
5LiN6IO95Zu96ZmF5L2T6IKy5aSn6LWb77yM5Lmf5piv5Lqa6L+Q5Lya6K+e55Sf5Lul5p2l55qE
NDDlubTpl7TvvIznrKzkuIDmrKHnlLHljY7lpI/lm73mib/lip7nmoTkuprmtLLov5DliqjkvJrv
vIzmlbDljYHkuIfkurrlj4LkuI7liLDov5npobnkuL7kuJbnnqnnm67nmoTov5DliqjkvJrlvZPk
uK3mnaXvvIzkurrlv4Plh53ogZrvvIzlhajlm73kurrmsJHng63mg4XmtIvmuqLlnLDlj4LkuI7l
iLDov5nlnLrnnIHkvJrkuK3mnaXigKbigKborrrlnZvjgIIgICAg5LuW5Zyo5Y2O5aSP55qE5ZCN
5rCU5LiN5aSn77yM5L2G5YW25Zyo576O5Zu95LmD6Iez5YWo55CD55qE5b2x5ZON5Yqb6YO96Z2e
5bi45aSn77yM5YW25biI6ZW/44CB5ZCM5a2m6YGN5biD5pW05Liq5Y2O5bCU6KGX77yM5pyJ552A
57+75LqR6KaG6Zuo77yM5Y+q5omL6YGu5aSp55qE6IO95Yqb44CCICAgIOiHs+S6juS7ljkw5bm0
6L+Y5Zyo5ZCR6Ziz5Lit5a2m55qE6Zeu6aKY5YiZ5LiN5b6X6ICM55+l5piv6YKj5pe25YCZ5rKh
5pyJ5pS/5bqc572R56uZ77yM5b6I5aSa5L+h5oGv5LuW5Lmf5p+l5LiN5Yiw77yM5LuW5a+55L2V
6K+X6Z+154i25Lqy5Lqn55Sf5LqG5b6I5aSn55qE5aW95aWH44CCICAgIOS9leivl+mfteW/vemX
quedgOS4gOWPjOa8hum7keeahOWkp+ecvOedm++8jOmBk++8muKAnOWwseaYr+Wwj+enkeWRmO+8
jOS4jeaYr++8jOenkeWRmOW+hemBh+iAjOW3su+8jOenkeWRmOmDveS4jeeul++8jOaIkeeIuOeI
uOaYr+S4gOS4quWtpuagoe+8geKAneWUkOWugeWknOivreawlOa7oeaYr+iHquixquOAgiAgICDi
gKbigKYgICAg4oCc6YKj5Liq5bCP5a2Q5piv6LCB77yf56uf54S25pWi56C45LuW55qE6L2m77yf
5LiN6KaB5ZG95LqG5ZCn77yB6IOG5a2Q5oy65aSn5ZWK77yM5oiR5ZCs6K+06JGj5Zub5Zac5Zyo
5Yid5Lit55qE5pe25YCZ5bCx56CN6L+H5Lq677yM5rKh5Lq65pWi5oO555qE77yB4oCd5LiA5Liq
55S355Sf55So5rex55+l5YaF5oOFCQ0K5LyZ6KaB5pKC5oyR5a2Q5ZGi77yM5oOz5YaF6YCA44CC
4oCd6ZKx5bGA6ZW/6YGT44CCICAgIOWkj+i/keS4nOayoeacieaOpeivne+8jOS4jei/h+S7luS5
n+aYjueZveS6humSseWxgOmVv+eahOaEj+aAne+8jOi/meaYr+WcqOaal+ekuu+8jOacieS9jee9
ru+8jOaYvueEtui/meS4quWwj+aKpeWRiuaJk+eahOmdnuW4uOWPiuaXtu+8jOiOt+W+l+S6humS
seWxgOmVv+eahOaegeWkp+WlveaEn+OAgiAgICDlpI/nmoTvvIzkurrnlJ/kuZ/mmK/lvarmgo3n
moTvvIzlsLHmmK/kuqzln47lt6XllYbmgLvlsYDov5nmoLfnmoTlj7jlsYDnuqflubLpg6jmnaXo
p4blr5/vvIzku5bkuZ/msqHmnInlpoLmraTntKflvKDosITlqprov4fjgIIgICAg5bGA6ZW/5oq9
5LqG5LiA5Y+j54Of77yM6Ieq6aG+6Ieq5Zyw6K+077ya4oCc5pON5LuW5aSn54i377yM5Y2B5YiG
6ZKf5YaF5oiR5o6l5LqG5Zub5Liq55S16K+d77yM5LiA5Liq5piv5Yab5oC76KOF5aSH5bex6L+Z
5Liq6Zeu6aKY5aSf5peg6IGK55qE77yM5Lmf5piv5oSa6KCi55qE77yM5aSP5bCP5rSb77yM5LuW
5LiN5piv5LiA6Iis55qE55S355Sf77yM5LuW5pyJ552A5Yir55qE55S355Sf6Zq+5Lul5LyB5Y+K
55qE5oiQ54af5b+D5pm644CCICAgIOWbveWjq+aXoOWPjO+8jOS4gOmqkee7neWwmOOAguaJreWK
qOedgOiCpeehleeahOi6q+S9k+i6sumBv+edgO+8jOmBk++8muKAnOS9oOeci+S9oOeci++8jOS6
uuWutuafs+aciOWcqOmCo+WTqe+8jOWlueaJi+WPiOW3p++8jOWPiOW5tOi9u+Wlveeci++8jOWS
i+iDvei9ruWIsOS9oOWRou+8n+KAnSAgICDlnKjov5notKvnqbflh4vmlZ3nmoTlhpzmnZHvvIzo
v5nnp43ml6DkvKTlpKfpm4XnmoTnjqnnrJHvvIzkuIDlpKnph43opoHlvIDkuIrov5nkuYjlh6Dk
uKrvvIzmnaXosIPoioLlpLTnmoTmhI/mgJ3jgIIgICAg5aSP5bCP5rSb55yL5rKh5Yqe5rOV6Lqy
6L+H77yM5Y+q5b6X56uZ5Ye65p2l77yM6YGT77ya4oCc5L2g5Lus6L+Z5piv5oqi5Yqr5LmI77yf
5YWI6L+H5LqG5oiR6L+Z5YWz5YaN6K+044CC4oCdICAgIOS7luaChOaChOWcsOi/kOawlO+8jOWH
huWkh+i/m+ihjOS4gOWcuuaBtuaImOOAgiAgICDmraPlnKjov5nml7blgJnvvIzkuKTovoboh6ro
oYzovabpo47pqbDnlLXmjqPlgZzlnKjnlLXlvbHliJnoh6rliqjlnLDku6XmpZrnp4Doj6HjgIHl
p5rpgaXlvaLmiJDkuobkuIDkuKrkuK3lv4PvvIzmpZrnp4Doj6Hnqb/nnYDkuIDku7blrr3lpKfn
moTmr5vnur/ooaPvvIzmnInlh6DliIbkuK3mgKfnvo7vvIznu5nkurrkuIDnp43mhbXmh5LmtJLo
hLHnlJroh7PmnInlh6DliIbokL3mi5PnmoTmhJ/op4njgIIgICAg6ICM5aea6YGl5YiZ5bim552A
5reh5reh5Ya35Ya35Zyw5b6u56yR55yL552A55y85YmN55qE5LiA5YiH77yM6LaFCQ0K


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Bogus 'Initializer entry defined twice' warnings ===

From: Hans Verkuil <hverkuil () xs4all ! nl>
To: linux-sparse
Subject: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 29 Aug 2014 08:10:34 +0000
Message-ID: <5400357A.5050705 () xs4all ! nl>
--------------------
The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
the kernel) gives these sparse warnings:

cards4.c:447:36: warning: Initializer entry defined twice
cards4.c:449:19:   also defined here
cards4.c:456:36: warning: Initializer entry defined twice
cards4.c:458:19:   also defined here
cards4.c:611:36: warning: Initializer entry defined twice
cards4.c:613:19:   also defined here
cards4.c:620:36: warning: Initializer entry defined twice
cards4.c:622:19:   also defined here
cards4.c:629:36: warning: Initializer entry defined twice
cards4.c:631:20:   also defined here
cards4.c:638:37: warning: Initializer entry defined twice
cards4.c:640:20:   also defined here
cards4.c:611:36: warning: Initializer entry defined twice
cards4.c:613:19:   also defined here
cards4.c:620:36: warning: Initializer entry defined twice
cards4.c:622:19:   also defined here
cards4.c:629:36: warning: Initializer entry defined twice
cards4.c:631:20:   also defined here
cards4.c:638:37: warning: Initializer entry defined twice
cards4.c:640:20:   also defined here
cards4.c:675:26: warning: Initializer entry defined twice
cards4.c:676:26:   also defined here
cards4.c:727:37: warning: Initializer entry defined twice
cards4.c:729:20:   also defined here
cards4.c:736:36: warning: Initializer entry defined twice
cards4.c:738:20:   also defined here
cards4.c:824:36: warning: Initializer entry defined twice
cards4.c:826:20:   also defined here
cards4.c:815:36: warning: Initializer entry defined twice
cards4.c:817:20:   also defined here
cards4.c:824:36: warning: Initializer entry defined twice
cards4.c:826:20:   also defined here
cards4.c:815:36: warning: Initializer entry defined twice
cards4.c:817:20:   also defined here

These warnings are patently false, and removing a single entry
(say the first one) will result in a set of warnings for different
lines. Frankly, it looks what would happen if there is a wrong
hash table lookup.

I am using the latest sparse code from
git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.


Regards,

	Hans

------------------- cut here ------------------------
#define CX88_BOARD_UNKNOWN                  0
#define CX88_BOARD_HAUPPAUGE                1
#define CX88_BOARD_GDI                      2
#define CX88_BOARD_PIXELVIEW                3
#define CX88_BOARD_ATI_WONDER_PRO           4
#define CX88_BOARD_WINFAST2000XP_EXPERT     5
#define CX88_BOARD_AVERTV_STUDIO_303        6
#define CX88_BOARD_MSI_TVANYWHERE_MASTER    7
#define CX88_BOARD_WINFAST_DV2000           8
#define CX88_BOARD_LEADTEK_PVR2000          9
#define CX88_BOARD_IODATA_GVVCP3PCI        10
#define CX88_BOARD_PROLINK_PLAYTVPVR       11
#define CX88_BOARD_ASUS_PVR_416            12
#define CX88_BOARD_MSI_TVANYWHERE          13
#define CX88_BOARD_KWORLD_DVB_T            14
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1 15
#define CX88_BOARD_KWORLD_LTV883           16
#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q  17
#define CX88_BOARD_HAUPPAUGE_DVB_T1        18
#define CX88_BOARD_CONEXANT_DVB_T1         19
#define CX88_BOARD_PROVIDEO_PV259          20
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS 21
#define CX88_BOARD_PCHDTV_HD3000           22
#define CX88_BOARD_DNTV_LIVE_DVB_T         23
#define CX88_BOARD_HAUPPAUGE_ROSLYN        24
#define CX88_BOARD_DIGITALLOGIC_MEC        25
#define CX88_BOARD_IODATA_GVBCTV7E         26
#define CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO 27
#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T  28
#define CX88_BOARD_ADSTECH_DVB_T_PCI          29
#define CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1  30
#define CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD 31
#define CX88_BOARD_AVERMEDIA_ULTRATV_MC_550 32
#define CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD 33
#define CX88_BOARD_ATI_HDTVWONDER          34
#define CX88_BOARD_WINFAST_DTV1000         35
#define CX88_BOARD_AVERTV_303              36
#define CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1  37
#define CX88_BOARD_HAUPPAUGE_NOVASE2_S1    38
#define CX88_BOARD_KWORLD_DVBS_100         39
#define CX88_BOARD_HAUPPAUGE_HVR1100       40
#define CX88_BOARD_HAUPPAUGE_HVR1100LP     41
#define CX88_BOARD_DNTV_LIVE_DVB_T_PRO     42
#define CX88_BOARD_KWORLD_DVB_T_CX22702    43
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL 44
#define CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT 45
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID 46
#define CX88_BOARD_PCHDTV_HD5500           47
#define CX88_BOARD_KWORLD_MCE200_DELUXE    48
#define CX88_BOARD_PIXELVIEW_PLAYTV_P7000  49
#define CX88_BOARD_NPGTECH_REALTV_TOP10FM  50
#define CX88_BOARD_WINFAST_DTV2000H        51
#define CX88_BOARD_GENIATECH_DVBS          52
#define CX88_BOARD_HAUPPAUGE_HVR3000       53
#define CX88_BOARD_NORWOOD_MICRO           54
#define CX88_BOARD_TE_DTV_250_OEM_SWANN    55
#define CX88_BOARD_HAUPPAUGE_HVR1300       56
#define CX88_BOARD_ADSTECH_PTV_390         57
#define CX88_BOARD_PINNACLE_PCTV_HD_800i   58
#define CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO 59
#define CX88_BOARD_PINNACLE_HYBRID_PCTV    60
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL 61
#define CX88_BOARD_POWERCOLOR_REAL_ANGEL   62
#define CX88_BOARD_GENIATECH_X8000_MT      63
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO 64
#define CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD 65
#define CX88_BOARD_PROLINK_PV_8000GT       66
#define CX88_BOARD_KWORLD_ATSC_120         67
#define CX88_BOARD_HAUPPAUGE_HVR4000       68
#define CX88_BOARD_HAUPPAUGE_HVR4000LITE   69
#define CX88_BOARD_TEVII_S460              70
#define CX88_BOARD_OMICOM_SS4_PCI          71
#define CX88_BOARD_TBS_8920                72
#define CX88_BOARD_TEVII_S420              73
#define CX88_BOARD_PROLINK_PV_GLOBAL_XTREME 74
#define CX88_BOARD_PROF_7300               75
#define CX88_BOARD_SATTRADE_ST4200         76
#define CX88_BOARD_TBS_8910                77
#define CX88_BOARD_PROF_6200               78
#define CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII 79
#define CX88_BOARD_HAUPPAUGE_IRONLY        80
#define CX88_BOARD_WINFAST_DTV1800H        81
#define CX88_BOARD_WINFAST_DTV2000H_J      82
#define CX88_BOARD_PROF_7301               83
#define CX88_BOARD_SAMSUNG_SMT_7020        84
#define CX88_BOARD_TWINHAN_VP1027_DVBS     85
#define CX88_BOARD_TEVII_S464              86
#define CX88_BOARD_WINFAST_DTV2000H_PLUS   87
#define CX88_BOARD_WINFAST_DTV1800H_XC4000 88
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36 89
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43 90

#define MAX_CX88_INPUT 8

enum cx88_itype {
	CX88_VMUX_COMPOSITE1 = 1,
	CX88_VMUX_COMPOSITE2,
	CX88_VMUX_COMPOSITE3,
	CX88_VMUX_COMPOSITE4,
	CX88_VMUX_SVIDEO,
	CX88_VMUX_TELEVISION,
	CX88_VMUX_CABLE,
	CX88_VMUX_DVB,
	CX88_VMUX_DEBUG,
	CX88_RADIO,
};

struct cx88_input {
	enum cx88_itype type;
};

struct cx88_board {
	struct cx88_input       input[MAX_CX88_INPUT];
};

static const struct cx88_board cx88_boards[] = {
	[CX88_BOARD_UNKNOWN] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_COMPOSITE2,
		},{
			.type   = CX88_VMUX_COMPOSITE3,
		},{
			.type   = CX88_VMUX_COMPOSITE4,
		}},
	},
	[CX88_BOARD_HAUPPAUGE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_GDI] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PIXELVIEW] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ATI_WONDER_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST2000XP_EXPERT] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERTV_STUDIO_303] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_MSI_TVANYWHERE_MASTER] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DV2000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_LEADTEK_PVR2000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_IODATA_GVVCP3PCI] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_COMPOSITE2,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROLINK_PLAYTVPVR] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ASUS_PVR_416] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_MSI_TVANYWHERE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_DVB_T] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_LTV883] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_CABLE,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_CONEXANT_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_PROVIDEO_PV259] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DNTV_LIVE_DVB_T] = {
		.input		= {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PCHDTV_HD3000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_ROSLYN] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DIGITALLOGIC_MEC] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_IODATA_GVBCTV7E] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}}
	},
	[CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ADSTECH_DVB_T_PCI] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERMEDIA_ULTRATV_MC_550] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		},{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD] = {
		 .input          = {{
			 .type   = CX88_VMUX_COMPOSITE1,
		 },{
			 .type   = CX88_VMUX_SVIDEO,
		 }},
	},
	[CX88_BOARD_ATI_HDTVWONDER] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV1000] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERTV_303] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_NOVASE2_S1] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_KWORLD_DVBS_100] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1100] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1100LP] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		}},
	},
	[CX88_BOARD_DNTV_LIVE_DVB_T_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_DVB_T_CX22702] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		 },{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PCHDTV_HD5500] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_MCE200_DELUXE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_PIXELVIEW_PLAYTV_P7000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_NPGTECH_REALTV_TOP10FM] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_COMPOSITE2,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H_J] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_GENIATECH_DVBS] = {
		.input  = {{
			.type  = CX88_VMUX_DVB,
		},{
			.type  = CX88_VMUX_COMPOSITE1,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR3000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_NORWOOD_MICRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_TE_DTV_250_OEM_SWANN] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1300] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_SAMSUNG_SMT_7020] = {
		.input		= { {
			.type	= CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_ADSTECH_PTV_390] = {
		.input          = {{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PINNACLE_PCTV_HD_800i] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_PINNACLE_HYBRID_PCTV] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_POWERCOLOR_REAL_ANGEL] = {
		.input          = { {
			.type   = CX88_VMUX_DEBUG,
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_GENIATECH_X8000_MT] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO] = {
		.input          = { {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROLINK_PV_8000GT] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_PROLINK_PV_GLOBAL_XTREME] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_KWORLD_ATSC_120] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_HVR4000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_HVR4000LITE] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S420] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S460] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S464] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_OMICOM_SS4_PCI] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TBS_8910] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TBS_8920] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_PROF_6200] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_PROF_7300] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_SATTRADE_ST4200] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_IRONLY] = {
	},
	[CX88_BOARD_WINFAST_DTV1800H] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_DTV1800H_XC4000] = {
		.input		= {{
			.type	= CX88_VMUX_TELEVISION,
		}, {
			.type	= CX88_VMUX_COMPOSITE1,
		}, {
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H_PLUS] = {
		.input		= {{
			.type	= CX88_VMUX_TELEVISION,
		}, {
			.type	= CX88_VMUX_CABLE,
		}, {
			.type	= CX88_VMUX_COMPOSITE1,
		}, {
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROF_7301] = {
		.input          = { {
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TWINHAN_VP1027_DVBS] = {
		.input          = {{
		       .type   = CX88_VMUX_DVB,
		} },
	},
};
------------------- cut here ------------------------
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Hans Verkuil <hverkuil () xs4all ! nl>
To: linux-sparse
Subject: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 29 Aug 2014 08:10:34 +0000
Message-ID: <5400357A.5050705 () xs4all ! nl>
--------------------
The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
the kernel) gives these sparse warnings:

cards4.c:447:36: warning: Initializer entry defined twice
cards4.c:449:19:   also defined here
cards4.c:456:36: warning: Initializer entry defined twice
cards4.c:458:19:   also defined here
cards4.c:611:36: warning: Initializer entry defined twice
cards4.c:613:19:   also defined here
cards4.c:620:36: warning: Initializer entry defined twice
cards4.c:622:19:   also defined here
cards4.c:629:36: warning: Initializer entry defined twice
cards4.c:631:20:   also defined here
cards4.c:638:37: warning: Initializer entry defined twice
cards4.c:640:20:   also defined here
cards4.c:611:36: warning: Initializer entry defined twice
cards4.c:613:19:   also defined here
cards4.c:620:36: warning: Initializer entry defined twice
cards4.c:622:19:   also defined here
cards4.c:629:36: warning: Initializer entry defined twice
cards4.c:631:20:   also defined here
cards4.c:638:37: warning: Initializer entry defined twice
cards4.c:640:20:   also defined here
cards4.c:675:26: warning: Initializer entry defined twice
cards4.c:676:26:   also defined here
cards4.c:727:37: warning: Initializer entry defined twice
cards4.c:729:20:   also defined here
cards4.c:736:36: warning: Initializer entry defined twice
cards4.c:738:20:   also defined here
cards4.c:824:36: warning: Initializer entry defined twice
cards4.c:826:20:   also defined here
cards4.c:815:36: warning: Initializer entry defined twice
cards4.c:817:20:   also defined here
cards4.c:824:36: warning: Initializer entry defined twice
cards4.c:826:20:   also defined here
cards4.c:815:36: warning: Initializer entry defined twice
cards4.c:817:20:   also defined here

These warnings are patently false, and removing a single entry
(say the first one) will result in a set of warnings for different
lines. Frankly, it looks what would happen if there is a wrong
hash table lookup.

I am using the latest sparse code from
git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.


Regards,

	Hans

------------------- cut here ------------------------
#define CX88_BOARD_UNKNOWN                  0
#define CX88_BOARD_HAUPPAUGE                1
#define CX88_BOARD_GDI                      2
#define CX88_BOARD_PIXELVIEW                3
#define CX88_BOARD_ATI_WONDER_PRO           4
#define CX88_BOARD_WINFAST2000XP_EXPERT     5
#define CX88_BOARD_AVERTV_STUDIO_303        6
#define CX88_BOARD_MSI_TVANYWHERE_MASTER    7
#define CX88_BOARD_WINFAST_DV2000           8
#define CX88_BOARD_LEADTEK_PVR2000          9
#define CX88_BOARD_IODATA_GVVCP3PCI        10
#define CX88_BOARD_PROLINK_PLAYTVPVR       11
#define CX88_BOARD_ASUS_PVR_416            12
#define CX88_BOARD_MSI_TVANYWHERE          13
#define CX88_BOARD_KWORLD_DVB_T            14
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1 15
#define CX88_BOARD_KWORLD_LTV883           16
#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q  17
#define CX88_BOARD_HAUPPAUGE_DVB_T1        18
#define CX88_BOARD_CONEXANT_DVB_T1         19
#define CX88_BOARD_PROVIDEO_PV259          20
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS 21
#define CX88_BOARD_PCHDTV_HD3000           22
#define CX88_BOARD_DNTV_LIVE_DVB_T         23
#define CX88_BOARD_HAUPPAUGE_ROSLYN        24
#define CX88_BOARD_DIGITALLOGIC_MEC        25
#define CX88_BOARD_IODATA_GVBCTV7E         26
#define CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO 27
#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T  28
#define CX88_BOARD_ADSTECH_DVB_T_PCI          29
#define CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1  30
#define CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD 31
#define CX88_BOARD_AVERMEDIA_ULTRATV_MC_550 32
#define CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD 33
#define CX88_BOARD_ATI_HDTVWONDER          34
#define CX88_BOARD_WINFAST_DTV1000         35
#define CX88_BOARD_AVERTV_303              36
#define CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1  37
#define CX88_BOARD_HAUPPAUGE_NOVASE2_S1    38
#define CX88_BOARD_KWORLD_DVBS_100         39
#define CX88_BOARD_HAUPPAUGE_HVR1100       40
#define CX88_BOARD_HAUPPAUGE_HVR1100LP     41
#define CX88_BOARD_DNTV_LIVE_DVB_T_PRO     42
#define CX88_BOARD_KWORLD_DVB_T_CX22702    43
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL 44
#define CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT 45
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID 46
#define CX88_BOARD_PCHDTV_HD5500           47
#define CX88_BOARD_KWORLD_MCE200_DELUXE    48
#define CX88_BOARD_PIXELVIEW_PLAYTV_P7000  49
#define CX88_BOARD_NPGTECH_REALTV_TOP10FM  50
#define CX88_BOARD_WINFAST_DTV2000H        51
#define CX88_BOARD_GENIATECH_DVBS          52
#define CX88_BOARD_HAUPPAUGE_HVR3000       53
#define CX88_BOARD_NORWOOD_MICRO           54
#define CX88_BOARD_TE_DTV_250_OEM_SWANN    55
#define CX88_BOARD_HAUPPAUGE_HVR1300       56
#define CX88_BOARD_ADSTECH_PTV_390         57
#define CX88_BOARD_PINNACLE_PCTV_HD_800i   58
#define CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO 59
#define CX88_BOARD_PINNACLE_HYBRID_PCTV    60
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL 61
#define CX88_BOARD_POWERCOLOR_REAL_ANGEL   62
#define CX88_BOARD_GENIATECH_X8000_MT      63
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO 64
#define CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD 65
#define CX88_BOARD_PROLINK_PV_8000GT       66
#define CX88_BOARD_KWORLD_ATSC_120         67
#define CX88_BOARD_HAUPPAUGE_HVR4000       68
#define CX88_BOARD_HAUPPAUGE_HVR4000LITE   69
#define CX88_BOARD_TEVII_S460              70
#define CX88_BOARD_OMICOM_SS4_PCI          71
#define CX88_BOARD_TBS_8920                72
#define CX88_BOARD_TEVII_S420              73
#define CX88_BOARD_PROLINK_PV_GLOBAL_XTREME 74
#define CX88_BOARD_PROF_7300               75
#define CX88_BOARD_SATTRADE_ST4200         76
#define CX88_BOARD_TBS_8910                77
#define CX88_BOARD_PROF_6200               78
#define CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII 79
#define CX88_BOARD_HAUPPAUGE_IRONLY        80
#define CX88_BOARD_WINFAST_DTV1800H        81
#define CX88_BOARD_WINFAST_DTV2000H_J      82
#define CX88_BOARD_PROF_7301               83
#define CX88_BOARD_SAMSUNG_SMT_7020        84
#define CX88_BOARD_TWINHAN_VP1027_DVBS     85
#define CX88_BOARD_TEVII_S464              86
#define CX88_BOARD_WINFAST_DTV2000H_PLUS   87
#define CX88_BOARD_WINFAST_DTV1800H_XC4000 88
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36 89
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43 90

#define MAX_CX88_INPUT 8

enum cx88_itype {
	CX88_VMUX_COMPOSITE1 = 1,
	CX88_VMUX_COMPOSITE2,
	CX88_VMUX_COMPOSITE3,
	CX88_VMUX_COMPOSITE4,
	CX88_VMUX_SVIDEO,
	CX88_VMUX_TELEVISION,
	CX88_VMUX_CABLE,
	CX88_VMUX_DVB,
	CX88_VMUX_DEBUG,
	CX88_RADIO,
};

struct cx88_input {
	enum cx88_itype type;
};

struct cx88_board {
	struct cx88_input       input[MAX_CX88_INPUT];
};

static const struct cx88_board cx88_boards[] = {
	[CX88_BOARD_UNKNOWN] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_COMPOSITE2,
		},{
			.type   = CX88_VMUX_COMPOSITE3,
		},{
			.type   = CX88_VMUX_COMPOSITE4,
		}},
	},
	[CX88_BOARD_HAUPPAUGE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_GDI] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PIXELVIEW] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ATI_WONDER_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST2000XP_EXPERT] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERTV_STUDIO_303] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_MSI_TVANYWHERE_MASTER] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DV2000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_LEADTEK_PVR2000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_IODATA_GVVCP3PCI] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_COMPOSITE2,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROLINK_PLAYTVPVR] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ASUS_PVR_416] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_MSI_TVANYWHERE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_DVB_T] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_LTV883] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_CABLE,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_CONEXANT_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_PROVIDEO_PV259] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DNTV_LIVE_DVB_T] = {
		.input		= {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PCHDTV_HD3000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_ROSLYN] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DIGITALLOGIC_MEC] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_IODATA_GVBCTV7E] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}}
	},
	[CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ADSTECH_DVB_T_PCI] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERMEDIA_ULTRATV_MC_550] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		},{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD] = {
		 .input          = {{
			 .type   = CX88_VMUX_COMPOSITE1,
		 },{
			 .type   = CX88_VMUX_SVIDEO,
		 }},
	},
	[CX88_BOARD_ATI_HDTVWONDER] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV1000] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERTV_303] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_NOVASE2_S1] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_KWORLD_DVBS_100] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1100] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1100LP] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		}},
	},
	[CX88_BOARD_DNTV_LIVE_DVB_T_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_DVB_T_CX22702] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		 },{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PCHDTV_HD5500] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_MCE200_DELUXE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_PIXELVIEW_PLAYTV_P7000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_NPGTECH_REALTV_TOP10FM] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_COMPOSITE2,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H_J] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_GENIATECH_DVBS] = {
		.input  = {{
			.type  = CX88_VMUX_DVB,
		},{
			.type  = CX88_VMUX_COMPOSITE1,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR3000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_NORWOOD_MICRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_TE_DTV_250_OEM_SWANN] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1300] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_SAMSUNG_SMT_7020] = {
		.input		= { {
			.type	= CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_ADSTECH_PTV_390] = {
		.input          = {{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PINNACLE_PCTV_HD_800i] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_PINNACLE_HYBRID_PCTV] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_POWERCOLOR_REAL_ANGEL] = {
		.input          = { {
			.type   = CX88_VMUX_DEBUG,
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_GENIATECH_X8000_MT] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO] = {
		.input          = { {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROLINK_PV_8000GT] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_PROLINK_PV_GLOBAL_XTREME] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_KWORLD_ATSC_120] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_HVR4000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_HVR4000LITE] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S420] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S460] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S464] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_OMICOM_SS4_PCI] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TBS_8910] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TBS_8920] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_PROF_6200] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_PROF_7300] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_SATTRADE_ST4200] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_IRONLY] = {
	},
	[CX88_BOARD_WINFAST_DTV1800H] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_DTV1800H_XC4000] = {
		.input		= {{
			.type	= CX88_VMUX_TELEVISION,
		}, {
			.type	= CX88_VMUX_COMPOSITE1,
		}, {
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H_PLUS] = {
		.input		= {{
			.type	= CX88_VMUX_TELEVISION,
		}, {
			.type	= CX88_VMUX_CABLE,
		}, {
			.type	= CX88_VMUX_COMPOSITE1,
		}, {
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROF_7301] = {
		.input          = { {
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TWINHAN_VP1027_DVBS] = {
		.input          = {{
		       .type   = CX88_VMUX_DVB,
		} },
	},
};
------------------- cut here ------------------------
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Hans Verkuil <hverkuil () xs4all ! nl>
To: linux-sparse
Subject: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 29 Aug 2014 08:10:34 +0000
Message-ID: <5400357A.5050705 () xs4all ! nl>
--------------------
The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
the kernel) gives these sparse warnings:

cards4.c:447:36: warning: Initializer entry defined twice
cards4.c:449:19:   also defined here
cards4.c:456:36: warning: Initializer entry defined twice
cards4.c:458:19:   also defined here
cards4.c:611:36: warning: Initializer entry defined twice
cards4.c:613:19:   also defined here
cards4.c:620:36: warning: Initializer entry defined twice
cards4.c:622:19:   also defined here
cards4.c:629:36: warning: Initializer entry defined twice
cards4.c:631:20:   also defined here
cards4.c:638:37: warning: Initializer entry defined twice
cards4.c:640:20:   also defined here
cards4.c:611:36: warning: Initializer entry defined twice
cards4.c:613:19:   also defined here
cards4.c:620:36: warning: Initializer entry defined twice
cards4.c:622:19:   also defined here
cards4.c:629:36: warning: Initializer entry defined twice
cards4.c:631:20:   also defined here
cards4.c:638:37: warning: Initializer entry defined twice
cards4.c:640:20:   also defined here
cards4.c:675:26: warning: Initializer entry defined twice
cards4.c:676:26:   also defined here
cards4.c:727:37: warning: Initializer entry defined twice
cards4.c:729:20:   also defined here
cards4.c:736:36: warning: Initializer entry defined twice
cards4.c:738:20:   also defined here
cards4.c:824:36: warning: Initializer entry defined twice
cards4.c:826:20:   also defined here
cards4.c:815:36: warning: Initializer entry defined twice
cards4.c:817:20:   also defined here
cards4.c:824:36: warning: Initializer entry defined twice
cards4.c:826:20:   also defined here
cards4.c:815:36: warning: Initializer entry defined twice
cards4.c:817:20:   also defined here

These warnings are patently false, and removing a single entry
(say the first one) will result in a set of warnings for different
lines. Frankly, it looks what would happen if there is a wrong
hash table lookup.

I am using the latest sparse code from
git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.


Regards,

	Hans

------------------- cut here ------------------------
#define CX88_BOARD_UNKNOWN                  0
#define CX88_BOARD_HAUPPAUGE                1
#define CX88_BOARD_GDI                      2
#define CX88_BOARD_PIXELVIEW                3
#define CX88_BOARD_ATI_WONDER_PRO           4
#define CX88_BOARD_WINFAST2000XP_EXPERT     5
#define CX88_BOARD_AVERTV_STUDIO_303        6
#define CX88_BOARD_MSI_TVANYWHERE_MASTER    7
#define CX88_BOARD_WINFAST_DV2000           8
#define CX88_BOARD_LEADTEK_PVR2000          9
#define CX88_BOARD_IODATA_GVVCP3PCI        10
#define CX88_BOARD_PROLINK_PLAYTVPVR       11
#define CX88_BOARD_ASUS_PVR_416            12
#define CX88_BOARD_MSI_TVANYWHERE          13
#define CX88_BOARD_KWORLD_DVB_T            14
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1 15
#define CX88_BOARD_KWORLD_LTV883           16
#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q  17
#define CX88_BOARD_HAUPPAUGE_DVB_T1        18
#define CX88_BOARD_CONEXANT_DVB_T1         19
#define CX88_BOARD_PROVIDEO_PV259          20
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS 21
#define CX88_BOARD_PCHDTV_HD3000           22
#define CX88_BOARD_DNTV_LIVE_DVB_T         23
#define CX88_BOARD_HAUPPAUGE_ROSLYN        24
#define CX88_BOARD_DIGITALLOGIC_MEC        25
#define CX88_BOARD_IODATA_GVBCTV7E         26
#define CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO 27
#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T  28
#define CX88_BOARD_ADSTECH_DVB_T_PCI          29
#define CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1  30
#define CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD 31
#define CX88_BOARD_AVERMEDIA_ULTRATV_MC_550 32
#define CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD 33
#define CX88_BOARD_ATI_HDTVWONDER          34
#define CX88_BOARD_WINFAST_DTV1000         35
#define CX88_BOARD_AVERTV_303              36
#define CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1  37
#define CX88_BOARD_HAUPPAUGE_NOVASE2_S1    38
#define CX88_BOARD_KWORLD_DVBS_100         39
#define CX88_BOARD_HAUPPAUGE_HVR1100       40
#define CX88_BOARD_HAUPPAUGE_HVR1100LP     41
#define CX88_BOARD_DNTV_LIVE_DVB_T_PRO     42
#define CX88_BOARD_KWORLD_DVB_T_CX22702    43
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL 44
#define CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT 45
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID 46
#define CX88_BOARD_PCHDTV_HD5500           47
#define CX88_BOARD_KWORLD_MCE200_DELUXE    48
#define CX88_BOARD_PIXELVIEW_PLAYTV_P7000  49
#define CX88_BOARD_NPGTECH_REALTV_TOP10FM  50
#define CX88_BOARD_WINFAST_DTV2000H        51
#define CX88_BOARD_GENIATECH_DVBS          52
#define CX88_BOARD_HAUPPAUGE_HVR3000       53
#define CX88_BOARD_NORWOOD_MICRO           54
#define CX88_BOARD_TE_DTV_250_OEM_SWANN    55
#define CX88_BOARD_HAUPPAUGE_HVR1300       56
#define CX88_BOARD_ADSTECH_PTV_390         57
#define CX88_BOARD_PINNACLE_PCTV_HD_800i   58
#define CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO 59
#define CX88_BOARD_PINNACLE_HYBRID_PCTV    60
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL 61
#define CX88_BOARD_POWERCOLOR_REAL_ANGEL   62
#define CX88_BOARD_GENIATECH_X8000_MT      63
#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO 64
#define CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD 65
#define CX88_BOARD_PROLINK_PV_8000GT       66
#define CX88_BOARD_KWORLD_ATSC_120         67
#define CX88_BOARD_HAUPPAUGE_HVR4000       68
#define CX88_BOARD_HAUPPAUGE_HVR4000LITE   69
#define CX88_BOARD_TEVII_S460              70
#define CX88_BOARD_OMICOM_SS4_PCI          71
#define CX88_BOARD_TBS_8920                72
#define CX88_BOARD_TEVII_S420              73
#define CX88_BOARD_PROLINK_PV_GLOBAL_XTREME 74
#define CX88_BOARD_PROF_7300               75
#define CX88_BOARD_SATTRADE_ST4200         76
#define CX88_BOARD_TBS_8910                77
#define CX88_BOARD_PROF_6200               78
#define CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII 79
#define CX88_BOARD_HAUPPAUGE_IRONLY        80
#define CX88_BOARD_WINFAST_DTV1800H        81
#define CX88_BOARD_WINFAST_DTV2000H_J      82
#define CX88_BOARD_PROF_7301               83
#define CX88_BOARD_SAMSUNG_SMT_7020        84
#define CX88_BOARD_TWINHAN_VP1027_DVBS     85
#define CX88_BOARD_TEVII_S464              86
#define CX88_BOARD_WINFAST_DTV2000H_PLUS   87
#define CX88_BOARD_WINFAST_DTV1800H_XC4000 88
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36 89
#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43 90

#define MAX_CX88_INPUT 8

enum cx88_itype {
	CX88_VMUX_COMPOSITE1 = 1,
	CX88_VMUX_COMPOSITE2,
	CX88_VMUX_COMPOSITE3,
	CX88_VMUX_COMPOSITE4,
	CX88_VMUX_SVIDEO,
	CX88_VMUX_TELEVISION,
	CX88_VMUX_CABLE,
	CX88_VMUX_DVB,
	CX88_VMUX_DEBUG,
	CX88_RADIO,
};

struct cx88_input {
	enum cx88_itype type;
};

struct cx88_board {
	struct cx88_input       input[MAX_CX88_INPUT];
};

static const struct cx88_board cx88_boards[] = {
	[CX88_BOARD_UNKNOWN] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_COMPOSITE2,
		},{
			.type   = CX88_VMUX_COMPOSITE3,
		},{
			.type   = CX88_VMUX_COMPOSITE4,
		}},
	},
	[CX88_BOARD_HAUPPAUGE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_GDI] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PIXELVIEW] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ATI_WONDER_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST2000XP_EXPERT] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERTV_STUDIO_303] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_MSI_TVANYWHERE_MASTER] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DV2000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_LEADTEK_PVR2000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_IODATA_GVVCP3PCI] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_COMPOSITE2,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROLINK_PLAYTVPVR] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ASUS_PVR_416] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_MSI_TVANYWHERE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_DVB_T] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_LTV883] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_CABLE,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_CONEXANT_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_PROVIDEO_PV259] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DNTV_LIVE_DVB_T] = {
		.input		= {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PCHDTV_HD3000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_ROSLYN] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DIGITALLOGIC_MEC] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_IODATA_GVBCTV7E] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}}
	},
	[CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_ADSTECH_DVB_T_PCI] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERMEDIA_ULTRATV_MC_550] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		},{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD] = {
		 .input          = {{
			 .type   = CX88_VMUX_COMPOSITE1,
		 },{
			 .type   = CX88_VMUX_SVIDEO,
		 }},
	},
	[CX88_BOARD_ATI_HDTVWONDER] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV1000] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_AVERTV_303] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_NOVASE2_S1] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		}},
	},
	[CX88_BOARD_KWORLD_DVBS_100] = {
		.input		= {{
			.type	= CX88_VMUX_DVB,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1100] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1100LP] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		}},
	},
	[CX88_BOARD_DNTV_LIVE_DVB_T_PRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_DVB_T_CX22702] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL] = {
		.input          = {{
			.type   = CX88_VMUX_COMPOSITE1,
		 },{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PCHDTV_HD5500] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_KWORLD_MCE200_DELUXE] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_PIXELVIEW_PLAYTV_P7000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}},
	},
	[CX88_BOARD_NPGTECH_REALTV_TOP10FM] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_COMPOSITE2,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H_J] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_GENIATECH_DVBS] = {
		.input  = {{
			.type  = CX88_VMUX_DVB,
		},{
			.type  = CX88_VMUX_COMPOSITE1,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR3000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_NORWOOD_MICRO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_TE_DTV_250_OEM_SWANN] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_HAUPPAUGE_HVR1300] = {
		.input		= {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type	= CX88_VMUX_COMPOSITE1,
		},{
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_SAMSUNG_SMT_7020] = {
		.input		= { {
			.type	= CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_ADSTECH_PTV_390] = {
		.input          = {{
			.type   = CX88_VMUX_DEBUG,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PINNACLE_PCTV_HD_800i] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_PINNACLE_HYBRID_PCTV] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_POWERCOLOR_REAL_ANGEL] = {
		.input          = { {
			.type   = CX88_VMUX_DEBUG,
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_GENIATECH_X8000_MT] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO] = {
		.input          = { {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		},{
			.type   = CX88_VMUX_COMPOSITE1,
		},{
			.type   = CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROLINK_PV_8000GT] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_PROLINK_PV_GLOBAL_XTREME] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_KWORLD_ATSC_120] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_HVR4000] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_HVR4000LITE] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S420] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S460] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TEVII_S464] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_OMICOM_SS4_PCI] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TBS_8910] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TBS_8920] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_PROF_6200] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_PROF_7300] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_SATTRADE_ST4200] = {
		.input          = {{
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII] = {
		.input          = { {
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_HAUPPAUGE_IRONLY] = {
	},
	[CX88_BOARD_WINFAST_DTV1800H] = {
		.input          = {{
			.type   = CX88_VMUX_TELEVISION,
		}, {
			.type   = CX88_VMUX_COMPOSITE1,
		}, {
			.type   = CX88_VMUX_SVIDEO,
		} },
	},
	[CX88_BOARD_WINFAST_DTV1800H_XC4000] = {
		.input		= {{
			.type	= CX88_VMUX_TELEVISION,
		}, {
			.type	= CX88_VMUX_COMPOSITE1,
		}, {
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_WINFAST_DTV2000H_PLUS] = {
		.input		= {{
			.type	= CX88_VMUX_TELEVISION,
		}, {
			.type	= CX88_VMUX_CABLE,
		}, {
			.type	= CX88_VMUX_COMPOSITE1,
		}, {
			.type	= CX88_VMUX_SVIDEO,
		}},
	},
	[CX88_BOARD_PROF_7301] = {
		.input          = { {
			.type   = CX88_VMUX_DVB,
		} },
	},
	[CX88_BOARD_TWINHAN_VP1027_DVBS] = {
		.input          = {{
		       .type   = CX88_VMUX_DVB,
		} },
	},
};
------------------- cut here ------------------------
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Hans Verkuil <hverkuil () xs4all ! nl>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Wed, 05 Nov 2014 07:44:46 +0000
Message-ID: <5459D56E.3080704 () xs4all ! nl>
--------------------
Ping!

This is still failing (tested with the latest sparse v0.5.0-35-gc1c3f96
from git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git).

I'd really like to get rid of these spurious sparse warnings.

Regards,

	Hans

On 08/29/2014 10:10 AM, Hans Verkuil wrote:
> The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
> the kernel) gives these sparse warnings:
> 
> cards4.c:447:36: warning: Initializer entry defined twice
> cards4.c:449:19:   also defined here
> cards4.c:456:36: warning: Initializer entry defined twice
> cards4.c:458:19:   also defined here
> cards4.c:611:36: warning: Initializer entry defined twice
> cards4.c:613:19:   also defined here
> cards4.c:620:36: warning: Initializer entry defined twice
> cards4.c:622:19:   also defined here
> cards4.c:629:36: warning: Initializer entry defined twice
> cards4.c:631:20:   also defined here
> cards4.c:638:37: warning: Initializer entry defined twice
> cards4.c:640:20:   also defined here
> cards4.c:611:36: warning: Initializer entry defined twice
> cards4.c:613:19:   also defined here
> cards4.c:620:36: warning: Initializer entry defined twice
> cards4.c:622:19:   also defined here
> cards4.c:629:36: warning: Initializer entry defined twice
> cards4.c:631:20:   also defined here
> cards4.c:638:37: warning: Initializer entry defined twice
> cards4.c:640:20:   also defined here
> cards4.c:675:26: warning: Initializer entry defined twice
> cards4.c:676:26:   also defined here
> cards4.c:727:37: warning: Initializer entry defined twice
> cards4.c:729:20:   also defined here
> cards4.c:736:36: warning: Initializer entry defined twice
> cards4.c:738:20:   also defined here
> cards4.c:824:36: warning: Initializer entry defined twice
> cards4.c:826:20:   also defined here
> cards4.c:815:36: warning: Initializer entry defined twice
> cards4.c:817:20:   also defined here
> cards4.c:824:36: warning: Initializer entry defined twice
> cards4.c:826:20:   also defined here
> cards4.c:815:36: warning: Initializer entry defined twice
> cards4.c:817:20:   also defined here
> 
> These warnings are patently false, and removing a single entry
> (say the first one) will result in a set of warnings for different
> lines. Frankly, it looks what would happen if there is a wrong
> hash table lookup.
> 
> I am using the latest sparse code from
> git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.
> 
> 
> Regards,
> 
> 	Hans
> 
> ------------------- cut here ------------------------
> #define CX88_BOARD_UNKNOWN                  0
> #define CX88_BOARD_HAUPPAUGE                1
> #define CX88_BOARD_GDI                      2
> #define CX88_BOARD_PIXELVIEW                3
> #define CX88_BOARD_ATI_WONDER_PRO           4
> #define CX88_BOARD_WINFAST2000XP_EXPERT     5
> #define CX88_BOARD_AVERTV_STUDIO_303        6
> #define CX88_BOARD_MSI_TVANYWHERE_MASTER    7
> #define CX88_BOARD_WINFAST_DV2000           8
> #define CX88_BOARD_LEADTEK_PVR2000          9
> #define CX88_BOARD_IODATA_GVVCP3PCI        10
> #define CX88_BOARD_PROLINK_PLAYTVPVR       11
> #define CX88_BOARD_ASUS_PVR_416            12
> #define CX88_BOARD_MSI_TVANYWHERE          13
> #define CX88_BOARD_KWORLD_DVB_T            14
> #define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1 15
> #define CX88_BOARD_KWORLD_LTV883           16
> #define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q  17
> #define CX88_BOARD_HAUPPAUGE_DVB_T1        18
> #define CX88_BOARD_CONEXANT_DVB_T1         19
> #define CX88_BOARD_PROVIDEO_PV259          20
> #define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS 21
> #define CX88_BOARD_PCHDTV_HD3000           22
> #define CX88_BOARD_DNTV_LIVE_DVB_T         23
> #define CX88_BOARD_HAUPPAUGE_ROSLYN        24
> #define CX88_BOARD_DIGITALLOGIC_MEC        25
> #define CX88_BOARD_IODATA_GVBCTV7E         26
> #define CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO 27
> #define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T  28
> #define CX88_BOARD_ADSTECH_DVB_T_PCI          29
> #define CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1  30
> #define CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD 31
> #define CX88_BOARD_AVERMEDIA_ULTRATV_MC_550 32
> #define CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD 33
> #define CX88_BOARD_ATI_HDTVWONDER          34
> #define CX88_BOARD_WINFAST_DTV1000         35
> #define CX88_BOARD_AVERTV_303              36
> #define CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1  37
> #define CX88_BOARD_HAUPPAUGE_NOVASE2_S1    38
> #define CX88_BOARD_KWORLD_DVBS_100         39
> #define CX88_BOARD_HAUPPAUGE_HVR1100       40
> #define CX88_BOARD_HAUPPAUGE_HVR1100LP     41
> #define CX88_BOARD_DNTV_LIVE_DVB_T_PRO     42
> #define CX88_BOARD_KWORLD_DVB_T_CX22702    43
> #define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL 44
> #define CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT 45
> #define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID 46
> #define CX88_BOARD_PCHDTV_HD5500           47
> #define CX88_BOARD_KWORLD_MCE200_DELUXE    48
> #define CX88_BOARD_PIXELVIEW_PLAYTV_P7000  49
> #define CX88_BOARD_NPGTECH_REALTV_TOP10FM  50
> #define CX88_BOARD_WINFAST_DTV2000H        51
> #define CX88_BOARD_GENIATECH_DVBS          52
> #define CX88_BOARD_HAUPPAUGE_HVR3000       53
> #define CX88_BOARD_NORWOOD_MICRO           54
> #define CX88_BOARD_TE_DTV_250_OEM_SWANN    55
> #define CX88_BOARD_HAUPPAUGE_HVR1300       56
> #define CX88_BOARD_ADSTECH_PTV_390         57
> #define CX88_BOARD_PINNACLE_PCTV_HD_800i   58
> #define CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO 59
> #define CX88_BOARD_PINNACLE_HYBRID_PCTV    60
> #define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL 61
> #define CX88_BOARD_POWERCOLOR_REAL_ANGEL   62
> #define CX88_BOARD_GENIATECH_X8000_MT      63
> #define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO 64
> #define CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD 65
> #define CX88_BOARD_PROLINK_PV_8000GT       66
> #define CX88_BOARD_KWORLD_ATSC_120         67
> #define CX88_BOARD_HAUPPAUGE_HVR4000       68
> #define CX88_BOARD_HAUPPAUGE_HVR4000LITE   69
> #define CX88_BOARD_TEVII_S460              70
> #define CX88_BOARD_OMICOM_SS4_PCI          71
> #define CX88_BOARD_TBS_8920                72
> #define CX88_BOARD_TEVII_S420              73
> #define CX88_BOARD_PROLINK_PV_GLOBAL_XTREME 74
> #define CX88_BOARD_PROF_7300               75
> #define CX88_BOARD_SATTRADE_ST4200         76
> #define CX88_BOARD_TBS_8910                77
> #define CX88_BOARD_PROF_6200               78
> #define CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII 79
> #define CX88_BOARD_HAUPPAUGE_IRONLY        80
> #define CX88_BOARD_WINFAST_DTV1800H        81
> #define CX88_BOARD_WINFAST_DTV2000H_J      82
> #define CX88_BOARD_PROF_7301               83
> #define CX88_BOARD_SAMSUNG_SMT_7020        84
> #define CX88_BOARD_TWINHAN_VP1027_DVBS     85
> #define CX88_BOARD_TEVII_S464              86
> #define CX88_BOARD_WINFAST_DTV2000H_PLUS   87
> #define CX88_BOARD_WINFAST_DTV1800H_XC4000 88
> #define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36 89
> #define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43 90
> 
> #define MAX_CX88_INPUT 8
> 
> enum cx88_itype {
> 	CX88_VMUX_COMPOSITE1 = 1,
> 	CX88_VMUX_COMPOSITE2,
> 	CX88_VMUX_COMPOSITE3,
> 	CX88_VMUX_COMPOSITE4,
> 	CX88_VMUX_SVIDEO,
> 	CX88_VMUX_TELEVISION,
> 	CX88_VMUX_CABLE,
> 	CX88_VMUX_DVB,
> 	CX88_VMUX_DEBUG,
> 	CX88_RADIO,
> };
> 
> struct cx88_input {
> 	enum cx88_itype type;
> };
> 
> struct cx88_board {
> 	struct cx88_input       input[MAX_CX88_INPUT];
> };
> 
> static const struct cx88_board cx88_boards[] = {
> 	[CX88_BOARD_UNKNOWN] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE2,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE3,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE4,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_DEBUG,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_GDI] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PIXELVIEW] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_ATI_WONDER_PRO] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_WINFAST2000XP_EXPERT] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_AVERTV_STUDIO_303] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_MSI_TVANYWHERE_MASTER] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_WINFAST_DV2000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_LEADTEK_PVR2000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_IODATA_GVVCP3PCI] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE2,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PROLINK_PLAYTVPVR] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_ASUS_PVR_416] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_MSI_TVANYWHERE] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_DVB_T] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_LTV883] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_DEBUG,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_CABLE,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_DVB_T1] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		}},
> 	},
> 	[CX88_BOARD_CONEXANT_DVB_T1] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		}},
> 	},
> 	[CX88_BOARD_PROVIDEO_PV259] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DNTV_LIVE_DVB_T] = {
> 		.input		= {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PCHDTV_HD3000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_ROSLYN] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_DEBUG,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DIGITALLOGIC_MEC] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_IODATA_GVBCTV7E] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}}
> 	},
> 	[CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_ADSTECH_DVB_T_PCI] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_AVERMEDIA_ULTRATV_MC_550] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		},{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD] = {
> 		 .input          = {{
> 			 .type   = CX88_VMUX_COMPOSITE1,
> 		 },{
> 			 .type   = CX88_VMUX_SVIDEO,
> 		 }},
> 	},
> 	[CX88_BOARD_ATI_HDTVWONDER] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_WINFAST_DTV1000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_AVERTV_303] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1] = {
> 		.input		= {{
> 			.type	= CX88_VMUX_DVB,
> 		},{
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type	= CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_NOVASE2_S1] = {
> 		.input		= {{
> 			.type	= CX88_VMUX_DVB,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_DVBS_100] = {
> 		.input		= {{
> 			.type	= CX88_VMUX_DVB,
> 		},{
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type	= CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_HVR1100] = {
> 		.input		= {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type	= CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_HVR1100LP] = {
> 		.input		= {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		}},
> 	},
> 	[CX88_BOARD_DNTV_LIVE_DVB_T_PRO] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_DVB_T_CX22702] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		 },{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PCHDTV_HD5500] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_KWORLD_MCE200_DELUXE] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}},
> 	},
> 	[CX88_BOARD_PIXELVIEW_PLAYTV_P7000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}},
> 	},
> 	[CX88_BOARD_NPGTECH_REALTV_TOP10FM] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_WINFAST_DTV2000H] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE2,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_WINFAST_DTV2000H_J] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_GENIATECH_DVBS] = {
> 		.input  = {{
> 			.type  = CX88_VMUX_DVB,
> 		},{
> 			.type  = CX88_VMUX_COMPOSITE1,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_HVR3000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_NORWOOD_MICRO] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_TE_DTV_250_OEM_SWANN] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_HAUPPAUGE_HVR1300] = {
> 		.input		= {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type	= CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_SAMSUNG_SMT_7020] = {
> 		.input		= { {
> 			.type	= CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_ADSTECH_PTV_390] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DEBUG,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PINNACLE_PCTV_HD_800i] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_PINNACLE_HYBRID_PCTV] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_POWERCOLOR_REAL_ANGEL] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_DEBUG,
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_GENIATECH_X8000_MT] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		},{
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		},{
> 			.type   = CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PROLINK_PV_8000GT] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_PROLINK_PV_GLOBAL_XTREME] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_KWORLD_ATSC_120] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_HAUPPAUGE_HVR4000] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_HAUPPAUGE_HVR4000LITE] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TEVII_S420] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TEVII_S460] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TEVII_S464] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_OMICOM_SS4_PCI] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TBS_8910] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TBS_8920] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_PROF_6200] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_PROF_7300] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_SATTRADE_ST4200] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_HAUPPAUGE_IRONLY] = {
> 	},
> 	[CX88_BOARD_WINFAST_DTV1800H] = {
> 		.input          = {{
> 			.type   = CX88_VMUX_TELEVISION,
> 		}, {
> 			.type   = CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type   = CX88_VMUX_SVIDEO,
> 		} },
> 	},
> 	[CX88_BOARD_WINFAST_DTV1800H_XC4000] = {
> 		.input		= {{
> 			.type	= CX88_VMUX_TELEVISION,
> 		}, {
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type	= CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_WINFAST_DTV2000H_PLUS] = {
> 		.input		= {{
> 			.type	= CX88_VMUX_TELEVISION,
> 		}, {
> 			.type	= CX88_VMUX_CABLE,
> 		}, {
> 			.type	= CX88_VMUX_COMPOSITE1,
> 		}, {
> 			.type	= CX88_VMUX_SVIDEO,
> 		}},
> 	},
> 	[CX88_BOARD_PROF_7301] = {
> 		.input          = { {
> 			.type   = CX88_VMUX_DVB,
> 		} },
> 	},
> 	[CX88_BOARD_TWINHAN_VP1027_DVBS] = {
> 		.input          = {{
> 		       .type   = CX88_VMUX_DVB,
> 		} },
> 	},
> };
> ------------------- cut here ------------------------
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
> 

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Wed, 05 Nov 2014 10:49:23 +0000
Message-ID: <CANeU7QmfgPwOk0LMaUFxaH6UzA03NUizR6ybZ58NGkPEd3OkvQ () mail ! gmail ! com>
--------------------
On Wed, Nov 5, 2014 at 3:44 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> Ping!
>
> This is still failing (tested with the latest sparse v0.5.0-35-gc1c3f96
> from git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git).
>
> I'd really like to get rid of these spurious sparse warnings.

Sorry I did not know this warning still exist. There have been some
fix for similar
warnings. I just confirm that your example reproduce the warning in my sparse
tree.

I will take a look.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Wed, 05 Nov 2014 10:49:23 +0000
Message-ID: <CANeU7QmfgPwOk0LMaUFxaH6UzA03NUizR6ybZ58NGkPEd3OkvQ () mail ! gmail ! com>
--------------------
On Wed, Nov 5, 2014 at 3:44 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> Ping!
>
> This is still failing (tested with the latest sparse v0.5.0-35-gc1c3f96
> from git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git).
>
> I'd really like to get rid of these spurious sparse warnings.

Sorry I did not know this warning still exist. There have been some
fix for similar
warnings. I just confirm that your example reproduce the warning in my sparse
tree.

I will take a look.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Wed, 12 Nov 2014 15:39:20 +0000
Message-ID: <CANeU7Q=q7AL=nh2BGfHyAYqjHbMu9cu3NbR7Jkfw4wd+SPRWUA () mail ! gmail ! com>
--------------------
On Fri, Aug 29, 2014 at 4:10 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
> the kernel) gives these sparse warnings:
>
> cards4.c:447:36: warning: Initializer entry defined twice
> cards4.c:449:19:   also defined here
>
> I am using the latest sparse code from
> git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.

Thanks for the bug report. It has been puzzling for me as well.
It seems there is some duplicate entry in the expression list
for the very long initializer. The duplicate entry first show up after
the expand_symbol phase. The bug will disappear if the list is
sorter.

I have narrow it down to the sort_list() function.
If we turn on " #define PARANOIA" in sort.c.
Sparse can trigger assert fail:

sparse: sort.c:89: verify_seq_sorted: Assertion `cmp (a, b) <= 0' failed.
Aborted (core dumped)

Still need more work to fix it.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Wed, 12 Nov 2014 15:39:20 +0000
Message-ID: <CANeU7Q=q7AL=nh2BGfHyAYqjHbMu9cu3NbR7Jkfw4wd+SPRWUA () mail ! gmail ! com>
--------------------
On Fri, Aug 29, 2014 at 4:10 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
> the kernel) gives these sparse warnings:
>
> cards4.c:447:36: warning: Initializer entry defined twice
> cards4.c:449:19:   also defined here
>
> I am using the latest sparse code from
> git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.

Thanks for the bug report. It has been puzzling for me as well.
It seems there is some duplicate entry in the expression list
for the very long initializer. The duplicate entry first show up after
the expand_symbol phase. The bug will disappear if the list is
sorter.

I have narrow it down to the sort_list() function.
If we turn on " #define PARANOIA" in sort.c.
Sparse can trigger assert fail:

sparse: sort.c:89: verify_seq_sorted: Assertion `cmp (a, b) <= 0' failed.
Aborted (core dumped)

Still need more work to fix it.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Hans Verkuil <hverkuil () xs4all ! nl>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 05 Dec 2014 13:39:12 +0000
Message-ID: <5481B580.3080100 () xs4all ! nl>
--------------------
Hi Chris,

On 11/12/2014 04:39 PM, Christopher Li wrote:
> On Fri, Aug 29, 2014 at 4:10 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
>> The following test source (based on drivers/media/pci/cx88/cx88-cards.c from
>> the kernel) gives these sparse warnings:
>>
>> cards4.c:447:36: warning: Initializer entry defined twice
>> cards4.c:449:19:   also defined here
>>
>> I am using the latest sparse code from
>> git://git.kernel.org/pub/scm/devel/sparse/chrisl/sparse.git.
> 
> Thanks for the bug report. It has been puzzling for me as well.
> It seems there is some duplicate entry in the expression list
> for the very long initializer. The duplicate entry first show up after
> the expand_symbol phase. The bug will disappear if the list is
> sorter.
> 
> I have narrow it down to the sort_list() function.
> If we turn on " #define PARANOIA" in sort.c.
> Sparse can trigger assert fail:
> 
> sparse: sort.c:89: verify_seq_sorted: Assertion `cmp (a, b) <= 0' failed.
> Aborted (core dumped)
> 
> Still need more work to fix it.

Any updates on this?

Thanks,

	Hans

> 
> Chris
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
> 

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Tue, 09 Dec 2014 01:11:31 +0000
Message-ID: <CANeU7QnoNPbYsURU=4mJyGVHE2+CdxqFFdLA2TErD3JhAEqwqw () mail ! gmail ! com>
--------------------
On Fri, Dec 5, 2014 at 9:39 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> Hi Chris,
>
> Any updates on this?
>

Well, I haven't fully understand the code that merge two sorted list in place.
It is that code that cause the sorting error. One quick and dirty way to fix it
is just convert the list with more than one bucket into an array then
use qsort()
on it. That will require modify the compare function and copy the list back from
the array.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 12 Dec 2014 04:32:47 +0000
Message-ID: <CANeU7Qko4VY_hZbuuNVLbRjaiEeFAyb8VLDmew0zSz1SYrPA9w () mail ! gmail ! com>
--------------------
On Fri, Dec 5, 2014 at 9:39 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
>> Still need more work to fix it.
>
> Any updates on this?
>

The search is over.

    Ptr list sorting should use memmove instead of memcpy

    The target buffer is overlapped with source buffer.
    This cause the duplicate entry warning reported by Hans.

    Reported-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Christopher Li <sparse@chrisli.org>

diff --git a/sort.c b/sort.c
index afd7184..430ba44 100644
--- a/sort.c
+++ b/sort.c
@@ -99,7 +99,7 @@ static void verify_seq_sorted (struct ptr_list *l, int n,
        assert (nbuf >= nr);                                    \
        memcpy ((b)->list, buffer, nr * sizeof (void *));       \
        nbuf -= nr;                                             \
-       memcpy (buffer, buffer + nr, nbuf * sizeof (void *));   \
+       memmove (buffer, buffer + nr, nbuf * sizeof (void *));  \
   } while (0)


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 12 Dec 2014 04:32:47 +0000
Message-ID: <CANeU7Qko4VY_hZbuuNVLbRjaiEeFAyb8VLDmew0zSz1SYrPA9w () mail ! gmail ! com>
--------------------
On Fri, Dec 5, 2014 at 9:39 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
>> Still need more work to fix it.
>
> Any updates on this?
>

The search is over.

    Ptr list sorting should use memmove instead of memcpy

    The target buffer is overlapped with source buffer.
    This cause the duplicate entry warning reported by Hans.

    Reported-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Christopher Li <sparse@chrisli.org>

diff --git a/sort.c b/sort.c
index afd7184..430ba44 100644
--- a/sort.c
+++ b/sort.c
@@ -99,7 +99,7 @@ static void verify_seq_sorted (struct ptr_list *l, int n,
        assert (nbuf >= nr);                                    \
        memcpy ((b)->list, buffer, nr * sizeof (void *));       \
        nbuf -= nr;                                             \
-       memcpy (buffer, buffer + nr, nbuf * sizeof (void *));   \
+       memmove (buffer, buffer + nr, nbuf * sizeof (void *));  \
   } while (0)


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Hans Verkuil <hverkuil () xs4all ! nl>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 12 Dec 2014 08:04:14 +0000
Message-ID: <548AA17E.9030504 () xs4all ! nl>
--------------------
On 12/12/2014 05:32 AM, Christopher Li wrote:
> On Fri, Dec 5, 2014 at 9:39 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
>>> Still need more work to fix it.
>>
>> Any updates on this?
>>
> 
> The search is over.
> 
>     Ptr list sorting should use memmove instead of memcpy
> 
>     The target buffer is overlapped with source buffer.
>     This cause the duplicate entry warning reported by Hans.

Fantastic! This fixes the problem, now I can concentrate on getting rid
of the last few remaining sparse warnings in drivers/media.

Regards,

	Hans

> 
>     Reported-by: Hans Verkuil <hverkuil@xs4all.nl>
>     Signed-off-by: Christopher Li <sparse@chrisli.org>
> 
> diff --git a/sort.c b/sort.c
> index afd7184..430ba44 100644
> --- a/sort.c
> +++ b/sort.c
> @@ -99,7 +99,7 @@ static void verify_seq_sorted (struct ptr_list *l, int n,
>         assert (nbuf >= nr);                                    \
>         memcpy ((b)->list, buffer, nr * sizeof (void *));       \
>         nbuf -= nr;                                             \
> -       memcpy (buffer, buffer + nr, nbuf * sizeof (void *));   \
> +       memmove (buffer, buffer + nr, nbuf * sizeof (void *));  \
>    } while (0)
> 
> 
> Chris
> 

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 12 Dec 2014 08:12:10 +0000
Message-ID: <20141212081209.GA16645 () thin>
--------------------
On Fri, Dec 12, 2014 at 12:32:47PM +0800, Christopher Li wrote:
> On Fri, Dec 5, 2014 at 9:39 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> >> Still need more work to fix it.
> >
> > Any updates on this?
> >
> 
> The search is over.
> 
>     Ptr list sorting should use memmove instead of memcpy
> 
>     The target buffer is overlapped with source buffer.
>     This cause the duplicate entry warning reported by Hans.
> 
>     Reported-by: Hans Verkuil <hverkuil@xs4all.nl>
>     Signed-off-by: Christopher Li <sparse@chrisli.org>
> 
> diff --git a/sort.c b/sort.c
> index afd7184..430ba44 100644
> --- a/sort.c
> +++ b/sort.c
> @@ -99,7 +99,7 @@ static void verify_seq_sorted (struct ptr_list *l, int n,
>         assert (nbuf >= nr);                                    \
>         memcpy ((b)->list, buffer, nr * sizeof (void *));       \
>         nbuf -= nr;                                             \
> -       memcpy (buffer, buffer + nr, nbuf * sizeof (void *));   \
> +       memmove (buffer, buffer + nr, nbuf * sizeof (void *));  \
>    } while (0)

Great catch, Chris!

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: Bogus 'Initializer entry defined twice' warnings
Date: Fri, 12 Dec 2014 08:12:10 +0000
Message-ID: <20141212081209.GA16645 () thin>
--------------------
On Fri, Dec 12, 2014 at 12:32:47PM +0800, Christopher Li wrote:
> On Fri, Dec 5, 2014 at 9:39 PM, Hans Verkuil <hverkuil@xs4all.nl> wrote:
> >> Still need more work to fix it.
> >
> > Any updates on this?
> >
> 
> The search is over.
> 
>     Ptr list sorting should use memmove instead of memcpy
> 
>     The target buffer is overlapped with source buffer.
>     This cause the duplicate entry warning reported by Hans.
> 
>     Reported-by: Hans Verkuil <hverkuil@xs4all.nl>
>     Signed-off-by: Christopher Li <sparse@chrisli.org>
> 
> diff --git a/sort.c b/sort.c
> index afd7184..430ba44 100644
> --- a/sort.c
> +++ b/sort.c
> @@ -99,7 +99,7 @@ static void verify_seq_sorted (struct ptr_list *l, int n,
>         assert (nbuf >= nr);                                    \
>         memcpy ((b)->list, buffer, nr * sizeof (void *));       \
>         nbuf -= nr;                                             \
> -       memcpy (buffer, buffer + nr, nbuf * sizeof (void *));   \
> +       memmove (buffer, buffer + nr, nbuf * sizeof (void *));  \
>    } while (0)

Great catch, Chris!

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Designated initializers for fields in anonymous structs and unions ===

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Thu, 31 Jul 2014 18:39:02 +0000
Message-ID: <CA+55aFxptOTqCR9b0o8sEKwzyQOU0rfKTptRY5s=j5R_X=UdUg () mail ! gmail ! com>
--------------------
--bcaec529a00741195c04ff819650
Content-Type: text/plain; charset=UTF-8

On Thu, Jul 31, 2014 at 11:10 AM,  <josh@joshtriplett.org> wrote:
> GCC 4.6 and newer support initializing designated initializers for fields in
> anonymous structs and unions.  However, sparse does not.

I sent patches for this back in April, based on a report from Hans
Verkuil. My patches fixed the parsing part, but had a (known) bug with
getting the offsets right, so your test-case actually retulrs in

  t.c:23:6: warning: Initializer entry defined twice
  t.c:24:6:   also defined here

because the offset calculation for "b" was wrong, and as a result
sparse thinks "a" and "b" overlap. John Keeping had a patch that tried
to fix that too.

I think they are all in

   https://github.com/johnkeeping/sparse/

but not in the "official" sparse tree, which hasn't seen any work
since January afaik. Maybe there are other trees than John's..

I'm attaching my set of sparse patches from early April in case
anybody wants to look at them. No guarantees, and as mentioned there's
t least an offset bug, but they should be an improvement, at least.

                    Linus

--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-Add-warning-about-duplicate-initializers.patch"
Content-Disposition: attachment; 
	filename="0001-Add-warning-about-duplicate-initializers.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7ug0

RnJvbSBkMjQ1NzA5YjA3NGM4ZDA3ZGJhNjFiNGE0NzUxNDhkNDU0OWUzNjk3IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFN1biwgMzAgTWFyIDIwMTQgMDk6NDk6MTMgLTA3MDAKU3ViamVjdDog
W1BBVENIIDEvNF0gQWRkIHdhcm5pbmcgYWJvdXQgZHVwbGljYXRlIGluaXRpYWxpemVycwoKTm90
aWNlZCB0aGlzIHdoaWxlIGxvb2tpbmcgYXQgYW4gaW5kZXBlbmRlbnQgYnVnIHJlcG9ydGVkIGJ5
IEhhbnMKVmVya3VpbC4KClNpZ25lZC1vZmYtYnk6IExpbnVzIFRvcnZhbGRzIDx0b3J2YWxkc0Bs
aW51eC1mb3VuZGF0aW9uLm9yZz4KLS0tCiBldmFsdWF0ZS5jIHwgOCArKysrKysrKwogMSBmaWxl
IGNoYW5nZWQsIDggaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2V2YWx1YXRlLmMgYi9ldmFs
dWF0ZS5jCmluZGV4IDY2NTU2MTUwZGRhYy4uOGE1M2IzZTg4NGUwIDEwMDY0NAotLS0gYS9ldmFs
dWF0ZS5jCisrKyBiL2V2YWx1YXRlLmMKQEAgLTMwNDMsMTAgKzMwNDMsMTggQEAgc3RhdGljIHZv
aWQgY2hlY2tfZHVwbGljYXRlcyhzdHJ1Y3Qgc3ltYm9sICpzeW0pCiB7CiAJaW50IGRlY2xhcmVk
ID0gMDsKIAlzdHJ1Y3Qgc3ltYm9sICpuZXh0ID0gc3ltOworCWludCBpbml0aWFsaXplZCA9IHN5
bS0+aW5pdGlhbGl6ZXIgIT0gTlVMTDsKIAogCXdoaWxlICgobmV4dCA9IG5leHQtPnNhbWVfc3lt
Ym9sKSAhPSBOVUxMKSB7CiAJCWNvbnN0IGNoYXIgKnR5cGVkaWZmOwogCQlldmFsdWF0ZV9zeW1i
b2wobmV4dCk7CisJCWlmIChpbml0aWFsaXplZCAmJiBuZXh0LT5pbml0aWFsaXplcikgeworCQkJ
c3BhcnNlX2Vycm9yKHN5bS0+cG9zLCAic3ltYm9sICclcycgaGFzIG11bHRpcGxlIGluaXRpYWxp
emVycyAob3JpZ2luYWxseSBpbml0aWFsaXplZCBhdCAlczolZCkiLAorCQkJCXNob3dfaWRlbnQo
c3ltLT5pZGVudCksCisJCQkJc3RyZWFtX25hbWUobmV4dC0+cG9zLnN0cmVhbSksIG5leHQtPnBv
cy5saW5lKTsKKwkJCS8qIE9ubHkgd2FybiBvbmNlICovCisJCQlpbml0aWFsaXplZCA9IDA7CisJ
CX0KIAkJZGVjbGFyZWQrKzsKIAkJdHlwZWRpZmYgPSB0eXBlX2RpZmZlcmVuY2UoJnN5bS0+Y3R5
cGUsICZuZXh0LT5jdHlwZSwgMCwgMCk7CiAJCWlmICh0eXBlZGlmZikgewotLSAKMi4wLjEuNDI3
LmdjNDczNzJkCgo=
--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0002-Use-any-previous-initializer-to-size-a-symbol.patch"
Content-Disposition: attachment; 
	filename="0002-Use-any-previous-initializer-to-size-a-symbol.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7us1

RnJvbSAxNzEzOWU1ZDdhMzVjNGIxNzkzMjIxZjA3M2E0ZjU0M2YwMGIxY2ZhIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFN1biwgMzAgTWFyIDIwMTQgMTA6MTM6NTQgLTA3MDAKU3ViamVjdDog
W1BBVENIIDIvNF0gVXNlIGFueSBwcmV2aW91cyBpbml0aWFsaXplciB0byBzaXplIGEgc3ltYm9s
CgpXaGVuIHdlIHNpemUgYSBzeW1ib2wsIHdlIG9ubHkgaGF2ZSBvbmUgaW5pdGlhbGl6ZXIgcGVy
IHN5bWJvbCwgYnV0IHdlCm1heSBoYXZlIG11bHRpcGxlIHN5bWJvbCBkZWNsYXJhdGlvbnMgZm9y
IHRoZSBzYW1lIHN5bWJvbC4gIFNvIG1ha2Ugc3VyZQp0byB3YWxrIHRoZSAic2FtZV9zeW1ib2wi
IGNoYWluIHRvIGZpbmQgdGhlIGluaXRpYWxpemVyLCByYXRoZXIgdGhhbgphc3N1bWluZyBpdCBp
cyBhdHRhY2hlZCB0byB0aGUgY3VycmVudCBkZWNsYXJhdGlvbi4KClJlcG9ydGVkLWJ5OiBIYW5z
IFZlcmt1aWwgPGh2ZXJrdWlsQHhzNGFsbC5ubD4KU2lnbmVkLW9mZi1ieTogTGludXMgVG9ydmFs
ZHMgPHRvcnZhbGRzQGxpbnV4LWZvdW5kYXRpb24ub3JnPgotLS0KIHN5bWJvbC5jIHwgMjQgKysr
KysrKysrKysrKysrKysrLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMTggaW5zZXJ0aW9ucygrKSwg
NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zeW1ib2wuYyBiL3N5bWJvbC5jCmluZGV4IGVi
NmUxMjE1ZWU4Ny4uNGI5MWFiZDgwMjFlIDEwMDY0NAotLS0gYS9zeW1ib2wuYworKysgYi9zeW1i
b2wuYwpAQCAtMzU0LDYgKzM1NCwxNSBAQCBzdGF0aWMgaW50IGNvdW50X2FycmF5X2luaXRpYWxp
emVyKHN0cnVjdCBzeW1ib2wgKnQsIHN0cnVjdCBleHByZXNzaW9uICpleHByKQogCXJldHVybiBu
cjsKIH0KIAorc3RhdGljIHN0cnVjdCBleHByZXNzaW9uICpnZXRfc3ltYm9sX2luaXRpYWxpemVy
KHN0cnVjdCBzeW1ib2wgKnN5bSkKK3sKKwlkbyB7CisJCWlmIChzeW0tPmluaXRpYWxpemVyKQor
CQkJcmV0dXJuIHN5bS0+aW5pdGlhbGl6ZXI7CisJfSB3aGlsZSAoKHN5bSA9IHN5bS0+c2FtZV9z
eW1ib2wpICE9IE5VTEwpOworCXJldHVybiBOVUxMOworfQorCiBzdGF0aWMgc3RydWN0IHN5bWJv
bCAqIGV4YW1pbmVfbm9kZV90eXBlKHN0cnVjdCBzeW1ib2wgKnN5bSkKIHsKIAlzdHJ1Y3Qgc3lt
Ym9sICpiYXNlX3R5cGUgPSBleGFtaW5lX2Jhc2VfdHlwZShzeW0pOwpAQCAtMzc2LDEyICszODUs
MTUgQEAgc3RhdGljIHN0cnVjdCBzeW1ib2wgKiBleGFtaW5lX25vZGVfdHlwZShzdHJ1Y3Qgc3lt
Ym9sICpzeW0pCiAJCXN5bS0+Y3R5cGUuYWxpZ25tZW50ID0gYWxpZ25tZW50OwogCiAJLyogVW5z
aXplZCBhcnJheT8gVGhlIHNpemUgbWlnaHQgY29tZSBmcm9tIHRoZSBpbml0aWFsaXplci4uICov
Ci0JaWYgKGJpdF9zaXplIDwgMCAmJiBiYXNlX3R5cGUtPnR5cGUgPT0gU1lNX0FSUkFZICYmIHN5
bS0+aW5pdGlhbGl6ZXIpIHsKLQkJc3RydWN0IHN5bWJvbCAqbm9kZV90eXBlID0gYmFzZV90eXBl
LT5jdHlwZS5iYXNlX3R5cGU7Ci0JCWludCBjb3VudCA9IGNvdW50X2FycmF5X2luaXRpYWxpemVy
KG5vZGVfdHlwZSwgc3ltLT5pbml0aWFsaXplcik7Ci0KLQkJaWYgKG5vZGVfdHlwZSAmJiBub2Rl
X3R5cGUtPmJpdF9zaXplID49IDApCi0JCQliaXRfc2l6ZSA9IG5vZGVfdHlwZS0+Yml0X3NpemUg
KiBjb3VudDsKKwlpZiAoYml0X3NpemUgPCAwICYmIGJhc2VfdHlwZS0+dHlwZSA9PSBTWU1fQVJS
QVkpIHsKKwkJc3RydWN0IGV4cHJlc3Npb24gKmluaXRpYWxpemVyID0gZ2V0X3N5bWJvbF9pbml0
aWFsaXplcihzeW0pOworCQlpZiAoaW5pdGlhbGl6ZXIpIHsKKwkJCXN0cnVjdCBzeW1ib2wgKm5v
ZGVfdHlwZSA9IGJhc2VfdHlwZS0+Y3R5cGUuYmFzZV90eXBlOworCQkJaW50IGNvdW50ID0gY291
bnRfYXJyYXlfaW5pdGlhbGl6ZXIobm9kZV90eXBlLCBpbml0aWFsaXplcik7CisKKwkJCWlmIChu
b2RlX3R5cGUgJiYgbm9kZV90eXBlLT5iaXRfc2l6ZSA+PSAwKQorCQkJCWJpdF9zaXplID0gbm9k
ZV90eXBlLT5iaXRfc2l6ZSAqIGNvdW50OworCQl9CiAJfQogCQogCXN5bS0+Yml0X3NpemUgPSBi
aXRfc2l6ZTsKLS0gCjIuMC4xLjQyNy5nYzQ3MzcyZAoK
--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0003-Allow-named-initializers-for-anonymous-union-members.patch"
Content-Disposition: attachment; 
	filename="0003-Allow-named-initializers-for-anonymous-union-members.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7ux2

RnJvbSA1ZTg3MGY3ZmE1MzVjMDNhYzJjMWFlNzg0NzkzMjdkMTEyYzI1NjRlIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFR1ZSwgMSBBcHIgMjAxNCAxMDoxODo1OSAtMDcwMApTdWJqZWN0OiBb
UEFUQ0ggMy80XSBBbGxvdyBuYW1lZCBpbml0aWFsaXplcnMgZm9yIGFub255bW91cyB1bmlvbiBt
ZW1iZXJzCgpUaGUgaW5pdGlhbGl6ZXIgdHlwZSBldmFsdWF0aW9uIGRpZG4ndCB1c2UgdGhlIGZ1
bmN0aW9uIHRoYXQga25ldyBhYm91dApyZWN1cnNpdmVseSBsb29raW5nIGZvciBtZW1iZXIgbmFt
ZXMgaW4gYW5vbnltb3VzIHVuaW9ucyBhbmQgc3RydWN0cy4KClNpZ25lZC1vZmYtYnk6IExpbnVz
IFRvcnZhbGRzIDx0b3J2YWxkc0BsaW51eC1mb3VuZGF0aW9uLm9yZz4KLS0tCiBldmFsdWF0ZS5j
IHwgMTQgKystLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyIGluc2VydGlvbnMoKyksIDEy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2V2YWx1YXRlLmMgYi9ldmFsdWF0ZS5jCmluZGV4
IDhhNTNiM2U4ODRlMC4uNWFkZmMxZTNmZjI2IDEwMDY0NAotLS0gYS9ldmFsdWF0ZS5jCisrKyBi
L2V2YWx1YXRlLmMKQEAgLTIxNzEsMTcgKzIxNzEsNiBAQCBzdGF0aWMgaW50IGV2YWx1YXRlX2Fy
Z3VtZW50cyhzdHJ1Y3Qgc3ltYm9sICpmLCBzdHJ1Y3Qgc3ltYm9sICpmbiwgc3RydWN0IGV4cHJl
cwogCXJldHVybiAxOwogfQogCi1zdGF0aWMgc3RydWN0IHN5bWJvbCAqZmluZF9zdHJ1Y3RfaWRl
bnQoc3RydWN0IHN5bWJvbCAqY3R5cGUsIHN0cnVjdCBpZGVudCAqaWRlbnQpCi17Ci0Jc3RydWN0
IHN5bWJvbCAqc3ltOwotCi0JRk9SX0VBQ0hfUFRSKGN0eXBlLT5zeW1ib2xfbGlzdCwgc3ltKSB7
Ci0JCWlmIChzeW0tPmlkZW50ID09IGlkZW50KQotCQkJcmV0dXJuIHN5bTsKLQl9IEVORF9GT1Jf
RUFDSF9QVFIoc3ltKTsKLQlyZXR1cm4gTlVMTDsKLX0KLQogc3RhdGljIHZvaWQgY29udmVydF9p
bmRleChzdHJ1Y3QgZXhwcmVzc2lvbiAqZSkKIHsKIAlzdHJ1Y3QgZXhwcmVzc2lvbiAqY2hpbGQg
PSBlLT5pZHhfZXhwcmVzc2lvbjsKQEAgLTIyOTAsMTEgKzIyNzksMTIgQEAgc3RhdGljIHN0cnVj
dCBleHByZXNzaW9uICpjaGVja19kZXNpZ25hdG9ycyhzdHJ1Y3QgZXhwcmVzc2lvbiAqZSwKIAkJ
CX0KIAkJCWUgPSBlLT5pZHhfZXhwcmVzc2lvbjsKIAkJfSBlbHNlIGlmIChlLT50eXBlID09IEVY
UFJfSURFTlRJRklFUikgeworCQkJaW50IG9mZnNldCA9IDA7CiAJCQlpZiAoY3R5cGUtPnR5cGUg
IT0gU1lNX1NUUlVDVCAmJiBjdHlwZS0+dHlwZSAhPSBTWU1fVU5JT04pIHsKIAkJCQllcnIgPSAi
ZmllbGQgbmFtZSBub3QgaW4gc3RydWN0IG9yIHVuaW9uIjsKIAkJCQlicmVhazsKIAkJCX0KLQkJ
CWN0eXBlID0gZmluZF9zdHJ1Y3RfaWRlbnQoY3R5cGUsIGUtPmV4cHJfaWRlbnQpOworCQkJY3R5
cGUgPSBmaW5kX2lkZW50aWZpZXIoZS0+ZXhwcl9pZGVudCwgY3R5cGUtPnN5bWJvbF9saXN0LCAm
b2Zmc2V0KTsKIAkJCWlmICghY3R5cGUpIHsKIAkJCQllcnIgPSAidW5rbm93biBmaWVsZCBuYW1l
IGluIjsKIAkJCQlicmVhazsKLS0gCjIuMC4xLjQyNy5nYzQ3MzcyZAoK
--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0004-Fix-scoping-of-extern-symbols-in-block-scope.patch"
Content-Disposition: attachment; 
	filename="0004-Fix-scoping-of-extern-symbols-in-block-scope.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7v03

RnJvbSBjMDExNTk3ZmY2Nzc2NWRhNWRhY2I0NzJkZGJkNjlkYzRiNTE0MTZkIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFR1ZSwgMSBBcHIgMjAxNCAxMDoyMDozNCAtMDcwMApTdWJqZWN0OiBb
UEFUQ0ggNC80XSBGaXggc2NvcGluZyBvZiBleHRlcm4gc3ltYm9scyBpbiBibG9jayBzY29wZQoK
V2UnZCBvbmx5IG1hdGNoIHRoZW0gd2l0aCBvdGhlciBzeW1ib2xzIG1hcmtlZCAnZXh0ZXJuJywg
YnV0IHJlYWxseSwgd2UKc2hvdWxkIG1hdGNoIHRoZW0gd2l0aCBhbnkgdG9wLWxldmVsIG5vbi1z
dGF0aWMgc3ltYm9sLgoKU2lnbmVkLW9mZi1ieTogTGludXMgVG9ydmFsZHMgPHRvcnZhbGRzQGxp
bnV4LWZvdW5kYXRpb24ub3JnPgotLS0KIHN5bWJvbC5jIHwgMTQgKysrKysrKysrLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCA5IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvc3ltYm9sLmMgYi9zeW1ib2wuYwppbmRleCA0YjkxYWJkODAyMWUuLmM1ZTQ3ODQ3MzRhOCAx
MDA2NDQKLS0tIGEvc3ltYm9sLmMKKysrIGIvc3ltYm9sLmMKQEAgLTU3NiwxMSArNTc2LDE1IEBA
IHZvaWQgY2hlY2tfZGVjbGFyYXRpb24oc3RydWN0IHN5bWJvbCAqc3ltKQogCQkJc3ltLT5zYW1l
X3N5bWJvbCA9IG5leHQ7CiAJCQlyZXR1cm47CiAJCX0KLQkJaWYgKHN5bS0+Y3R5cGUubW9kaWZp
ZXJzICYgbmV4dC0+Y3R5cGUubW9kaWZpZXJzICYgTU9EX0VYVEVSTikgewotCQkJaWYgKChzeW0t
PmN0eXBlLm1vZGlmaWVycyBeIG5leHQtPmN0eXBlLm1vZGlmaWVycykgJiBNT0RfSU5MSU5FKQot
CQkJCWNvbnRpbnVlOwotCQkJc3ltLT5zYW1lX3N5bWJvbCA9IG5leHQ7Ci0JCQlyZXR1cm47CisJ
CS8qIEV4dGVybiBpbiBibG9jayBsZXZlbCBtYXRjaGVzIGEgVE9QTEVWRUwgbm9uLXN0YXRpYyBz
eW1ib2wgKi8KKwkJaWYgKHN5bS0+Y3R5cGUubW9kaWZpZXJzICYgTU9EX0VYVEVSTikgeworCQkJ
aWYgKChuZXh0LT5jdHlwZS5tb2RpZmllcnMgJiAoTU9EX1RPUExFVkVMfE1PRF9TVEFUSUMpKSA9
PSBNT0RfVE9QTEVWRUwpIHsKKwkJCQkvKiBGSVhNRT8gRGlmZmVycyBpbiAnaW5saW5lJyBvbmx5
PyBXaHkgZG9lcyB0aGF0IG1hdHRlcj8gKi8KKwkJCQlpZiAoKHN5bS0+Y3R5cGUubW9kaWZpZXJz
IF4gbmV4dC0+Y3R5cGUubW9kaWZpZXJzKSAmIE1PRF9JTkxJTkUpCisJCQkJCWNvbnRpbnVlOwor
CQkJCXN5bS0+c2FtZV9zeW1ib2wgPSBuZXh0OworCQkJCXJldHVybjsKKwkJCX0KIAkJfQogCiAJ
CWlmICghV3NoYWRvdyB8fCB3YXJuZWQpCi0tIAoyLjAuMS40MjcuZ2M0NzM3MmQKCg==
--bcaec529a00741195c04ff819650--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Thu, 31 Jul 2014 18:39:02 +0000
Message-ID: <CA+55aFxptOTqCR9b0o8sEKwzyQOU0rfKTptRY5s=j5R_X=UdUg () mail ! gmail ! com>
--------------------
--bcaec529a00741195c04ff819650
Content-Type: text/plain; charset=UTF-8

On Thu, Jul 31, 2014 at 11:10 AM,  <josh@joshtriplett.org> wrote:
> GCC 4.6 and newer support initializing designated initializers for fields in
> anonymous structs and unions.  However, sparse does not.

I sent patches for this back in April, based on a report from Hans
Verkuil. My patches fixed the parsing part, but had a (known) bug with
getting the offsets right, so your test-case actually retulrs in

  t.c:23:6: warning: Initializer entry defined twice
  t.c:24:6:   also defined here

because the offset calculation for "b" was wrong, and as a result
sparse thinks "a" and "b" overlap. John Keeping had a patch that tried
to fix that too.

I think they are all in

   https://github.com/johnkeeping/sparse/

but not in the "official" sparse tree, which hasn't seen any work
since January afaik. Maybe there are other trees than John's..

I'm attaching my set of sparse patches from early April in case
anybody wants to look at them. No guarantees, and as mentioned there's
t least an offset bug, but they should be an improvement, at least.

                    Linus

--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-Add-warning-about-duplicate-initializers.patch"
Content-Disposition: attachment; 
	filename="0001-Add-warning-about-duplicate-initializers.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7ug0

RnJvbSBkMjQ1NzA5YjA3NGM4ZDA3ZGJhNjFiNGE0NzUxNDhkNDU0OWUzNjk3IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFN1biwgMzAgTWFyIDIwMTQgMDk6NDk6MTMgLTA3MDAKU3ViamVjdDog
W1BBVENIIDEvNF0gQWRkIHdhcm5pbmcgYWJvdXQgZHVwbGljYXRlIGluaXRpYWxpemVycwoKTm90
aWNlZCB0aGlzIHdoaWxlIGxvb2tpbmcgYXQgYW4gaW5kZXBlbmRlbnQgYnVnIHJlcG9ydGVkIGJ5
IEhhbnMKVmVya3VpbC4KClNpZ25lZC1vZmYtYnk6IExpbnVzIFRvcnZhbGRzIDx0b3J2YWxkc0Bs
aW51eC1mb3VuZGF0aW9uLm9yZz4KLS0tCiBldmFsdWF0ZS5jIHwgOCArKysrKysrKwogMSBmaWxl
IGNoYW5nZWQsIDggaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2V2YWx1YXRlLmMgYi9ldmFs
dWF0ZS5jCmluZGV4IDY2NTU2MTUwZGRhYy4uOGE1M2IzZTg4NGUwIDEwMDY0NAotLS0gYS9ldmFs
dWF0ZS5jCisrKyBiL2V2YWx1YXRlLmMKQEAgLTMwNDMsMTAgKzMwNDMsMTggQEAgc3RhdGljIHZv
aWQgY2hlY2tfZHVwbGljYXRlcyhzdHJ1Y3Qgc3ltYm9sICpzeW0pCiB7CiAJaW50IGRlY2xhcmVk
ID0gMDsKIAlzdHJ1Y3Qgc3ltYm9sICpuZXh0ID0gc3ltOworCWludCBpbml0aWFsaXplZCA9IHN5
bS0+aW5pdGlhbGl6ZXIgIT0gTlVMTDsKIAogCXdoaWxlICgobmV4dCA9IG5leHQtPnNhbWVfc3lt
Ym9sKSAhPSBOVUxMKSB7CiAJCWNvbnN0IGNoYXIgKnR5cGVkaWZmOwogCQlldmFsdWF0ZV9zeW1i
b2wobmV4dCk7CisJCWlmIChpbml0aWFsaXplZCAmJiBuZXh0LT5pbml0aWFsaXplcikgeworCQkJ
c3BhcnNlX2Vycm9yKHN5bS0+cG9zLCAic3ltYm9sICclcycgaGFzIG11bHRpcGxlIGluaXRpYWxp
emVycyAob3JpZ2luYWxseSBpbml0aWFsaXplZCBhdCAlczolZCkiLAorCQkJCXNob3dfaWRlbnQo
c3ltLT5pZGVudCksCisJCQkJc3RyZWFtX25hbWUobmV4dC0+cG9zLnN0cmVhbSksIG5leHQtPnBv
cy5saW5lKTsKKwkJCS8qIE9ubHkgd2FybiBvbmNlICovCisJCQlpbml0aWFsaXplZCA9IDA7CisJ
CX0KIAkJZGVjbGFyZWQrKzsKIAkJdHlwZWRpZmYgPSB0eXBlX2RpZmZlcmVuY2UoJnN5bS0+Y3R5
cGUsICZuZXh0LT5jdHlwZSwgMCwgMCk7CiAJCWlmICh0eXBlZGlmZikgewotLSAKMi4wLjEuNDI3
LmdjNDczNzJkCgo=
--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0002-Use-any-previous-initializer-to-size-a-symbol.patch"
Content-Disposition: attachment; 
	filename="0002-Use-any-previous-initializer-to-size-a-symbol.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7us1

RnJvbSAxNzEzOWU1ZDdhMzVjNGIxNzkzMjIxZjA3M2E0ZjU0M2YwMGIxY2ZhIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFN1biwgMzAgTWFyIDIwMTQgMTA6MTM6NTQgLTA3MDAKU3ViamVjdDog
W1BBVENIIDIvNF0gVXNlIGFueSBwcmV2aW91cyBpbml0aWFsaXplciB0byBzaXplIGEgc3ltYm9s
CgpXaGVuIHdlIHNpemUgYSBzeW1ib2wsIHdlIG9ubHkgaGF2ZSBvbmUgaW5pdGlhbGl6ZXIgcGVy
IHN5bWJvbCwgYnV0IHdlCm1heSBoYXZlIG11bHRpcGxlIHN5bWJvbCBkZWNsYXJhdGlvbnMgZm9y
IHRoZSBzYW1lIHN5bWJvbC4gIFNvIG1ha2Ugc3VyZQp0byB3YWxrIHRoZSAic2FtZV9zeW1ib2wi
IGNoYWluIHRvIGZpbmQgdGhlIGluaXRpYWxpemVyLCByYXRoZXIgdGhhbgphc3N1bWluZyBpdCBp
cyBhdHRhY2hlZCB0byB0aGUgY3VycmVudCBkZWNsYXJhdGlvbi4KClJlcG9ydGVkLWJ5OiBIYW5z
IFZlcmt1aWwgPGh2ZXJrdWlsQHhzNGFsbC5ubD4KU2lnbmVkLW9mZi1ieTogTGludXMgVG9ydmFs
ZHMgPHRvcnZhbGRzQGxpbnV4LWZvdW5kYXRpb24ub3JnPgotLS0KIHN5bWJvbC5jIHwgMjQgKysr
KysrKysrKysrKysrKysrLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMTggaW5zZXJ0aW9ucygrKSwg
NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zeW1ib2wuYyBiL3N5bWJvbC5jCmluZGV4IGVi
NmUxMjE1ZWU4Ny4uNGI5MWFiZDgwMjFlIDEwMDY0NAotLS0gYS9zeW1ib2wuYworKysgYi9zeW1i
b2wuYwpAQCAtMzU0LDYgKzM1NCwxNSBAQCBzdGF0aWMgaW50IGNvdW50X2FycmF5X2luaXRpYWxp
emVyKHN0cnVjdCBzeW1ib2wgKnQsIHN0cnVjdCBleHByZXNzaW9uICpleHByKQogCXJldHVybiBu
cjsKIH0KIAorc3RhdGljIHN0cnVjdCBleHByZXNzaW9uICpnZXRfc3ltYm9sX2luaXRpYWxpemVy
KHN0cnVjdCBzeW1ib2wgKnN5bSkKK3sKKwlkbyB7CisJCWlmIChzeW0tPmluaXRpYWxpemVyKQor
CQkJcmV0dXJuIHN5bS0+aW5pdGlhbGl6ZXI7CisJfSB3aGlsZSAoKHN5bSA9IHN5bS0+c2FtZV9z
eW1ib2wpICE9IE5VTEwpOworCXJldHVybiBOVUxMOworfQorCiBzdGF0aWMgc3RydWN0IHN5bWJv
bCAqIGV4YW1pbmVfbm9kZV90eXBlKHN0cnVjdCBzeW1ib2wgKnN5bSkKIHsKIAlzdHJ1Y3Qgc3lt
Ym9sICpiYXNlX3R5cGUgPSBleGFtaW5lX2Jhc2VfdHlwZShzeW0pOwpAQCAtMzc2LDEyICszODUs
MTUgQEAgc3RhdGljIHN0cnVjdCBzeW1ib2wgKiBleGFtaW5lX25vZGVfdHlwZShzdHJ1Y3Qgc3lt
Ym9sICpzeW0pCiAJCXN5bS0+Y3R5cGUuYWxpZ25tZW50ID0gYWxpZ25tZW50OwogCiAJLyogVW5z
aXplZCBhcnJheT8gVGhlIHNpemUgbWlnaHQgY29tZSBmcm9tIHRoZSBpbml0aWFsaXplci4uICov
Ci0JaWYgKGJpdF9zaXplIDwgMCAmJiBiYXNlX3R5cGUtPnR5cGUgPT0gU1lNX0FSUkFZICYmIHN5
bS0+aW5pdGlhbGl6ZXIpIHsKLQkJc3RydWN0IHN5bWJvbCAqbm9kZV90eXBlID0gYmFzZV90eXBl
LT5jdHlwZS5iYXNlX3R5cGU7Ci0JCWludCBjb3VudCA9IGNvdW50X2FycmF5X2luaXRpYWxpemVy
KG5vZGVfdHlwZSwgc3ltLT5pbml0aWFsaXplcik7Ci0KLQkJaWYgKG5vZGVfdHlwZSAmJiBub2Rl
X3R5cGUtPmJpdF9zaXplID49IDApCi0JCQliaXRfc2l6ZSA9IG5vZGVfdHlwZS0+Yml0X3NpemUg
KiBjb3VudDsKKwlpZiAoYml0X3NpemUgPCAwICYmIGJhc2VfdHlwZS0+dHlwZSA9PSBTWU1fQVJS
QVkpIHsKKwkJc3RydWN0IGV4cHJlc3Npb24gKmluaXRpYWxpemVyID0gZ2V0X3N5bWJvbF9pbml0
aWFsaXplcihzeW0pOworCQlpZiAoaW5pdGlhbGl6ZXIpIHsKKwkJCXN0cnVjdCBzeW1ib2wgKm5v
ZGVfdHlwZSA9IGJhc2VfdHlwZS0+Y3R5cGUuYmFzZV90eXBlOworCQkJaW50IGNvdW50ID0gY291
bnRfYXJyYXlfaW5pdGlhbGl6ZXIobm9kZV90eXBlLCBpbml0aWFsaXplcik7CisKKwkJCWlmIChu
b2RlX3R5cGUgJiYgbm9kZV90eXBlLT5iaXRfc2l6ZSA+PSAwKQorCQkJCWJpdF9zaXplID0gbm9k
ZV90eXBlLT5iaXRfc2l6ZSAqIGNvdW50OworCQl9CiAJfQogCQogCXN5bS0+Yml0X3NpemUgPSBi
aXRfc2l6ZTsKLS0gCjIuMC4xLjQyNy5nYzQ3MzcyZAoK
--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0003-Allow-named-initializers-for-anonymous-union-members.patch"
Content-Disposition: attachment; 
	filename="0003-Allow-named-initializers-for-anonymous-union-members.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7ux2

RnJvbSA1ZTg3MGY3ZmE1MzVjMDNhYzJjMWFlNzg0NzkzMjdkMTEyYzI1NjRlIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFR1ZSwgMSBBcHIgMjAxNCAxMDoxODo1OSAtMDcwMApTdWJqZWN0OiBb
UEFUQ0ggMy80XSBBbGxvdyBuYW1lZCBpbml0aWFsaXplcnMgZm9yIGFub255bW91cyB1bmlvbiBt
ZW1iZXJzCgpUaGUgaW5pdGlhbGl6ZXIgdHlwZSBldmFsdWF0aW9uIGRpZG4ndCB1c2UgdGhlIGZ1
bmN0aW9uIHRoYXQga25ldyBhYm91dApyZWN1cnNpdmVseSBsb29raW5nIGZvciBtZW1iZXIgbmFt
ZXMgaW4gYW5vbnltb3VzIHVuaW9ucyBhbmQgc3RydWN0cy4KClNpZ25lZC1vZmYtYnk6IExpbnVz
IFRvcnZhbGRzIDx0b3J2YWxkc0BsaW51eC1mb3VuZGF0aW9uLm9yZz4KLS0tCiBldmFsdWF0ZS5j
IHwgMTQgKystLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyIGluc2VydGlvbnMoKyksIDEy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2V2YWx1YXRlLmMgYi9ldmFsdWF0ZS5jCmluZGV4
IDhhNTNiM2U4ODRlMC4uNWFkZmMxZTNmZjI2IDEwMDY0NAotLS0gYS9ldmFsdWF0ZS5jCisrKyBi
L2V2YWx1YXRlLmMKQEAgLTIxNzEsMTcgKzIxNzEsNiBAQCBzdGF0aWMgaW50IGV2YWx1YXRlX2Fy
Z3VtZW50cyhzdHJ1Y3Qgc3ltYm9sICpmLCBzdHJ1Y3Qgc3ltYm9sICpmbiwgc3RydWN0IGV4cHJl
cwogCXJldHVybiAxOwogfQogCi1zdGF0aWMgc3RydWN0IHN5bWJvbCAqZmluZF9zdHJ1Y3RfaWRl
bnQoc3RydWN0IHN5bWJvbCAqY3R5cGUsIHN0cnVjdCBpZGVudCAqaWRlbnQpCi17Ci0Jc3RydWN0
IHN5bWJvbCAqc3ltOwotCi0JRk9SX0VBQ0hfUFRSKGN0eXBlLT5zeW1ib2xfbGlzdCwgc3ltKSB7
Ci0JCWlmIChzeW0tPmlkZW50ID09IGlkZW50KQotCQkJcmV0dXJuIHN5bTsKLQl9IEVORF9GT1Jf
RUFDSF9QVFIoc3ltKTsKLQlyZXR1cm4gTlVMTDsKLX0KLQogc3RhdGljIHZvaWQgY29udmVydF9p
bmRleChzdHJ1Y3QgZXhwcmVzc2lvbiAqZSkKIHsKIAlzdHJ1Y3QgZXhwcmVzc2lvbiAqY2hpbGQg
PSBlLT5pZHhfZXhwcmVzc2lvbjsKQEAgLTIyOTAsMTEgKzIyNzksMTIgQEAgc3RhdGljIHN0cnVj
dCBleHByZXNzaW9uICpjaGVja19kZXNpZ25hdG9ycyhzdHJ1Y3QgZXhwcmVzc2lvbiAqZSwKIAkJ
CX0KIAkJCWUgPSBlLT5pZHhfZXhwcmVzc2lvbjsKIAkJfSBlbHNlIGlmIChlLT50eXBlID09IEVY
UFJfSURFTlRJRklFUikgeworCQkJaW50IG9mZnNldCA9IDA7CiAJCQlpZiAoY3R5cGUtPnR5cGUg
IT0gU1lNX1NUUlVDVCAmJiBjdHlwZS0+dHlwZSAhPSBTWU1fVU5JT04pIHsKIAkJCQllcnIgPSAi
ZmllbGQgbmFtZSBub3QgaW4gc3RydWN0IG9yIHVuaW9uIjsKIAkJCQlicmVhazsKIAkJCX0KLQkJ
CWN0eXBlID0gZmluZF9zdHJ1Y3RfaWRlbnQoY3R5cGUsIGUtPmV4cHJfaWRlbnQpOworCQkJY3R5
cGUgPSBmaW5kX2lkZW50aWZpZXIoZS0+ZXhwcl9pZGVudCwgY3R5cGUtPnN5bWJvbF9saXN0LCAm
b2Zmc2V0KTsKIAkJCWlmICghY3R5cGUpIHsKIAkJCQllcnIgPSAidW5rbm93biBmaWVsZCBuYW1l
IGluIjsKIAkJCQlicmVhazsKLS0gCjIuMC4xLjQyNy5nYzQ3MzcyZAoK
--bcaec529a00741195c04ff819650
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0004-Fix-scoping-of-extern-symbols-in-block-scope.patch"
Content-Disposition: attachment; 
	filename="0004-Fix-scoping-of-extern-symbols-in-block-scope.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyafc7v03

RnJvbSBjMDExNTk3ZmY2Nzc2NWRhNWRhY2I0NzJkZGJkNjlkYzRiNTE0MTZkIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFR1ZSwgMSBBcHIgMjAxNCAxMDoyMDozNCAtMDcwMApTdWJqZWN0OiBb
UEFUQ0ggNC80XSBGaXggc2NvcGluZyBvZiBleHRlcm4gc3ltYm9scyBpbiBibG9jayBzY29wZQoK
V2UnZCBvbmx5IG1hdGNoIHRoZW0gd2l0aCBvdGhlciBzeW1ib2xzIG1hcmtlZCAnZXh0ZXJuJywg
YnV0IHJlYWxseSwgd2UKc2hvdWxkIG1hdGNoIHRoZW0gd2l0aCBhbnkgdG9wLWxldmVsIG5vbi1z
dGF0aWMgc3ltYm9sLgoKU2lnbmVkLW9mZi1ieTogTGludXMgVG9ydmFsZHMgPHRvcnZhbGRzQGxp
bnV4LWZvdW5kYXRpb24ub3JnPgotLS0KIHN5bWJvbC5jIHwgMTQgKysrKysrKysrLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCA5IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvc3ltYm9sLmMgYi9zeW1ib2wuYwppbmRleCA0YjkxYWJkODAyMWUuLmM1ZTQ3ODQ3MzRhOCAx
MDA2NDQKLS0tIGEvc3ltYm9sLmMKKysrIGIvc3ltYm9sLmMKQEAgLTU3NiwxMSArNTc2LDE1IEBA
IHZvaWQgY2hlY2tfZGVjbGFyYXRpb24oc3RydWN0IHN5bWJvbCAqc3ltKQogCQkJc3ltLT5zYW1l
X3N5bWJvbCA9IG5leHQ7CiAJCQlyZXR1cm47CiAJCX0KLQkJaWYgKHN5bS0+Y3R5cGUubW9kaWZp
ZXJzICYgbmV4dC0+Y3R5cGUubW9kaWZpZXJzICYgTU9EX0VYVEVSTikgewotCQkJaWYgKChzeW0t
PmN0eXBlLm1vZGlmaWVycyBeIG5leHQtPmN0eXBlLm1vZGlmaWVycykgJiBNT0RfSU5MSU5FKQot
CQkJCWNvbnRpbnVlOwotCQkJc3ltLT5zYW1lX3N5bWJvbCA9IG5leHQ7Ci0JCQlyZXR1cm47CisJ
CS8qIEV4dGVybiBpbiBibG9jayBsZXZlbCBtYXRjaGVzIGEgVE9QTEVWRUwgbm9uLXN0YXRpYyBz
eW1ib2wgKi8KKwkJaWYgKHN5bS0+Y3R5cGUubW9kaWZpZXJzICYgTU9EX0VYVEVSTikgeworCQkJ
aWYgKChuZXh0LT5jdHlwZS5tb2RpZmllcnMgJiAoTU9EX1RPUExFVkVMfE1PRF9TVEFUSUMpKSA9
PSBNT0RfVE9QTEVWRUwpIHsKKwkJCQkvKiBGSVhNRT8gRGlmZmVycyBpbiAnaW5saW5lJyBvbmx5
PyBXaHkgZG9lcyB0aGF0IG1hdHRlcj8gKi8KKwkJCQlpZiAoKHN5bS0+Y3R5cGUubW9kaWZpZXJz
IF4gbmV4dC0+Y3R5cGUubW9kaWZpZXJzKSAmIE1PRF9JTkxJTkUpCisJCQkJCWNvbnRpbnVlOwor
CQkJCXN5bS0+c2FtZV9zeW1ib2wgPSBuZXh0OworCQkJCXJldHVybjsKKwkJCX0KIAkJfQogCiAJ
CWlmICghV3NoYWRvdyB8fCB3YXJuZWQpCi0tIAoyLjAuMS40MjcuZ2M0NzM3MmQKCg==
--bcaec529a00741195c04ff819650--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Thu, 31 Jul 2014 18:50:30 +0000
Message-ID: <CA+55aFwg=yuR6Ro1O3g50Y1QR-hPeW5y_BLQ18go_DoX9SZe6Q () mail ! gmail ! com>
--------------------
On Thu, Jul 31, 2014 at 11:39 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> but not in the "official" sparse tree, which hasn't seen any work
> since January afaik.

Ugh, I looked at the old "sparse/sparse.git" tree (and badly at that,
it stopped updating in April, not January). It's
"sparse/chrisl/sparse.git" these days. No wonder I didn't see any
recent work.

The sparse.wiki.kernel.org main page is the first google hit for
"sparse git tree" and mentions that old git repo, not Chris' new one.

That leaves just my last patch ("Fix scoping of extern") as being not
in the sparse tree, and that's irrelevant for the union initializer
thing.

Chris, any particular reason why the url changed?

            Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Thu, 31 Jul 2014 18:50:30 +0000
Message-ID: <CA+55aFwg=yuR6Ro1O3g50Y1QR-hPeW5y_BLQ18go_DoX9SZe6Q () mail ! gmail ! com>
--------------------
On Thu, Jul 31, 2014 at 11:39 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> but not in the "official" sparse tree, which hasn't seen any work
> since January afaik.

Ugh, I looked at the old "sparse/sparse.git" tree (and badly at that,
it stopped updating in April, not January). It's
"sparse/chrisl/sparse.git" these days. No wonder I didn't see any
recent work.

The sparse.wiki.kernel.org main page is the first google hit for
"sparse git tree" and mentions that old git repo, not Chris' new one.

That leaves just my last patch ("Fix scoping of extern") as being not
in the sparse tree, and that's irrelevant for the union initializer
thing.

Chris, any particular reason why the url changed?

            Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: josh () joshtriplett ! org
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Thu, 31 Jul 2014 20:55:01 +0000
Message-ID: <20140731205501.GA13837 () cloud>
--------------------
On Thu, Jul 31, 2014 at 11:50:30AM -0700, Linus Torvalds wrote:
> On Thu, Jul 31, 2014 at 11:39 AM, Linus Torvalds
> <torvalds@linux-foundation.org> wrote:
> >
> > but not in the "official" sparse tree, which hasn't seen any work
> > since January afaik.
> 
> Ugh, I looked at the old "sparse/sparse.git" tree (and badly at that,
> it stopped updating in April, not January). It's
> "sparse/chrisl/sparse.git" these days. No wonder I didn't see any
> recent work.
> 
> The sparse.wiki.kernel.org main page is the first google hit for
> "sparse git tree" and mentions that old git repo, not Chris' new one.
> 
> That leaves just my last patch ("Fix scoping of extern") as being not
> in the sparse tree, and that's irrelevant for the union initializer
> thing.
> 
> Chris, any particular reason why the url changed?

I think Chris has been trying to use chrisl as a staging tree to let
things cook a while, and then moving them over to the sparse tree.
However, I think it'd make more sense to do that as a branch rather than
a separate repo.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Fri, 01 Aug 2014 02:19:20 +0000
Message-ID: <CA+55aFwinxO5H=5Rtgz37AuOCTHBDWJ6mVRU0HX+fiGP9JRa1Q () mail ! gmail ! com>
--------------------
--bcaec529a00759c72304ff8804e1
Content-Type: text/plain; charset=UTF-8

On Thu, Jul 31, 2014 at 11:10 AM,  <josh@joshtriplett.org> wrote:
> Test case:
>
> struct S {
>     int a;
>     union {
>         int b;
>         int c;
>     };
> };
>
> static struct S s = {
>     .a = 0,
>     .b = 0,
> };

So sparse fails on this test-case (differently from what Josh
reported, because apparently Josh is running 0.5.0) with:

  t.c:10:6: warning: Initializer entry defined twice
  t.c:11:6:   also defined here

because the offsets are miscomputed. The conversion from
EXPR_IDENTIFIER (an initializer entry with a named identifier) to
EXPR_POS (an initializer entry with a byte offset) got this wrong.

We need to use "find_identifier()" that does the proper recursive
lookup and updates the offset, but the required structure type wasn't
passed down to convert_designators() and convert_ident(), so the patch
is a bit bigger than just changing a couple of lines.

I'm quite sure we still screw complex intiializers up . But this makes
at least Josh's test-case pass, and looks superficially sane.

Hmm?

                  Linus

--bcaec529a00759c72304ff8804e1
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-Make-convert_ident-use-find_identifier-to-get-the-pr.patch"
Content-Disposition: attachment; 
	filename="0001-Make-convert_ident-use-find_identifier-to-get-the-pr.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyavnslf0

RnJvbSA3NjcwZDkzM2U4MjkxN2VhMjhhN2U1YTVkZjA5YmNjOTc0NGRiYTM0IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IFRodSwgMzEgSnVsIDIwMTQgMTk6MDE6MzYgLTA3MDAKU3ViamVjdDog
W1BBVENIXSBNYWtlICdjb252ZXJ0X2lkZW50KCknIHVzZSAnZmluZF9pZGVudGlmaWVyKCknIHRv
IGdldCB0aGUKIHByb3BlciBtZW1iZXIgb2Zmc2V0CgpUaGUgY29udmVydF9pZGVudCgpIGZ1bmN0
aW9uIHVzZWQgdG8gZG8KCglzdHJ1Y3Qgc3ltYm9sICpzeW0gPSBlLT5maWVsZDsKCWUtPmluaXRf
b2Zmc2V0ID0gc3ltLT5vZmZzZXQ7Cgp3aGljaCBpcyB3cm9uZyBmb3IgZW1iZWRkZWQgdW5uYW1l
ZCB1bmlvbnMuICBJdCByZWFsbHkgd2FudHMgdG8gZG8KImZpbmRfaWRlbnRpZmllcigpIiwgd2hp
Y2ggbG9va3MgdXAgdGhlIGZpZWxkIG5hbWUgaW4gdGhlIHN0cnVjdHVyZSBvcgp1bmlvbiB0eXBl
LCBhbmQgcHJvcGVybHkgYWRkcyB0aGUgb2Zmc2V0cyB3aGVuIGl0IGxvb2tzIHRoaW5ncyB1cCBp
biBhbgphbm9ueW1vdXMgc3RydWN0dXJlIG9yIHVuaW9uLgoKSG93ZXZlciwgd2UgZGlkbid0IHBh
c3MgaW4gdGhlIHJpZ2h0IHN5bWJvbCB0eXBlLCBzbyBjb252ZXJ0X2lkZW50KCkKY291bGRuJ3Qg
YmUganVzdCB0cml2aWFsbHkgY29udmVydGVkIHdpdGggYSBjb3VwbGUgb2YgbGluZXMuCgpUaGlz
IGNoYW5nZXMgdGhlIGNvZGUgdG8gcGFzcyBpbiB0aGUgc3RydWN0L3VuaW9uIHR5cGUsIGFuZCBh
bHNvCnJlLW9yZ2FuaXplcyBmaW5kX2lkZW50aWZpZXIoKSB0byBoYXZlIGEgbmljZXIgY2FsbGlu
ZyBjb252ZW50aW9uLiAgV2UKbm93IHBhc3MgaW4gdGhlIHR5cGUsIG5vdCB0aGUgbmFtZS1saXN0
LCB3aGljaCBtYWtlcyBpdCBwb3NzaWJsZSBmb3IKZmluZF9pZGVudGlmaWVyKCkgdG8gZG8gdGhl
IHBlZWxpbmcgb2YgdGhlIFNZTV9OT0RFIGlmIHJlcXVpcmVkLApzaW1wbGlmeWluZyB0aGUgY2Fs
bGVycyAoaW5jbHVkaW5nIHRoZSByZWN1cnNpdmUgY2FsbCBmb3IgdGhlIGFub255bW91cwpjYXNl
KS4KClJlcG9ydGVkLWJ5OiBKdXN0IFRyaXBsZXR0IDxqb3NoQGpvc2h0cmlwbGV0dC5vcmc+ClNp
Z25lZC1vZmYtYnk6IExpbnVzIFRvcnZhbGRzIDx0b3J2YWxkc0BsaW51eC1mb3VuZGF0aW9uLm9y
Zz4KLS0tCiBldmFsdWF0ZS5jIHwgNDcgKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0t
LS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyNiBpbnNlcnRpb25zKCspLCAyMSBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9ldmFsdWF0ZS5jIGIvZXZhbHVhdGUuYwppbmRleCAwMzk5
MmQwM2FlMWQuLjUxOTVkZWNkMWIyZSAxMDA2NDQKLS0tIGEvZXZhbHVhdGUuYworKysgYi9ldmFs
dWF0ZS5jCkBAIC0xODcyLDEzICsxODcyLDE5IEBAIHN0YXRpYyBzdHJ1Y3Qgc3ltYm9sICpldmFs
dWF0ZV9wcmVvcChzdHJ1Y3QgZXhwcmVzc2lvbiAqZXhwcikKIAlyZXR1cm4gY3R5cGU7CiB9CiAK
LXN0YXRpYyBzdHJ1Y3Qgc3ltYm9sICpmaW5kX2lkZW50aWZpZXIoc3RydWN0IGlkZW50ICppZGVu
dCwgc3RydWN0IHN5bWJvbF9saXN0ICpfbGlzdCwgaW50ICpvZmZzZXQpCitzdGF0aWMgc3RydWN0
IHN5bWJvbCAqZmluZF9pZGVudGlmaWVyKHN0cnVjdCBpZGVudCAqaWRlbnQsIHN0cnVjdCBzeW1i
b2wgKmN0eXBlLCBpbnQgKm9mZnNldCkKIHsKLQlzdHJ1Y3QgcHRyX2xpc3QgKmhlYWQgPSAoc3Ry
dWN0IHB0cl9saXN0ICopX2xpc3Q7Ci0Jc3RydWN0IHB0cl9saXN0ICpsaXN0ID0gaGVhZDsKKwlz
dHJ1Y3QgcHRyX2xpc3QgKmhlYWQsICpsaXN0OwogCisJaWYgKGN0eXBlLT50eXBlID09IFNZTV9O
T0RFKQorCQljdHlwZSA9IGN0eXBlLT5jdHlwZS5iYXNlX3R5cGU7CisJaWYgKGN0eXBlLT50eXBl
ICE9IFNZTV9VTklPTiAmJiBjdHlwZS0+dHlwZSAhPSBTWU1fU1RSVUNUKQorCQlyZXR1cm4gTlVM
TDsKKworCWhlYWQgPSAoc3RydWN0IHB0cl9saXN0ICopY3R5cGUtPnN5bWJvbF9saXN0OwogCWlm
ICghaGVhZCkKIAkJcmV0dXJuIE5VTEw7CisJbGlzdCA9IGhlYWQ7CiAJZG8gewogCQlpbnQgaTsK
IAkJZm9yIChpID0gMDsgaSA8IGxpc3QtPm5yOyBpKyspIHsKQEAgLTE4ODksMTMgKzE4OTUsOCBA
QCBzdGF0aWMgc3RydWN0IHN5bWJvbCAqZmluZF9pZGVudGlmaWVyKHN0cnVjdCBpZGVudCAqaWRl
bnQsIHN0cnVjdCBzeW1ib2xfbGlzdCAqXwogCQkJCSpvZmZzZXQgPSBzeW0tPm9mZnNldDsKIAkJ
CQlyZXR1cm4gc3ltOwogCQkJfSBlbHNlIHsKLQkJCQlzdHJ1Y3Qgc3ltYm9sICpjdHlwZSA9IHN5
bS0+Y3R5cGUuYmFzZV90eXBlOwogCQkJCXN0cnVjdCBzeW1ib2wgKnN1YjsKLQkJCQlpZiAoIWN0
eXBlKQotCQkJCQljb250aW51ZTsKLQkJCQlpZiAoY3R5cGUtPnR5cGUgIT0gU1lNX1VOSU9OICYm
IGN0eXBlLT50eXBlICE9IFNZTV9TVFJVQ1QpCi0JCQkJCWNvbnRpbnVlOwotCQkJCXN1YiA9IGZp
bmRfaWRlbnRpZmllcihpZGVudCwgY3R5cGUtPnN5bWJvbF9saXN0LCBvZmZzZXQpOworCQkJCXN1
YiA9IGZpbmRfaWRlbnRpZmllcihpZGVudCwgc3ltLCBvZmZzZXQpOwogCQkJCWlmICghc3ViKQog
CQkJCQljb250aW51ZTsKIAkJCQkqb2Zmc2V0ICs9IHN5bS0+b2Zmc2V0OwpAQCAtMTk2NSw3ICsx
OTY2LDcgQEAgc3RhdGljIHN0cnVjdCBzeW1ib2wgKmV2YWx1YXRlX21lbWJlcl9kZXJlZmVyZW5j
ZShzdHJ1Y3QgZXhwcmVzc2lvbiAqZXhwcikKIAkJcmV0dXJuIE5VTEw7CiAJfQogCW9mZnNldCA9
IDA7Ci0JbWVtYmVyID0gZmluZF9pZGVudGlmaWVyKGlkZW50LCBjdHlwZS0+c3ltYm9sX2xpc3Qs
ICZvZmZzZXQpOworCW1lbWJlciA9IGZpbmRfaWRlbnRpZmllcihpZGVudCwgY3R5cGUsICZvZmZz
ZXQpOwogCWlmICghbWVtYmVyKSB7CiAJCWNvbnN0IGNoYXIgKnR5cGUgPSBjdHlwZS0+dHlwZSA9
PSBTWU1fU1RSVUNUID8gInN0cnVjdCIgOiAidW5pb24iOwogCQljb25zdCBjaGFyICpuYW1lID0g
Ijx1bm5hbWVkPiI7CkBAIC0yMjIwLDIzICsyMjIxLDI3IEBAIHN0YXRpYyB2b2lkIGNvbnZlcnRf
aW5kZXgoc3RydWN0IGV4cHJlc3Npb24gKmUpCiAJZS0+aW5pdF9leHByID0gY2hpbGQ7CiB9CiAK
LXN0YXRpYyB2b2lkIGNvbnZlcnRfaWRlbnQoc3RydWN0IGV4cHJlc3Npb24gKmUpCitzdGF0aWMg
dm9pZCBjb252ZXJ0X2lkZW50KHN0cnVjdCBleHByZXNzaW9uICplLCBzdHJ1Y3Qgc3ltYm9sICpj
dHlwZSkKIHsKKwlpbnQgb2Zmc2V0OwogCXN0cnVjdCBleHByZXNzaW9uICpjaGlsZCA9IGUtPmlk
ZW50X2V4cHJlc3Npb247Ci0Jc3RydWN0IHN5bWJvbCAqc3ltID0gZS0+ZmllbGQ7CisKKwljdHlw
ZSA9IGZpbmRfaWRlbnRpZmllcihlLT5leHByX2lkZW50LCBjdHlwZSwgJm9mZnNldCk7CisJaWYg
KCFjdHlwZSkKKwkJcmV0dXJuOwogCWUtPnR5cGUgPSBFWFBSX1BPUzsKLQllLT5pbml0X29mZnNl
dCA9IHN5bS0+b2Zmc2V0OworCWUtPmluaXRfb2Zmc2V0ID0gb2Zmc2V0OwogCWUtPmluaXRfbnIg
PSAxOwogCWUtPmluaXRfZXhwciA9IGNoaWxkOwogfQogCi1zdGF0aWMgdm9pZCBjb252ZXJ0X2Rl
c2lnbmF0b3JzKHN0cnVjdCBleHByZXNzaW9uICplKQorc3RhdGljIHZvaWQgY29udmVydF9kZXNp
Z25hdG9ycyhzdHJ1Y3QgZXhwcmVzc2lvbiAqZSwgc3RydWN0IHN5bWJvbCAqY3R5cGUpCiB7CiAJ
d2hpbGUgKGUpIHsKIAkJaWYgKGUtPnR5cGUgPT0gRVhQUl9JTkRFWCkKIAkJCWNvbnZlcnRfaW5k
ZXgoZSk7CiAJCWVsc2UgaWYgKGUtPnR5cGUgPT0gRVhQUl9JREVOVElGSUVSKQotCQkJY29udmVy
dF9pZGVudChlKTsKKwkJCWNvbnZlcnRfaWRlbnQoZSwgY3R5cGUpOwogCQllbHNlCiAJCQlicmVh
azsKIAkJZSA9IGUtPmluaXRfZXhwcjsKQEAgLTIzMjIsNyArMjMyNyw3IEBAIHN0YXRpYyBzdHJ1
Y3QgZXhwcmVzc2lvbiAqY2hlY2tfZGVzaWduYXRvcnMoc3RydWN0IGV4cHJlc3Npb24gKmUsCiAJ
CQkJZXJyID0gImZpZWxkIG5hbWUgbm90IGluIHN0cnVjdCBvciB1bmlvbiI7CiAJCQkJYnJlYWs7
CiAJCQl9Ci0JCQljdHlwZSA9IGZpbmRfaWRlbnRpZmllcihlLT5leHByX2lkZW50LCBjdHlwZS0+
c3ltYm9sX2xpc3QsICZvZmZzZXQpOworCQkJY3R5cGUgPSBmaW5kX2lkZW50aWZpZXIoZS0+ZXhw
cl9pZGVudCwgY3R5cGUsICZvZmZzZXQpOwogCQkJaWYgKCFjdHlwZSkgewogCQkJCWVyciA9ICJ1
bmtub3duIGZpZWxkIG5hbWUgaW4iOwogCQkJCWJyZWFrOwpAQCAtMjM5Miw3ICsyMzk3LDcgQEAg
c3RhdGljIHN0cnVjdCBleHByZXNzaW9uICpuZXh0X2Rlc2lnbmF0b3JzKHN0cnVjdCBleHByZXNz
aW9uICpvbGQsCiAJCWlmICghY29weSkgewogCQkJZmllbGQgPSBvbGQtPmZpZWxkLT5uZXh0X3N1
Ym9iamVjdDsKIAkJCWlmICghZmllbGQpIHsKLQkJCQljb252ZXJ0X2lkZW50KG9sZCk7CisJCQkJ
Y29udmVydF9pZGVudChvbGQsIGN0eXBlKTsKIAkJCQlyZXR1cm4gTlVMTDsKIAkJCX0KIAkJCWNv
cHkgPSBlOwpAQCAtMjQwNiw3ICsyNDExLDcgQEAgc3RhdGljIHN0cnVjdCBleHByZXNzaW9uICpu
ZXh0X2Rlc2lnbmF0b3JzKHN0cnVjdCBleHByZXNzaW9uICpvbGQsCiAJCW5ldy0+ZXhwcl9pZGVu
dCA9IGZpZWxkLT5pZGVudDsKIAkJbmV3LT5pZGVudF9leHByZXNzaW9uID0gY29weTsKIAkJbmV3
LT5jdHlwZSA9IGZpZWxkOwotCQljb252ZXJ0X2lkZW50KG9sZCk7CisJCWNvbnZlcnRfaWRlbnQo
b2xkLCBjdHlwZSk7CiAJfQogCXJldHVybiBuZXc7CiB9CkBAIC0yNDY1LDcgKzI0NzAsNyBAQCBz
dGF0aWMgdm9pZCBoYW5kbGVfbGlzdF9pbml0aWFsaXplcihzdHJ1Y3QgZXhwcmVzc2lvbiAqZXhw
ciwKIAkJCXRvcCA9IG5leHQ7CiAJCQkvKiBkZWVwZXIgdGhhbiBvbmUgZGVzaWduYXRvcj8gKi8K
IAkJCWp1bXBlZCA9IHRvcCAhPSBlOwotCQkJY29udmVydF9kZXNpZ25hdG9ycyhsYXN0KTsKKwkJ
CWNvbnZlcnRfZGVzaWduYXRvcnMobGFzdCwgY3R5cGUpOwogCQkJbGFzdCA9IGU7CiAJCX0KIApA
QCAtMjQ5Nyw3ICsyNTAyLDcgQEAgZm91bmQ6CiAKIAl9IEVORF9GT1JfRUFDSF9QVFIoZSk7CiAK
LQljb252ZXJ0X2Rlc2lnbmF0b3JzKGxhc3QpOworCWNvbnZlcnRfZGVzaWduYXRvcnMobGFzdCwg
Y3R5cGUpOwogCWV4cHItPmN0eXBlID0gY3R5cGU7CiB9CiAKQEAgLTI5MDEsNyArMjkwNiw3IEBA
IHN0YXRpYyBzdHJ1Y3Qgc3ltYm9sICpldmFsdWF0ZV9vZmZzZXRvZihzdHJ1Y3QgZXhwcmVzc2lv
biAqZXhwcikKIAkJCXJldHVybiBOVUxMOwogCQl9CiAKLQkJZmllbGQgPSBmaW5kX2lkZW50aWZp
ZXIoZXhwci0+aWRlbnQsIGN0eXBlLT5zeW1ib2xfbGlzdCwgJm9mZnNldCk7CisJCWZpZWxkID0g
ZmluZF9pZGVudGlmaWVyKGV4cHItPmlkZW50LCBjdHlwZSwgJm9mZnNldCk7CiAJCWlmICghZmll
bGQpIHsKIAkJCWV4cHJlc3Npb25fZXJyb3IoZXhwciwgInVua25vd24gbWVtYmVyIik7CiAJCQly
ZXR1cm4gTlVMTDsKLS0gCjIuMS4wLnJjMC41Mi5nYWE1NDRiZgoK
--bcaec529a00759c72304ff8804e1--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Fri, 01 Aug 2014 02:41:06 +0000
Message-ID: <CA+55aFwhz6aHV145jLGJx9MH6Nb67TdHwE=Zz_0Vu4u6L8A7Dw () mail ! gmail ! com>
--------------------
On Thu, Jul 31, 2014 at 7:19 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> I'm quite sure we still screw complex intiializers up . But this makes
> at least Josh's test-case pass, and looks superficially sane.

Hmm. It exposes other problems.

For example, the fact that we look up the identifier now exposes the
fact that "first_subobject()" creates this dummy "EXPR_IDENTIFIER"
expression that has no identifier. That will then cause
"find_identifier()" to fail, which in turn causes convert_ident() to
fail. Resulting in the parse tree having remaining EXPR_IDENTIFIER
nodes, which will later result in "unknown expression (25,0)" errors.

That's easy enough to fix with just adding the proper initializer, ie

    new->expr_ident = field->ident;

to first_subobject().

But the change apparently also exposes some problems with nested
EXPR_POS cases, so now we mis-parse initializers that have multiple
levels of naming, of the type

   struct S a = { .a.b = 1 };

I haven't had the energy to figure out what went wrong with that one,
and I'm getting rather fed up with this for today, so I'm hoping
somebody else finds this at all interesting.

              Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Fri, 01 Aug 2014 02:41:54 +0000
Message-ID: <20140801024154.GA21780 () thin>
--------------------
On Thu, Jul 31, 2014 at 07:19:20PM -0700, Linus Torvalds wrote:
> On Thu, Jul 31, 2014 at 11:10 AM,  <josh@joshtriplett.org> wrote:
> > Test case:
> >
> > struct S {
> >     int a;
> >     union {
> >         int b;
> >         int c;
> >     };
> > };
> >
> > static struct S s = {
> >     .a = 0,
> >     .b = 0,
> > };
> 
> So sparse fails on this test-case (differently from what Josh
> reported, because apparently Josh is running 0.5.0) with:
> 
>   t.c:10:6: warning: Initializer entry defined twice
>   t.c:11:6:   also defined here

I had the latest bits from the main sparse repo; switching to the
chrisli repo gives me these same results.

> because the offsets are miscomputed. The conversion from
> EXPR_IDENTIFIER (an initializer entry with a named identifier) to
> EXPR_POS (an initializer entry with a byte offset) got this wrong.
> 
> We need to use "find_identifier()" that does the proper recursive
> lookup and updates the offset, but the required structure type wasn't
> passed down to convert_designators() and convert_ident(), so the patch
> is a bit bigger than just changing a couple of lines.
> 
> I'm quite sure we still screw complex intiializers up . But this makes
> at least Josh's test-case pass, and looks superficially sane.
> 
> Hmm?

Comments below.

> From 7670d933e82917ea28a7e5a5df09bcc9744dba34 Mon Sep 17 00:00:00 2001
> From: Linus Torvalds <torvalds@linux-foundation.org>
> Date: Thu, 31 Jul 2014 19:01:36 -0700
> Subject: [PATCH] Make 'convert_ident()' use 'find_identifier()' to get the
>  proper member offset
> 
> The convert_ident() function used to do
> 
> 	struct symbol *sym = e->field;
> 	e->init_offset = sym->offset;
> 
> which is wrong for embedded unnamed unions.  It really wants to do
> "find_identifier()", which looks up the field name in the structure or
> union type, and properly adds the offsets when it looks things up in an
> anonymous structure or union.
> 
> However, we didn't pass in the right symbol type, so convert_ident()
> couldn't be just trivially converted with a couple of lines.
> 
> This changes the code to pass in the struct/union type, and also
> re-organizes find_identifier() to have a nicer calling convention.  We
> now pass in the type, not the name-list, which makes it possible for
> find_identifier() to do the peeling of the SYM_NODE if required,
> simplifying the callers (including the recursive call for the anonymous
> case).
> 
> Reported-by: Just Triplett <josh@joshtriplett.org>

s/Just/Josh/

> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

With the above typo fixed:
Reviewed-by: Josh Triplett <josh@joshtriplett.org>
Tested-by: Josh Triplett <josh@joshtriplett.org>

It might make sense to combine this with the handling of array
designated initializers, to allow things like .x[0].y.z[3] = ..., but
this definitely fixes the issue I ran into.

(And now I'm wondering why nobody seems to have ever created an
"unnamed array" extension.)

> ---
>  evaluate.c | 47 ++++++++++++++++++++++++++---------------------
>  1 file changed, 26 insertions(+), 21 deletions(-)
> 
> diff --git a/evaluate.c b/evaluate.c
> index 03992d03ae1d..5195decd1b2e 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -1872,13 +1872,19 @@ static struct symbol *evaluate_preop(struct expression *expr)
>  	return ctype;
>  }
>  
> -static struct symbol *find_identifier(struct ident *ident, struct symbol_list *_list, int *offset)
> +static struct symbol *find_identifier(struct ident *ident, struct symbol *ctype, int *offset)
>  {
> -	struct ptr_list *head = (struct ptr_list *)_list;
> -	struct ptr_list *list = head;
> +	struct ptr_list *head, *list;
>  
> +	if (ctype->type == SYM_NODE)
> +		ctype = ctype->ctype.base_type;
> +	if (ctype->type != SYM_UNION && ctype->type != SYM_STRUCT)
> +		return NULL;
> +
> +	head = (struct ptr_list *)ctype->symbol_list;
>  	if (!head)
>  		return NULL;
> +	list = head;
>  	do {
>  		int i;
>  		for (i = 0; i < list->nr; i++) {
> @@ -1889,13 +1895,8 @@ static struct symbol *find_identifier(struct ident *ident, struct symbol_list *_
>  				*offset = sym->offset;
>  				return sym;
>  			} else {
> -				struct symbol *ctype = sym->ctype.base_type;
>  				struct symbol *sub;
> -				if (!ctype)
> -					continue;
> -				if (ctype->type != SYM_UNION && ctype->type != SYM_STRUCT)
> -					continue;
> -				sub = find_identifier(ident, ctype->symbol_list, offset);
> +				sub = find_identifier(ident, sym, offset);
>  				if (!sub)
>  					continue;
>  				*offset += sym->offset;
> @@ -1965,7 +1966,7 @@ static struct symbol *evaluate_member_dereference(struct expression *expr)
>  		return NULL;
>  	}
>  	offset = 0;
> -	member = find_identifier(ident, ctype->symbol_list, &offset);
> +	member = find_identifier(ident, ctype, &offset);
>  	if (!member) {
>  		const char *type = ctype->type == SYM_STRUCT ? "struct" : "union";
>  		const char *name = "<unnamed>";
> @@ -2220,23 +2221,27 @@ static void convert_index(struct expression *e)
>  	e->init_expr = child;
>  }
>  
> -static void convert_ident(struct expression *e)
> +static void convert_ident(struct expression *e, struct symbol *ctype)
>  {
> +	int offset;
>  	struct expression *child = e->ident_expression;
> -	struct symbol *sym = e->field;
> +
> +	ctype = find_identifier(e->expr_ident, ctype, &offset);
> +	if (!ctype)
> +		return;
>  	e->type = EXPR_POS;
> -	e->init_offset = sym->offset;
> +	e->init_offset = offset;
>  	e->init_nr = 1;
>  	e->init_expr = child;
>  }
>  
> -static void convert_designators(struct expression *e)
> +static void convert_designators(struct expression *e, struct symbol *ctype)
>  {
>  	while (e) {
>  		if (e->type == EXPR_INDEX)
>  			convert_index(e);
>  		else if (e->type == EXPR_IDENTIFIER)
> -			convert_ident(e);
> +			convert_ident(e, ctype);
>  		else
>  			break;
>  		e = e->init_expr;
> @@ -2322,7 +2327,7 @@ static struct expression *check_designators(struct expression *e,
>  				err = "field name not in struct or union";
>  				break;
>  			}
> -			ctype = find_identifier(e->expr_ident, ctype->symbol_list, &offset);
> +			ctype = find_identifier(e->expr_ident, ctype, &offset);
>  			if (!ctype) {
>  				err = "unknown field name in";
>  				break;
> @@ -2392,7 +2397,7 @@ static struct expression *next_designators(struct expression *old,
>  		if (!copy) {
>  			field = old->field->next_subobject;
>  			if (!field) {
> -				convert_ident(old);
> +				convert_ident(old, ctype);
>  				return NULL;
>  			}
>  			copy = e;
> @@ -2406,7 +2411,7 @@ static struct expression *next_designators(struct expression *old,
>  		new->expr_ident = field->ident;
>  		new->ident_expression = copy;
>  		new->ctype = field;
> -		convert_ident(old);
> +		convert_ident(old, ctype);
>  	}
>  	return new;
>  }
> @@ -2465,7 +2470,7 @@ static void handle_list_initializer(struct expression *expr,
>  			top = next;
>  			/* deeper than one designator? */
>  			jumped = top != e;
> -			convert_designators(last);
> +			convert_designators(last, ctype);
>  			last = e;
>  		}
>  
> @@ -2497,7 +2502,7 @@ found:
>  
>  	} END_FOR_EACH_PTR(e);
>  
> -	convert_designators(last);
> +	convert_designators(last, ctype);
>  	expr->ctype = ctype;
>  }
>  
> @@ -2901,7 +2906,7 @@ static struct symbol *evaluate_offsetof(struct expression *expr)
>  			return NULL;
>  		}
>  
> -		field = find_identifier(expr->ident, ctype->symbol_list, &offset);
> +		field = find_identifier(expr->ident, ctype, &offset);
>  		if (!field) {
>  			expression_error(expr, "unknown member");
>  			return NULL;
> -- 
> 2.1.0.rc0.52.gaa544bf
> 

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 01:16:08 +0000
Message-ID: <CA+55aFwfN1L6U=6+_a-Ue_Z6tPNfphKkpidtdD06zs+tHLPyJQ () mail ! gmail ! com>
--------------------
--001a1133614e2683ab04ff9b40e6
Content-Type: text/plain; charset=UTF-8

On Thu, Jul 31, 2014 at 7:41 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> Hmm. It exposes other problems.
>
> For example, the fact that we look up the identifier now exposes the
> fact that "first_subobject()" creates this dummy "EXPR_IDENTIFIER"
> expression that has no identifier. That will then cause
> "find_identifier()" to fail, which in turn causes convert_ident() to
> fail. Resulting in the parse tree having remaining EXPR_IDENTIFIER
> nodes, which will later result in "unknown expression (25,0)" errors.
>
> That's easy enough to fix with just adding the proper initializer, ie
>
>     new->expr_ident = field->ident;
>
> to first_subobject().

Actually, sadly, while that worked for my test-cases (and for Josh's
case), it turns out to really *not* work in general: the dummy
EXPR_IDENTIFIER that we create may end up referring to a unnamed
union, which doesn't *have* an ident associated with it.

This only really triggers when you mix named initializers with then
relying on the whole "initialize the next one without a name", but
that does happen. And it fundamentally breaks that whole "use
find_identifier()" approach.

So convert_ident() really cannot use find_indent(), and really does
have to use "sym->offset". But that doesn't work for anonymous union
members, because that offset was the offset within the anonymous
union, not the parent structure.

However, the fix is "simple". We can just say that anonymous
union/structure member offsets have to be the offsets within the
parent union instead, and fix things up. So how about a patch like
this *instead* of the previous patch..

                 Linus

--001a1133614e2683ab04ff9b40e6
Content-Type: text/plain; charset=US-ASCII; name="patch.diff"
Content-Disposition: attachment; filename="patch.diff"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyc91eyk0

IGV2YWx1YXRlLmMgfCAgMiArLQogc3ltYm9sLmMgICB8IDE2ICsrKysrKysrKysrKysrKysKIDIg
ZmlsZXMgY2hhbmdlZCwgMTcgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdp
dCBhL2V2YWx1YXRlLmMgYi9ldmFsdWF0ZS5jCmluZGV4IDAzOTkyZDAzYWUxZC4uNzgxNTBmODNh
MTlmIDEwMDY0NAotLS0gYS9ldmFsdWF0ZS5jCisrKyBiL2V2YWx1YXRlLmMKQEAgLTE4OTgsNyAr
MTg5OCw3IEBAIHN0YXRpYyBzdHJ1Y3Qgc3ltYm9sICpmaW5kX2lkZW50aWZpZXIoc3RydWN0IGlk
ZW50ICppZGVudCwgc3RydWN0IHN5bWJvbF9saXN0ICpfCiAJCQkJc3ViID0gZmluZF9pZGVudGlm
aWVyKGlkZW50LCBjdHlwZS0+c3ltYm9sX2xpc3QsIG9mZnNldCk7CiAJCQkJaWYgKCFzdWIpCiAJ
CQkJCWNvbnRpbnVlOwotCQkJCSpvZmZzZXQgKz0gc3ltLT5vZmZzZXQ7CisJCQkJKm9mZnNldCA9
IHN5bS0+b2Zmc2V0OwogCQkJCXJldHVybiBzdWI7CiAJCQl9CQogCQl9CmRpZmYgLS1naXQgYS9z
eW1ib2wuYyBiL3N5bWJvbC5jCmluZGV4IGEyNzMxMzQ4YTAxMS4uMzJhZjY0MDUwYTY0IDEwMDY0
NAotLS0gYS9zeW1ib2wuYworKysgYi9zeW1ib2wuYwpAQCAtMTE2LDYgKzExNiwxOCBAQCBzdGF0
aWMgaW50IGJpdGZpZWxkX2Jhc2Vfc2l6ZShzdHJ1Y3Qgc3ltYm9sICpzeW0pCiAJcmV0dXJuIHN5
bS0+Yml0X3NpemU7CiB9CiAKK3N0YXRpYyB2b2lkIHVwZGF0ZV9zeW1ib2xfb2Zmc2V0cyhzdHJ1
Y3Qgc3ltYm9sICpzeW0sIHVuc2lnbmVkIGludCBvZmZzZXQpCit7CisJc3RydWN0IHN5bWJvbCAq
ZmllbGQ7CisKKwlpZiAoc3ltLT50eXBlICE9IFNZTV9TVFJVQ1QgJiYgc3ltLT50eXBlICE9IFNZ
TV9VTklPTikKKwkJcmV0dXJuOworCUZPUl9FQUNIX1BUUihzeW0tPnN5bWJvbF9saXN0LCBmaWVs
ZCkgeworCQlmaWVsZC0+b2Zmc2V0ICs9IG9mZnNldDsKKwkJdXBkYXRlX3N5bWJvbF9vZmZzZXRz
KGZpZWxkLCBvZmZzZXQpOworCX0gRU5EX0ZPUl9FQUNIX1BUUihmaWVsZCk7Cit9CisKIC8qCiAg
KiBTdHJ1Y3R1cmVzIGFyZSBhIGJpdCBtb3JlIGludGVyZXN0aW5nIHRvIGxheSBvdXQKICAqLwpA
QCAtMTc0LDYgKzE4NiwxMCBAQCBzdGF0aWMgdm9pZCBsYXlfb3V0X3N0cnVjdChzdHJ1Y3Qgc3lt
Ym9sICpzeW0sIHN0cnVjdCBzdHJ1Y3RfdW5pb25faW5mbyAqaW5mbykKIAliaXRfc2l6ZSA9IChi
aXRfc2l6ZSArIGFsaWduX2JpdF9tYXNrKSAmIH5hbGlnbl9iaXRfbWFzazsKIAlzeW0tPm9mZnNl
dCA9IGJpdHNfdG9fYnl0ZXMoYml0X3NpemUpOwogCisJLyogSWYgaXQncyBhbiB1bm5hbWVkIHN0
cnVjdCBvciB1bmlvbiwgdXBkYXRlIHRoZSBvZmZzZXRzIG9mIHRoZSBzdWItbWVtYmVycyAqLwor
CWlmIChzeW0tPm9mZnNldCAmJiAhc3ltLT5pZGVudCkKKwkJdXBkYXRlX3N5bWJvbF9vZmZzZXRz
KHN5bSwgc3ltLT5vZmZzZXQpOworCiAJaW5mby0+Yml0X3NpemUgPSBiaXRfc2l6ZSArIGJhc2Vf
c2l6ZTsKIAkvLyB3YXJuaW5nIChzeW0tPnBvcywgInJlZ3VsYXI6IG9mZnNldD0lZCIsIHN5bS0+
b2Zmc2V0KTsKIH0K
--001a1133614e2683ab04ff9b40e6--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 05:16:59 +0000
Message-ID: <CANeU7Qn4++T+GsL6pjnEem0SOWhGrvBN7TLC8p8Hjbw2xCmVbw () mail ! gmail ! com>
--------------------
On Fri, Aug 1, 2014 at 6:16 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> Actually, sadly, while that worked for my test-cases (and for Josh's
> case), it turns out to really *not* work in general: the dummy
> EXPR_IDENTIFIER that we create may end up referring to a unnamed
> union, which doesn't *have* an ident associated with it.
>
> This only really triggers when you mix named initializers with then
> relying on the whole "initialize the next one without a name", but
> that does happen. And it fundamentally breaks that whole "use
> find_identifier()" approach.
>
> So convert_ident() really cannot use find_indent(), and really does
> have to use "sym->offset". But that doesn't work for anonymous union
> members, because that offset was the offset within the anonymous
> union, not the parent structure.
>
> However, the fix is "simple". We can just say that anonymous
> union/structure member offsets have to be the offsets within the
> parent union instead, and fix things up. So how about a patch like
> this *instead* of the previous patch..

Sorry I am late for the party. This approach assume the anonymous
structure is only referenced inside the structure. There is not other
external reference. However, that assumption is not true if "-fplan9-extensions"
or "-fms-extensions" was enabled. Sparse current does not support these
two extensions. But it will be a problem if we support them down the road.

According to this gcc document:

https://gcc.gnu.org/onlinedocs/gcc/Unnamed-Fields.html

One of the example is this:
     struct s1 { int a; };
     struct s2 { struct s1; };

You see, "struct s1" does not have a name, however "struct s1" can be
referenced from other symbol. So update the symbol offset in "struct s1"
will be wrong for the other reference of "struct s1".

Actually, the "find_identifier" call inside function "check_designators" already
calculate the correct offset. Only if we can pass that offset to
"convert_ident()".

Another idea is that, instead of using ident in EXPR_IDENTIFIER, we can
do one time find_identifier(). Then convert the EXPR_IDENTIFIER to an index
to the struct. It might take more than one index level for the anonymous
struct or union. BTW, that is very similar to the LLVM  performing the
"Get Element Pointer" instruction. Using the index, we can still reference
the anonymous struct.  This is not a trivial change. However it might be
the right thing to do if we want to support "-fplan9-extensions"

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 08:27:23 +0000
Message-ID: <CANeU7Q=11kDQdW7=2m6UwCzf6pcQU05stuSp+ysPus5d1oneJA () mail ! gmail ! com>
--------------------
On Thu, Jul 31, 2014 at 11:50 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> That leaves just my last patch ("Fix scoping of extern") as being not
> in the sparse tree, and that's irrelevant for the union initializer
> thing.

I just apply that without the "FIXME" part. That two lines are from an incorrect
fix for the external inline bug. I just remove it for now. Currently
sparse will fail
at the external inline test. I will fix that in a separate patch.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 08:27:23 +0000
Message-ID: <CANeU7Q=11kDQdW7=2m6UwCzf6pcQU05stuSp+ysPus5d1oneJA () mail ! gmail ! com>
--------------------
On Thu, Jul 31, 2014 at 11:50 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> That leaves just my last patch ("Fix scoping of extern") as being not
> in the sparse tree, and that's irrelevant for the union initializer
> thing.

I just apply that without the "FIXME" part. That two lines are from an incorrect
fix for the external inline bug. I just remove it for now. Currently
sparse will fail
at the external inline test. I will fix that in a separate patch.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 18:09:01 +0000
Message-ID: <CANeU7QnTx50Hrw3-8vqAc=3e59v7ppnjgS6GVGMwbhOMZvbH9A () mail ! gmail ! com>
--------------------
--001a11c12ce6838ed904ffa9660c
Content-Type: text/plain; charset=ISO-8859-1

On Sat, Aug 2, 2014 at 1:27 AM, Christopher Li <sparse@chrisli.org> wrote:
> I just apply that without the "FIXME" part. That two lines are from an incorrect
> fix for the external inline bug. I just remove it for now. Currently
> sparse will fail
> at the external inline test. I will fix that in a separate patch.

This is a follow up change to fix the extern-inline.c validation bug.
Feed back are welcome.

Consider the following case, extern inline declare after
extern declare of the same function.

extern int g(int);
extern __inline__ int g(int x)
{
        return x;
}

Sparse will give the first function global scope and
the second one file scope. Also the first one will get the
function body from the second one. That cause the failure
of the validation/extern-inlien.c

This change rebind the scope of the same_symbol chain to
the new scope. It will pass the extern-inline.c test case.

Chris

--001a11c12ce6838ed904ffa9660c
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-Make-same_symbol-list-share-the-same-scope.patch"
Content-Disposition: attachment; 
	filename="0001-Make-same_symbol-list-share-the-same-scope.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyd93er70

RnJvbSA3YWJkOGE3NmI0ZTA3YWQ2MGI1MjYyZTRjNzg1OGU2Mzg0NjdmYWI4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgpE
YXRlOiBTYXQsIDIgQXVnIDIwMTQgMTA6NTY6NTkgLTA3MDAKU3ViamVjdDogW1BBVENIXSBNYWtl
IHNhbWVfc3ltYm9sIGxpc3Qgc2hhcmUgdGhlIHNhbWUgc2NvcGUKCkNvbnNpZGVyIHRoZSBmb2xs
b3dpbmcgY2FzZSwgZXh0ZXJuIGlubGluZSBkZWNsYXJlIGFmdGVyCmV4dGVybiBkZWNsYXJlIG9m
IHRoZSBzYW1lIGZ1bmN0aW9uLgoKZXh0ZXJuIGludCBnKGludCk7CmV4dGVybiBfX2lubGluZV9f
IGludCBnKGludCB4KQp7CiAgICAgICAgcmV0dXJuIHg7Cn0KClNwYXJzZSB3aWxsIGdpdmUgdGhl
IGZpcnN0IGZ1bmN0aW9uIGdsb2JhbCBzY29wZSBhbmQKdGhlIHNlY29uZCBvbmUgZmlsZSBzY29w
ZS4gQWxzbyB0aGUgZmlyc3Qgb25lIHdpbGwgZ2V0IHRoZQpmdW5jdGlvbiBib2R5IGZyb20gdGhl
IHNlY29uZCBvbmUuIFRoYXQgY2F1c2UgdGhlIGZhaWx1cmUKb2YgdGhlIHZhbGlkYXRpb24vZXh0
ZXJuLWlubGllbi5jCgpUaGlzIGNoYW5nZSByZWJpbmQgdGhlIHNjb3BlIG9mIHRoZSBzYW1lX3N5
bWJvbCBjaGFpbiB0bwp0aGUgbmV3IHNjb3BlLiBJdCB3aWxsIHBhc3MgdGhlIGV4dGVybi1pbmxp
bmUuYyB0ZXN0IGNhc2UuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNo
cmlzbGkub3JnPgotLS0KIHBhcnNlLmMgfCAgMSArCiBzY29wZS5jIHwgMTQgKysrKysrKysrKysr
KysKIHNjb3BlLmggfCAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDE2IGluc2VydGlvbnMoKykKCmRp
ZmYgLS1naXQgYS9wYXJzZS5jIGIvcGFyc2UuYwppbmRleCA1NWE1N2E3Li5lYWExODgzIDEwMDY0
NAotLS0gYS9wYXJzZS5jCisrKyBiL3BhcnNlLmMKQEAgLTI2MTEsNiArMjYxMSw3IEBAIHN0YXRp
YyBzdHJ1Y3QgdG9rZW4gKnBhcnNlX2Z1bmN0aW9uX2JvZHkoc3RydWN0IHRva2VuICp0b2tlbiwg
c3RydWN0IHN5bWJvbCAqZGVjCiAJCWluZm8ocHJldi0+ZGVmaW5pdGlvbi0+cG9zLCAiIHRoZSBw
cmV2aW91cyBvbmUgaXMgaGVyZSIpOwogCX0gZWxzZSB7CiAJCXdoaWxlIChwcmV2KSB7CisJCQly
ZWJpbmRfc2NvcGUocHJldiwgZGVjbC0+c2NvcGUpOwogCQkJcHJldi0+ZGVmaW5pdGlvbiA9IGRl
Y2w7CiAJCQlwcmV2ID0gcHJldi0+c2FtZV9zeW1ib2w7CiAJCX0KZGlmZiAtLWdpdCBhL3Njb3Bl
LmMgYi9zY29wZS5jCmluZGV4IGI0MTVhY2UuLmNiZjJmY2YgMTAwNjQ0Ci0tLSBhL3Njb3BlLmMK
KysrIGIvc2NvcGUuYwpAQCAtNDYsNiArNDYsMjAgQEAgdm9pZCBiaW5kX3Njb3BlKHN0cnVjdCBz
eW1ib2wgKnN5bSwgc3RydWN0IHNjb3BlICpzY29wZSkKIAlhZGRfc3ltYm9sKCZzY29wZS0+c3lt
Ym9scywgc3ltKTsKIH0KIAorCit2b2lkIHJlYmluZF9zY29wZShzdHJ1Y3Qgc3ltYm9sICpzeW0s
IHN0cnVjdCBzY29wZSAqbmV3KQoreworCXN0cnVjdCBzY29wZSAqb2xkID0gc3ltLT5zY29wZTsK
KworCWlmIChvbGQgPT0gbmV3KQorCQlyZXR1cm47CisKKwlpZiAob2xkKQorCQlkZWxldGVfcHRy
X2xpc3RfZW50cnkoKHN0cnVjdCBwdHJfbGlzdCoqKSAmb2xkLT5zeW1ib2xzLCBzeW0sIDEpOwor
CisJYmluZF9zY29wZShzeW0sIG5ldyk7Cit9CisKIHN0YXRpYyB2b2lkIHN0YXJ0X3Njb3BlKHN0
cnVjdCBzY29wZSAqKnMpCiB7CiAJc3RydWN0IHNjb3BlICpzY29wZSA9IF9fYWxsb2Nfc2NvcGUo
MCk7CmRpZmYgLS1naXQgYS9zY29wZS5oIGIvc2NvcGUuaAppbmRleCAwNDVjMzU2Li45YmJiNjc1
IDEwMDY0NAotLS0gYS9zY29wZS5oCisrKyBiL3Njb3BlLmgKQEAgLTU1LDYgKzU1LDcgQEAgZXh0
ZXJuIHZvaWQgc3RhcnRfZnVuY3Rpb25fc2NvcGUodm9pZCk7CiBleHRlcm4gdm9pZCBlbmRfZnVu
Y3Rpb25fc2NvcGUodm9pZCk7CiAKIGV4dGVybiB2b2lkIGJpbmRfc2NvcGUoc3RydWN0IHN5bWJv
bCAqLCBzdHJ1Y3Qgc2NvcGUgKik7CitleHRlcm4gdm9pZCByZWJpbmRfc2NvcGUoc3RydWN0IHN5
bWJvbCAqLCBzdHJ1Y3Qgc2NvcGUgKik7CiAKIGV4dGVybiBpbnQgaXNfb3V0ZXJfc2NvcGUoc3Ry
dWN0IHNjb3BlICopOwogI2VuZGlmCi0tIAoxLjkuMwoK
--001a11c12ce6838ed904ffa9660c--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 18:09:01 +0000
Message-ID: <CANeU7QnTx50Hrw3-8vqAc=3e59v7ppnjgS6GVGMwbhOMZvbH9A () mail ! gmail ! com>
--------------------
--001a11c12ce6838ed904ffa9660c
Content-Type: text/plain; charset=ISO-8859-1

On Sat, Aug 2, 2014 at 1:27 AM, Christopher Li <sparse@chrisli.org> wrote:
> I just apply that without the "FIXME" part. That two lines are from an incorrect
> fix for the external inline bug. I just remove it for now. Currently
> sparse will fail
> at the external inline test. I will fix that in a separate patch.

This is a follow up change to fix the extern-inline.c validation bug.
Feed back are welcome.

Consider the following case, extern inline declare after
extern declare of the same function.

extern int g(int);
extern __inline__ int g(int x)
{
        return x;
}

Sparse will give the first function global scope and
the second one file scope. Also the first one will get the
function body from the second one. That cause the failure
of the validation/extern-inlien.c

This change rebind the scope of the same_symbol chain to
the new scope. It will pass the extern-inline.c test case.

Chris

--001a11c12ce6838ed904ffa9660c
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-Make-same_symbol-list-share-the-same-scope.patch"
Content-Disposition: attachment; 
	filename="0001-Make-same_symbol-list-share-the-same-scope.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyd93er70

RnJvbSA3YWJkOGE3NmI0ZTA3YWQ2MGI1MjYyZTRjNzg1OGU2Mzg0NjdmYWI4IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgpE
YXRlOiBTYXQsIDIgQXVnIDIwMTQgMTA6NTY6NTkgLTA3MDAKU3ViamVjdDogW1BBVENIXSBNYWtl
IHNhbWVfc3ltYm9sIGxpc3Qgc2hhcmUgdGhlIHNhbWUgc2NvcGUKCkNvbnNpZGVyIHRoZSBmb2xs
b3dpbmcgY2FzZSwgZXh0ZXJuIGlubGluZSBkZWNsYXJlIGFmdGVyCmV4dGVybiBkZWNsYXJlIG9m
IHRoZSBzYW1lIGZ1bmN0aW9uLgoKZXh0ZXJuIGludCBnKGludCk7CmV4dGVybiBfX2lubGluZV9f
IGludCBnKGludCB4KQp7CiAgICAgICAgcmV0dXJuIHg7Cn0KClNwYXJzZSB3aWxsIGdpdmUgdGhl
IGZpcnN0IGZ1bmN0aW9uIGdsb2JhbCBzY29wZSBhbmQKdGhlIHNlY29uZCBvbmUgZmlsZSBzY29w
ZS4gQWxzbyB0aGUgZmlyc3Qgb25lIHdpbGwgZ2V0IHRoZQpmdW5jdGlvbiBib2R5IGZyb20gdGhl
IHNlY29uZCBvbmUuIFRoYXQgY2F1c2UgdGhlIGZhaWx1cmUKb2YgdGhlIHZhbGlkYXRpb24vZXh0
ZXJuLWlubGllbi5jCgpUaGlzIGNoYW5nZSByZWJpbmQgdGhlIHNjb3BlIG9mIHRoZSBzYW1lX3N5
bWJvbCBjaGFpbiB0bwp0aGUgbmV3IHNjb3BlLiBJdCB3aWxsIHBhc3MgdGhlIGV4dGVybi1pbmxp
bmUuYyB0ZXN0IGNhc2UuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNo
cmlzbGkub3JnPgotLS0KIHBhcnNlLmMgfCAgMSArCiBzY29wZS5jIHwgMTQgKysrKysrKysrKysr
KysKIHNjb3BlLmggfCAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDE2IGluc2VydGlvbnMoKykKCmRp
ZmYgLS1naXQgYS9wYXJzZS5jIGIvcGFyc2UuYwppbmRleCA1NWE1N2E3Li5lYWExODgzIDEwMDY0
NAotLS0gYS9wYXJzZS5jCisrKyBiL3BhcnNlLmMKQEAgLTI2MTEsNiArMjYxMSw3IEBAIHN0YXRp
YyBzdHJ1Y3QgdG9rZW4gKnBhcnNlX2Z1bmN0aW9uX2JvZHkoc3RydWN0IHRva2VuICp0b2tlbiwg
c3RydWN0IHN5bWJvbCAqZGVjCiAJCWluZm8ocHJldi0+ZGVmaW5pdGlvbi0+cG9zLCAiIHRoZSBw
cmV2aW91cyBvbmUgaXMgaGVyZSIpOwogCX0gZWxzZSB7CiAJCXdoaWxlIChwcmV2KSB7CisJCQly
ZWJpbmRfc2NvcGUocHJldiwgZGVjbC0+c2NvcGUpOwogCQkJcHJldi0+ZGVmaW5pdGlvbiA9IGRl
Y2w7CiAJCQlwcmV2ID0gcHJldi0+c2FtZV9zeW1ib2w7CiAJCX0KZGlmZiAtLWdpdCBhL3Njb3Bl
LmMgYi9zY29wZS5jCmluZGV4IGI0MTVhY2UuLmNiZjJmY2YgMTAwNjQ0Ci0tLSBhL3Njb3BlLmMK
KysrIGIvc2NvcGUuYwpAQCAtNDYsNiArNDYsMjAgQEAgdm9pZCBiaW5kX3Njb3BlKHN0cnVjdCBz
eW1ib2wgKnN5bSwgc3RydWN0IHNjb3BlICpzY29wZSkKIAlhZGRfc3ltYm9sKCZzY29wZS0+c3lt
Ym9scywgc3ltKTsKIH0KIAorCit2b2lkIHJlYmluZF9zY29wZShzdHJ1Y3Qgc3ltYm9sICpzeW0s
IHN0cnVjdCBzY29wZSAqbmV3KQoreworCXN0cnVjdCBzY29wZSAqb2xkID0gc3ltLT5zY29wZTsK
KworCWlmIChvbGQgPT0gbmV3KQorCQlyZXR1cm47CisKKwlpZiAob2xkKQorCQlkZWxldGVfcHRy
X2xpc3RfZW50cnkoKHN0cnVjdCBwdHJfbGlzdCoqKSAmb2xkLT5zeW1ib2xzLCBzeW0sIDEpOwor
CisJYmluZF9zY29wZShzeW0sIG5ldyk7Cit9CisKIHN0YXRpYyB2b2lkIHN0YXJ0X3Njb3BlKHN0
cnVjdCBzY29wZSAqKnMpCiB7CiAJc3RydWN0IHNjb3BlICpzY29wZSA9IF9fYWxsb2Nfc2NvcGUo
MCk7CmRpZmYgLS1naXQgYS9zY29wZS5oIGIvc2NvcGUuaAppbmRleCAwNDVjMzU2Li45YmJiNjc1
IDEwMDY0NAotLS0gYS9zY29wZS5oCisrKyBiL3Njb3BlLmgKQEAgLTU1LDYgKzU1LDcgQEAgZXh0
ZXJuIHZvaWQgc3RhcnRfZnVuY3Rpb25fc2NvcGUodm9pZCk7CiBleHRlcm4gdm9pZCBlbmRfZnVu
Y3Rpb25fc2NvcGUodm9pZCk7CiAKIGV4dGVybiB2b2lkIGJpbmRfc2NvcGUoc3RydWN0IHN5bWJv
bCAqLCBzdHJ1Y3Qgc2NvcGUgKik7CitleHRlcm4gdm9pZCByZWJpbmRfc2NvcGUoc3RydWN0IHN5
bWJvbCAqLCBzdHJ1Y3Qgc2NvcGUgKik7CiAKIGV4dGVybiBpbnQgaXNfb3V0ZXJfc2NvcGUoc3Ry
dWN0IHNjb3BlICopOwogI2VuZGlmCi0tIAoxLjkuMwoK
--001a11c12ce6838ed904ffa9660c--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 18:10:59 +0000
Message-ID: <CA+55aFzfdfh80o1-BUA4CqurZ_A94cbNwCxHJZi-aFdLc+hF+w () mail ! gmail ! com>
--------------------
On Fri, Aug 1, 2014 at 10:16 PM, Christopher Li <sparse@chrisli.org> wrote:
>
> Sorry I am late for the party. This approach assume the anonymous
> structure is only referenced inside the structure.

It does indeed. I thought that was ok.

> There is not other
> external reference. However, that assumption is not true if "-fplan9-extensions"
> or "-fms-extensions" was enabled. Sparse current does not support these
> two extensions. But it will be a problem if we support them down the road.

.. and in fact I think even without those things, you can just make
the unnamed union have a type name, ie

   struct S {
      union T {
          int a;
      }
   };

the union T has a typename, but is a unnamed member of struct S. We
could use "union T" later.

> Actually, the "find_identifier" call inside function "check_designators" already
> calculate the correct offset. Only if we can pass that offset to
> "convert_ident()".

I actually tried that initially, and wanted to get rid of the whole
"check_designators()" vs "convert_designators()", but couldn't really
find a sane way to make that work. I'll look at it again, maybe I
missed something.

             LInus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Derek M Jones <derek () knosof ! co ! uk>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 18:31:20 +0000
Message-ID: <53DD2E78.2050609 () knosof ! co ! uk>
--------------------
Linus,

> .. and in fact I think even without those things, you can just make
> the unnamed union have a type name, ie
>
>     struct S {
>        union T {
>            int a;
>        }
>     };
>
> the union T has a typename, but is a unnamed member of struct S. We
> could use "union T" later.

No such luck, not allowed by the C Standard.

6.7.2.1p13
"An unnamed member whose type specifier is a structure specifier with
no tag is called an anonymous structure; an unnamed member whose type
specifier is a union specifier with no tag is called an anonymous union"

But you can do this sort of thing when the type specifier is not anonymous.

-- 
Derek M. Jones                  tel: +44 (0) 1252 520 667
Knowledge Software Ltd          blog:shape-of-code.coding-guidelines.com
Software analysis               http://www.knosof.co.uk
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Derek M Jones <derek () knosof ! co ! uk>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 18:31:20 +0000
Message-ID: <53DD2E78.2050609 () knosof ! co ! uk>
--------------------
Linus,

> .. and in fact I think even without those things, you can just make
> the unnamed union have a type name, ie
>
>     struct S {
>        union T {
>            int a;
>        }
>     };
>
> the union T has a typename, but is a unnamed member of struct S. We
> could use "union T" later.

No such luck, not allowed by the C Standard.

6.7.2.1p13
"An unnamed member whose type specifier is a structure specifier with
no tag is called an anonymous structure; an unnamed member whose type
specifier is a union specifier with no tag is called an anonymous union"

But you can do this sort of thing when the type specifier is not anonymous.

-- 
Derek M. Jones                  tel: +44 (0) 1252 520 667
Knowledge Software Ltd          blog:shape-of-code.coding-guidelines.com
Software analysis               http://www.knosof.co.uk
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 18:40:23 +0000
Message-ID: <CANeU7Qkrb-Q49JqpKy4fpBzFziCJxS_TCb22sxvpeGNrD6aqBQ () mail ! gmail ! com>
--------------------
On Sat, Aug 2, 2014 at 11:31 AM, Derek M Jones <derek@knosof.co.uk> wrote:
>> .. and in fact I think even without those things, you can just make
>> the unnamed union have a type name, ie
>>
>>     struct S {
>>        union T {
>>            int a;
>>        }
>>     };
>>
>> the union T has a typename, but is a unnamed member of struct S. We
>> could use "union T" later.
>
>
> No such luck, not allowed by the C Standard.
>
> 6.7.2.1p13
> "An unnamed member whose type specifier is a structure specifier with
> no tag is called an anonymous structure; an unnamed member whose type
> specifier is a union specifier with no tag is called an anonymous union"
>
> But you can do this sort of thing when the type specifier is not anonymous.

That is what I recall as well, not part of stander C. If you enable
the "-fplan9-extensions",
Linus' example can pass.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 19:53:56 +0000
Message-ID: <CA+55aFzWAZ-ZQ6DSvnj6vQnwCHyDX11an1nOAo43UGaLcfshwg () mail ! gmail ! com>
--------------------
--001a11339974bbe0b404ffaaddb1
Content-Type: text/plain; charset=UTF-8

On Sat, Aug 2, 2014 at 11:10 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
>> Actually, the "find_identifier" call inside function "check_designators" already
>> calculate the correct offset. Only if we can pass that offset to
>> "convert_ident()".
>
> I actually tried that initially, and wanted to get rid of the whole
> "check_designators()" vs "convert_designators()", but couldn't really
> find a sane way to make that work. I'll look at it again, maybe I
> missed something.

No, I didn't miss anything.

The "trivial fix" is to just save off the offset in check_designators
(add a new field to the "EXPR_IDENTIFIER" part of "struct expression"
and then pick up that offset in "convert_ident()"

However, that has exactly the same issue with the whole fake
EXPR_IDENTIFIER created by "next_designators()". Now we need to
initialize the offset field there too. And, for the same reason as
before, the field that "next_designator()" picks may not *have* an
identifier, because the next designator may in fact be an anonymous
union.

Anyway, with all that said, maybe this really confusing and hacky
patch would work. It passes my tests. The magic offset calculation in
next_designators() has a big comment about what the heck it is doing,
and otherwise it's a fairly straightforward case of "save offset from
check_designators() time to be used by convert_ident()".

My stupid test-case is this incredibly hacky thing:

    struct A {
        int aa;
        int bb;
    };

    struct S {
        int a;
        union {
            int b;
            int c;
        } u[10];
        int dummy;
        union {
            int d;
            int e;
        };
    };

    int fn(void)
    {
        struct S s = {
            .a = 1,
            .u[2].b = 2,
            .dummy = 1,
             { 3 }
        };
        return s.dummy*1000 + s.d*100 + s.u[2].b*10 + s.a; // 1321
    }

where I use "./test-linearize" to verify that the initializer layout
matches the code generation layout (so that 'fn' function *should*
linearize to just a simple "ret.32 $1321", and with this patch it
does).

But I bet this misses some case. However, the current state wrt
initializer offsets really is very broken, so maybe it's ok.

Can anybody see anything wrong with it? It's reasonably simple. Every
place that initializes "expr->field" for an EXPR_IDENTIFIER now also
initializes "expr->offset".

              Linus

--001a11339974bbe0b404ffaaddb1
Content-Type: text/plain; charset=US-ASCII; name="patch.diff"
Content-Disposition: attachment; filename="patch.diff"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hydcwl300

IGV2YWx1YXRlLmMgICB8IDIwICsrKysrKysrKysrKysrKysrKy0tCiBleHByZXNzaW9uLmggfCAg
MSArCiAyIGZpbGVzIGNoYW5nZWQsIDE5IGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZXZhbHVhdGUuYyBiL2V2YWx1YXRlLmMKaW5kZXggMDM5OTJkMDNhZTFkLi4z
MWE2YTQ5MzI5YjggMTAwNjQ0Ci0tLSBhL2V2YWx1YXRlLmMKKysrIGIvZXZhbHVhdGUuYwpAQCAt
MjIyMyw5ICsyMjIzLDEwIEBAIHN0YXRpYyB2b2lkIGNvbnZlcnRfaW5kZXgoc3RydWN0IGV4cHJl
c3Npb24gKmUpCiBzdGF0aWMgdm9pZCBjb252ZXJ0X2lkZW50KHN0cnVjdCBleHByZXNzaW9uICpl
KQogewogCXN0cnVjdCBleHByZXNzaW9uICpjaGlsZCA9IGUtPmlkZW50X2V4cHJlc3Npb247Ci0J
c3RydWN0IHN5bWJvbCAqc3ltID0gZS0+ZmllbGQ7CisJaW50IG9mZnNldCA9IGUtPm9mZnNldDsK
KwogCWUtPnR5cGUgPSBFWFBSX1BPUzsKLQllLT5pbml0X29mZnNldCA9IHN5bS0+b2Zmc2V0Owor
CWUtPmluaXRfb2Zmc2V0ID0gb2Zmc2V0OwogCWUtPmluaXRfbnIgPSAxOwogCWUtPmluaXRfZXhw
ciA9IGNoaWxkOwogfQpAQCAtMjI3Nyw2ICsyMjc4LDcgQEAgc3RhdGljIHN0cnVjdCBleHByZXNz
aW9uICpmaXJzdF9zdWJvYmplY3Qoc3RydWN0IHN5bWJvbCAqY3R5cGUsIGludCBjbGFzcywKIAkJ
bmV3ID0gYWxsb2NfZXhwcmVzc2lvbihlLT5wb3MsIEVYUFJfSURFTlRJRklFUik7CiAJCW5ldy0+
aWRlbnRfZXhwcmVzc2lvbiA9IGU7CiAJCW5ldy0+ZmllbGQgPSBuZXctPmN0eXBlID0gZmllbGQ7
CisJCW5ldy0+b2Zmc2V0ID0gZmllbGQtPm9mZnNldDsKIAl9CiAJKnYgPSBuZXc7CiAJcmV0dXJu
IG5ldzsKQEAgLTIzMjcsNiArMjMyOSw3IEBAIHN0YXRpYyBzdHJ1Y3QgZXhwcmVzc2lvbiAqY2hl
Y2tfZGVzaWduYXRvcnMoc3RydWN0IGV4cHJlc3Npb24gKmUsCiAJCQkJZXJyID0gInVua25vd24g
ZmllbGQgbmFtZSBpbiI7CiAJCQkJYnJlYWs7CiAJCQl9CisJCQllLT5vZmZzZXQgPSBvZmZzZXQ7
CiAJCQllLT5maWVsZCA9IGUtPmN0eXBlID0gY3R5cGU7CiAJCQlsYXN0ID0gZTsKIAkJCWlmICgh
ZS0+aWRlbnRfZXhwcmVzc2lvbikgewpAQCAtMjM4Niw2ICsyMzg5LDcgQEAgc3RhdGljIHN0cnVj
dCBleHByZXNzaW9uICpuZXh0X2Rlc2lnbmF0b3JzKHN0cnVjdCBleHByZXNzaW9uICpvbGQsCiAJ
fSBlbHNlIGlmIChvbGQtPnR5cGUgPT0gRVhQUl9JREVOVElGSUVSKSB7CiAJCXN0cnVjdCBleHBy
ZXNzaW9uICpjb3B5OwogCQlzdHJ1Y3Qgc3ltYm9sICpmaWVsZDsKKwkJaW50IG9mZnNldCA9IDA7
CiAKIAkJY29weSA9IG5leHRfZGVzaWduYXRvcnMob2xkLT5pZGVudF9leHByZXNzaW9uLAogCQkJ
CQlvbGQtPmN0eXBlLCBlLCB2KTsKQEAgLTIzOTcsNiArMjQwMSwxNyBAQCBzdGF0aWMgc3RydWN0
IGV4cHJlc3Npb24gKm5leHRfZGVzaWduYXRvcnMoc3RydWN0IGV4cHJlc3Npb24gKm9sZCwKIAkJ
CX0KIAkJCWNvcHkgPSBlOwogCQkJKnYgPSBuZXcgPSBhbGxvY19leHByZXNzaW9uKGUtPnBvcywg
RVhQUl9JREVOVElGSUVSKTsKKwkJCS8qCisJCQkgKiBXZSBjYW4ndCBuZWNlc3NhcmlseSB0cnVz
dCAiZmllbGQtPm9mZnNldCIsCisJCQkgKiBiZWNhdXNlIHRoZSBmaWVsZCBtaWdodCBiZSBpbiBh
biBhbm9ueW1vdXMKKwkJCSAqIHVuaW9uLCBhbmQgdGhlIGZpZWxkIG9mZnNldCBpcyB0aGVuIHRo
ZSBvZmZzZXQKKwkJCSAqIHdpdGhpbiB0aGF0IHVuaW9uLgorCQkJICoKKwkJCSAqIFRoZSAib2xk
LT5vZmZzZXQgLSBvbGQtPmZpZWxkLT5vZmZzZXQiCisJCQkgKiB3b3VsZCBiZSB0aGUgb2Zmc2V0
IG9mIHN1Y2ggYW4gYW5vbnltb3VzCisJCQkgKiB1bmlvbi4KKwkJCSAqLworCQkJb2Zmc2V0ID0g
b2xkLT5vZmZzZXQgLSBvbGQtPmZpZWxkLT5vZmZzZXQ7CiAJCX0gZWxzZSB7CiAJCQlmaWVsZCA9
IG9sZC0+ZmllbGQ7CiAJCQluZXcgPSBhbGxvY19leHByZXNzaW9uKGUtPnBvcywgRVhQUl9JREVO
VElGSUVSKTsKQEAgLTI0MDYsNiArMjQyMSw3IEBAIHN0YXRpYyBzdHJ1Y3QgZXhwcmVzc2lvbiAq
bmV4dF9kZXNpZ25hdG9ycyhzdHJ1Y3QgZXhwcmVzc2lvbiAqb2xkLAogCQluZXctPmV4cHJfaWRl
bnQgPSBmaWVsZC0+aWRlbnQ7CiAJCW5ldy0+aWRlbnRfZXhwcmVzc2lvbiA9IGNvcHk7CiAJCW5l
dy0+Y3R5cGUgPSBmaWVsZDsKKwkJbmV3LT5vZmZzZXQgPSBmaWVsZC0+b2Zmc2V0ICsgb2Zmc2V0
OwogCQljb252ZXJ0X2lkZW50KG9sZCk7CiAJfQogCXJldHVybiBuZXc7CmRpZmYgLS1naXQgYS9l
eHByZXNzaW9uLmggYi9leHByZXNzaW9uLmgKaW5kZXggZTMxZDE0MDUxZTAxLi44MGIzYmU1ZjUy
NmYgMTAwNjQ0Ci0tLSBhL2V4cHJlc3Npb24uaAorKysgYi9leHByZXNzaW9uLmgKQEAgLTE0OSw2
ICsxNDksNyBAQCBzdHJ1Y3QgZXhwcmVzc2lvbiB7CiAJCXN0cnVjdCBleHByZXNzaW9uX2xpc3Qg
KmV4cHJfbGlzdDsKIAkJLy8gRVhQUl9JREVOVElGSUVSCiAJCXN0cnVjdCAvKiBpZGVudF9leHBy
ICovIHsKKwkJCWludCBvZmZzZXQ7CiAJCQlzdHJ1Y3QgaWRlbnQgKmV4cHJfaWRlbnQ7CiAJCQlz
dHJ1Y3Qgc3ltYm9sICpmaWVsZDsKIAkJCXN0cnVjdCBleHByZXNzaW9uICppZGVudF9leHByZXNz
aW9uOwo=
--001a11339974bbe0b404ffaaddb1--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 20:09:02 +0000
Message-ID: <CA+55aFwXGioNQenk1gBPWrDpx2icmthpadTYO1uHzE5co0W4VA () mail ! gmail ! com>
--------------------
On Sat, Aug 2, 2014 at 12:53 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> My stupid test-case is this incredibly hacky thing:

.. actually, that test-case wasn't the one that showed the original
problem, it just ends up testing many of the other cases, notably the
"next_designator() creates that unnamed union case".

The test-case that shows the problem this patch fixes is one that
actually names the unnamed union entry (so instead of the "{ 3 }"
initializer, it uses ".d=3" to initialize the entry in the unnamed
union.

Just to clarify. See the difference in code generation by
"test-linearize" for those two cases (ie "{3}" vs ".d=3" in the
initializer).

          Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Sat, 02 Aug 2014 20:09:02 +0000
Message-ID: <CA+55aFwXGioNQenk1gBPWrDpx2icmthpadTYO1uHzE5co0W4VA () mail ! gmail ! com>
--------------------
On Sat, Aug 2, 2014 at 12:53 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
>
> My stupid test-case is this incredibly hacky thing:

.. actually, that test-case wasn't the one that showed the original
problem, it just ends up testing many of the other cases, notably the
"next_designator() creates that unnamed union case".

The test-case that shows the problem this patch fixes is one that
actually names the unnamed union entry (so instead of the "{ 3 }"
initializer, it uses ".d=3" to initialize the entry in the unnamed
union.

Just to clarify. See the difference in code generation by
"test-linearize" for those two cases (ie "{3}" vs ".d=3" in the
initializer).

          Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Wed, 06 Aug 2014 09:15:18 +0000
Message-ID: <CANeU7QkJdCWZggG=XnsdD54+2FUvG9SKLKG7141s62jOesJ_nA () mail ! gmail ! com>
--------------------
On Sat, Aug 2, 2014 at 12:53 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> On Sat, Aug 2, 2014 at 11:10 AM, Linus Torvalds
> <torvalds@linux-foundation.org> wrote:
>>
>>> Actually, the "find_identifier" call inside function "check_designators" already
>>> calculate the correct offset. Only if we can pass that offset to
>>> "convert_ident()".
>>
>> I actu
> My stupid test-case is this incredibly hacky thing:
>
>     struct A {
>         int aa;
>         int bb;
>     };
>
>     struct S {
>         int a;
>         union {
>             int b;
>             int c;
>         } u[10];
>         int dummy;
>         union {
>             int d;
>             int e;
>         };
>     };
>
>     int fn(void)
>     {
>         struct S s = {
>             .a = 1,
>             .u[2].b = 2,
>             .dummy = 1,
>              { 3 }
>         };
>         return s.dummy*1000 + s.d*100 + s.u[2].b*10 + s.a; // 1321
>     }
>
> where I use "./test-linearize" to verify that the initializer layout
> matches the code generation layout (so that 'fn' function *should*
> linearize to just a simple "ret.32 $1321", and with this patch it
> does).
>
> But I bet this misses some case. However, the current state wrt
> initializer offsets really is very broken, so maybe it's ok.
>
> Can anybody see anything wrong with it? It's reasonably simple. Every
> place that initializes "expr->field" for an EXPR_IDENTIFIER now also
> initializes "expr->offset".

I did not see any thing wrong with it. The only thing is it bump up the
expression struct size. Definitely better than what we have right now.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Designated initializers for fields in anonymous structs and unions
Date: Wed, 06 Aug 2014 09:15:18 +0000
Message-ID: <CANeU7QkJdCWZggG=XnsdD54+2FUvG9SKLKG7141s62jOesJ_nA () mail ! gmail ! com>
--------------------
On Sat, Aug 2, 2014 at 12:53 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> On Sat, Aug 2, 2014 at 11:10 AM, Linus Torvalds
> <torvalds@linux-foundation.org> wrote:
>>
>>> Actually, the "find_identifier" call inside function "check_designators" already
>>> calculate the correct offset. Only if we can pass that offset to
>>> "convert_ident()".
>>
>> I actu
> My stupid test-case is this incredibly hacky thing:
>
>     struct A {
>         int aa;
>         int bb;
>     };
>
>     struct S {
>         int a;
>         union {
>             int b;
>             int c;
>         } u[10];
>         int dummy;
>         union {
>             int d;
>             int e;
>         };
>     };
>
>     int fn(void)
>     {
>         struct S s = {
>             .a = 1,
>             .u[2].b = 2,
>             .dummy = 1,
>              { 3 }
>         };
>         return s.dummy*1000 + s.d*100 + s.u[2].b*10 + s.a; // 1321
>     }
>
> where I use "./test-linearize" to verify that the initializer layout
> matches the code generation layout (so that 'fn' function *should*
> linearize to just a simple "ret.32 $1321", and with this patch it
> does).
>
> But I bet this misses some case. However, the current state wrt
> initializer offsets really is very broken, so maybe it's ok.
>
> Can anybody see anything wrong with it? It's reasonably simple. Every
> place that initializes "expr->field" for an EXPR_IDENTIFIER now also
> initializes "expr->offset".

I did not see any thing wrong with it. The only thing is it bump up the
expression struct size. Definitely better than what we have right now.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Fwd: [PATCH 01/10] Add the __restrict__ keyword ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: Fwd: [PATCH 01/10] Add the __restrict__ keyword
Date: Thu, 07 Aug 2014 20:02:02 +0000
Message-ID: <53E3DB3A.5000909 () ramsay1 ! demon ! co ! uk>
--------------------
On 07/08/14 04:04, Christopher Li wrote:
> Send again to the list with plain text mode.
> 
>> No, __restrict__ is only applied to various pointer types in the MinGW
>> header files (see below). So, I agree that validation/reserved.c is not
>> exactly representative of the actual use of __restrict__ (or *any* of the
>> keywords come to that), but that does at least provide a minimal test.
> 
> 
> Let me clarify. I want to have some regression test cover your usage case.
> e.g. If I rewrite some part of sparse and breaks __restrict__ but did not break
> __restrict, I will have not way of knowing it. So please submit corresponding
> test case.

Yep, version 2 of patch coming soon.

> __restrict__ does not seem like part of the stander C. BTW, did you try
> to use gcc -E to find out if __restrict__ expand to any thing like "__restrict"?

Yes, the header is using the keyword __restrict__. (I have found that headers
tend to use __restrict if they are using macros).

>> Having said that, I think I see two tests included for the array declaration
>> usage: abstract-array-declarator-static.c and restrict-array.c.
>>
> I don't see it cover the __restrict__ case as far as I can tell.

Yes, I didn't get that you were talking specifically about __restrict__,
rather than any one of 'restrict', '__restrict' or '__restrict__'.

> Also, do you have run into the case that "__restrict__" was use in abstract
> array? None of your grep example show usage in the array. Your patch seems
> suggest that is possible.

They are very rare in the wild! :-D

The only examples I have come across for real are 'posix_spawn()' (see
<spawn.h>) and 'regexec()' (<regex.h>).

ATB,
Ramsay Jones


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: How to fix: asm output is not an lvalue ===

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: How to fix: asm output is not an lvalue
Date: Sat, 26 Apr 2014 23:44:13 +0000
Message-ID: <CA+55aFx0QAPEDBEyb+fDsb+Asb-q_6tb7K=KMLP4o4DxncxSpg () mail ! gmail ! com>
--------------------
On Sat, Apr 26, 2014 at 2:57 PM, Sam Ravnborg <sam@ravnborg.org> wrote:
>
> Following code snippet generate these warnings:
> t.c:9:9: warning: asm output is not an lvalue

Yeah. That code snippet is pure and utter garbage.

Gcc has this totally insane extension that makes casts be lvalues.
It's stupid and horrid, and pointless to boot. So apparently gcc
accepts that crap.

But it is very much total crap.

Those casts to (USItype) are all pointless to begin with (since the
values are of that type already!) and they mean that the expression
isn't something you can assign to (lvalue). The fact that gcc accepts
code like that is an embarrassment.

            Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-sparse
Subject: Re: How to fix: asm output is not an lvalue
Date: Sun, 27 Apr 2014 06:48:04 +0000
Message-ID: <20140427064803.GA31264 () ravnborg ! org>
--------------------
On Sat, Apr 26, 2014 at 04:44:13PM -0700, Linus Torvalds wrote:
> On Sat, Apr 26, 2014 at 2:57 PM, Sam Ravnborg <sam@ravnborg.org> wrote:
> >
> > Following code snippet generate these warnings:
> > t.c:9:9: warning: asm output is not an lvalue
> 
> Yeah. That code snippet is pure and utter garbage.
> 
> Gcc has this totally insane extension that makes casts be lvalues.
> It's stupid and horrid, and pointless to boot. So apparently gcc
> accepts that crap.
> 
> But it is very much total crap.
> 
> Those casts to (USItype) are all pointless to begin with (since the
> values are of that type already!) and they mean that the expression
> isn't something you can assign to (lvalue). The fact that gcc accepts
> code like that is an embarrassment.

Thanks.
When I dropped the casts to the output values the warnings were gone.

Now the code is down to ~30 warnings - looks like this.
math_32.c:371:17: warning: shift too big (4294967267) for type unsigned long
math_32.c:428:21: warning: shift too big (63) for type unsigned long

But this code is so full of macros that it is not funny :-(

	Sam
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-sparse
Subject: Re: How to fix: asm output is not an lvalue
Date: Sun, 27 Apr 2014 08:41:29 +0000
Message-ID: <20140427084129.GA10056 () ravnborg ! org>
--------------------
On Sat, Apr 26, 2014 at 11:57:34PM -0700, Josh Triplett wrote:
> On Sun, Apr 27, 2014 at 08:48:04AM +0200, Sam Ravnborg wrote:
> > On Sat, Apr 26, 2014 at 04:44:13PM -0700, Linus Torvalds wrote:
> > > On Sat, Apr 26, 2014 at 2:57 PM, Sam Ravnborg <sam@ravnborg.org> wrote:
> > > >
> > > > Following code snippet generate these warnings:
> > > > t.c:9:9: warning: asm output is not an lvalue
> > > 
> > > Yeah. That code snippet is pure and utter garbage.
> > > 
> > > Gcc has this totally insane extension that makes casts be lvalues.
> > > It's stupid and horrid, and pointless to boot. So apparently gcc
> > > accepts that crap.
> > > 
> > > But it is very much total crap.
> > > 
> > > Those casts to (USItype) are all pointless to begin with (since the
> > > values are of that type already!) and they mean that the expression
> > > isn't something you can assign to (lvalue). The fact that gcc accepts
> > > code like that is an embarrassment.
> > 
> > Thanks.
> > When I dropped the casts to the output values the warnings were gone.
> > 
> > Now the code is down to ~30 warnings - looks like this.
> > math_32.c:371:17: warning: shift too big (4294967267) for type unsigned long
> 
> That one looks like a bug; that's just below 2**32 (4294967296), which
> makes no sense as a shift.  Perhaps there's a precedence issue?

Deep down in some macro expansion I found the following:

$ cat t.c
void foo(void);
int x;
int y;

static void todo(void)
{

        if (3 < 32)
                foo();
        else
                x = y << (3 - 32);
}


This produces the same warning.
But the if expression is always true so the else part could be ignored.

This is line 52 in include/math/op-2.h in the kernel if someone
wants to take a look...
I have no test-suite for the softfloat stuff, so I am not going to touch this code...

	Sam
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Kind Regards ===

From: Abdul Nasser <abdulnas500 () justin ! ddo ! jp>
To: linux-sparse
Subject: Kind Regards
Date: Sun, 26 Jan 2014 22:31:41 +0000
Message-ID: <SECEXCHANGEezrmjZ7z00006363 () mail ! standardelectronics ! com>
--------------------
Greetings,
My name is Abdul Nasser Sokariah and I am writing you from Syria, I choose to contact you directly as I need a reliable person to trust who can help me handle my huge deposit  with a vault company in EUROPE, and based on my present situation in Syria, I need you urgently to take possession of everything and further modalities/directives will follow.Please reply to my private  Email: nasserabdul190@yahoo.com

I wait for your response.

Yours truly,
Abdul Nasser Sokariah
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: My Dear Beloved! ===

From: "Ho Chen Tung" <hochentung45 () gmail ! com>
To: linux-sparse
Subject: My Dear Beloved!
Date: Tue, 29 Jul 2014 20:22:37 +0000
Message-ID: <SHOLAND-SERVER8Npqh00000417 () sholandllc ! com>
--------------------
Contact me with acceptance to transfer $21,410,000.00 to you. I will tell you the facts after I get your reply.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Possible bug with _Static_assert & sparse ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Possible bug with _Static_assert & sparse
Date: Sat, 02 Aug 2014 05:29:04 +0000
Message-ID: <CANeU7QkfSiU6WX_TND++E=zWNBeWWPTj7F722Kij1q=tKqmzgQ () mail ! gmail ! com>
--------------------
--089e0158b2ccc4407804ff9ec8cf
Content-Type: text/plain; charset=ISO-8859-1

On Wed, Jul 30, 2014 at 10:32 AM, Mike Holmes <mike.holmes@linaro.org> wrote:
> Hi
>
> I wondered if the following sparse error indication was expected
> behaviour or if it is a bug,
> I would not expect sparse to error with "got 9"
>
>
> $ cat static.c
> #include <stdio.h>
>
> #define fake 9
> _Static_assert( fake > 8, "test message");
>


I create a patch to parse the _Static_assert and static_assert.
Because _Static_assert can happen on the top level declare. It is
not really a statement. My patch is not complete because
parse_static_assert() does not save the parsing result for later
evaluation. I need to figure out where to store it because it is
not a statement and it has no effect on back ends. Suggestions
are welcome.

Chris

--089e0158b2ccc4407804ff9ec8cf
Content-Type: text/x-patch; charset=US-ASCII; name="static-assert.patch"
Content-Disposition: attachment; filename="static-assert.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hyci1lzx0

ZGlmZiAtLWdpdCBhL3BhcnNlLmMgYi9wYXJzZS5jCmluZGV4IDU1YTU3YTcuLjU5ZmM5MzQgMTAw
NjQ0Ci0tLSBhL3BhcnNlLmMKKysrIGIvcGFyc2UuYwpAQCAtNzMsNiArNzMsOCBAQCBzdGF0aWMg
c3RydWN0IHRva2VuICpwYXJzZV9jb250ZXh0X3N0YXRlbWVudChzdHJ1Y3QgdG9rZW4gKnRva2Vu
LCBzdHJ1Y3Qgc3RhdGVtZQogc3RhdGljIHN0cnVjdCB0b2tlbiAqcGFyc2VfcmFuZ2Vfc3RhdGVt
ZW50KHN0cnVjdCB0b2tlbiAqdG9rZW4sIHN0cnVjdCBzdGF0ZW1lbnQgKnN0bXQpOwogc3RhdGlj
IHN0cnVjdCB0b2tlbiAqcGFyc2VfYXNtX3N0YXRlbWVudChzdHJ1Y3QgdG9rZW4gKnRva2VuLCBz
dHJ1Y3Qgc3RhdGVtZW50ICpzdG10KTsKIHN0YXRpYyBzdHJ1Y3QgdG9rZW4gKnRvcGxldmVsX2Fz
bV9kZWNsYXJhdGlvbihzdHJ1Y3QgdG9rZW4gKnRva2VuLCBzdHJ1Y3Qgc3ltYm9sX2xpc3QgKips
aXN0KTsKK3N0YXRpYyBzdHJ1Y3QgdG9rZW4gKnBhcnNlX3N0YXRpY19hc3NlcnRfc3RhdGVtZW50
KHN0cnVjdCB0b2tlbiAqdG9rZW4sIHN0cnVjdCBzdGF0ZW1lbnQgKnN0bXQpOworc3RhdGljIHN0
cnVjdCB0b2tlbiAqdG9wbGV2ZWxfc3RhdGljX2Fzc2VydF9kZWNsYXJhdGlvbihzdHJ1Y3QgdG9r
ZW4gKnRva2VuLCBzdHJ1Y3Qgc3ltYm9sX2xpc3QgKipsaXN0KTsKIAogdHlwZWRlZiBzdHJ1Y3Qg
dG9rZW4gKmF0dHJfdChzdHJ1Y3QgdG9rZW4gKiwgc3RydWN0IHN5bWJvbCAqLAogCQkJICAgICBz
dHJ1Y3QgZGVjbF9zdGF0ZSAqKTsKQEAgLTMwOCw2ICszMTAsMTEgQEAgc3RhdGljIHN0cnVjdCBz
eW1ib2xfb3AgYXNtX29wID0gewogCS50b3BsZXZlbCA9IHRvcGxldmVsX2FzbV9kZWNsYXJhdGlv
biwKIH07CiAKK3N0YXRpYyBzdHJ1Y3Qgc3ltYm9sX29wIHN0YXRpY19hc3NlcnRfb3AgPSB7CisJ
LnN0YXRlbWVudCA9IHBhcnNlX3N0YXRpY19hc3NlcnRfc3RhdGVtZW50LAorCS50b3BsZXZlbCA9
IHRvcGxldmVsX3N0YXRpY19hc3NlcnRfZGVjbGFyYXRpb24sCit9OworCiBzdGF0aWMgc3RydWN0
IHN5bWJvbF9vcCBwYWNrZWRfb3AgPSB7CiAJLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZV9wYWNrZWQs
CiB9OwpAQCAtNDYwLDYgKzQ2Nyw4IEBAIHN0YXRpYyBzdHJ1Y3QgaW5pdF9rZXl3b3JkIHsKIAl7
ICJhc20iLAlOU19LRVlXT1JELCAub3AgPSAmYXNtX29wIH0sCiAJeyAiX19hc20iLAlOU19LRVlX
T1JELCAub3AgPSAmYXNtX29wIH0sCiAJeyAiX19hc21fXyIsCU5TX0tFWVdPUkQsIC5vcCA9ICZh
c21fb3AgfSwKKwl7ICJzdGF0aWNfYXNzZXJ0IiwgTlNfS0VZV09SRCwgLm9wID0gJnN0YXRpY19h
c3NlcnRfb3AgfSwKKwl7ICJfU3RhdGljX2Fzc2VydCIsIE5TX0tFWVdPUkQsIC5vcCA9ICZzdGF0
aWNfYXNzZXJ0X29wIH0sCiAKIAkvKiBBdHRyaWJ1dGUgKi8KIAl7ICJwYWNrZWQiLAlOU19LRVlX
T1JELCAub3AgPSAmcGFja2VkX29wIH0sCkBAIC0yMDAzLDYgKzIwMTIsMjkgQEAgc3RhdGljIHN0
cnVjdCB0b2tlbiAqcGFyc2VfYXNtX2RlY2xhcmF0b3Ioc3RydWN0IHRva2VuICp0b2tlbiwgc3Ry
dWN0IGRlY2xfc3RhdGUKIAlyZXR1cm4gdG9rZW47CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgdG9rZW4g
KnBhcnNlX3N0YXRpY19hc3NlcnQoc3RydWN0IHRva2VuICogdG9rZW4pCit7CisJc3RydWN0IGV4
cHJlc3Npb24gKmV4cHIgPSBOVUxMOworCisJdG9rZW4gPSBleHBlY3QodG9rZW4tPm5leHQsICco
JywgImFmdGVyIHN0YXRpYyBhc3NlcnQiKTsKKwl0b2tlbiA9IGNvbmRpdGlvbmFsX2V4cHJlc3Np
b24odG9rZW4sICZleHByKTsKKwl0b2tlbiA9IGV4cGVjdCh0b2tlbiwgJywnLCAiYWZ0ZXIgY29u
c3RhbnQgZXhwcmVzc2lvbiBvZiBzdGF0aWMgYXNzZXJ0Iik7CisJdG9rZW4gPSBwYXJzZV9leHBy
ZXNzaW9uKHRva2VuLCAmZXhwcik7CisJdG9rZW4gPSBleHBlY3QodG9rZW4sICcpJywgImFmdGVy
IHN0YXRpYyBhc3NlcnQiKTsKKwlyZXR1cm4gZXhwZWN0KHRva2VuLCAnOycsICJhdCBlbmQgb2Yg
c3RhdGljIGFzc2VydCIpOworfQorCitzdGF0aWMgc3RydWN0IHRva2VuICpwYXJzZV9zdGF0aWNf
YXNzZXJ0X3N0YXRlbWVudChzdHJ1Y3QgdG9rZW4gKnRva2VuLCBzdHJ1Y3Qgc3RhdGVtZW50ICpz
dG10KQoreworCXJldHVybiBwYXJzZV9zdGF0aWNfYXNzZXJ0KHRva2VuKTsKK30KKworc3RhdGlj
IHN0cnVjdCB0b2tlbiAqdG9wbGV2ZWxfc3RhdGljX2Fzc2VydF9kZWNsYXJhdGlvbihzdHJ1Y3Qg
dG9rZW4gKnRva2VuLCBzdHJ1Y3Qgc3ltYm9sX2xpc3QgKipsaXN0KQoreworCXJldHVybiBwYXJz
ZV9zdGF0aWNfYXNzZXJ0KHRva2VuKTsKK30KKworCiAvKiBNYWtlIGEgc3RhdGVtZW50IG91dCBv
ZiBhbiBleHByZXNzaW9uICovCiBzdGF0aWMgc3RydWN0IHN0YXRlbWVudCAqbWFrZV9zdGF0ZW1l
bnQoc3RydWN0IGV4cHJlc3Npb24gKmV4cHIpCiB7Cg==
--089e0158b2ccc4407804ff9ec8cf--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse 0.5.0 ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Sparse 0.5.0
Date: Tue, 01 Apr 2014 16:41:17 +0000
Message-ID: <CANeU7Qmk_AhDhYnk=1O-3C7aM_yNBqT_pHzhk0cwJMB-C68TCQ () mail ! gmail ! com>
--------------------
As a lot of you have already noticed. The sparse 0.5.0 has been
tagged and upload to the kernel.org for a while.

One of the most noticeable change of the sparse 0.5.0 is the
license. The sparse project has finally move to the MIT license.
Thanks for the hard work of Dan Carpenter and Franz Schrober,
who contact and collect permissions from the sparse developers.
We actually manage to get *all* developer's blessing on the MIT
license.

This release also has some enhancement matching the latest
kernel source annotations. It will reduce the noise level of the sparse
warnings.

So there you have it. The official announcement of the sparse 0.5.0.

Chris

---
Al Viro (9):
      Fix handling of __func__
      Fix tab handling in nextchar_slow()
      Fix ,##__VA_ARGS__ kludge
      Gentler handling of bitwise warnings in unary operations
      simplify handling of newline/whitespace flags in expand()
      fix handling of -include
      massage handling of wide string literals/character constants in tokenizer
      switch to delayed handling of escape sequences
      L ## 'a' is valid; so's L ## "a"

Benjamin Herrenschmidt (1):
      sparse, llvm: Fix varargs functions

Christopher Li (19):
      Limit usage of g++ to llvm related programs.
      Merge branch 'sparse-llvm' of git://github.com/penberg/sparse-llvm.git
      Adding default for m64/m32 handle
      Merge branch 'for-chris' of git://github.com/penberg/sparse-llvm
      Merge branch 'llvm/core' of github.com:penberg/sparse-llvm
      remove weak define x86_64
      Merge git://git.kernel.org/pub/scm/linux/kernel/git/viro/sparse into marge
      Clean up some test case error.
      Fix segfault cause by fucntion without ident.
      Get rid of gcc warning about enum values
      Larger buffer size for token concatenation
      Proper variable length array warning
      Allow forced attribute in function argument
      Trivial: Remove redundant Makefile variable
      Merge branch 'llvmcore'
      Merge branch 'Novafora' of
git://git.zytor.com/users/hpa/sparse/sparse into license
      Sparse 0.5.0 rc1
      Fix make dist failure
      Sparse 0.5.0

Emilio G. Cota (1):
      gitignore: add 'version.h'

Ethan Jackson (1):
      sparse: Add 'leaf' to ignored attributes.

Franz Schrober (5):
      Revert "Update the information in README about using the library."
      Revert "Fix mistaken comparison that becomes a no-op."
      sparse: Relicense under the MIT license
      FAQ: Remove outdated sections about the license
      sparse: Also check bit_offset when checking implicit casts

Frederic Crozat (1):
      Add __builtin_stpcpy, __sync_synchronize,
__sync_bool_compare_and_swap to declare_builtin_functions

James Westby (1):
      Update the information in README about using the library.

Jan Pokorn (2):
      unssa: track use of newly added pseudo
      simplify: conservative handling of casts with pointers

Jeff Garzik (15):
      sparse, llvm: if-else code generation
      sparse-llvm: OP_SEL
      sparse-llvm: OP_SWITCH
      sparse-llvm: OP_LOAD
      sparse-llvm OP_PHISOURCE: replace copy with target=src pointer operation
      sparse, llvm: replace FIXME comment with assert(), following
existing style
      sparse, llvm: implement OP_CALL
      sparse, llvm: move OP_PHI code from switch statement to separate function
      sparse, llvm: move OP_CAST code to separate func.  support FP casts.
      sparse, llvm: create helper for obtaining instruction's type
      sparse, llvm: store module-local functions on function reference list
      sparse, llvm: move OP_COPY support to separate function.  Add FP support.
      sparse, llvm: support OP_STORE
      sparse, llvm: Fix loops, by properly handling OP_PHI forward references
      sparse, llvm: add loop testcase

Jeff Layton (1):
      sparse: add __builtin_va_arg_pack() and __builtin_va_arg_pack_len()

Joe Perches (1):
      There's no current way to know the version     of sparse.  Add
--version to see it.

Jonathan Neuschfer (9):
      FAQ: update the website address and call it Wiki
      ptrlist.c: fix a typo in a comment
      sparse, llvm: 'Verify' the LLVM module before writing it
      sparse, llvm: convert the condition of branch/select to bool
      sparse, llvm: Fix type of loaded values
      sparse, llvm: Fix resulting type of store address calculations
      sparse, llvm: de-duplicate load/store address calculation code
      sparse, llvm: base load/store address type on insn_symbol_type()
      sparse, llvm: add a struct access test case

Josh Triplett (2):
      Define __SIZEOF_POINTER__
      Support #pragma once

KOSAKI Motohiro (2):
      sparse: Add '__vector_size__' to ignored attributes
      sparse: Add 'error' to ignored attributes

Kamil Dudka (2):
      cse: treat PHI-nodes as other instructions
      cse: update PHI users when throwing away an instruction
Kim Phillips (2):
      sparse: add built-in byte swap identifiers
      sparse: add built-in atomic memory access identifiers

Linus Torvalds (1):
      sparse, llvm: Make function declaration accessible to backend

Masatake YAMATO (3):
      Warn about initialization of a char array with a too long
constant C string.
      Test case for -Winit-cstring option
      Add description for -Winit-cstring option

Mauro Dreissig (1):
      Fix wrong array size expression

Pekka Enberg (69):
      sparse, llvm: Initial commit
      sparse, llvm: Fix assert() in sparse code
      sparse, llvm: Fix global variable initialization
      sparse, llvm: Fix 'sparsec' when it's not in PATH
      llvm, sparse: Separate entry and exit basic blocks
      sparse, llvm: Add switch statement to output_insn()
      sparse, llvm: OP_RET/PSEUDO_VAL code generation
      sparse, llvm: Add support for OP_RET/PSEUDO_ARG
      sparse, llvm: Introduce 'struct function' to clean up code
      sparse, llvm: Add output_op_binary() stub
      sparse, llvm: Implement OP_ADD
      sparse, llvm: Add support for more binary ops
      sparse, llvm: Implement some binary comparison ops
      sparse, llvm: Move binop tests to validation/backend
      sparse, llvm: Implement OP_CAST
      sparse, llvm: Floating point support for binops
      sparse, llvm: Reorganize code generation tests
      sparse, llvm: Bitwise not operator codegen
      sparse, llvm: Kill ifdef'd unssa() call
      sparse, llvm: Kill debugging code
      Merge pull request #1 from jgarzik/hacks
      Merge pull request #2 from jgarzik/hacks
      sparse, llvm: Warn the user when we fall back to GCC
      sparse, llvm: Code generation for string constants
      sparse, llvm: Cleanup output_data()
      sparse, llvm: Fix OP_CAST to use zero-extend
      sparse, llvm: Improve sparsec front-end
      sparse, llvm: Fix PSEUDO_OP code generation
      sparse, llvm: Don't redefine module local functions
      Revert "sparse, llvm: Don't redefine module local functions"
      sparse, llvm: Fix code generation for casts
      sparse, llvm: Fix pseudo_type() for PSEUDO_ARG
      Merge pull request #3 from jgarzik/hacks
      Merge branch 'master' of github.com:penberg/sparse-llvm
      llvm, sparse: Fix symbol_is_fp_type() goof
      Merge pull request #4 from jgarzik/hacks
      sparse, llvm: Fix code generation for 'long double' data type
      sparse, llvm: Add support for struct types
      sparse, llvm: Add support for symbol initializers
      sparse: Bump up sizeof(_Bool) to 8 bits
      sparse, llvm: Add support for logical ops
      sparse, llvm: Fix 'void *' pointer code generation
      sparse, llvm: Use new LLVM type system API for structs
      sparse, llvm: Fix struct code generation
      sparse, llvm: Fix symbol_type() for bitfields and enums
      sparse, llvm: Add support for array types
      sparse, llvm: Add support for union types
      sparse, llvm: Make 'sparsec' error handling more robust
      sparse, llvm: Function pointer code generation
      sparse, llvm: Fix symbol initializer code generation
      sparse, llvm: Fix 'extern' symbol code generation
      sparse, llvm: Make llc output to stdout in sparsec
      sparse, llvm: Pointer cast code generation
      sparse, llvm: OP_SET_B and OP_SET_A code generation
      sparse, llvm: More comparison ops code generation
      sparse, llvm: Simplify comparison op code generation
      sparse, llvm: FP comparison op code generation
      Merge pull request #6 from jgarzik/hacks
      sparse, llvm: Don't fail the build if LLVM is too old
      sparse, llvm: Use LLVMInt1Type() in sym_basetype_type()
      sparse, llvm: Add test case for <stdbool.h> type
      Revert "sparse: Bump up sizeof(_Bool) to 8 bits"
      sparse, llvm: Add _Bool to cast validation test
      sparse, llvm: Simplify output_data() type logic
      sparse, llvm: Fix string initializer code generation
      sparse, llvm: Fix global string access code generation
      sparse, llvm: Fix SIGSEGV for extern symbols
      sparse, llvm: Fix 'void' return type code generation
      sparse, llvm: Use LLVM_HOSTTRIPLE

Ramsay Jones (2):
      char.c: Fix parsing of escapes
      symbol.c: Set correct size of array from parenthesized string initializer

Randy Dunlap (1):
      sparse patch v2: add noclone as an ignored attribute

Robert Bedichek (1):
      Novafora license grant using MIT license.

Shakthi Kannan (1):
      I have updated the sparse.1 man page including the __bitwise
relevant content, and created Documentation/sparse.txt with the
complete comparison between __nocast vs __bitwise.

Xi Wang (17):
      compile-i386: fix use-after-free in func_cleanup()
      check missing or duplicate goto labels
      fix casting constant to _Bool
      fix SIGFPE caused by signed division overflow
      sparse, llvm: fix link errors
      sparse, llvm: fix phi generation
      sparse, llvm: simplify function generation
      sparse, llvm: improve pointer arithmetic handling
      sparse, llvm: set target specification
      sparse, llvm: use LLVM_DEFAULT_TARGET_TRIPLE
      sparse, llvm: fix array size
      sparse, llvm: cache symbol_type() result
      sparse, llvm: fix struct name generation
      sparse, llvm: set more data attributes
      sparse, llvm: die if error
      Fix result type of relational and logical operators
      Fix expression type for floating point negation ('!')
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse context warning on 0.5.0 ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: Sparse context warning on 0.5.0
Date: Sat, 11 Oct 2014 02:14:00 +0000
Message-ID: <CANeU7Qn68zSjRJ9oVmYJm4cw9qyRqyXWUr4gp2sCdKsZ-XrYyw () mail ! gmail ! com>
--------------------
On Sat, Oct 11, 2014 at 9:52 AM, Franco, Scott
<Scott.Franco@caviumnetworks.com> wrote:
> Chistopher,
>
> Thanks for looking at my issue. I've been running it via the kernel make (make c=1),
> So I'll figure out how to strip it out of the make and get back to you (I suspect the
> Easiest way is to make --dry it and use the output).
>

There should be a ".octeon_poll.o.cmd" inside the same directory where
you generate
the octeon_poll.o file. The first line of that file contain the build
command of gcc.

You can copy that to a new shell script and edit it a little bit to
invoke gcc -E with
the same command line argument, without using the kbuild.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse doesn't seem to care about checking context? data ===

From: Brett Nash <nash () nash ! id ! au>
To: linux-sparse
Subject: Sparse doesn't seem to care about checking context? data
Date: Tue, 09 Sep 2014 20:51:01 +0000
Message-ID: <20140909205101.GA18784 () codekia ! com>
--------------------

--SLDf9lqlvOQaIe6s
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Hello,

I was just testing sparse on a large (non-linux) code base using the
__must_hold macro (eg __attribute__((context, 1, 1))).

However I don't seem to be able to trigger a warning from it.

I've attached a test case below, is there some magic I need to do get sparse
to trigger on this case.  I also note there are currently no tests in
validation that check for this case.

Regards,
nash

--SLDf9lqlvOQaIe6s
Content-Type: text/x-csrc; charset=us-ascii
Content-Disposition: attachment; filename="sparse_context.c"


static int must_hold(int x) __attribute__((context(1,1))) {
	int z;

	return x * 7;
}

static int release(int x) __attribute__((context(1, 0))) {
	__context__(-1);
	return 0;
}

static int acquiresilently(int x) {
	__context__(1);

	return 1;
}

int main(int argc, char **argv) {
	must_hold(8);
	__context__(1);
	must_hold(0);
	__context__(-1);
	return 0;
}

--SLDf9lqlvOQaIe6s--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse maintainership (was: [PATCH] sparse: Make -Werror turn warnigns into errors) ===

From: Thomas Graf <tgraf () suug ! ch>
To: linux-sparse
Subject: Sparse maintainership (was: [PATCH] sparse: Make -Werror turn warnigns into errors)
Date: Wed, 24 Sep 2014 12:31:40 +0000
Message-ID: <20140924123140.GF24298 () casper ! infradead ! org>
--------------------
Are you still maintaining sparse Christopher?

Cheers,
Thomas
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Sparse warning: "initializer entry defined twice" - sparse can't handle bool? ===

From: Mariusz Gorski <marius.gorski () gmail ! com>
To: linux-kernel
Subject: Sparse warning: "initializer entry defined twice" - sparse can't handle bool?
Date: Sun, 19 Oct 2014 09:46:29 +0000
Message-ID: <CABbAP1QWTorBt+f-nCmw1Q_DPe1CLecXYGUJFAcQkuw0Rk6d2g () mail ! gmail ! com>
--------------------
Sparse throws the following warning, which I can't really understand:

$ make drivers/staging/vt6655/ C=2
[...]
  CHECK   drivers/staging/vt6655/datarate.c
drivers/staging/vt6655/datarate.c:302:40: warning: Initializer entry
defined twice
drivers/staging/vt6655/datarate.c:302:46:   also defined here

The code looks fine to me:
bool bAutoRate[MAX_RATE]    = {true, true, true, true, false, false,
true, true, true, true, true, true};

I've googled it and found only this LKML discussion:
https://lkml.org/lkml/2010/5/7/31

I've tested the suggested code sample and here are the results:
$ cat foo.c
typedef _Bool bool;
enum {
     false = 0,
     true = 1
};
static const bool foo[10] = {
       true,
       true,
       false,
       false,
};

$ sparse foo.c
foo.c:7:8: warning: Initializer entry defined twice
foo.c:8:8:   also defined here

It this a sparse problem?

Thanks,
Mariusz
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Randy Dunlap <rdunlap () infradead ! org>
To: linux-sparse
Subject: Re: Sparse warning: "initializer entry defined twice" - sparse can't handle bool?
Date: Sun, 19 Oct 2014 17:21:29 +0000
Message-ID: <5443F319.4000303 () infradead ! org>
--------------------
[adding linux-sparse mailing list]

On 10/19/14 02:46, Mariusz Gorski wrote:
> Sparse throws the following warning, which I can't really understand:
> 
> $ make drivers/staging/vt6655/ C=2
> [...]
>   CHECK   drivers/staging/vt6655/datarate.c
> drivers/staging/vt6655/datarate.c:302:40: warning: Initializer entry
> defined twice
> drivers/staging/vt6655/datarate.c:302:46:   also defined here
> 
> The code looks fine to me:
> bool bAutoRate[MAX_RATE]    = {true, true, true, true, false, false,
> true, true, true, true, true, true};
> 
> I've googled it and found only this LKML discussion:
> https://lkml.org/lkml/2010/5/7/31
> 
> I've tested the suggested code sample and here are the results:
> $ cat foo.c
> typedef _Bool bool;
> enum {
>      false = 0,
>      true = 1
> };
> static const bool foo[10] = {
>        true,
>        true,
>        false,
>        false,
> };
> 
> $ sparse foo.c
> foo.c:7:8: warning: Initializer entry defined twice
> foo.c:8:8:   also defined here
> 
> It this a sparse problem?
> 
> Thanks,
> Mariusz
> --


-- 
~Randy
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-kernel
Subject: Re: Sparse warning: "initializer entry defined twice" - sparse can't handle bool?
Date: Sun, 19 Oct 2014 21:40:53 +0000
Message-ID: <54442FE5.8080705 () ramsay1 ! demon ! co ! uk>
--------------------
On 19/10/14 18:21, Randy Dunlap wrote:
> [adding linux-sparse mailing list]
> 
> On 10/19/14 02:46, Mariusz Gorski wrote:
>> Sparse throws the following warning, which I can't really understand:
>>
>> $ make drivers/staging/vt6655/ C=2
>> [...]
>>   CHECK   drivers/staging/vt6655/datarate.c
>> drivers/staging/vt6655/datarate.c:302:40: warning: Initializer entry
>> defined twice
>> drivers/staging/vt6655/datarate.c:302:46:   also defined here
>>
>> The code looks fine to me:
>> bool bAutoRate[MAX_RATE]    = {true, true, true, true, false, false,
>> true, true, true, true, true, true};
>>
>> I've googled it and found only this LKML discussion:
>> https://lkml.org/lkml/2010/5/7/31
>>
>> I've tested the suggested code sample and here are the results:
>> $ cat foo.c
>> typedef _Bool bool;
>> enum {
>>      false = 0,
>>      true = 1
>> };
>> static const bool foo[10] = {
>>        true,
>>        true,
>>        false,
>>        false,
>> };
>>
>> $ sparse foo.c
>> foo.c:7:8: warning: Initializer entry defined twice
>> foo.c:8:8:   also defined here
>>
>> It this a sparse problem?

Yes, I imagine you are using a sparse version of v0.5.0 or
earlier right?

This was fixed by commit b3e9d87c6 ("sparse: make bits_to_bytes
round up instead of down", 16-07-2014), which describes to
v0.5.0-17-gb3e9d87, which has not been included in a released
version yet. (if you don't mind building from source, you could
build the master branch using a clone the git repository at
git://git.kernel.org/pub/scm/devel/sparse/sparse.git).

I'm afraid that I don't know when the next release is due.

HTH

ATB,
Ramsay Jones


--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: Sparse warning: "initializer entry defined twice" - sparse can't handle bool?
Date: Sun, 19 Oct 2014 21:40:53 +0000
Message-ID: <54442FE5.8080705 () ramsay1 ! demon ! co ! uk>
--------------------
On 19/10/14 18:21, Randy Dunlap wrote:
> [adding linux-sparse mailing list]
> 
> On 10/19/14 02:46, Mariusz Gorski wrote:
>> Sparse throws the following warning, which I can't really understand:
>>
>> $ make drivers/staging/vt6655/ C=2
>> [...]
>>   CHECK   drivers/staging/vt6655/datarate.c
>> drivers/staging/vt6655/datarate.c:302:40: warning: Initializer entry
>> defined twice
>> drivers/staging/vt6655/datarate.c:302:46:   also defined here
>>
>> The code looks fine to me:
>> bool bAutoRate[MAX_RATE]    = {true, true, true, true, false, false,
>> true, true, true, true, true, true};
>>
>> I've googled it and found only this LKML discussion:
>> https://lkml.org/lkml/2010/5/7/31
>>
>> I've tested the suggested code sample and here are the results:
>> $ cat foo.c
>> typedef _Bool bool;
>> enum {
>>      false = 0,
>>      true = 1
>> };
>> static const bool foo[10] = {
>>        true,
>>        true,
>>        false,
>>        false,
>> };
>>
>> $ sparse foo.c
>> foo.c:7:8: warning: Initializer entry defined twice
>> foo.c:8:8:   also defined here
>>
>> It this a sparse problem?

Yes, I imagine you are using a sparse version of v0.5.0 or
earlier right?

This was fixed by commit b3e9d87c6 ("sparse: make bits_to_bytes
round up instead of down", 16-07-2014), which describes to
v0.5.0-17-gb3e9d87, which has not been included in a released
version yet. (if you don't mind building from source, you could
build the master branch using a clone the git repository at
git://git.kernel.org/pub/scm/devel/sparse/sparse.git).

I'm afraid that I don't know when the next release is due.

HTH

ATB,
Ramsay Jones


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Mariusz Gorski <marius.gorski () gmail ! com>
To: linux-kernel
Subject: Re: Sparse warning: "initializer entry defined twice" - sparse can't handle bool?
Date: Mon, 20 Oct 2014 21:00:40 +0000
Message-ID: <CABbAP1RzO-D+AC4qTY8RZmp4M0wBxupqmFj3Jz132=Lhw4kzoQ () mail ! gmail ! com>
--------------------
Yes, I've actually used outdated sparse in version 0.4.3. After
updating to the latest one, built from master in git repo, the issue
is gone. Thanks.

On 19 October 2014 23:40, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
> On 19/10/14 18:21, Randy Dunlap wrote:
>> [adding linux-sparse mailing list]
>>
>> On 10/19/14 02:46, Mariusz Gorski wrote:
>>> Sparse throws the following warning, which I can't really understand:
>>>
>>> $ make drivers/staging/vt6655/ C=2
>>> [...]
>>>   CHECK   drivers/staging/vt6655/datarate.c
>>> drivers/staging/vt6655/datarate.c:302:40: warning: Initializer entry
>>> defined twice
>>> drivers/staging/vt6655/datarate.c:302:46:   also defined here
>>>
>>> The code looks fine to me:
>>> bool bAutoRate[MAX_RATE]    = {true, true, true, true, false, false,
>>> true, true, true, true, true, true};
>>>
>>> I've googled it and found only this LKML discussion:
>>> https://lkml.org/lkml/2010/5/7/31
>>>
>>> I've tested the suggested code sample and here are the results:
>>> $ cat foo.c
>>> typedef _Bool bool;
>>> enum {
>>>      false = 0,
>>>      true = 1
>>> };
>>> static const bool foo[10] = {
>>>        true,
>>>        true,
>>>        false,
>>>        false,
>>> };
>>>
>>> $ sparse foo.c
>>> foo.c:7:8: warning: Initializer entry defined twice
>>> foo.c:8:8:   also defined here
>>>
>>> It this a sparse problem?
>
> Yes, I imagine you are using a sparse version of v0.5.0 or
> earlier right?
>
> This was fixed by commit b3e9d87c6 ("sparse: make bits_to_bytes
> round up instead of down", 16-07-2014), which describes to
> v0.5.0-17-gb3e9d87, which has not been included in a released
> version yet. (if you don't mind building from source, you could
> build the master branch using a clone the git repository at
> git://git.kernel.org/pub/scm/devel/sparse/sparse.git).
>
> I'm afraid that I don't know when the next release is due.
>
> HTH
>
> ATB,
> Ramsay Jones
>
>
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: Very Urgent............ ===

From: Fabian Morision <fmorision4 () gmail ! com>
To: linux-sparse
Subject: Re: Very Urgent............
Date: Wed, 30 Jul 2014 23:18:20 +0000
Message-ID: <CAPnz-Ta_o==1nJhS330wQOG9PpNNjnWsUp-E5Nd2JTWv-23tTA () mail ! gmail ! com>
--------------------
Greetings from gulf region

Thanks for the e-mail. I am very interested on funding lucrative
business partnership with you acting as the manager and sole
controller of the investment while i remain a silent investor for a
period of ten yrs , though I am only looking at investment
opportunities within the range you specified for a start. You can
reply me here (fmorision@yahoo.com)

Let me know your thought asap

Regards

Financial Consultant

Mr.Fabian Morision
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Warn for extern prototypes ===

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-sparse
Subject: Warn for extern prototypes
Date: Wed, 30 Apr 2014 20:07:30 +0000
Message-ID: <20140430200730.GA11100 () ravnborg ! org>
--------------------
Hi all.

Is it possible to get a warning when sparse encounter a
function prototype declared using "extern"?

So the following code:

extern void foo(void);
void bar(int x);

Would generate warnings because the declaration of foo()
uses extern.


I took a very short peek at evaluate.c - but decided to ask as maybe
there is already something that I overlooked or it is maybe trivial.

The rationale behind this is that at least in some areas of the kernel,
the use of "extern" for prototypes are no longer accepted.
A sparse warnings would be good to tell me all the cases I missed
in the conversion.

	Sam
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: Warn for extern prototypes
Date: Wed, 30 Apr 2014 20:30:57 +0000
Message-ID: <20140430203056.GJ26890 () mwanda>
--------------------
On Wed, Apr 30, 2014 at 10:07:30PM +0200, Sam Ravnborg wrote:
> The rationale behind this is that at least in some areas of the kernel,
> the use of "extern" for prototypes are no longer accepted.
> A sparse warnings would be good to tell me all the cases I missed
> in the conversion.

Doesn't checkpatch.pl already check for this?

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-sparse
Subject: Re: Warn for extern prototypes
Date: Wed, 30 Apr 2014 20:48:16 +0000
Message-ID: <20140430204816.GA14951 () ravnborg ! org>
--------------------
On Wed, Apr 30, 2014 at 11:30:57PM +0300, Dan Carpenter wrote:
> On Wed, Apr 30, 2014 at 10:07:30PM +0200, Sam Ravnborg wrote:
> > The rationale behind this is that at least in some areas of the kernel,
> > the use of "extern" for prototypes are no longer accepted.
> > A sparse warnings would be good to tell me all the cases I missed
> > in the conversion.
> 
> Doesn't checkpatch.pl already check for this?
checkpatch --strict -f foo.h will include this check.

But then there are so much other noise...

It is much simpler to do:

   make C=2 arch/sparc/

and the process the sparse warnings.

	Sam

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: Your Urgent reply. ===

From: HUSAM AL SAYED <Husamalsayed () asia ! com>
To: linux-sparse
Subject: Your Urgent reply.
Date: Mon, 26 May 2014 18:00:48 +0000
Message-ID: <CAKFyHyqE-jAV0G8GqYW7H_3cUYv2iXVQm5a6-m1VNZWRhKVXAg () mail ! gmail ! com>
--------------------
Dear Friend,


Compliments of the day.This mail May be a surprise to you Because you
did not give me the permission to do so and Neither do you know me but
before I tell you about myself I want you to please forgive me for
sending this mail without your permission I have been in search of
someone with this last name so when I saw you online, I was pushed to
contact you and see how best we can assist each other. I am Mr. Husam
Al Sayed, a Bank Officer here in U.A.E. I believe it is the wish of
God for me to come across you now. I am having an important business
discussion I wish to share with you which I  believe will interest
you, because it is in connection with your last name and you are going
to benefit from it.

One Late peter who was among the death victims in the May 27 2006
Earthquake disaster in Java, Indonesia that killed over 5,000 people.
He was in Indonesia on a business trip and that was how he met his
end. My bank management is yet to know about his death, I knew about
it because he was my friend and I am his account officer.he did not
mention any Next of Kin/ Heir when the account was opened, and he was
not married and no children. Last week my Bank Management requested
that he should give instructions on what to do about his funds,I know
this will happen and that is why I have been looking for a means to
handle the situation,

If you are interested send me your private Email Address so that i can
send you more details of the transaction,
Thanks for your understanding

I am waiting for your reply.

Best regards,

Mr. Husam Al Sayed
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 0/4] chrisl master branch patches ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 0/4] chrisl master branch patches
Date: Sat, 11 Oct 2014 19:55:15 +0000
Message-ID: <54398B23.8080501 () ramsay1 ! demon ! co ! uk>
--------------------
Hi Chris,

I noticed, this afternoon, that you have pushed new patches to your
public repo on kernel.org (including most of the patches from my
'misc sparse patches' series). After a quick test, I noticed a few
minor problems (see first two patches).

I don't know how you like to manage your public repo, but if you
don't mind re-winding your master branch, then you could squash
patch #1 into commit e23abfd and patch #2 into fe57afa.

The third patch is actually a re-send of one I sent separately
after the 10 patch series.

The final patch is a possible alternative to "[PATCH 04/10]
compile-i386.c: don't mix calls to write(2) with stdio", which
basically just removes the compile program. If you prefer
another solution, just let me know.

[Note: I have been living with the RFC patch #10 for quite a
while now with no problems. However, it was just a quick hack
to speed up cgcc/sparse on Cygwin and, on reflection, not a
good reason to introduce a sparse configuration file! Also, the
use of the perl language for the config file can be viewed as
a bit cute (too cute for some people). I will probably keep it
as a locally applied patch on cygwin (it is a noticeable speedup
on cygwin), but remove it on Linux.]

Ramsay Jones (4):
  test-suite: remove bashism to avoid test failures
  cgcc: avoid passing a sparse-only option to cc
  parse.c: remove duplicate 'may_alias' ignored_attributes
  compile: remove the unmaintained compile program

 .gitignore            |    1 -
 Makefile              |    4 +-
 cgcc                  |    4 +-
 compile-i386.c        | 2407 -------------------------------------------------
 compile.c             |   84 --
 compile.h             |   10 -
 parse.c               |    2 -
 validation/test-suite |    2 +-
 8 files changed, 4 insertions(+), 2510 deletions(-)
 delete mode 100644 compile-i386.c
 delete mode 100644 compile.c
 delete mode 100644 compile.h

-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 0/4] chrisl master branch patches
Date: Mon, 13 Oct 2014 22:58:53 +0000
Message-ID: <543C592D.50807 () ramsay1 ! demon ! co ! uk>
--------------------
On 12/10/14 10:22, Christopher Li wrote:
> On Sun, Oct 12, 2014 at 3:55 AM, Ramsay Jones
> <ramsay@ramsay1.demon.co.uk> wrote:

[snip]

>> The final patch is a possible alternative to "[PATCH 04/10]
>> compile-i386.c: don't mix calls to write(2) with stdio", which
>> basically just removes the compile program. If you prefer
>> another solution, just let me know.
> 
> I think I would just keep it as example of using the sparse
> front end AST. For compiling, the sparse-llvm does a better job
> there.
> 

OK, I will send an alternative patch separately (directly after this).

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 0/5] kbuild: LLVMLinux: Initial updates to kbuild to enable the kernel to be compiled with cl ===

From: behanw () converseincode ! com
To: linux-sparse
Subject: [PATCH 0/5] kbuild: LLVMLinux: Initial updates to kbuild to enable the kernel to be compiled with cl
Date: Wed, 26 Feb 2014 01:08:38 +0000
Message-ID: <1393376923-21892-1-git-send-email-behanw () converseincode ! com>
--------------------
From: Behan Webster <behanw@converseincode.com>

These patches add initial support for compiling the x86 kernel with clang. More
patches to the kernel code are required to actually compile the kernel with
clang. The intent of these patches are just to get things started with kbuild.

The LLVMLinux project aims to fully build the Linux kernel using both gcc and
clang (the C front end for the LLVM compiler infrastructure project). 


Behan Webster (1):
  kbuild: LLVMLinux: Add Kbuild support for building kernel with Clang

Jan-Simon Mller (3):
  kbuild: LLVMLinux: Adapt warnings for compilation with clang
  kbuild: LLVMLinux: Fix LINUX_COMPILER definition script for
    compilation with clang
  x86 kbuild: LLVMLinux: More cc-options added for clang

Mark Charlebois (1):
  LLVMLinux: Add support for clang to compiler.h and new
    compiler-clang.h

 Makefile                       | 32 +++++++++++++++++++++++++++++++-
 arch/x86/Makefile              |  8 +++++++-
 include/linux/compiler-clang.h | 12 ++++++++++++
 include/linux/compiler.h       |  7 +++++++
 scripts/Makefile.build         | 13 ++++++++++++-
 scripts/mkcompile_h            |  2 +-
 6 files changed, 70 insertions(+), 4 deletions(-)
 create mode 100644 include/linux/compiler-clang.h

-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 0/7] Silence even more W=2 warnings ===

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-sparse
Subject: Re: [PATCH 0/7] Silence even more W=2 warnings
Date: Fri, 26 Sep 2014 21:07:25 +0000
Message-ID: <04133DCF-C237-45D2-8AEB-199A42EBCCDE () intel ! com>
--------------------
--Apple-Mail=_4F337770-DF1B-4B20-888D-04A9682FB207
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 26, 2014, at 12:58 PM, <josh@joshtriplett.org> =
<josh@joshtriplett.org> wrote:

> On Fri, Sep 26, 2014 at 07:37:19PM +0000, Rustad, Mark D wrote:
>> Most of the others come from null-entry table initializations, i.e. {
>> 0 }, which give missing field initializer warnings.
>=20
> I'd suggest that such initializers should just be {}, not { 0 }, and =
we
> should teach compilers to specifically *not* complain about empty
> initializers even when otherwise complaining about missing fields.
> Initializing a structure to 0 is completely sensible.

I agree completely! But of course that isn't how it is now. I guess I =
have spent too many years stuck on a single version of gcc that I tend =
not to think of changing the compiler readily enough. At least now I can =
upgrade the compiler freely.

Made me go check to be sure. Indeed even { } still throws the =
missing-initializers warning with gcc 4.8.3.

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_4F337770-DF1B-4B20-888D-04A9682FB207
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUJdWMAAoJEDwO/+eO4+5utiMQAL6vhDQzEk2y5w1sPw5P4JZJ
3TeYWasxVUZ/90gWdt9bI/oGtWuCmtNn0ZwCvhMW17C4tbhxge22b+yMFpBomvqX
GE/U8ZzgmMY2I/rraoVWMkWKNc/XLOw5KJ2r1OjzY6x6XszhmnKRkHq5d6igogX8
wD1BkGKcidPTjRvqPUeoj4ZkjPdgmP2uy0/cCB6eXYukorYQ1Nql/3G8QnC4vIeW
09GeHOGPbhaunVohw7+vVGvJZUgPpqaf3B75tSeXxpvKoV2yNYcz0mwDhxzENCH7
lxh7DQyrsGgwTAbyxYPwbS6RZ0C8HGlQzGBEhf+K9hoW4tVZLv36LNCGqXqT4Sd/
xkH8+DXMYZgAyMIHD62JrgalLoAZpwYeJlTxkAnDxjeQhqImAAggjomjcQmEgrTr
WlVfLRGe8VAUDfydmHWX6qaMXpNSLb8zQZWXe/HIEXFvi51hd9jPmKZ9eLv2Ky0I
iFmPl+bmGGobgeA8xtVXcu62LVkPw4tChkXcQwZAbU3dPU0Qf+QjtfPBiOCFv53L
j+Hf0HAAb2OWmwgBJEO5BXaBGUuR3uE3UCouZ+fzOzpptl+UE1jn5wWzWbl7PTk5
OOt4U/VOXJY4xEeceJ3kbHWMjzEwRsQqoLOGFLH/4N6ZQ+tmEu5RyxMg2gIMi5n0
iALiip1eyMYhGapLqdnA
=VzCJ
-----END PGP SIGNATURE-----

--Apple-Mail=_4F337770-DF1B-4B20-888D-04A9682FB207--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 00/10] misc sparse patches ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 00/10] misc sparse patches
Date: Mon, 04 Aug 2014 18:31:55 +0000
Message-ID: <53DFD19B.1090201 () ramsay1 ! demon ! co ! uk>
--------------------

Hi Chris,

I have collected quite a few sparse patches, some of which are
very old (e.g. patch #1 is from 2009), so it's about time I at
least tried to get them upstream! This represents the subset of
patches which I think are useful/ready (the MinGW patches are
still on the back-burner!). ;-)

Some short notes on the patches:

  01. Add the __restrict__ keyword
  02. sparse: add 'gnu_inline' to the ignored attributes

These patches fix up features that are used in system header
files, on certain platforms, which usually renders sparse
completely useless if you #include such a system header.

  03. don't call isdigit/tolower with a char argument
  04. compile-i386.c: don't mix calls to write(2) with stdio

These fix up some compiler warnings. See patch #4 for some
further notes.

  05. Makefile: suppress error message from shell
  06. don't run sparse{c,i} tests when sparse-llvm is disabled

If you don't have LLVM installed, the test suite spews many
test failures for programs that haven't been built, which
obscures test failures for sparse itself. These patches provide
a means to silence the useless test failures.

  07. Add support for multiarch system header files
  08. cgcc: use only the cc command to determine $gcc_base_dir
  09. cgcc: use $ccom to set $multiarch_dir if not specified

A couple of years ago, after upgrading my Linux installation,
I found that gcc was now using 'multiarch' directories for
various files. This caused a problem, in particular, with
the system include files. For example, this meant that I had
to add '-isystem /usr/include/i386-linux-gnu' to SPARSE_FLAGS
in my config.mak file in git.git to make things work again.
These patches provide support for 'multiarch' systems in
sparse directly, which actually fixes some (4) tests which
include some system headers.

  10. cgcc: add a configuration file for cgcc

Unlike the previous patches, this one is brand new and marked
as RFC. When I added patch #9 I noticed a marked slowdown on
cygwin. A few days ago, I finally decided to have a look at this
to see if I could improve the performance on cygwin. This patch
not only clawed back the time lost by patch #9, but it improved
the performance even further (by about 20%).

ATB,
Ramsay Jones


Ramsay Jones (10):
  Add the __restrict__ keyword
  sparse: add 'gnu_inline' to the ignored attributes
  don't call isdigit/tolower with a char argument
  compile-i386.c: don't mix calls to write(2) with stdio
  Makefile: suppress error message from shell
  don't run sparse{c,i} tests when sparse-llvm is disabled
  Add support for multiarch system header files
  cgcc: use only the cc command to determine $gcc_base_dir
  cgcc: use $ccom to set $multiarch_dir if not specified
  cgcc: add a configuration file for cgcc

 Makefile                 | 19 ++++++++++---------
 cgcc                     | 23 +++++++++++++++++++++--
 compile-i386.c           |  7 ++-----
 expression.c             |  2 +-
 ident-list.h             |  2 +-
 lib.c                    | 22 +++++++++++++++++++---
 parse.c                  |  5 ++++-
 sparse.1                 |  6 ++++++
 validation/attr-inline.c | 21 +++++++++++++++++++++
 validation/reserved.c    |  1 +
 validation/test-suite    | 25 +++++++++++++++++++++++--
 11 files changed, 109 insertions(+), 24 deletions(-)
 create mode 100644 validation/attr-inline.c

-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 01/10] Add the __restrict__ keyword ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 01/10] Add the __restrict__ keyword
Date: Wed, 06 Aug 2014 15:21:45 +0000
Message-ID: <53E24809.5020603 () ramsay1 ! demon ! co ! uk>
--------------------
On 06/08/14 10:19, Christopher Li wrote:
> On Mon, Aug 4, 2014 at 11:32 AM, Ramsay Jones
> <ramsay@ramsay1.demon.co.uk> wrote:
>>
>> -       if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
>> +       if (match_idents(token, &restrict_ident, &__restrict_ident, &__restrict___ident, NULL))
>>                 token = abstract_array_static_declarator(token->next, &has_static);
>>         token = parse_expression(token, &expr);
>>         sym->array_size = expr;
>> diff --git a/validation/reserved.c b/validation/reserved.c
>> index caacd21..e5d7af8 100644
>> --- a/validation/reserved.c
>> +++ b/validation/reserved.c
>> @@ -30,6 +30,7 @@ reserved.c:8:12: error: Trying to use reserved word '__const' as identifier
>>  reserved.c:9:12: error: Trying to use reserved word '__const__' as identifier
>>  reserved.c:10:12: error: Trying to use reserved word 'restrict' as identifier
>>  reserved.c:11:12: error: Trying to use reserved word '__restrict' as identifier
>> +reserved.c:12:12: error: Trying to use reserved word '__restrict__' as identifier
>>  reserved.c:13:12: error: Trying to use reserved word 'typedef' as identifier
>>  reserved.c:14:12: error: Trying to use reserved word '__typeof' as identifier
>>  reserved.c:15:12: error: Trying to use reserved word '__typeof__' as identifier
> 
> Can you give more test case for __restrict__? Your patch seems suggest that you
> hit some  code use "__restruct__" for abstract array declaration. Did
> that actually
> happen? I want to get some example.

No, __restrict__ is only applied to various pointer types in the MinGW
header files (see below). So, I agree that validation/reserved.c is not
exactly representative of the actual use of __restrict__ (or *any* of the
keywords come to that), but that does at least provide a minimal test.
Also, I can't believe that Al did not intend to include __restrict__ in the
original commit d5c9c2431; well actually he *did* include it in the test, he
just didn't notice some of the missing implementation! ;-D

Having said that, I think I see two tests included for the array declaration
usage: abstract-array-declarator-static.c and restrict-array.c.

As for the MinGW headers, I can only talk about the current/old 32-bit
version of MinGW (I read somewhere that the new MinGW-64 project will
actually re-vamp the 32-bit version as well), but my installation was
updated only last September, so they are still being used. One of the
reasons for the MinGW patches being on the back-burner is because I
haven't installed the 64-bit version yet (last time I looked, it wasn't
considered ready for use).

I have included, below, the output of a grep for __restrict__ in the
header files, which returned 50 matching lines (note that the one and
only use of __restrict in the declaration of strtoll which must have
been a typo!).

HTH,

ATB,
Ramsay Jones

-- 8< --
/mingw/include/inttypes.h:264:intmax_t __cdecl __MINGW_NOTHROW strtoimax (const char* __restrict__ nptr,
/mingw/include/inttypes.h:265:                            char** __restrict__ endptr, int base);
/mingw/include/inttypes.h:266:uintmax_t __cdecl __MINGW_NOTHROW strtoumax (const char* __restrict__ nptr,
/mingw/include/inttypes.h:267:			     char** __restrict__ endptr, int base);
/mingw/include/inttypes.h:269:intmax_t __cdecl __MINGW_NOTHROW wcstoimax (const wchar_t* __restrict__ nptr,
/mingw/include/inttypes.h:270:                            wchar_t** __restrict__ endptr, int base);
/mingw/include/inttypes.h:271:uintmax_t __cdecl __MINGW_NOTHROW wcstoumax (const wchar_t* __restrict__ nptr,
/mingw/include/inttypes.h:272:			     wchar_t** __restrict__ endptr, int base);
/mingw/include/search.h:82:void * __cdecl tdelete (const void * __restrict__, void ** __restrict__,
/mingw/include/stdio.h:333:int __cdecl __MINGW_NOTHROW vscanf (const char * __restrict__, __VALIST);
/mingw/include/stdio.h:334:int __cdecl __MINGW_NOTHROW vfscanf (FILE * __restrict__, const char * __restrict__,
/mingw/include/stdio.h:336:int __cdecl __MINGW_NOTHROW vsscanf (const char * __restrict__,
/mingw/include/stdio.h:337:		     const char * __restrict__, __VALIST);
/mingw/include/stdio.h:607:int __cdecl __MINGW_NOTHROW vwscanf (const wchar_t * __restrict__, __VALIST);
/mingw/include/stdio.h:608:int __cdecl __MINGW_NOTHROW vfwscanf (FILE * __restrict__,
/mingw/include/stdio.h:609:		       const wchar_t * __restrict__, __VALIST);
/mingw/include/stdio.h:610:int __cdecl __MINGW_NOTHROW vswscanf (const wchar_t * __restrict__,
/mingw/include/stdio.h:611:		       const wchar_t * __restrict__, __VALIST);
/mingw/include/stdlib.h:318:strtod (const char* __restrict__ __nptr, char** __restrict__ __endptr)
/mingw/include/stdlib.h:322:float __cdecl __MINGW_NOTHROW strtof (const char * __restrict__, char ** __restrict__);
/mingw/include/stdlib.h:323:long double __cdecl __MINGW_NOTHROW strtold (const char * __restrict__, char ** __restrict__);
/mingw/include/stdlib.h:337:float __cdecl __MINGW_NOTHROW wcstof( const wchar_t * __restrict__, wchar_t ** __restrict__);
/mingw/include/stdlib.h:338:long double __cdecl __MINGW_NOTHROW wcstold (const wchar_t * __restrict__, wchar_t ** __restrict__);
/mingw/include/stdlib.h:518:long long  __cdecl __MINGW_NOTHROW strtoll (const char* __restrict__, char** __restrict, int);
/mingw/include/stdlib.h:519:unsigned long long  __cdecl __MINGW_NOTHROW strtoull (const char* __restrict__, char** __restrict__, int);
/mingw/include/sys/time.h:39:int __cdecl __MINGW_NOTHROW gettimeofday(struct timeval *__restrict__,
/mingw/include/sys/time.h:40:			 void *__restrict__  /*	tzp (unused) */);
/mingw/include/wchar.h:150:int __cdecl __MINGW_NOTHROW vwscanf (const wchar_t * __restrict__, __VALIST);
/mingw/include/wchar.h:151:int __cdecl __MINGW_NOTHROW vfwscanf (FILE * __restrict__,
/mingw/include/wchar.h:152:		       const wchar_t * __restrict__, __VALIST);
/mingw/include/wchar.h:153:int __cdecl __MINGW_NOTHROW vswscanf (const wchar_t * __restrict__,
/mingw/include/wchar.h:154:		       const wchar_t * __restrict__, __VALIST);
/mingw/include/wchar.h:165:float __cdecl __MINGW_NOTHROW wcstof (const wchar_t * __restrict__, wchar_t ** __restrict__);
/mingw/include/wchar.h:166:long double __cdecl __MINGW_NOTHROW wcstold (const wchar_t * __restrict__, wchar_t ** __restrict__);
/mingw/include/wchar.h:281:size_t __cdecl __MINGW_NOTHROW mbrlen(const char * __restrict__, size_t,
/mingw/include/wchar.h:282:		      mbstate_t * __restrict__);
/mingw/include/wchar.h:283:size_t __cdecl __MINGW_NOTHROW mbrtowc(wchar_t * __restrict__, const char * __restrict__,
/mingw/include/wchar.h:284:		       size_t, mbstate_t * __restrict__);
/mingw/include/wchar.h:285:size_t __cdecl __MINGW_NOTHROW mbsrtowcs(wchar_t * __restrict__, const char ** __restrict__,
/mingw/include/wchar.h:286:			 size_t, mbstate_t * __restrict__);
/mingw/include/wchar.h:287:size_t __cdecl __MINGW_NOTHROW wcrtomb(char * __restrict__, wchar_t,
/mingw/include/wchar.h:288:		       mbstate_t * __restrict__);
/mingw/include/wchar.h:289:size_t __cdecl __MINGW_NOTHROW wcsrtombs(char * __restrict__, const wchar_t ** __restrict__,
/mingw/include/wchar.h:290:			 size_t, mbstate_t * __restrict__);
/mingw/include/wchar.h:306:wchar_t* __cdecl __MINGW_NOTHROW wmemcpy(wchar_t* __restrict__,
/mingw/include/wchar.h:307:		         const wchar_t* __restrict__,
/mingw/include/wchar.h:310:long long __cdecl __MINGW_NOTHROW wcstoll(const wchar_t * __restrict__,
/mingw/include/wchar.h:311:			  wchar_t** __restrict__, int);
/mingw/include/wchar.h:312:unsigned long long __cdecl __MINGW_NOTHROW wcstoull(const wchar_t * __restrict__,
/mingw/include/wchar.h:313:			    wchar_t ** __restrict__, int);


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 02/10] sparse: add 'gnu_inline' to the ignored attributes ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 02/10] sparse: add 'gnu_inline' to the ignored attributes
Date: Mon, 04 Aug 2014 18:33:42 +0000
Message-ID: <53DFD206.20002 () ramsay1 ! demon ! co ! uk>
--------------------

Add some more ignored attributes which are used in glibc header files,
along with a simple test case which includes all three inline attributes
(__gnu_inline__, __always_inline__ and __noinline__).

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 parse.c                  |  2 ++
 validation/attr-inline.c | 21 +++++++++++++++++++++
 2 files changed, 23 insertions(+)
 create mode 100644 validation/attr-inline.c

diff --git a/parse.c b/parse.c
index 9767e59..69bcf82 100644
--- a/parse.c
+++ b/parse.c
@@ -536,6 +536,8 @@ const char *ignored_attributes[] = {
 	"__format__",
 	"format_arg",
 	"__format_arg__",
+	"gnu_inline",
+	"__gnu_inline__",
 	"hot",
 	"__hot__",
         "leaf",
diff --git a/validation/attr-inline.c b/validation/attr-inline.c
new file mode 100644
index 0000000..1b88ddb
--- /dev/null
+++ b/validation/attr-inline.c
@@ -0,0 +1,21 @@
+
+static inline __attribute__((__always_inline__)) int gt(int lhs, int rhs)
+{
+	return lhs > rhs;
+}
+
+extern inline __attribute__((__gnu_inline__)) int ge(int lhs, int rhs)
+{
+	return lhs >= rhs;
+}
+
+static __attribute__((__warning__("That's junk!"))) __attribute__((__unused__))
+__attribute__((__noinline__))
+void junk(void)
+{
+	__asm__("");
+}
+
+/*
+ * check-name: inline attributes
+ */
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 03/10] don't call isdigit/tolower with a char argument ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 03/10] don't call isdigit/tolower with a char argument
Date: Mon, 04 Aug 2014 18:34:30 +0000
Message-ID: <53DFD236.8090309 () ramsay1 ! demon ! co ! uk>
--------------------

This suppresses some "array subscript has type 'char'" warnings from
gcc (version 4.8.3). (see also, commit cf5114a1)

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 expression.c | 2 +-
 lib.c        | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/expression.c b/expression.c
index 4353dbe..7293d47 100644
--- a/expression.c
+++ b/expression.c
@@ -240,7 +240,7 @@ static struct token *builtin_offsetof_expr(struct token *token,
 
 static unsigned long long parse_num(const char *nptr, char **end)
 {
-	if (nptr[0] == '0' && tolower(nptr[1]) == 'b')
+	if (nptr[0] == '0' && tolower((unsigned char)nptr[1]) == 'b')
 		return strtoull(&nptr[2], end, 2);
 	return strtoull(nptr, end, 0);
 }
diff --git a/lib.c b/lib.c
index 4e6fc81..9c7767e 100644
--- a/lib.c
+++ b/lib.c
@@ -281,7 +281,7 @@ static char **handle_switch_D(char *arg, char **next)
 	const char *name = arg + 1;
 	const char *value = "1";
 
-	if (!*name || isspace(*name))
+	if (!*name || isspace((unsigned char)*name))
 		die("argument to `-D' is missing");
 
 	for (;;) {
@@ -699,7 +699,7 @@ static char **handle_param(char *arg, char **next)
 	/* For now just skip any '--param=*' or '--param *' */
 	if (*arg == '\0') {
 		value = *++next;
-	} else if (isspace(*arg) || *arg == '=') {
+	} else if (isspace((unsigned char)*arg) || *arg == '=') {
 		value = ++arg;
 	}
 
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 04/10] compile-i386.c: don't mix calls to write(2) with stdio ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 04/10] compile-i386.c: don't mix calls to write(2) with stdio
Date: Mon, 04 Aug 2014 18:36:39 +0000
Message-ID: <53DFD2B7.7080801 () ramsay1 ! demon ! co ! uk>
--------------------

Some versions of gcc (e.g. v4.8.2) complain about ignoring the return
value of a call to 'write(2)' on line 735, since it is marked with
the warn_unused_result attribute. (see also lines 745-747).

Note that this code is mixing calls to 'write' on STDOUT_FILENO with
calls to stdio functions on the stdout file handle. So, in order to
suppress the compiler warnings, we replace both calls to 'write' with
equivalent calls to stdio functions.

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

Since there are no tests for the compile program, I ran the old version
(from commit 748b856) and this version over all of the .c files in the
sparse directory, saving the output to file and diff-ing the result.
Unfortunately, compile segfaults on most files and the diff shows that
this patch leads to a change in behaviour, caused by the lack of I/O
buffer flushing prior to the segfault (all of the diffs showed missing 
text at the end of each new output file).

Just to confirm, I added back the 'fflush(stdout); ...' line that I
removed in the third hunk below _and_ duplicated that line and placed
it after the call to 'emit_atom_list(f);'. This version of compile
produced (almost) exactly the same output as the original.

The reason for the almost is that three files showed a non-empty diff
which seemed to indicate (a possible bug?) that a label name was being
generated from a memory address. The actual addresses/label name
generated in each file was different, but they were used consistently
in each file. For example, the complete diff for sort.c is:

    --- sort.c.out-old	2014-08-04 17:32:32.399744973 +0100
    +++ sort.c.out-new	2014-08-04 17:37:04.189092702 +0100
    @@ -742,7 +742,7 @@
     	addl	$744, %esp
     	ret	
     	.size	merge_block_seqs, .-merge_block_seqs
    -.L0xb740550c:
    +.L0xb748068c:
     .globl sort_list
     	.type	sort_list, @function
     sort_list:
    @@ -837,7 +837,7 @@
     	movl	%eax, 68(%esp)		# .... end copy
     	jmp	.L72
     .L87:					# end if
    -	jmp	.LS0xb740550c
    +	jmp	.LS0xb748068c
     .L86:					# end if
     	movl	44(%esp), %eax		# begin copy ..
     	movl	%eax, 72(%esp)		# .... end copy

ATB,
Ramsay Jones

 compile-i386.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/compile-i386.c b/compile-i386.c
index 88169ec..f89b6ca 100644
--- a/compile-i386.c
+++ b/compile-i386.c
@@ -732,7 +732,7 @@ static void emit_insn_atom(struct function *f, struct atom *atom)
 			atom->insn,
 			comment[0] ? "\t\t" : "", comment);
 
-	write(STDOUT_FILENO, s, strlen(s));
+	printf("%s", s);
 }
 
 static void emit_atom_list(struct function *f)
@@ -742,9 +742,7 @@ static void emit_atom_list(struct function *f)
 	FOR_EACH_PTR(f->atom_list, atom) {
 		switch (atom->type) {
 		case ATOM_TEXT: {
-			ssize_t rc = write(STDOUT_FILENO, atom->text,
-					   atom->text_len);
-			(void) rc;	/* FIXME */
+			printf("%.*s", (int)atom->text_len, atom->text);
 			break;
 		}
 		case ATOM_INSN:
@@ -886,7 +884,6 @@ static void emit_func_post(struct symbol *sym)
 	insn("ret", NULL, NULL, NULL);
 
 	/* output everything to stdout */
-	fflush(stdout);		/* paranoia; needed? */
 	emit_atom_list(f);
 
 	/* function footer */
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 04/10] compile-i386.c: don't mix calls to write(2) with stdio
Date: Tue, 30 Sep 2014 02:34:50 +0000
Message-ID: <CANeU7QnARF7N3Yz1h+XF-zqjYnN+XA54QRENNfpbs2Ayq5LbAA () mail ! gmail ! com>
--------------------
On Sat, Sep 27, 2014 at 9:00 PM, Ramsay Jones
<ramsay@ramsay1.demon.co.uk> wrote:
>>> -       write(STDOUT_FILENO, s, strlen(s));
>>> +       printf("%s", s);
>>
>
> I was only really fixing the compiler warning (in an side-ways fashion).
> (although I think it is an improvement).

I would just check the return value and "die" if there is an error to silence
the error.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 04/10] compile-i386.c: don't mix calls to write(2) with stdio
Date: Thu, 02 Oct 2014 10:27:43 +0000
Message-ID: <542D289F.9090701 () ramsay1 ! demon ! co ! uk>
--------------------
On 30/09/14 03:34, Christopher Li wrote:
> On Sat, Sep 27, 2014 at 9:00 PM, Ramsay Jones
> <ramsay@ramsay1.demon.co.uk> wrote:
>>>> -       write(STDOUT_FILENO, s, strlen(s));
>>>> +       printf("%s", s);
>>>
>>
>> I was only really fixing the compiler warning (in an side-ways fashion).
>> (although I think it is an improvement).
> 
> I would just check the return value and "die" if there is an error to silence
> the error.

Hmmm, I can change the patch to do that if you prefer.

Having said that, given that this is not currently maintained, what
do you think about a patch to remove it?

[Are you hoping someone will pick it up again soon?]

Let me know which patch you would like to see.

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Mon, 04 Aug 2014 18:38:24 +0000
Message-ID: <53DFD320.2050903 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 validation/test-suite | 25 +++++++++++++++++++++++--
 1 file changed, 23 insertions(+), 2 deletions(-)

diff --git a/validation/test-suite b/validation/test-suite
index 3c011c6..0142701 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -7,12 +7,18 @@ default_cmd="sparse \$file"
 tests_list=`find . -name '*.c' | sed -e 's#^\./\(.*\)#\1#' | sort`
 prog_name=`basename $0`
 
+if [ ! -x "$default_path/sparse-llvm" ]; then
+	disabled_cmds="sparsec sparsei sparse-llvm"
+fi
+
 # counts:
 #	- tests that have not been converted to test-suite format
+#	- tests that are disabled
 #	- tests that passed
 #	- tests that failed
 #	- tests that failed but are known to fail
 unhandled_tests=0
+disabled_tests=0
 ok_tests=0
 ko_tests=0
 known_ko_tests=0
@@ -80,6 +86,7 @@ echo "    help                       prints usage"
 #	- 0 if the test passed,
 #	- 1 if it failed,
 #	- 2 if it is not a "test-suite" test.
+#	- 3 if the test is disabled.
 do_test()
 {
 	test_failed=0
@@ -95,8 +102,6 @@ do_test()
 	fi
 	test_name=$last_result
 
-	echo "     TEST    $test_name ($file)"
-
 	# does the test provide a specific command ?
 	cmd=`eval echo $default_path/$default_cmd`
 	get_value "check-command" $file
@@ -104,6 +109,19 @@ do_test()
 		last_result=`echo $last_result | sed -e 's/^ *//'`
 		cmd=`eval echo $default_path/$last_result`
 	fi
+
+	# check for disabled commands
+	for i in $disabled_cmds; do
+		case "$cmd" in
+		*$i*)
+			disabled_tests=`expr $disabled_tests + 1`
+			return 3
+			;;
+		esac
+	done
+
+	echo "     TEST    $test_name ($file)"
+
 	verbose "Using command       : $cmd"
 
 	# grab the expected exit value
@@ -168,6 +186,9 @@ do_test_suite()
 	if [ "$unhandled_tests" -ne "0" ]; then
 		echo "$unhandled_tests tests could not be handled by $prog_name"
 	fi
+	if [ "$disabled_tests" -ne "0" ]; then
+		echo "$disabled_tests tests were disabled"
+	fi
 }
 
 ##
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Mon, 04 Aug 2014 18:38:24 +0000
Message-ID: <53DFD320.2050903 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 validation/test-suite | 25 +++++++++++++++++++++++--
 1 file changed, 23 insertions(+), 2 deletions(-)

diff --git a/validation/test-suite b/validation/test-suite
index 3c011c6..0142701 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -7,12 +7,18 @@ default_cmd="sparse \$file"
 tests_list=`find . -name '*.c' | sed -e 's#^\./\(.*\)#\1#' | sort`
 prog_name=`basename $0`
 
+if [ ! -x "$default_path/sparse-llvm" ]; then
+	disabled_cmds="sparsec sparsei sparse-llvm"
+fi
+
 # counts:
 #	- tests that have not been converted to test-suite format
+#	- tests that are disabled
 #	- tests that passed
 #	- tests that failed
 #	- tests that failed but are known to fail
 unhandled_tests=0
+disabled_tests=0
 ok_tests=0
 ko_tests=0
 known_ko_tests=0
@@ -80,6 +86,7 @@ echo "    help                       prints usage"
 #	- 0 if the test passed,
 #	- 1 if it failed,
 #	- 2 if it is not a "test-suite" test.
+#	- 3 if the test is disabled.
 do_test()
 {
 	test_failed=0
@@ -95,8 +102,6 @@ do_test()
 	fi
 	test_name=$last_result
 
-	echo "     TEST    $test_name ($file)"
-
 	# does the test provide a specific command ?
 	cmd=`eval echo $default_path/$default_cmd`
 	get_value "check-command" $file
@@ -104,6 +109,19 @@ do_test()
 		last_result=`echo $last_result | sed -e 's/^ *//'`
 		cmd=`eval echo $default_path/$last_result`
 	fi
+
+	# check for disabled commands
+	for i in $disabled_cmds; do
+		case "$cmd" in
+		*$i*)
+			disabled_tests=`expr $disabled_tests + 1`
+			return 3
+			;;
+		esac
+	done
+
+	echo "     TEST    $test_name ($file)"
+
 	verbose "Using command       : $cmd"
 
 	# grab the expected exit value
@@ -168,6 +186,9 @@ do_test_suite()
 	if [ "$unhandled_tests" -ne "0" ]; then
 		echo "$unhandled_tests tests could not be handled by $prog_name"
 	fi
+	if [ "$disabled_tests" -ne "0" ]; then
+		echo "$disabled_tests tests were disabled"
+	fi
 }
 
 ##
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Mon, 04 Aug 2014 18:38:24 +0000
Message-ID: <53DFD320.2050903 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 validation/test-suite | 25 +++++++++++++++++++++++--
 1 file changed, 23 insertions(+), 2 deletions(-)

diff --git a/validation/test-suite b/validation/test-suite
index 3c011c6..0142701 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -7,12 +7,18 @@ default_cmd="sparse \$file"
 tests_list=`find . -name '*.c' | sed -e 's#^\./\(.*\)#\1#' | sort`
 prog_name=`basename $0`
 
+if [ ! -x "$default_path/sparse-llvm" ]; then
+	disabled_cmds="sparsec sparsei sparse-llvm"
+fi
+
 # counts:
 #	- tests that have not been converted to test-suite format
+#	- tests that are disabled
 #	- tests that passed
 #	- tests that failed
 #	- tests that failed but are known to fail
 unhandled_tests=0
+disabled_tests=0
 ok_tests=0
 ko_tests=0
 known_ko_tests=0
@@ -80,6 +86,7 @@ echo "    help                       prints usage"
 #	- 0 if the test passed,
 #	- 1 if it failed,
 #	- 2 if it is not a "test-suite" test.
+#	- 3 if the test is disabled.
 do_test()
 {
 	test_failed=0
@@ -95,8 +102,6 @@ do_test()
 	fi
 	test_name=$last_result
 
-	echo "     TEST    $test_name ($file)"
-
 	# does the test provide a specific command ?
 	cmd=`eval echo $default_path/$default_cmd`
 	get_value "check-command" $file
@@ -104,6 +109,19 @@ do_test()
 		last_result=`echo $last_result | sed -e 's/^ *//'`
 		cmd=`eval echo $default_path/$last_result`
 	fi
+
+	# check for disabled commands
+	for i in $disabled_cmds; do
+		case "$cmd" in
+		*$i*)
+			disabled_tests=`expr $disabled_tests + 1`
+			return 3
+			;;
+		esac
+	done
+
+	echo "     TEST    $test_name ($file)"
+
 	verbose "Using command       : $cmd"
 
 	# grab the expected exit value
@@ -168,6 +186,9 @@ do_test_suite()
 	if [ "$unhandled_tests" -ne "0" ]; then
 		echo "$unhandled_tests tests could not be handled by $prog_name"
 	fi
+	if [ "$disabled_tests" -ne "0" ]; then
+		echo "$disabled_tests tests were disabled"
+	fi
 }
 
 ##
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Sat, 27 Sep 2014 13:37:27 +0000
Message-ID: <5426BD97.2080700 () ramsay1 ! demon ! co ! uk>
--------------------
On 27/09/14 05:29, Christopher Li wrote:
> On Tue, Aug 5, 2014 at 2:38 AM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
>> +if [ ! -x "$default_path/sparse-llvm" ]; then
>> +       disabled_cmds="sparsec sparsei sparse-llvm"
>> +fi
> 
> I think this can  be simplified as if the test command was not found,
> then that test will be disabled. It doesn't need to be sparse llvm, it
> can be other
> test program.

Unfortunately, sparcec and sparsei are the commands that are
used by the tests (I included sparse-llvm in the list in case
any _future_ tests used it directly), and they do exist and
are executable. They simply will not work if sparse-llvm is
not built.

I did think about removing the x-bit on sparse{c,i} in git,
enabling it again in the worktree if sparse-llvm was built,
but I was concerned that would not work on cygwin and it
would possibly complicate installation. ie I didn't try it
out seriously. This patch seemed the best solution to me.

[Another idea I didn't try: name the sparse{c,i} scripts
sparse{c,i}-in and rename them as part of a successful
build of sparse-llvm]

BTW, the 'validation/backend/sum.c' fails for me on cygwin
(64-bit), but I think it is actually a problem with the
llvm interpreter lli. (it works fine on my old 32-bit Linux
laptop).

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Sat, 27 Sep 2014 13:37:27 +0000
Message-ID: <5426BD97.2080700 () ramsay1 ! demon ! co ! uk>
--------------------
On 27/09/14 05:29, Christopher Li wrote:
> On Tue, Aug 5, 2014 at 2:38 AM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
>> +if [ ! -x "$default_path/sparse-llvm" ]; then
>> +       disabled_cmds="sparsec sparsei sparse-llvm"
>> +fi
> 
> I think this can  be simplified as if the test command was not found,
> then that test will be disabled. It doesn't need to be sparse llvm, it
> can be other
> test program.

Unfortunately, sparcec and sparsei are the commands that are
used by the tests (I included sparse-llvm in the list in case
any _future_ tests used it directly), and they do exist and
are executable. They simply will not work if sparse-llvm is
not built.

I did think about removing the x-bit on sparse{c,i} in git,
enabling it again in the worktree if sparse-llvm was built,
but I was concerned that would not work on cygwin and it
would possibly complicate installation. ie I didn't try it
out seriously. This patch seemed the best solution to me.

[Another idea I didn't try: name the sparse{c,i} scripts
sparse{c,i}-in and rename them as part of a successful
build of sparse-llvm]

BTW, the 'validation/backend/sum.c' fails for me on cygwin
(64-bit), but I think it is actually a problem with the
llvm interpreter lli. (it works fine on my old 32-bit Linux
laptop).

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Tue, 30 Sep 2014 03:26:11 +0000
Message-ID: <CANeU7Q=vDAuBwWqy0=rbvkpgmzysCw=pfSEcwzyRRSZj3QrJbA () mail ! gmail ! com>
--------------------
On Sat, Sep 27, 2014 at 9:37 PM, Ramsay Jones
<ramsay@ramsay1.demon.co.uk> wrote:
> On 27/09/14 05:29, Christopher Li wrote:
>
> Unfortunately, sparcec and sparsei are the commands that are
> used by the tests (I included sparse-llvm in the list in case
> any _future_ tests used it directly), and they do exist and
> are executable. They simply will not work if sparse-llvm is
> not built.
>

I see. That make sense.

We just need a way to specify the dependency of test commands.
e.g. sparsec depends on sparse-llvm. So if sparsec does  not exist,
or sparse-llvm does  not exist, the test will be skipped.

I am thinking some thing in the test-suite like:

set_deps sparsec sparse-llvm
set_deps sparsei sparse-llvm

...
get_deps `basename cmd`
dep_cmd=$last_result

> Note that I renamed sparse{c,i} to sparse{c,i}-in. It may have been
> better to name then sparse{c,i}.sh, since they are not really templates
> to be 'processed' to create a build product. dunno.
>

I prefer specify the dependency. Another copy is not necessary.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Tue, 30 Sep 2014 03:26:11 +0000
Message-ID: <CANeU7Q=vDAuBwWqy0=rbvkpgmzysCw=pfSEcwzyRRSZj3QrJbA () mail ! gmail ! com>
--------------------
On Sat, Sep 27, 2014 at 9:37 PM, Ramsay Jones
<ramsay@ramsay1.demon.co.uk> wrote:
> On 27/09/14 05:29, Christopher Li wrote:
>
> Unfortunately, sparcec and sparsei are the commands that are
> used by the tests (I included sparse-llvm in the list in case
> any _future_ tests used it directly), and they do exist and
> are executable. They simply will not work if sparse-llvm is
> not built.
>

I see. That make sense.

We just need a way to specify the dependency of test commands.
e.g. sparsec depends on sparse-llvm. So if sparsec does  not exist,
or sparse-llvm does  not exist, the test will be skipped.

I am thinking some thing in the test-suite like:

set_deps sparsec sparse-llvm
set_deps sparsei sparse-llvm

...
get_deps `basename cmd`
dep_cmd=$last_result

> Note that I renamed sparse{c,i} to sparse{c,i}-in. It may have been
> better to name then sparse{c,i}.sh, since they are not really templates
> to be 'processed' to create a build product. dunno.
>

I prefer specify the dependency. Another copy is not necessary.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Thu, 02 Oct 2014 03:44:56 +0000
Message-ID: <CANeU7QnXWFad9Re0MtGkei6F6ZnUOH96et5_7aJQommFp2dLwQ () mail ! gmail ! com>
--------------------
On Tue, Sep 30, 2014 at 11:26 AM, Christopher Li <sparse@chrisli.org> wrote:
> I am thinking some thing in the test-suite like:
>
> set_deps sparsec sparse-llvm
> set_deps sparsei sparse-llvm
>
> ...
> get_deps `basename cmd`
> dep_cmd=$last_result

Actually, I try that, it is a little bit too complicated.

Your first approach is fine.

I end up using your V1 patch, with a small change to do exact match rather than
a wild cast. The wild cast has danger that match a sub word of the command.
e.g. if you try to disable command "sp", it will disable "sparse" as well.

Chris

diff --git a/validation/test-suite b/validation/test-suite
index 1c94aa8..784ff6b 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -111,13 +111,13 @@ do_test()
        fi

        # check for disabled commands
+       set -- $cmd
+       base_cmd=`basename $1`
        for i in $disabled_cmds; do
-               case "$cmd" in
-               *$i*)
+               if [ "$i" == "$base_cmd" ] ; then
                        disabled_tests=`expr $disabled_tests + 1`
                        return 3
-                       ;;
-               esac
+               fi
        done

        echo "     TEST    $test_name ($file)"
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Thu, 02 Oct 2014 10:31:48 +0000
Message-ID: <542D2994.7020304 () ramsay1 ! demon ! co ! uk>
--------------------
On 02/10/14 04:44, Christopher Li wrote:
> On Tue, Sep 30, 2014 at 11:26 AM, Christopher Li <sparse@chrisli.org> wrote:
>> I am thinking some thing in the test-suite like:
>>
>> set_deps sparsec sparse-llvm
>> set_deps sparsei sparse-llvm
>>
>> ...
>> get_deps `basename cmd`
>> dep_cmd=$last_result
> 
> Actually, I try that, it is a little bit too complicated.
> 
> Your first approach is fine.
> 
> I end up using your V1 patch, with a small change to do exact match rather than
> a wild cast. The wild cast has danger that match a sub word of the command.
> e.g. if you try to disable command "sp", it will disable "sparse" as well.

Ah yes, good catch!

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Thu, 02 Oct 2014 10:31:48 +0000
Message-ID: <542D2994.7020304 () ramsay1 ! demon ! co ! uk>
--------------------
On 02/10/14 04:44, Christopher Li wrote:
> On Tue, Sep 30, 2014 at 11:26 AM, Christopher Li <sparse@chrisli.org> wrote:
>> I am thinking some thing in the test-suite like:
>>
>> set_deps sparsec sparse-llvm
>> set_deps sparsei sparse-llvm
>>
>> ...
>> get_deps `basename cmd`
>> dep_cmd=$last_result
> 
> Actually, I try that, it is a little bit too complicated.
> 
> Your first approach is fine.
> 
> I end up using your V1 patch, with a small change to do exact match rather than
> a wild cast. The wild cast has danger that match a sub word of the command.
> e.g. if you try to disable command "sp", it will disable "sparse" as well.

Ah yes, good catch!

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 07/10] Add support for multiarch system header files ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 07/10] Add support for multiarch system header files
Date: Mon, 04 Aug 2014 18:39:12 +0000
Message-ID: <53DFD350.6080701 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 Makefile |  3 +++
 cgcc     | 10 ++++++++++
 lib.c    | 18 +++++++++++++++++-
 sparse.1 |  6 ++++++
 4 files changed, 36 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 1795905..36061e3 100644
--- a/Makefile
+++ b/Makefile
@@ -36,6 +36,9 @@ HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
 GCC_BASE = $(shell $(CC) --print-file-name=)
 BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
 
+MULTIARCH_TRIPLET = $(shell $(CC) -print-multiarch 2>/dev/null)
+BASIC_CFLAGS += -DMULTIARCH_TRIPLET=\"$(MULTIARCH_TRIPLET)\"
+
 ifeq ($(HAVE_GCC_DEP),yes)
 BASIC_CFLAGS += -Wp,-MD,$(@D)/.$(@F).d
 endif
diff --git a/cgcc b/cgcc
index c075e5f..ed35e39 100755
--- a/cgcc
+++ b/cgcc
@@ -11,6 +11,7 @@ my $gendeps = 0;
 my $do_check = 0;
 my $do_compile = 1;
 my $gcc_base_dir;
+my $multiarch_dir;
 my $verbose = 0;
 
 while (@ARGV) {
@@ -44,6 +45,12 @@ while (@ARGV) {
         next;
     }
 
+    if (/^-multiarch-dir$/) {
+        $multiarch_dir = shift @ARGV;
+        die ("$0: missing argument for -multiarch-dir option") if !$multiarch_dir;
+        next;
+    }
+
     # If someone adds "-E", don't pre-process twice.
     $do_compile = 0 if $_ eq '-E';
 
@@ -66,8 +73,11 @@ if ($do_check) {
     }
 
     $gcc_base_dir = qx($cc -print-file-name=) if !$gcc_base_dir;
+    chomp($gcc_base_dir);  # possibly remove '\n' from compiler
     $check .= " -gcc-base-dir " . $gcc_base_dir if $gcc_base_dir;
 
+    $check .= " -multiarch-dir " . $multiarch_dir if $multiarch_dir;
+
     print "$check\n" if $verbose;
     if ($do_compile) {
 	system ($check);
diff --git a/lib.c b/lib.c
index 9c7767e..0b62dcb 100644
--- a/lib.c
+++ b/lib.c
@@ -59,6 +59,7 @@ int gcc_minor = __GNUC_MINOR__;
 int gcc_patchlevel = __GNUC_PATCHLEVEL__;
 
 static const char *gcc_base_dir = GCC_BASE;
+static const char *multiarch_dir = MULTIARCH_TRIPLET;
 
 struct token *skip_to(struct token *token, int op)
 {
@@ -363,6 +364,14 @@ static char **handle_switch_M(char *arg, char **next)
 	return next;
 }
 
+static char **handle_multiarch_dir(char *arg, char **next)
+{
+	multiarch_dir = *++next;
+	if (!multiarch_dir)
+		die("missing argument for -multiarch-dir option");
+	return next;
+}
+
 static char **handle_switch_m(char *arg, char **next)
 {
 	if (!strcmp(arg, "m64")) {
@@ -371,7 +380,8 @@ static char **handle_switch_m(char *arg, char **next)
 		arch_m64 = 0;
 	} else if (!strcmp(arg, "msize-long")) {
 		arch_msize_long = 1;
-	}
+	} else if (!strcmp(arg, "multiarch-dir"))
+		return handle_multiarch_dir(arg, next);
 	return next;
 }
 
@@ -881,6 +891,12 @@ void create_builtin_stream(void)
 	add_pre_buffer("#weak_define __GNUC_MINOR__ %d\n", gcc_minor);
 	add_pre_buffer("#weak_define __GNUC_PATCHLEVEL__ %d\n", gcc_patchlevel);
 
+	/* add the multiarch include directories, if any */
+	if (multiarch_dir && *multiarch_dir) {
+		add_pre_buffer("#add_system \"/usr/include/%s\"\n", multiarch_dir);
+		add_pre_buffer("#add_system \"/usr/local/include/%s\"\n", multiarch_dir);
+	}
+
 	/* We add compiler headers path here because we have to parse
 	 * the arguments to get it, falling back to default. */
 	add_pre_buffer("#add_system \"%s/include\"\n", gcc_base_dir);
diff --git a/sparse.1 b/sparse.1
index 54da09b..a305a21 100644
--- a/sparse.1
+++ b/sparse.1
@@ -335,6 +335,12 @@ Sparse does not issue these warnings by default.
 .B \-gcc-base-dir \fIdir\fR
 Look for compiler-provided system headers in \fIdir\fR/include/ and \fIdir\fR/include-fixed/.
 .
+.TP
+.B \-multiarch-dir \fIdir\fR
+Look for system headers in the multiarch subdirectory \fIdir\fR.
+The \fIdir\fR name would normally take the form of the target's
+normalized GNU triplet. (e.g. i386-linux-gnu).
+.
 .SH OTHER OPTIONS
 .TP
 .B \-ftabstop=WIDTH
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 07/10] Add support for multiarch system header files
Date: Mon, 04 Aug 2014 18:39:12 +0000
Message-ID: <53DFD350.6080701 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 Makefile |  3 +++
 cgcc     | 10 ++++++++++
 lib.c    | 18 +++++++++++++++++-
 sparse.1 |  6 ++++++
 4 files changed, 36 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 1795905..36061e3 100644
--- a/Makefile
+++ b/Makefile
@@ -36,6 +36,9 @@ HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
 GCC_BASE = $(shell $(CC) --print-file-name=)
 BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
 
+MULTIARCH_TRIPLET = $(shell $(CC) -print-multiarch 2>/dev/null)
+BASIC_CFLAGS += -DMULTIARCH_TRIPLET=\"$(MULTIARCH_TRIPLET)\"
+
 ifeq ($(HAVE_GCC_DEP),yes)
 BASIC_CFLAGS += -Wp,-MD,$(@D)/.$(@F).d
 endif
diff --git a/cgcc b/cgcc
index c075e5f..ed35e39 100755
--- a/cgcc
+++ b/cgcc
@@ -11,6 +11,7 @@ my $gendeps = 0;
 my $do_check = 0;
 my $do_compile = 1;
 my $gcc_base_dir;
+my $multiarch_dir;
 my $verbose = 0;
 
 while (@ARGV) {
@@ -44,6 +45,12 @@ while (@ARGV) {
         next;
     }
 
+    if (/^-multiarch-dir$/) {
+        $multiarch_dir = shift @ARGV;
+        die ("$0: missing argument for -multiarch-dir option") if !$multiarch_dir;
+        next;
+    }
+
     # If someone adds "-E", don't pre-process twice.
     $do_compile = 0 if $_ eq '-E';
 
@@ -66,8 +73,11 @@ if ($do_check) {
     }
 
     $gcc_base_dir = qx($cc -print-file-name=) if !$gcc_base_dir;
+    chomp($gcc_base_dir);  # possibly remove '\n' from compiler
     $check .= " -gcc-base-dir " . $gcc_base_dir if $gcc_base_dir;
 
+    $check .= " -multiarch-dir " . $multiarch_dir if $multiarch_dir;
+
     print "$check\n" if $verbose;
     if ($do_compile) {
 	system ($check);
diff --git a/lib.c b/lib.c
index 9c7767e..0b62dcb 100644
--- a/lib.c
+++ b/lib.c
@@ -59,6 +59,7 @@ int gcc_minor = __GNUC_MINOR__;
 int gcc_patchlevel = __GNUC_PATCHLEVEL__;
 
 static const char *gcc_base_dir = GCC_BASE;
+static const char *multiarch_dir = MULTIARCH_TRIPLET;
 
 struct token *skip_to(struct token *token, int op)
 {
@@ -363,6 +364,14 @@ static char **handle_switch_M(char *arg, char **next)
 	return next;
 }
 
+static char **handle_multiarch_dir(char *arg, char **next)
+{
+	multiarch_dir = *++next;
+	if (!multiarch_dir)
+		die("missing argument for -multiarch-dir option");
+	return next;
+}
+
 static char **handle_switch_m(char *arg, char **next)
 {
 	if (!strcmp(arg, "m64")) {
@@ -371,7 +380,8 @@ static char **handle_switch_m(char *arg, char **next)
 		arch_m64 = 0;
 	} else if (!strcmp(arg, "msize-long")) {
 		arch_msize_long = 1;
-	}
+	} else if (!strcmp(arg, "multiarch-dir"))
+		return handle_multiarch_dir(arg, next);
 	return next;
 }
 
@@ -881,6 +891,12 @@ void create_builtin_stream(void)
 	add_pre_buffer("#weak_define __GNUC_MINOR__ %d\n", gcc_minor);
 	add_pre_buffer("#weak_define __GNUC_PATCHLEVEL__ %d\n", gcc_patchlevel);
 
+	/* add the multiarch include directories, if any */
+	if (multiarch_dir && *multiarch_dir) {
+		add_pre_buffer("#add_system \"/usr/include/%s\"\n", multiarch_dir);
+		add_pre_buffer("#add_system \"/usr/local/include/%s\"\n", multiarch_dir);
+	}
+
 	/* We add compiler headers path here because we have to parse
 	 * the arguments to get it, falling back to default. */
 	add_pre_buffer("#add_system \"%s/include\"\n", gcc_base_dir);
diff --git a/sparse.1 b/sparse.1
index 54da09b..a305a21 100644
--- a/sparse.1
+++ b/sparse.1
@@ -335,6 +335,12 @@ Sparse does not issue these warnings by default.
 .B \-gcc-base-dir \fIdir\fR
 Look for compiler-provided system headers in \fIdir\fR/include/ and \fIdir\fR/include-fixed/.
 .
+.TP
+.B \-multiarch-dir \fIdir\fR
+Look for system headers in the multiarch subdirectory \fIdir\fR.
+The \fIdir\fR name would normally take the form of the target's
+normalized GNU triplet. (e.g. i386-linux-gnu).
+.
 .SH OTHER OPTIONS
 .TP
 .B \-ftabstop=WIDTH
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 07/10] Add support for multiarch system header files
Date: Mon, 06 Oct 2014 10:31:39 +0000
Message-ID: <54326F8B.1050201 () ramsay1 ! demon ! co ! uk>
--------------------
On 06/10/14 00:33, Christopher Li wrote:
> On Tue, Aug 5, 2014 at 2:39 AM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
>>
>> Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
> 
> May I have a more descriptive change log why is multiarch option useful?
> 
>> @@ -36,6 +36,9 @@ HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
>>  GCC_BASE = $(shell $(CC) --print-file-name=)
>>  BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
>>
>> +MULTIARCH_TRIPLET = $(shell $(CC) -print-multiarch 2>/dev/null)
>> +BASIC_CFLAGS += -DMULTIARCH_TRIPLET=\"$(MULTIARCH_TRIPLET)\"
> 
> My gcc(4.8, FC20) does not support "-print-multiarch".

Yep, same is true for cygwin.

> So the patch need to handle that case.
> As far as I can tell, this patch is not ready for empty  MULTIARCH_TRIPLET.

Hmm, works for me! Could you describe the failure you are seeing.

> 
>> +       if (multiarch_dir && *multiarch_dir) {
>> +               add_pre_buffer("#add_system \"/usr/include/%s\"\n", multiarch_dir);
>> +               add_pre_buffer("#add_system \"/usr/local/include/%s\"\n", multiarch_dir);
>> +       }
> 
> Not sure empty multiarch_dir works here.

Again, it works for me. :-D

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 07/10] Add support for multiarch system header files
Date: Tue, 07 Oct 2014 03:55:57 +0000
Message-ID: <CANeU7QmBc6Ogh-U-rfxfrvM+j8BS_HzTs6CaAQ7eGY4F+qDrZg () mail ! gmail ! com>
--------------------
On Mon, Oct 6, 2014 at 6:31 PM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
> On 06/10/14 00:33, Christopher Li wrote:
>> My gcc(4.8, FC20) does not support "-print-multiarch".
>
> Yep, same is true for cygwin.

I see, I thought your patch is expecting some thing from gcc.
Then how to you test this code path?

>>
>>> +       if (multiarch_dir && *multiarch_dir) {
>>> +               add_pre_buffer("#add_system \"/usr/include/%s\"\n", multiarch_dir);
>>> +               add_pre_buffer("#add_system \"/usr/local/include/%s\"\n", multiarch_dir);
>>> +       }
>>
> Again, it works for me. :-D

So I guess multiarch_dir can be empty here. I just did not expect
that.

Is it always prefix with "/usr/include/" and "/usr/local/include" for
different distributions?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 07/10] Add support for multiarch system header files
Date: Tue, 07 Oct 2014 10:20:49 +0000
Message-ID: <5433BE81.3080604 () ramsay1 ! demon ! co ! uk>
--------------------
On 07/10/14 04:55, Christopher Li wrote:
> On Mon, Oct 6, 2014 at 6:31 PM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
>> On 06/10/14 00:33, Christopher Li wrote:
>>> My gcc(4.8, FC20) does not support "-print-multiarch".
>>
>> Yep, same is true for cygwin.
> 
> I see, I thought your patch is expecting some thing from gcc.
> Then how to you test this code path?

Well, I slightly mis-spoke. Of the two cygwin installations I have,
one has a version of gcc which supports '-print-multiarch' and one
doesn't (i.e. it isn't really the version of cygwin, but gcc that
seems to matter). In any case, cygwin is not a "multiarch" system,
so on my 64-bit cygwin installation 'gcc -print-multiarch' prints
a blank line (ie an empty string) and exits with 0 status. On my
old 32-bit cygwin installation (if memory serves me correctly)
then gcc prints an error message and exits with non-zero status.

This patch is old enough that it was originally tested on my old
cygwin installation (this patch was developed on my old laptop), so
I haven't tested there for some time. However, before sending this
series I distinctly remember simulating this on 64-bit cygwin by
editing the Makefile and changing the '-print-multiarch' option
to '-print-junk', which _should_ have the same effect.

[ie the $(MULTIARCH_TRIPLET) make variable should be set to the
empty string on your FC20 system.]

> 
>>>
>>>> +       if (multiarch_dir && *multiarch_dir) {
>>>> +               add_pre_buffer("#add_system \"/usr/include/%s\"\n", multiarch_dir);
>>>> +               add_pre_buffer("#add_system \"/usr/local/include/%s\"\n", multiarch_dir);
>>>> +       }
>>>
>> Again, it works for me. :-D
> 
> So I guess multiarch_dir can be empty here. I just did not expect
> that.

Yes, indeed this _must_ be empty on non-multiarch systems.

[This was developed on Ubuntu, which is a multiarch system (and
I'm now on Linux Mint 17, which is also). Until now, I didn't
know that Fedora was not! :-D ]

> 
> Is it always prefix with "/usr/include/" and "/usr/local/include" for
> different distributions?

I can't quite remember how I came up with this list (it was a while
ago), but I think I had a look at the gcc source code. (Hmm, don't
quote me on that! ;-) ).

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 08/10] cgcc: use only the cc command to determine $gcc_base_dir ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 08/10] cgcc: use only the cc command to determine $gcc_base_dir
Date: Mon, 04 Aug 2014 18:39:55 +0000
Message-ID: <53DFD37B.4010104 () ramsay1 ! demon ! co ! uk>
--------------------

Capture the c-compiler command, in the $ccom variable, in order to
later invoke the compiler without extraneous command-line options.
In particular, use the $ccom variable in order to cleanly invoke the
compiler when setting the $gcc_base_dir variable.

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 cgcc | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/cgcc b/cgcc
index ed35e39..f330116 100755
--- a/cgcc
+++ b/cgcc
@@ -3,6 +3,7 @@
 
 my $cc = $ENV{'REAL_CC'} || 'cc';
 my $check = $ENV{'CHECK'} || 'sparse';
+my $ccom = $cc;
 
 my $m32 = 0;
 my $m64 = 0;
@@ -72,7 +73,7 @@ if ($do_check) {
 	$check .= &add_specs ('host_os_specs');
     }
 
-    $gcc_base_dir = qx($cc -print-file-name=) if !$gcc_base_dir;
+    $gcc_base_dir = qx($ccom -print-file-name=) if !$gcc_base_dir;
     chomp($gcc_base_dir);  # possibly remove '\n' from compiler
     $check .= " -gcc-base-dir " . $gcc_base_dir if $gcc_base_dir;
 
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 09/10] cgcc: use $ccom to set $multiarch_dir if not specified ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 09/10] cgcc: use $ccom to set $multiarch_dir if not specified
Date: Mon, 04 Aug 2014 18:40:32 +0000
Message-ID: <53DFD3A0.10106 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 cgcc | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/cgcc b/cgcc
index f330116..d7daa99 100755
--- a/cgcc
+++ b/cgcc
@@ -77,6 +77,8 @@ if ($do_check) {
     chomp($gcc_base_dir);  # possibly remove '\n' from compiler
     $check .= " -gcc-base-dir " . $gcc_base_dir if $gcc_base_dir;
 
+    $multiarch_dir = qx($ccom -print-multiarch) if ! defined $multiarch_dir;
+    chomp($multiarch_dir);  # possibly remove '\n' from compiler
     $check .= " -multiarch-dir " . $multiarch_dir if $multiarch_dir;
 
     print "$check\n" if $verbose;
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock ===

From: Fabian Frederick <fabf () skynet ! be>
To: linux-kernel
Subject: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Thu, 18 Sep 2014 18:46:16 +0000
Message-ID: <1411065976-20386-1-git-send-email-fabf () skynet ! be>
--------------------
fs/jffs2/summary.c:846:5: warning: context imbalance in 'jffs2_sum_write_sumnode' - unexpected unlock

Signed-off-by: Fabian Frederick <fabf@skynet.be>
---
 fs/jffs2/summary.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
index c522d09..a0bac7b 100644
--- a/fs/jffs2/summary.c
+++ b/fs/jffs2/summary.c
@@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock
 /* Write out summary information - called from jffs2_do_reserve_space */
 
 int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
+	__releases(&c->erase_completion_lock)
+	__acquires(&c->erase_completion_lock)
 {
 	int datasize, infosize, padsize;
 	struct jffs2_eraseblock *jeb;
-- 
1.9.1

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Brian Norris <computersforpeace () gmail ! com>
To: linux-kernel
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Mon, 22 Sep 2014 18:12:50 +0000
Message-ID: <20140922181250.GN1193 () ld-irv-0074>
--------------------
+ linux-sparse

On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> fs/jffs2/summary.c:846:5: warning: context imbalance in 'jffs2_sum_write_sumnode' - unexpected unlock
> 
> Signed-off-by: Fabian Frederick <fabf@skynet.be>
> ---
>  fs/jffs2/summary.c | 2 ++
>  1 file changed, 2 insertions(+)
> 
> diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> index c522d09..a0bac7b 100644
> --- a/fs/jffs2/summary.c
> +++ b/fs/jffs2/summary.c
> @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock
>  /* Write out summary information - called from jffs2_do_reserve_space */
>  
>  int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> +	__releases(&c->erase_completion_lock)
> +	__acquires(&c->erase_completion_lock)

I'm not too familiar with sparse notations, but Documentation/sparse.txt
suggests the above is wrong, and the following is more accurate:

	__must_hold(&c->erase_completion_lock)

But it looks like there are several other examples which do this.
Anyway, here's the relevant doc text, in case someone wants to clarify
it for me, or else tell me the documentation is wrong:

    __must_hold - The specified lock is held on function entry and exit.

    __acquires - The specified lock is held on function exit, but not entry.

    __releases - The specified lock is held on function entry, but not exit.

So __acquires and __releases look mutually exclusive, but it's not clear
if __must_hold will actually cover what we want. (I haven't tested it.)

>  {
>  	int datasize, infosize, padsize;
>  	struct jffs2_eraseblock *jeb;

Brian
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Brian Norris <computersforpeace () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Mon, 22 Sep 2014 18:12:50 +0000
Message-ID: <20140922181250.GN1193 () ld-irv-0074>
--------------------
+ linux-sparse

On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> fs/jffs2/summary.c:846:5: warning: context imbalance in 'jffs2_sum_write_sumnode' - unexpected unlock
> 
> Signed-off-by: Fabian Frederick <fabf@skynet.be>
> ---
>  fs/jffs2/summary.c | 2 ++
>  1 file changed, 2 insertions(+)
> 
> diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> index c522d09..a0bac7b 100644
> --- a/fs/jffs2/summary.c
> +++ b/fs/jffs2/summary.c
> @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock
>  /* Write out summary information - called from jffs2_do_reserve_space */
>  
>  int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> +	__releases(&c->erase_completion_lock)
> +	__acquires(&c->erase_completion_lock)

I'm not too familiar with sparse notations, but Documentation/sparse.txt
suggests the above is wrong, and the following is more accurate:

	__must_hold(&c->erase_completion_lock)

But it looks like there are several other examples which do this.
Anyway, here's the relevant doc text, in case someone wants to clarify
it for me, or else tell me the documentation is wrong:

    __must_hold - The specified lock is held on function entry and exit.

    __acquires - The specified lock is held on function exit, but not entry.

    __releases - The specified lock is held on function entry, but not exit.

So __acquires and __releases look mutually exclusive, but it's not clear
if __must_hold will actually cover what we want. (I haven't tested it.)

>  {
>  	int datasize, infosize, padsize;
>  	struct jffs2_eraseblock *jeb;

Brian
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: josh () joshtriplett ! org
To: linux-sparse
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Fri, 26 Sep 2014 23:17:27 +0000
Message-ID: <20140926231727.GD20917 () cloud>
--------------------
On Mon, Sep 22, 2014 at 11:12:50AM -0700, Brian Norris wrote:
> + linux-sparse
> 
> On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> > fs/jffs2/summary.c:846:5: warning: context imbalance in 'jffs2_sum_write_sumnode' - unexpected unlock
> > 
> > Signed-off-by: Fabian Frederick <fabf@skynet.be>
> > ---
> >  fs/jffs2/summary.c | 2 ++
> >  1 file changed, 2 insertions(+)
> > 
> > diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> > index c522d09..a0bac7b 100644
> > --- a/fs/jffs2/summary.c
> > +++ b/fs/jffs2/summary.c
> > @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info *c, struct jffs2_eraseblock
> >  /* Write out summary information - called from jffs2_do_reserve_space */
> >  
> >  int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> > +	__releases(&c->erase_completion_lock)
> > +	__acquires(&c->erase_completion_lock)
> 
> I'm not too familiar with sparse notations, but Documentation/sparse.txt
> suggests the above is wrong, and the following is more accurate:
> 
> 	__must_hold(&c->erase_completion_lock)
> 
> But it looks like there are several other examples which do this.
> Anyway, here's the relevant doc text, in case someone wants to clarify
> it for me, or else tell me the documentation is wrong:
> 
>     __must_hold - The specified lock is held on function entry and exit.
> 
>     __acquires - The specified lock is held on function exit, but not entry.
> 
>     __releases - The specified lock is held on function entry, but not exit.
> 
> So __acquires and __releases look mutually exclusive, but it's not clear
> if __must_hold will actually cover what we want. (I haven't tested it.)

__must_hold is indeed the correct annotation.  (There isn't currently
anything enforcing that, though.)

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Fabian Frederick <fabf () skynet ! be>
To: linux-sparse
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Sat, 27 Sep 2014 08:41:55 +0000
Message-ID: <1745266822.710655.1411807315752.open-xchange () webmail ! nmp ! skynet ! be>
--------------------


> On 27 September 2014 at 01:17 josh@joshtriplett.org wrote:
>
>
> On Mon, Sep 22, 2014 at 11:12:50AM -0700, Brian Norris wrote:
> > + linux-sparse
> >
> > On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> > > fs/jffs2/summary.c:846:5: warning: context imbalance in
> > > 'jffs2_sum_write_sumnode' - unexpected unlock
> > >
> > > Signed-off-by: Fabian Frederick <fabf@skynet.be>
> > > ---
> > > fs/jffs2/summary.c | 2 ++
> > > 1 file changed, 2 insertions(+)
> > >
> > > diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> > > index c522d09..a0bac7b 100644
> > > --- a/fs/jffs2/summary.c
> > > +++ b/fs/jffs2/summary.c
> > > @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info
> > > *c, struct jffs2_eraseblock
> > > /* Write out summary information - called from jffs2_do_reserve_space */
> > >
> > > int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> > > + __releases(&c->erase_completion_lock)
> > > + __acquires(&c->erase_completion_lock)
> >
> > I'm not too familiar with sparse notations, but Documentation/sparse.txt
> > suggests the above is wrong, and the following is more accurate:
> >
> >  __must_hold(&c->erase_completion_lock)
> >
> > But it looks like there are several other examples which do this.
> > Anyway, here's the relevant doc text, in case someone wants to clarify
> > it for me, or else tell me the documentation is wrong:
> >
> >  __must_hold - The specified lock is held on function entry and exit.
> >
> >  __acquires - The specified lock is held on function exit, but not entry.
> >
> >  __releases - The specified lock is held on function entry, but not exit.
> >
> > So __acquires and __releases look mutually exclusive, but it's not clear
> > if __must_hold will actually cover what we want. (I haven't tested it.)
>
> __must_hold is indeed the correct annotation. (There isn't currently
> anything enforcing that, though.)
>
> - Josh Triplett

There are 137 __releases && __acquires annotated functions in stable.

AFAICS those are based on lock held on function entry / lock held on exit

See
fs/fuse/file.c:1527
fs/kernfs/dir.c:341
drivers/block/nbd.c:564

Does it mean that all of these should be updated to __must_hold ?

Fabian
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Fabian Frederick <fabf () skynet ! be>
To: linux-kernel
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Sat, 27 Sep 2014 08:41:55 +0000
Message-ID: <1745266822.710655.1411807315752.open-xchange () webmail ! nmp ! skynet ! be>
--------------------


> On 27 September 2014 at 01:17 josh@joshtriplett.org wrote:
>
>
> On Mon, Sep 22, 2014 at 11:12:50AM -0700, Brian Norris wrote:
> > + linux-sparse
> >
> > On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> > > fs/jffs2/summary.c:846:5: warning: context imbalance in
> > > 'jffs2_sum_write_sumnode' - unexpected unlock
> > >
> > > Signed-off-by: Fabian Frederick <fabf@skynet.be>
> > > ---
> > > fs/jffs2/summary.c | 2 ++
> > > 1 file changed, 2 insertions(+)
> > >
> > > diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> > > index c522d09..a0bac7b 100644
> > > --- a/fs/jffs2/summary.c
> > > +++ b/fs/jffs2/summary.c
> > > @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info
> > > *c, struct jffs2_eraseblock
> > > /* Write out summary information - called from jffs2_do_reserve_space */
> > >
> > > int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> > > + __releases(&c->erase_completion_lock)
> > > + __acquires(&c->erase_completion_lock)
> >
> > I'm not too familiar with sparse notations, but Documentation/sparse.txt
> > suggests the above is wrong, and the following is more accurate:
> >
> >  __must_hold(&c->erase_completion_lock)
> >
> > But it looks like there are several other examples which do this.
> > Anyway, here's the relevant doc text, in case someone wants to clarify
> > it for me, or else tell me the documentation is wrong:
> >
> >  __must_hold - The specified lock is held on function entry and exit.
> >
> >  __acquires - The specified lock is held on function exit, but not entry.
> >
> >  __releases - The specified lock is held on function entry, but not exit.
> >
> > So __acquires and __releases look mutually exclusive, but it's not clear
> > if __must_hold will actually cover what we want. (I haven't tested it.)
>
> __must_hold is indeed the correct annotation. (There isn't currently
> anything enforcing that, though.)
>
> - Josh Triplett

There are 137 __releases && __acquires annotated functions in stable.

AFAICS those are based on lock held on function entry / lock held on exit

See
fs/fuse/file.c:1527
fs/kernfs/dir.c:341
drivers/block/nbd.c:564

Does it mean that all of these should be updated to __must_hold ?

Fabian
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Sun, 28 Sep 2014 09:56:50 +0000
Message-ID: <20140928095650.GA24178 () thin>
--------------------
On Sat, Sep 27, 2014 at 10:41:55AM +0200, Fabian Frederick wrote:
> 
> 
> > On 27 September 2014 at 01:17 josh@joshtriplett.org wrote:
> >
> >
> > On Mon, Sep 22, 2014 at 11:12:50AM -0700, Brian Norris wrote:
> > > + linux-sparse
> > >
> > > On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> > > > fs/jffs2/summary.c:846:5: warning: context imbalance in
> > > > 'jffs2_sum_write_sumnode' - unexpected unlock
> > > >
> > > > Signed-off-by: Fabian Frederick <fabf@skynet.be>
> > > > ---
> > > > fs/jffs2/summary.c | 2 ++
> > > > 1 file changed, 2 insertions(+)
> > > >
> > > > diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> > > > index c522d09..a0bac7b 100644
> > > > --- a/fs/jffs2/summary.c
> > > > +++ b/fs/jffs2/summary.c
> > > > @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info
> > > > *c, struct jffs2_eraseblock
> > > > /* Write out summary information - called from jffs2_do_reserve_space */
> > > >
> > > > int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> > > > + __releases(&c->erase_completion_lock)
> > > > + __acquires(&c->erase_completion_lock)
> > >
> > > I'm not too familiar with sparse notations, but Documentation/sparse.txt
> > > suggests the above is wrong, and the following is more accurate:
> > >
> > >  __must_hold(&c->erase_completion_lock)
> > >
> > > But it looks like there are several other examples which do this.
> > > Anyway, here's the relevant doc text, in case someone wants to clarify
> > > it for me, or else tell me the documentation is wrong:
> > >
> > >  __must_hold - The specified lock is held on function entry and exit.
> > >
> > >  __acquires - The specified lock is held on function exit, but not entry.
> > >
> > >  __releases - The specified lock is held on function entry, but not exit.
> > >
> > > So __acquires and __releases look mutually exclusive, but it's not clear
> > > if __must_hold will actually cover what we want. (I haven't tested it.)
> >
> > __must_hold is indeed the correct annotation. (There isn't currently
> > anything enforcing that, though.)
> >
> > - Josh Triplett
> 
> There are 137 __releases && __acquires annotated functions in stable.
> 
> AFAICS those are based on lock held on function entry / lock held on exit
> 
> See
> fs/fuse/file.c:1527
> fs/kernfs/dir.c:341
> drivers/block/nbd.c:564
> 
> Does it mean that all of these should be updated to __must_hold ?

Not really worth changing yet until something actually pays closer
attention to those annotations.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH 1/1] jffs2: fix sparse warning: unexpected unlock
Date: Sun, 28 Sep 2014 09:56:50 +0000
Message-ID: <20140928095650.GA24178 () thin>
--------------------
On Sat, Sep 27, 2014 at 10:41:55AM +0200, Fabian Frederick wrote:
> 
> 
> > On 27 September 2014 at 01:17 josh@joshtriplett.org wrote:
> >
> >
> > On Mon, Sep 22, 2014 at 11:12:50AM -0700, Brian Norris wrote:
> > > + linux-sparse
> > >
> > > On Thu, Sep 18, 2014 at 08:46:16PM +0200, Fabian Frederick wrote:
> > > > fs/jffs2/summary.c:846:5: warning: context imbalance in
> > > > 'jffs2_sum_write_sumnode' - unexpected unlock
> > > >
> > > > Signed-off-by: Fabian Frederick <fabf@skynet.be>
> > > > ---
> > > > fs/jffs2/summary.c | 2 ++
> > > > 1 file changed, 2 insertions(+)
> > > >
> > > > diff --git a/fs/jffs2/summary.c b/fs/jffs2/summary.c
> > > > index c522d09..a0bac7b 100644
> > > > --- a/fs/jffs2/summary.c
> > > > +++ b/fs/jffs2/summary.c
> > > > @@ -844,6 +844,8 @@ static int jffs2_sum_write_data(struct jffs2_sb_info
> > > > *c, struct jffs2_eraseblock
> > > > /* Write out summary information - called from jffs2_do_reserve_space */
> > > >
> > > > int jffs2_sum_write_sumnode(struct jffs2_sb_info *c)
> > > > + __releases(&c->erase_completion_lock)
> > > > + __acquires(&c->erase_completion_lock)
> > >
> > > I'm not too familiar with sparse notations, but Documentation/sparse.txt
> > > suggests the above is wrong, and the following is more accurate:
> > >
> > >  __must_hold(&c->erase_completion_lock)
> > >
> > > But it looks like there are several other examples which do this.
> > > Anyway, here's the relevant doc text, in case someone wants to clarify
> > > it for me, or else tell me the documentation is wrong:
> > >
> > >  __must_hold - The specified lock is held on function entry and exit.
> > >
> > >  __acquires - The specified lock is held on function exit, but not entry.
> > >
> > >  __releases - The specified lock is held on function entry, but not exit.
> > >
> > > So __acquires and __releases look mutually exclusive, but it's not clear
> > > if __must_hold will actually cover what we want. (I haven't tested it.)
> >
> > __must_hold is indeed the correct annotation. (There isn't currently
> > anything enforcing that, though.)
> >
> > - Josh Triplett
> 
> There are 137 __releases && __acquires annotated functions in stable.
> 
> AFAICS those are based on lock held on function entry / lock held on exit
> 
> See
> fs/fuse/file.c:1527
> fs/kernfs/dir.c:341
> drivers/block/nbd.c:564
> 
> Does it mean that all of these should be updated to __must_hold ?

Not really worth changing yet until something actually pays closer
attention to those annotations.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH 1/1] signal: use BUILD_BUG() instead of _NSIG_WORDS_is_unsupported_size() ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 1/1] signal: use BUILD_BUG() instead of _NSIG_WORDS_is_unsupported_size()
Date: Mon, 22 Sep 2014 17:26:05 +0000
Message-ID: <20140922172605.GF25352 () thin>
--------------------
On Sun, Sep 21, 2014 at 06:43:06PM +0200, Oleg Nesterov wrote:
> Kill _NSIG_WORDS_is_unsupported_size(), use BUILD_BUG() instead.
> This simplifies the code, avoids the nested-externs warnings, and
> this way we do not defer the problem to linker.
> 
> Also, fix the indentation in _SIG_SET_BINOP() and _SIG_SET_OP().
> 
> Note: this patch assumes that the code like "if (0) BUILD_BUG();"
> is valid. If not (say __compiletime_error() is not defined and thus
> __compiletime_error_fallback() uses a negative array) we should fix
> BUILD_BUG() and/or BUILD_BUG_ON_MSG(). This code should be fine by
> definition, this is the documented purpose of BUILD_BUG().
> 
> Reported-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
> Signed-off-by: Oleg Nesterov <oleg@redhat.com>

Thanks for posting this.

Reviewed-by: Josh Triplett <josh@joshtriplett.org>

>  include/linux/signal.h |   28 ++++++++++++----------------
>  1 files changed, 12 insertions(+), 16 deletions(-)
> 
> diff --git a/include/linux/signal.h b/include/linux/signal.h
> index 750196f..14acfd5 100644
> --- a/include/linux/signal.h
> +++ b/include/linux/signal.h
> @@ -67,7 +67,6 @@ static inline int sigismember(sigset_t *set, int _sig)
>  
>  static inline int sigisemptyset(sigset_t *set)
>  {
> -	extern void _NSIG_WORDS_is_unsupported_size(void);
>  	switch (_NSIG_WORDS) {
>  	case 4:
>  		return (set->sig[3] | set->sig[2] |
> @@ -77,7 +76,7 @@ static inline int sigisemptyset(sigset_t *set)
>  	case 1:
>  		return set->sig[0] == 0;
>  	default:
> -		_NSIG_WORDS_is_unsupported_size();
> +		BUILD_BUG();
>  		return 0;
>  	}
>  }
> @@ -90,24 +89,23 @@ static inline int sigisemptyset(sigset_t *set)
>  #define _SIG_SET_BINOP(name, op)					\
>  static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
>  {									\
> -	extern void _NSIG_WORDS_is_unsupported_size(void);		\
>  	unsigned long a0, a1, a2, a3, b0, b1, b2, b3;			\
>  									\
>  	switch (_NSIG_WORDS) {						\
> -	    case 4:							\
> +	case 4:								\
>  		a3 = a->sig[3]; a2 = a->sig[2];				\
>  		b3 = b->sig[3]; b2 = b->sig[2];				\
>  		r->sig[3] = op(a3, b3);					\
>  		r->sig[2] = op(a2, b2);					\
> -	    case 2:							\
> +	case 2:								\
>  		a1 = a->sig[1]; b1 = b->sig[1];				\
>  		r->sig[1] = op(a1, b1);					\
> -	    case 1:							\
> +	case 1:								\
>  		a0 = a->sig[0]; b0 = b->sig[0];				\
>  		r->sig[0] = op(a0, b0);					\
>  		break;							\
> -	    default:							\
> -		_NSIG_WORDS_is_unsupported_size();			\
> +	default:							\
> +		BUILD_BUG();						\
>  	}								\
>  }
>  
> @@ -128,16 +126,14 @@ _SIG_SET_BINOP(sigandnsets, _sig_andn)
>  #define _SIG_SET_OP(name, op)						\
>  static inline void name(sigset_t *set)					\
>  {									\
> -	extern void _NSIG_WORDS_is_unsupported_size(void);		\
> -									\
>  	switch (_NSIG_WORDS) {						\
> -	    case 4: set->sig[3] = op(set->sig[3]);			\
> -		    set->sig[2] = op(set->sig[2]);			\
> -	    case 2: set->sig[1] = op(set->sig[1]);			\
> -	    case 1: set->sig[0] = op(set->sig[0]);			\
> +	case 4:	set->sig[3] = op(set->sig[3]);				\
> +		set->sig[2] = op(set->sig[2]);				\
> +	case 2:	set->sig[1] = op(set->sig[1]);				\
> +	case 1:	set->sig[0] = op(set->sig[0]);				\
>  		    break;						\
> -	    default:							\
> -		_NSIG_WORDS_is_unsupported_size();			\
> +	default:							\
> +		BUILD_BUG();						\
>  	}								\
>  }
>  
> -- 
> 1.5.5.1
> 
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/3] sparse: Just use simple ints for decision variables ===

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: [PATCH 1/3] sparse: Just use simple ints for decision variables
Date: Mon, 09 Jun 2014 11:58:00 +0000
Message-ID: <1402315082-14102-2-git-send-email-phil () dovecot ! fi>
--------------------
The expressions are just ints, and const is pointess.

Signed-off-by: Phil Carmody <phil@dovecot.fi>
---
 evaluate.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..9052962 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -917,10 +917,10 @@ static struct symbol *evaluate_binop(struct expression *expr)
 			rtype = integer_promotion(rtype);
 		} else {
 			// The rest do usual conversions
-			const unsigned left_not  = expr->left->type == EXPR_PREOP
-			                           && expr->left->op == '!';
-			const unsigned right_not = expr->right->type == EXPR_PREOP
-			                           && expr->right->op == '!';
+			int left_not  = expr->left->type == EXPR_PREOP
+					&& expr->left->op == '!';
+			int right_not = expr->right->type == EXPR_PREOP
+			                && expr->right->op == '!';
 			if ((op == '&' || op == '|') && (left_not || right_not))
 				warning(expr->pos, "dubious: %sx %c %sy",
 				        left_not ? "!" : "",
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 1/3] sparse: Just use simple ints for decision variables
Date: Mon, 09 Jun 2014 13:27:59 +0000
Message-ID: <20140609132759.GA11986 () thin>
--------------------
On Mon, Jun 09, 2014 at 02:58:00PM +0300, Phil Carmody wrote:
> The expressions are just ints, and const is pointess.

"bool" actually seems more appropriate here.  As for the const, it
does in fact hold true, as neither changes afte rdeclaration; why not
keep it?

> Signed-off-by: Phil Carmody <phil@dovecot.fi>
> ---
>  evaluate.c | 8 ++++----
>  1 file changed, 4 insertions(+), 4 deletions(-)
> 
> diff --git a/evaluate.c b/evaluate.c
> index 6655615..9052962 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -917,10 +917,10 @@ static struct symbol *evaluate_binop(struct expression *expr)
>  			rtype = integer_promotion(rtype);
>  		} else {
>  			// The rest do usual conversions
> -			const unsigned left_not  = expr->left->type == EXPR_PREOP
> -			                           && expr->left->op == '!';
> -			const unsigned right_not = expr->right->type == EXPR_PREOP
> -			                           && expr->right->op == '!';
> +			int left_not  = expr->left->type == EXPR_PREOP
> +					&& expr->left->op == '!';
> +			int right_not = expr->right->type == EXPR_PREOP
> +			                && expr->right->op == '!';
>  			if ((op == '&' || op == '|') && (left_not || right_not))
>  				warning(expr->pos, "dubious: %sx %c %sy",
>  				        left_not ? "!" : "",
> -- 
> 2.0.0
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/4] test-suite: remove bashism to avoid test failures ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 1/4] test-suite: remove bashism to avoid test failures
Date: Sat, 11 Oct 2014 19:56:16 +0000
Message-ID: <54398B60.9080009 () ramsay1 ! demon ! co ! uk>
--------------------

The use of the '==' operator in a test/[ conditional is a non-POSIX
bash extension. In order to avoid test failures on systems that do
not have bash as the system shell (/bin/sh), replace the use of the
'==' operator with the POSIX compatible '=' operator.

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

Sorry for not spotting this earlier; I just looked at your patch in
my email client and thought 'yep, that looks good', without actually
testing the change. :(

Since Linux Mint is a Ubuntu derivative my /bin/sh is actually dash.
(I hear Fedora are looking to change /bin/sh to dash as well. :-D ).

ATB,
Ramsay Jones

 validation/test-suite | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/validation/test-suite b/validation/test-suite
index 7f0f83e..df5a7c6 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -114,7 +114,7 @@ do_test()
 	set -- $cmd
 	base_cmd=`basename $1`
 	for i in $disabled_cmds; do
-		if [ "$i" == "$base_cmd" ] ; then
+		if [ "$i" = "$base_cmd" ] ; then
 			disabled_tests=`expr $disabled_tests + 1`
 			echo "     DISABLE $test_name ($file)"
 			return 3
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/5] Add __designated_init, wrapping __attribute__((designated_init)) ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH 1/5] Add __designated_init, wrapping __attribute__((designated_init))
Date: Thu, 31 Jul 2014 23:47:23 +0000
Message-ID: <3130b0553b15518e3bef6d14c80280beed0f5ff9.1406850006.git.josh () joshtriplett ! org>
--------------------
GCC 4.10 and newer, and Sparse, supports
__attribute__((designated_init)), which marks a structure as requiring
a designated initializer rather than a positional one.  This helps
reduce churn and errors when used with _ops structures and similar
structures designed for future extension.

Add a wrapper __designated_init, which turns into
__attribute__((designated_init)) for Sparse or sufficiently new GCC.
Enable the corresponding warning as an error.

The following semantic patch can help mark structures containing
function pointers as requiring designated initializers:

@@
identifier I, f;
type T;
@@

struct I {
	...
	T (*f)(...);
	...
}
+ __designated_init
;

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 Makefile                      | 3 +++
 include/linux/compiler-gcc4.h | 4 ++++
 include/linux/compiler.h      | 5 +++++
 3 files changed, 12 insertions(+)

diff --git a/Makefile b/Makefile
index f6a7794..83773c2 100644
--- a/Makefile
+++ b/Makefile
@@ -744,6 +744,9 @@ KBUILD_CFLAGS   += $(call cc-option,-Werror=strict-prototypes)
 # Prohibit date/time macros, which would make the build non-deterministic
 KBUILD_CFLAGS   += $(call cc-option,-Werror=date-time)
 
+# Disallow positional initialization of designated structs
+KBUILD_CFLAGS += $(call cc-option,-Werror=designated-init)
+
 # use the deterministic mode of AR if available
 KBUILD_ARFLAGS := $(call ar-option,D)
 
diff --git a/include/linux/compiler-gcc4.h b/include/linux/compiler-gcc4.h
index 2507fd2..5cd3c26 100644
--- a/include/linux/compiler-gcc4.h
+++ b/include/linux/compiler-gcc4.h
@@ -85,4 +85,8 @@
 #if GCC_VERSION >= 40800 || (defined(__powerpc__) && GCC_VERSION >= 40600)
 #define __HAVE_BUILTIN_BSWAP16__
 #endif
+
+#if GCC_VERSION >= 41000 || defined(__CHECKER__)
+#define __designated_init __attribute__((designated_init))
+#endif
 #endif /* CONFIG_ARCH_USE_BUILTIN_BSWAP */
diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index d5ad7b1..c2334b2 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -266,6 +266,11 @@ void ftrace_likely_update(struct ftrace_branch_data *f, int val, int expect);
 #define __always_inline inline
 #endif
 
+/* Marks a struct as requiring designated initializers, never positional. */
+#ifndef __designated_init
+#define __designated_init
+#endif
+
 #endif /* __KERNEL__ */
 
 /*
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: josh () joshtriplett ! org
To: linux-sparse
Subject: Re: [PATCH 1/5] Add __designated_init, wrapping __attribute__((designated_init))
Date: Fri, 01 Aug 2014 21:36:17 +0000
Message-ID: <20140801213617.GB20310 () cloud>
--------------------
On Fri, Aug 01, 2014 at 01:45:29PM -0700, Andrew Morton wrote:
> On Thu, 31 Jul 2014 16:47:23 -0700 Josh Triplett <josh@joshtriplett.org> wrote:
> 
> > GCC 4.10 and newer, and Sparse, supports
> > __attribute__((designated_init)), which marks a structure as requiring
> > a designated initializer rather than a positional one.  This helps
> > reduce churn and errors when used with _ops structures and similar
> > structures designed for future extension.
> > 
> > Add a wrapper __designated_init, which turns into
> > __attribute__((designated_init)) for Sparse or sufficiently new GCC.
> > Enable the corresponding warning as an error.
> > 
> > The following semantic patch can help mark structures containing
> > function pointers as requiring designated initializers:
> > 
> > @@
> > identifier I, f;
> > type T;
> > @@
> > 
> > struct I {
> > 	...
> > 	T (*f)(...);
> > 	...
> > }
> > + __designated_init
> 
> hm, dunno about this.
> 
> I think that the kernel should always use designated initializers
> everywhere.  Perhaps there are a few special cases where positional
> initializers provide a superior result but I'm not sure where those
> might be.
> 
> In which case what we should do is to teach sparse to warn about
> positional initializers then go fix them all up (lol).  After that
> process is complete, this __designated_init tag would be just noise.
> 
> To support this perhaps a sparse tag would be needed which says
> "positional initializers are OK here".  This way we're adding the
> annotation to the exceptional cases, not to the common cases.

Before submitting this series, I actually used coccinelle to
automatically add __designated_init to nearly a thousand structures
(just in include/linux/ alone), and did a build with that.  Even just
adding it to structures with function pointers, some cases produce a
*huge* number of warnings.  I think it might make sense to work our way
through those warnings, but "go fix them all up" would be a gargantuan
effort.  (For an idea of scale: there were more warnings about
positional initialization than everything other warning combined, by a
substantial factor, and that's just from changing a few hundred
structures.)

I'm not at all convinced that we want to universally enforce designated
initializers *yet*.  They make sense for _ops structures and other
structures that contain function pointers (which is a small subset), but
for many other structures they just add a large amount of noise to
initialization.  If we could say "automatically add __designated_init to
structures matching these criteria", that could work, but "all
structures" not so much.  (For instance, a structure with a single
field, or two fields of incompatible types with an intuitive ordering,
doesn't gain much value from designated initialization.)

Now, some cases may make sense to fix despite the large volume.  For
instance, many users of dmi_system_id initialize it positionally, and
shouldn't; I've already written patches for quite a few of them, with
many more to go.  But, for instance, obs_kernel_param seems much less
worthwhile to fix, because we shouldn't add any new instances of it, and
we likely won't ever extend it.  The value in fixing this issue mostly
comes not with the current code, but with future changes to the
structure.  (And, as always happens with this kind of change, we'll end
up with a few holdouts who don't want to change their code, which will
stop us from eliminating the warning completely.)

In the course of introducing this change, we'll end up fixing a large
number of positional init warnings.  If in the course of doing so, it
starts making sense to enforce it everywhere, it seems easy enough to
sed away all the __designated_init tags.  But in terms of noise, the
actual additions of __designated_init will pale in comparison to the
patches fixing positional initializers.

Finally, by migrating over to this incrementally, structure by
structure, we can safely make the warning an error, which we could not
do if we applied it to every struct immediately.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/5] kbuild: LLVMLinux: Add Kbuild support for building kernel with Clang ===

From: behanw () converseincode ! com
To: linux-sparse
Subject: [PATCH 1/5] kbuild: LLVMLinux: Add Kbuild support for building kernel with Clang
Date: Wed, 26 Feb 2014 01:08:39 +0000
Message-ID: <1393376923-21892-2-git-send-email-behanw () converseincode ! com>
--------------------
From: Behan Webster <behanw@converseincode.com>

Add support to toplevel Makefile for compiling with clang, both for
HOSTCC and CC. Use cc-option to prevent gcc option from breaking clang, and
from clang options from breaking gcc.

Clang 3.4 semantics are the same as gcc semantics for unsupported flags. For
unsupported warnings clang 3.4 returns true but shows a warning and gcc shows
a warning and returns false.

Signed-off-by: Behan Webster <behanw@converseincode.com>
Signed-off-by: Jan-Simon Mller <dl9pf@gmx.de>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
Cc: PaX Team <pageexec@freemail.hu>
---
 Makefile | 32 +++++++++++++++++++++++++++++++-
 1 file changed, 31 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index 831b36a..c4ab30d 100644
--- a/Makefile
+++ b/Makefile
@@ -247,6 +247,15 @@ HOSTCXX      = g++
 HOSTCFLAGS   = -Wall -Wmissing-prototypes -Wstrict-prototypes -O2 -fomit-frame-pointer
 HOSTCXXFLAGS = -O2
 
+ifeq ($(shell $(HOSTCC) -v 2>&1 | grep -c "clang version"), 1)
+HOSTCOMPILER := clang
+HOSTCFLAGS  += -Wno-unused-value -Wno-unused-parameter \
+		-Wno-missing-field-initializers -fno-delete-null-pointer-checks
+else
+HOSTCOMPILER := gcc
+endif
+export HOSTCOMPILER
+
 # Decide whether to build built-in, modular, or both.
 # Normally, just do built-in.
 
@@ -323,6 +332,12 @@ endif
 
 export quiet Q KBUILD_VERBOSE
 
+ifeq ($(shell $(CC) -v 2>&1 | grep -c "clang version"), 1)
+COMPILER := clang
+else
+COMPILER := gcc
+endif
+export COMPILER
 
 # Look for make include files relative to root of kernel src
 MAKEFLAGS += --include-dir=$(srctree)
@@ -382,7 +397,7 @@ KBUILD_CFLAGS   := -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs \
 		   -fno-strict-aliasing -fno-common \
 		   -Werror-implicit-function-declaration \
 		   -Wno-format-security \
-		   -fno-delete-null-pointer-checks
+		   $(call cc-option,-fno-delete-null-pointer-checks,)
 KBUILD_AFLAGS_KERNEL :=
 KBUILD_CFLAGS_KERNEL :=
 KBUILD_AFLAGS   := -D__ASSEMBLY__
@@ -620,9 +635,24 @@ else
 endif
 KBUILD_CFLAGS += $(stackp-flag)
 
+ifeq ($(COMPILER),clang)
+KBUILD_CPPFLAGS += $(call cc-option,-Qunused-arguments,)
+KBUILD_CPPFLAGS += $(call cc-option,-Wno-unknown-warning-option,)
+KBUILD_CFLAGS += $(call cc-disable-warning, unused-variable)
+KBUILD_CFLAGS += $(call cc-disable-warning, format-invalid-specifier)
+KBUILD_CFLAGS += $(call cc-disable-warning, gnu)
+# Quiet clang warning: comparison of unsigned expression < 0 is always false
+KBUILD_CFLAGS += $(call cc-disable-warning, tautological-compare)
+# CLANG uses a _MergedGlobals as optimization, but this breaks modpost, as the
+# source of a reference will be _MergedGlobals and not on of the whitelisted names.
+# See modpost pattern 2
+KBUILD_CFLAGS += $(call cc-option, -mno-global-merge,)
+else
+
 # This warning generated too much noise in a regular build.
 # Use make W=1 to enable this warning (see scripts/Makefile.build)
 KBUILD_CFLAGS += $(call cc-disable-warning, unused-but-set-variable)
+endif
 
 ifdef CONFIG_FRAME_POINTER
 KBUILD_CFLAGS	+= -fno-omit-frame-pointer -fno-optimize-sibling-calls
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 1/7] compiler: Add diagnostic control macros ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: [PATCH 1/7] compiler: Add diagnostic control macros
Date: Fri, 19 Sep 2014 15:29:34 +0000
Message-ID: <1411140580-20909-2-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Add macros to control diagnostic messages where needed. These
are used to silence warning messages that are expected, normal
and do not indicate any sort of problem. Reducing the stream
of messages in this way helps possible problems to stand out.

The macros provided are:
	DIAG_PUSH() - to save diagnostic settings
	DIAG_POP() - to restore diagnostic settings
	DIAG_IGNORE(option) - to ignore a particular warning
	DIAG_GCC_IGNORE(option) - DIAG_IGNORE for gcc only
	DIAG_CLANG_IGNORE(option) - DIAG_IGNORE for clang only

CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/compiler-clang.h | 26 ++++++++++++++++++++++++++
 include/linux/compiler-gcc4.h  | 31 +++++++++++++++++++++++++++++++
 include/linux/compiler.h       | 20 ++++++++++++++++++++
 3 files changed, 77 insertions(+)

diff --git a/include/linux/compiler-clang.h b/include/linux/compiler-clang.h
index d1e49d5..039b112 100644
--- a/include/linux/compiler-clang.h
+++ b/include/linux/compiler-clang.h
@@ -10,3 +10,29 @@
 #undef uninitialized_var
 #define uninitialized_var(x) x = *(&(x))
 #endif
+
+/*
+ * Provide macros to manipulate diagnostic messages when possible.
+ * DIAG_PUSH pushes the diagnostic settings
+ * DIAG_POP pops the diagnostic settings
+ * DIAG_IGNORE(x) changes the given diagnostic setting to ignore
+ *
+ * Example:
+ *	DIAG_PUSH DIAG_IGNORE(aggregate-return)
+ *	struct timespec ns_to_timespec(const s64 nsec)
+ *	{
+ *		...
+ *	}
+ *	DIAG_POP
+ *
+ * Will prevent the warning on compilation of the function. Other
+ * steps are necessary to do the same thing for the call sites.
+ */
+#define DIAG_STR(x) #x
+#define DIAG_CAT(x, y) DIAG_STR(x##y)
+#define DIAG_DO_PRAGMA(x) _Pragma(#x)
+#define DIAG_PRAGMA(x) DIAG_DO_PRAGMA(clang diagnostic x)
+#define DIAG_IGNORE(x) DIAG_PRAGMA(ignored DIAG_CAT(-W, x))
+#define DIAG_PUSH DIAG_PRAGMA(push)
+#define DIAG_POP DIAG_PRAGMA(pop)
+#define DIAG_CLANG_IGNORE(x) DIAG_IGNORE(x)
diff --git a/include/linux/compiler-gcc4.h b/include/linux/compiler-gcc4.h
index 2507fd2..78387f6 100644
--- a/include/linux/compiler-gcc4.h
+++ b/include/linux/compiler-gcc4.h
@@ -86,3 +86,34 @@
 #define __HAVE_BUILTIN_BSWAP16__
 #endif
 #endif /* CONFIG_ARCH_USE_BUILTIN_BSWAP */
+
+/*
+ * Provide macros to manipulate diagnostic messages when possible.
+ * DIAG_PUSH pushes the diagnostic settings
+ * DIAG_POP pops the diagnostic settings
+ * DIAG_IGNORE(x) changes the given diagnostic setting to ignore
+ *
+ * Example:
+ *	DIAG_PUSH DIAG_IGNORE(aggregate-return)
+ *	struct timespec ns_to_timespec(const s64 nsec)
+ *	{
+ *		...
+ *	}
+ *	DIAG_POP
+ *
+ * Will prevent the warning on compilation of the function. Other
+ * steps are necessary to do the same thing for the call sites.
+ */
+#if GCC_VERSION >= 40600
+#define DIAG_STR(x) #x
+#define DIAG_CAT(x, y) DIAG_STR(x##y)
+#define DIAG_DO_PRAGMA(x) _Pragma(#x)
+#define DIAG_PRAGMA(x) DIAG_DO_PRAGMA(GCC diagnostic x)
+#define DIAG_IGNORE(x) DIAG_PRAGMA(ignored DIAG_CAT(-W, x))
+/* GCC 4.8 - 4.8.2 has issues with pop, so do not define push or pop */
+#if GCC_VERSION < 40800 || GCC_VERSION >= 40803
+#define DIAG_PUSH DIAG_PRAGMA(push)
+#define DIAG_POP DIAG_PRAGMA(pop)
+#endif /* GCC_VERSION < 40800 || GCC_VERSION >= 40803 */
+#define DIAG_GCC_IGNORE(x) DIAG_IGNORE(x)
+#endif /* GCC_VERSION >= 40600 */
diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index d5ad7b1..fde7b21 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -94,6 +94,26 @@ struct ftrace_branch_data {
 };
 
 /*
+ * Provide null definitions for diagnostic manipulation macros not provided
+ * for a particular compiler.
+ */
+#ifndef DIAG_PUSH
+#define DIAG_PUSH
+#endif
+#ifndef DIAG_POP
+#define DIAG_POP
+#endif
+#ifndef DIAG_IGNORE
+#define DIAG_IGNORE(x)
+#endif
+#ifndef DIAG_CLANG_IGNORE
+#define DIAG_CLANG_IGNORE(x)
+#endif
+#ifndef DIAG_GCC_IGNORE
+#define DIAG_GCC_IGNORE(x)
+#endif
+
+/*
  * Note: DISABLE_BRANCH_PROFILING can be used by special lowlevel code
  * to disable branch tracing on a per file basis.
  */
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/2] Use any previous initializer to size a symbol ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/2] Use any previous initializer to size a symbol
Date: Fri, 18 Apr 2014 06:29:39 +0000
Message-ID: <CANeU7QnpBiJWb8Qx0r1Y=7kjvQwFkuwWuM0dkBdK9=XrbDSh1w () mail ! gmail ! com>
--------------------
On Sun, Mar 30, 2014 at 1:21 PM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> Ok, I think that is just us being too anal. We should allow multiple
> definitions for functions that are identical otherwise, but differ in
> the "inline".
>
> So I think that MOD_INLINE check in check_declaration() is wrong, and
> makes us consider the definitions to be for different symbols. Yes,
> that ignores the warning, but they really *aren't* different symbols.

I take a closer look to this MOD_INLINE check. That check is wrong
and should be removed.

However, still don't have a good way to fix duplicate extern inline check yet.
Here is what goes wrong when I remove the check

./sparse validation/extern-inline.c validation/extern-inline.c
validation/extern-inline.c:12:1: warning: multiple definitions for function 'g'
validation/extern-inline.c:12:1:  the previous one is here

The offending source code are:
extern int g(int);

extern __inline__ int
g(int x)
{
        return x;
}

Notice that the first extern int g(int) does not have inline? It get the
global scope. The second g has inline, it get the local scope.

However, the first global version of g() gets the declaration from
parse_function_body()

        while (prev) {
            prev->definition = decl;
            prev = prev->same_symbol;
        }

The extern-inline version of g() actually get removed when the file scope
ends. The extern version stays and it has the definition from the
extern-inline version. (BTW, there is a minor bug there the user of
the first global symbol will know nothing about inline, they are using
the global version on the extern inline version. I can give a test case
if needed)

So when we compile the extern-inline as the second file, sparse complain
that there are two g() has definition, the conflicting one is the first global
version of g(), the function body borrow from the inline version.

> So the correct thing to do is (I think) to remove that check, and then
> make the parse_function_body() warning go away by accepting the fact
> that we can have both an inline version and an out-of-line version of
> the same function.

Unfortunately, disable the warning is not the right fix. Because it will
allow extern-inline fuction to have two function body in the same file.
e.g.

extern __inline__ int g(int x) { return x; }
extern __inline__ int g(int x) { return x + 1; }

If we just silence the warning, sparse will not able to warn about this.

So it come back to the question:
When the file scope ends, why does the global symbol
still stays? end_file_scope() only removes the local file symbol,
not the global symbol define by the previous file.

When sparse compile the second file, it can still see the global
symbol left by the previous file. If the global symbol was removed,
this duplicate definition warning should go way as well.

Suggestion?

I am tempting to just revert the MOD_INLINE check and fix the
extern inline breakage in a different patch.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/3] sparse: detect non-sign-extended masks created by '~' ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 2/3] sparse: detect non-sign-extended masks created by '~'
Date: Mon, 09 Jun 2014 13:34:24 +0000
Message-ID: <20140609133424.GB11986 () thin>
--------------------
On Mon, Jun 09, 2014 at 02:58:01PM +0300, Phil Carmody wrote:
> Consider the operation of rounding up to the nearest multiple of a power of 2.
> e.g.  #define ALLOC_SIZE(t) ((sizeof(t) + ASIZE - 1) & ~(ASIZE - 1))
> 
> If ASIZE is unfortunately defined as an unsigned type smaller than size_t,
> then the ~ will not undergo sign-bit extension, and the incorrect mask will
> be used. If used in a memory allocation context this could be fatal.
> 
> Warn about such dubious 'large op ~short' usage.
> 
> Signed-off-by: Phil Carmody <phil@dovecot.fi>
> ---
>  evaluate.c | 21 +++++++++++++++++++++
>  1 file changed, 21 insertions(+)
> 
> diff --git a/evaluate.c b/evaluate.c
> index 9052962..c0f3c91 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -189,6 +189,14 @@ left:
>  	return left;
>  }
>  
> +static int is_bigger_int_type(struct symbol *left, struct symbol *right)
> +{
> +	left = integer_promotion(left);
> +	right = integer_promotion(right);
> +
> +	return (left->bit_size > right->bit_size);
> +}
> +
>  static int same_cast_type(struct symbol *orig, struct symbol *new)
>  {
>  	return orig->bit_size == new->bit_size &&
> @@ -927,6 +935,19 @@ static struct symbol *evaluate_binop(struct expression *expr)
>  					op,
>  					right_not ? "!" : "");
>  
> +			left_not  = expr->left->type == EXPR_PREOP
> +					&& expr->left->op == '~';
> +			right_not = expr->right->type == EXPR_PREOP
> +			                && expr->right->op == '~';

Ah, now I see why you wanted these to not use "const".  Fair enough.
"bool" still seems like the right type, though.

> +			if ((left_not && is_bigger_int_type(rtype, ltype)
> +			     && (ltype->ctype.modifiers & MOD_UNSIGNED)) ||
> +			    (right_not && is_bigger_int_type(ltype, rtype)
> +			     && (rtype->ctype.modifiers & MOD_UNSIGNED)))

You might consider wrapping the common expression here, along with the
corresponding previous _not expression, into a function, and then
calling it twice, flipping the arguments around for the second call.

> +				warning(expr->pos, "dubious: %sx %c %sy",
> +				        left_not ? "~" : "",
> +					op,
> +					right_not ? "~" : "");

What happens here if left_not && right_not?  Should this warning still
occur?  I *think* it still makes sense for it to, but the warning
message might prove less informative.

> +
>  			ltype = usual_conversions(op, expr->left, expr->right,
>  						  lclass, rclass, ltype, rtype);
>  			ctype = rtype = ltype;
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: Re: [PATCH 2/3] sparse: detect non-sign-extended masks created by '~'
Date: Mon, 09 Jun 2014 16:05:41 +0000
Message-ID: <20140609160529.GA14166 () phil ! dovecot ! net>
--------------------
On Mon, Jun 09, 2014 at 06:34:24AM -0700, Josh Triplett wrote:

Thanks for the  quick response.

> On Mon, Jun 09, 2014 at 02:58:01PM +0300, Phil Carmody wrote:
> > Consider the operation of rounding up to the nearest multiple of a power of 2.
> > e.g.  #define ALLOC_SIZE(t) ((sizeof(t) + ASIZE - 1) & ~(ASIZE - 1))
> > 
> > If ASIZE is unfortunately defined as an unsigned type smaller than size_t,
> > then the ~ will not undergo sign-bit extension, and the incorrect mask will
> > be used. If used in a memory allocation context this could be fatal.
> > 
> > Warn about such dubious 'large op ~short' usage.
> > 
> > Signed-off-by: Phil Carmody <phil@dovecot.fi>
> > ---
> >  evaluate.c | 21 +++++++++++++++++++++
> >  1 file changed, 21 insertions(+)
> > 
> > diff --git a/evaluate.c b/evaluate.c
> > index 9052962..c0f3c91 100644
> > --- a/evaluate.c
> > +++ b/evaluate.c
> > @@ -189,6 +189,14 @@ left:
> >  	return left;
> >  }
> >  
> > +static int is_bigger_int_type(struct symbol *left, struct symbol *right)
> > +{
> > +	left = integer_promotion(left);
> > +	right = integer_promotion(right);
> > +
> > +	return (left->bit_size > right->bit_size);
> > +}
> > +
> >  static int same_cast_type(struct symbol *orig, struct symbol *new)
> >  {
> >  	return orig->bit_size == new->bit_size &&
> > @@ -927,6 +935,19 @@ static struct symbol *evaluate_binop(struct expression *expr)
> >  					op,
> >  					right_not ? "!" : "");
> >  
> > +			left_not  = expr->left->type == EXPR_PREOP
> > +					&& expr->left->op == '~';
> > +			right_not = expr->right->type == EXPR_PREOP
> > +			                && expr->right->op == '~';
> 
> Ah, now I see why you wanted these to not use "const".  Fair enough.
> "bool" still seems like the right type, though.

There did seem to be general bool-avoidance in the code, it would have been
my preference too.
 
> > +			if ((left_not && is_bigger_int_type(rtype, ltype)
> > +			     && (ltype->ctype.modifiers & MOD_UNSIGNED)) ||
> > +			    (right_not && is_bigger_int_type(ltype, rtype)
> > +			     && (rtype->ctype.modifiers & MOD_UNSIGNED)))
> 
> You might consider wrapping the common expression here, along with the
> corresponding previous _not expression, into a function, and then
> calling it twice, flipping the arguments around for the second call.

Yes, that makes sense.
 
> > +				warning(expr->pos, "dubious: %sx %c %sy",
> > +				        left_not ? "~" : "",
> > +					op,
> > +					right_not ? "~" : "");
> 
> What happens here if left_not && right_not?  Should this warning still
> occur?  I *think* it still makes sense for it to, but the warning
> message might prove less informative.

You're right, the message wouldn't identify which was the operand that
was not being sign extended. I can pull the warning itself into the helper
function I create for the test.

> > +
> >  			ltype = usual_conversions(op, expr->left, expr->right,
> >  						  lclass, rclass, ltype, rtype);
> >  			ctype = rtype = ltype;

Thanks for your comments. A v2 will be forthcoming...

Cheers,
Phil
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Sat, 11 Oct 2014 19:57:25 +0000
Message-ID: <54398BA5.6050005 () ramsay1 ! demon ! co ! uk>
--------------------

Passing the '-Wsparse-error' to cgcc can cause that option to be
passed to the C compiler (usually gcc), if the given source file
does not provoke any sparse warnings, which in turn results in
a failure to compile that file.

In order to avoid passing this sparse option to the compiler, we
add the '-Wsparse-error' option to the regular expression check
in the 'check_only_option' function.

In addition, we replace the plain call to 'die' when sparse exits
with non-zero status (maybe due to -Wsparse-error), with a simple
'exit 1'. This suppresses an 'Died at ./cgcc line 86.' message on
exit from cgcc.

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

The following shows the error/fix:

    $ pwd
    /home/ramsay/sparse
    $ cat -n hello.c
         1	#include <stdio.h>
         2	
         3	int main(void)
         4	{
         5		printf("Hello, world!\n");
         6		return 0;
         7	}
    $ CHECK=./sparse ./cgcc hello.c
    $ echo $?
    0
    $ CHECK=./sparse ./cgcc -Wsparse-error hello.c
    cc: error: unrecognized command line option -Wsparse-error
    $ echo $?
    1
    $ 

Note gcc complaining about the unknown option.
Now edit hello.c so that we generate a sparse warning ...

    $ cat -n hello.c
         1	#include <stdio.h>
         2	
         3	int f(void)
         4	{
         5		return 42;
         6	}
         7	
         8	int main(void)
         9	{
        10		printf("Hello, world!\n");
        11		return 0;
        12	}
    $ CHECK=./sparse ./cgcc hello.c
    hello.c:3:5: warning: symbol 'f' was not declared. Should it be static?
    $ echo $?
    0
    $ CHECK=./sparse ./cgcc -Wsparse-error hello.c
    hello.c:3:5: error: symbol 'f' was not declared. Should it be static?
    Died at ./cgcc line 86.
    $ echo $?
    1
    $ 

After this patch:

    with the original hello.c ...

    $ CHECK=./sparse ./cgcc hello.c
    $ echo $?
    0
    $ CHECK=./sparse ./cgcc -Wsparse-error hello.c
    $ echo $?
    0
    $ 

    with the modified hello.c ...

    $ CHECK=./sparse ./cgcc hello.c
    hello.c:3:5: warning: symbol 'f' was not declared. Should it be static?
    $ echo $?
    0
    $ CHECK=./sparse ./cgcc -Wsparse-error hello.c
    hello.c:3:5: error: symbol 'f' was not declared. Should it be static?
    $ echo $?
    1
    $ 

ATB,
Ramsay Jones


 cgcc | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/cgcc b/cgcc
index 8ee8da1..8e38174 100755
--- a/cgcc
+++ b/cgcc
@@ -83,7 +83,7 @@ if ($do_check) {
 
     print "$check\n" if $verbose;
     if ($do_compile) {
-	system ($check) == 0 or die;
+	system ($check) == 0 or exit 1;
     } else {
 	exec ($check);
     }
@@ -101,7 +101,7 @@ exit 0;
 
 sub check_only_option {
     my ($arg) = @_;
-    return 1 if $arg =~ /^-W(no-?)?(default-bitfield-sign|one-bit-signed-bitfield|cast-truncate|bitwise|typesign|context|undef|ptr-subtraction-blows|cast-to-as|decl|transparent-union|address-space|enum-mismatch|do-while|old-initializer|non-pointer-null|paren-string|return-void|designated-init|sparse-all)$/;
+    return 1 if $arg =~ /^-W(no-?)?(default-bitfield-sign|one-bit-signed-bitfield|cast-truncate|bitwise|typesign|context|undef|ptr-subtraction-blows|cast-to-as|decl|transparent-union|address-space|enum-mismatch|do-while|old-initializer|non-pointer-null|paren-string|return-void|designated-init|sparse-all|sparse-error)$/;
     return 1 if $arg =~ /^-v(no-?)?(entry|dead)$/;
     return 0;
 }
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Wed, 15 Oct 2014 14:23:40 +0000
Message-ID: <CANeU7QnOJTKK___Vb3VpN=_x62wVpS=A57UkTQrSz0-GYBF5rQ () mail ! gmail ! com>
--------------------
On Sun, Oct 12, 2014 at 3:57 AM, Ramsay Jones
<ramsay@ramsay1.demon.co.uk> wrote:
>
>
> -       system ($check) == 0 or die;
> +       system ($check) == 0 or exit 1;

Why not exit with the error code from sparse here?
Sparse might exit with other error code than "1" in the future.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Wed, 15 Oct 2014 17:33:46 +0000
Message-ID: <543EAFFA.6070503 () ramsay1 ! demon ! co ! uk>
--------------------
On 15/10/14 15:23, Christopher Li wrote:
> On Sun, Oct 12, 2014 at 3:57 AM, Ramsay Jones
> <ramsay@ramsay1.demon.co.uk> wrote:
>>
>>
>> -       system ($check) == 0 or die;
>> +       system ($check) == 0 or exit 1;
> 
> Why not exit with the error code from sparse here?
> Sparse might exit with other error code than "1" in the future.

The meaning of the return value from system() is not portable.

If you read the perl documentation (e.g. perldoc -f system and
perldoc perlport [look for system() specific comments near the
end]), you will see that there is some variability. (This is
particularly true if it executes a shell to run the command).

However, I have found over the years that the situation is
much worse than even the perl documentation claims! (e.g. On
'platforms' like cygwin/MinGW/Win32-gnu/Win32-ActiveState and
even some unix systems).

About the only thing they all agree on is that a 0 return means
success. So, that is all I rely on, in general. This is helped
by the fact that most programs return either 0 or 1. For those
programs that do return multiple failure codes, I often don't
care why it failed - just that it did. In the very few cases
that I do care, then I do a 'best effort' knowing that it may
return the wrong code on some platforms.

Hmm, off the top of my head, something like:

    sub exit_code {
        my ($code) = @_;
        if ($code == -1) { # failed to execute
            $code = 1;
        }
        elsif ($code & 127) { # died with a signal (maybe)
            $code = 1;
        }
        elsif ($code != 0) { # non-zero exit code (maybe)
            my $t = ($code >> 8) & 0xff;
            $code = 1;
            if ($t > 0) {
                $code = $t;
            }
        }
        return $code;
    }

    system ($check) or exit exit_code($?);

However, I think the above is way overkill in this case. ;-)

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Thu, 16 Oct 2014 01:45:02 +0000
Message-ID: <CANeU7Q=ruQhu19sY=mDyiBmyDCGRR+xmRE7SzN9BcGLRZWX8Bw () mail ! gmail ! com>
--------------------
Hi,

I create a branch in the chrisl repo call "review-ramsay" for your new
follow up patches.
I plan to do incremental fix up if any on that branch. Then when we
both happy about it,
I will do rebase and smash the commit before push to master branch.



On Thu, Oct 16, 2014 at 1:33 AM, Ramsay Jones
<ramsay@ramsay1.demon.co.uk> wrote:
> On 15/10/14 15:23, Christopher Li wrote:
>> On Sun, Oct 12, 2014 at 3:57 AM, Ramsay Jones
>> <ramsay@ramsay1.demon.co.uk> wrote:
>>>
>>>
>>> -       system ($check) == 0 or die;
>>> +       system ($check) == 0 or exit 1;
>>
>> Why not exit with the error code from sparse here?
>> Sparse might exit with other error code than "1" in the future.
>
> The meaning of the return value from system() is not portable.

I see. Does it mean we should use some thing other than "system".
or maybe some thing like:

$retcode = system($check);
if $retcode !=0 { exit $retcode; }

I don't use Perl so that might not be valid Perl.

> Hmm, off the top of my head, something like:
>
>     sub exit_code {
>         my ($code) = @_;
>         if ($code == -1) { # failed to execute
>             $code = 1;
>         }
>         elsif ($code & 127) { # died with a signal (maybe)
>             $code = 1;
>         }
>         elsif ($code != 0) { # non-zero exit code (maybe)
>             my $t = ($code >> 8) & 0xff;
>             $code = 1;
>             if ($t > 0) {
>                 $code = $t;
>             }
>         }
>         return $code;
>     }
>
>     system ($check) or exit exit_code($?);
>
> However, I think the above is way overkill in this case. ;-)

Yes, I agree, that is way overkill.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Wed, 22 Oct 2014 00:23:39 +0000
Message-ID: <CANeU7Qk_H8fV_soAbtGjHXwKBw3BWJgABhNM+KFLmM-rVY4N8w () mail ! gmail ! com>
--------------------
On Sun, Oct 19, 2014 at 10:21 PM, Ramsay Jones
<ramsay@ramsay1.demon.co.uk> wrote:
> Sorry for the late reply, it's been a busy few days. ;-)
>
> On 16/10/14 02:45, Christopher Li wrote:
>> Hi,
>>
>> I create a branch in the chrisl repo call "review-ramsay" for your new
>> follow up patches.
>> I plan to do incremental fix up if any on that branch. Then when we
>> both happy about it,
>> I will do rebase and smash the commit before push to master branch.
>
> Yes, I noticed the new branch - thanks!
>
> Did you have any thoughts regarding Josh Triplett's comments on the
> "compile-i386.c: don't ignore return value of write(2)" patch?

I am fine with either way. The current fix is fine. If you are up for
a new xwrite function, that is of course fine as well. Using printf()
is not much an improvement because printf() can still return
bytes less than the amount you requested.

>
> No, no, you don't want to do that even on Linux (let alone more
> exotic platforms like Windows, MinGW and cygwin).

In that case, I will leave the patch as it is. Thanks for the explain.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Thu, 23 Oct 2014 00:38:04 +0000
Message-ID: <54484DEC.2010902 () ramsay1 ! demon ! co ! uk>
--------------------
On 22/10/14 01:23, Christopher Li wrote:
> On Sun, Oct 19, 2014 at 10:21 PM, Ramsay Jones
> <ramsay@ramsay1.demon.co.uk> wrote:
>> Sorry for the late reply, it's been a busy few days. ;-)
>>
>> On 16/10/14 02:45, Christopher Li wrote:
>>> Hi,
>>>
>>> I create a branch in the chrisl repo call "review-ramsay" for your new
>>> follow up patches.
>>> I plan to do incremental fix up if any on that branch. Then when we
>>> both happy about it,
>>> I will do rebase and smash the commit before push to master branch.
>>
>> Yes, I noticed the new branch - thanks!
>>
>> Did you have any thoughts regarding Josh Triplett's comments on the
>> "compile-i386.c: don't ignore return value of write(2)" patch?
> 
> I am fine with either way. The current fix is fine.

I'm fine with this too. ;-)

>                                                     If you are up for
> a new xwrite function, that is of course fine as well.

Without putting too much thought into it, such a beast would probably
look something like this:

    #include <stddef.h>
    #include <unistd.h>
    #include <errno.h>
    
    ssize_t xwrite(int fd, const void *buf, size_t len)
    {
    	const char *p = buf;
    	ssize_t count = 0;
    
    	while (len > 0) {
    		ssize_t nw = write(fd, p, len);
    		if (nw < 0) {
    			if (errno == EAGAIN || errno == EINTR)
    				continue; /* recoverable error */
    			return -1;
    		}
    		len -= nw;
    		p += nw;
    		count += nw;
    	}
    	return count;
    }
    
Actually, I would need to think about what to do if write() returns
zero. Such a return is not an error, it simply didn't write anything.
Are we guaranteed that some progress will eventually be made, or
should there be another check for non-progress in the loop. dunno. :(

>                                                         Using printf()
> is not much an improvement because printf() can still return
> bytes less than the amount you requested.

Hmm, I don't understand this. _In general_, you don't know how many
bytes you are going to write before you call printf() and you don't
explicitly request any amount. Assuming no errors, which are indicated
with a negative return value, printf() returns the number of bytes
actually 'written'. The standard I/O routines, including all the internal
buffering, are much easier to use than the raw system calls (you don't
have to cater for short writes etc., like the code above, because the
standard library takes care of all of that for you).

My preference for the first patch (replacing calls to write with printf),
has little to do with this issue. I simply see no advantage in mixing
calls to the standard I/O library with write() system calls. (The call
to fflush(stdout) on line 889 has nothing to do with paranoia; it has to
do with correctness and is very much needed!)

Using printf() is more portable than write(). The emit_insn_atom() could
be greatly simplified by calling printf() directly rather than using
a sprintf/write combo. (not implemented in my patch). I would be very
surprised if using write() was any more efficient than printf(). I find
the code easier to comprehend without mixing I/O styles. So, once again,
what advantage does write() bestow?

Having said that, although I think the latest patch is perfectly fine, if
you would like me to try expanding on the above xwrite() idea, just let me
know.

ATB,
Ramsay Jones


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH 2/4] cgcc: avoid passing a sparse-only option to cc
Date: Sat, 25 Oct 2014 12:32:01 +0000
Message-ID: <544B9841.6010009 () ramsay1 ! demon ! co ! uk>
--------------------
On 25/10/14 05:14, Christopher Li wrote:
> On Thu, Oct 23, 2014 at 8:38 AM, Ramsay Jones
> <ramsay@ramsay1.demon.co.uk> wrote:
>>
>> Without putting too much thought into it, such a beast would probably
>> look something like this:
>>
>>     #include <stddef.h>
>>     #include <unistd.h>
>>     #include <errno.h>
>>
>>     ssize_t xwrite(int fd, const void *buf, size_t len)
>>     {
>>         const char *p = buf;
>>         ssize_t count = 0;
>>
>>         while (len > 0) {
>>                 ssize_t nw = write(fd, p, len);
>>                 if (nw < 0) {
>>                         if (errno == EAGAIN || errno == EINTR)
>>                                 continue; /* recoverable error */
>>                         return -1;
>>                 }
>>                 len -= nw;
>>                 p += nw;
>>                 count += nw;
>>         }
>>         return count;
>>     }
>>
>> Actually, I would need to think about what to do if write() returns
>> zero. Such a return is not an error, it simply didn't write anything.
>> Are we guaranteed that some progress will eventually be made, or
>> should there be another check for non-progress in the loop. dunno. :(
> 
> The while loop need to have some ending conditions otherwise
> it can result in no progress make on a loop. e.g. calling on a non
> blocking file descriptor and the write will block.

Yeah, I just typed that directly into my mail client and the first version
had an 'if (nw == 0) return -1;' in the loop. However, I couldn't justify
doing that, because it is not an error. I briefly thought about adding a
'non-progress' count to use to exit, but at this point I felt I would have
to go away and start reading ... so I just punted. It was only a quick
'something like this ...' anyway! ;-)

> I think for the compile-i386.c. It is fine just die on short write.
> It is just an example program.

Again, I'm happy to go with this too!

>> Hmm, I don't understand this. _In general_, you don't know how many
>> bytes you are going to write before you call printf() and you don't
>> explicitly request any amount. Assuming no errors, which are indicated
>> with a negative return value, printf() returns the number of bytes
>> actually 'written'. The standard I/O routines, including all the internal
>> buffering, are much easier to use than the raw system calls (you don't
>> have to cater for short writes etc., like the code above, because the
>> standard library takes care of all of that for you).
> 
> My feed back is base on the reason of the change. If your intend is
> to get rid of the warning of not checking the error condition. Then the
> right thing to do is to just check and handle it. Die on error is also one
> kind of handle. Might be a bit harsh, but fine for the example program.
> In this respect, printf is not better.

OK, point taken.

[snip]

> I vote for left the patch as it is.

Me too.

Thanks!

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/5] kbuild: LLVMLinux: Adapt warnings for compilation with clang ===

From: Behan Webster <behanw () converseincode ! com>
To: linux-sparse
Subject: Re: [PATCH 2/5] kbuild: LLVMLinux: Adapt warnings for compilation with clang
Date: Wed, 26 Feb 2014 02:38:51 +0000
Message-ID: <530D53BB.2020702 () converseincode ! com>
--------------------
On 02/25/14 17:17, Dave Jones wrote:
> On Tue, Feb 25, 2014 at 05:08:40PM -0800, behanw@converseincode.com wrote:
>   
>   > When compiling kernel with clang, disable warnings which are too noisy, and
>   > add the clang flag catch-undefined-behavior.
>   >
>   > +# Clang
>   > +warning-1 += $(call cc-disable-warning, initializer-overrides)
>   > +warning-1 += $(call cc-disable-warning, unused-value)
>   > +warning-1 += $(call cc-disable-warning, format)
>   > +warning-1 += $(call cc-disable-warning, unknown-warning-option)
>   > +warning-1 += $(call cc-disable-warning, self-assign)
>   > +warning-1 += $(call cc-disable-warning, sign-compare)
>   > +warning-1 += $(call cc-disable-warning, format-zero-length)
>   > +warning-1 += $(call cc-disable-warning, uninitialized)
>   > +warning-1 += $(call cc-option, -fcatch-undefined-behavior)
>
> Do you have a pointer to an example log-file from before this change ?
> I'm curious for eg, which self-assign warnings are showing up,
> because I've been fixing up the ones that Coverity found, of which
> there are only a dozen or so left iirc.
I count 22 in this particular x86 kernel build (some of which you may 
well have fixed already). Enjoy.

http://buildbot.llvm.linuxfoundation.org/self-assign-build.log.txt

Perhaps I should re-enable that warning, considering the number has 
dropped so dramatically from when I last checked over a year ago.

Thanks,

Behan

-- 
Behan Webster
behanw@converseincode.com

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 2/5] raid: Require designated initialization of structures ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-raid
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-raid" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-fsdevel
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-fsdevel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kbuild
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-kbuild" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-api
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-api" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH 2/5] raid: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:35 +0000
Message-ID: <1d468224409ef2bf46874f817d19389ac5d1b26d.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark raid6_calls and other structures containing function pointers with
__designated_init.  Fix implementations in lib/raid6/ to use designated
initializers; this also simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/raid/pq.h    |  4 ++--
 include/linux/raid/xor.h   |  2 +-
 include/linux/raid_class.h |  2 +-
 lib/raid6/altivec.uc       |  7 +++----
 lib/raid6/avx2.c           | 24 ++++++++++++------------
 lib/raid6/int.uc           |  6 ++----
 lib/raid6/mmx.c            | 14 ++++++--------
 lib/raid6/neon.c           |  7 +++----
 lib/raid6/sse1.c           | 16 ++++++++--------
 lib/raid6/sse2.c           | 24 ++++++++++++------------
 lib/raid6/tilegx.uc        |  6 ++----
 11 files changed, 52 insertions(+), 60 deletions(-)

diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
index 73069cb..2147bff 100644
--- a/include/linux/raid/pq.h
+++ b/include/linux/raid/pq.h
@@ -75,7 +75,7 @@ struct raid6_calls {
 	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
 	const char *name;	/* Name of this routine set */
 	int prefer;		/* Has special performance attribute */
-};
+} __designated_init;
 
 /* Selected algorithm */
 extern struct raid6_calls raid6_call;
@@ -109,7 +109,7 @@ struct raid6_recov_calls {
 	int  (*valid)(void);
 	const char *name;
 	int priority;
-};
+} __designated_init;
 
 extern const struct raid6_recov_calls raid6_recov_intx1;
 extern const struct raid6_recov_calls raid6_recov_ssse3;
diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
index 5a21095..c7df59f 100644
--- a/include/linux/raid/xor.h
+++ b/include/linux/raid/xor.h
@@ -17,6 +17,6 @@ struct xor_block_template {
 		     unsigned long *, unsigned long *);
 	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
 		     unsigned long *, unsigned long *, unsigned long *);
-};
+} __designated_init;
 
 #endif
diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
index 31e1ff6..603af94 100644
--- a/include/linux/raid_class.h
+++ b/include/linux/raid_class.h
@@ -16,7 +16,7 @@ struct raid_function_template {
 	int (*is_raid)(struct device *);
 	void (*get_resync)(struct device *);
 	void (*get_state)(struct device *);
-};
+} __designated_init;
 
 enum raid_state {
 	RAID_STATE_UNKNOWN = 0,
diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
index 7cc12b5..4ff138c 100644
--- a/lib/raid6/altivec.uc
+++ b/lib/raid6/altivec.uc
@@ -118,10 +118,9 @@ int raid6_have_altivec(void)
 #endif
 
 const struct raid6_calls raid6_altivec$# = {
-	raid6_altivec$#_gen_syndrome,
-	raid6_have_altivec,
-	"altivecx$#",
-	0
+	.gen_syndrome = raid6_altivec$#_gen_syndrome,
+	.valid = raid6_have_altivec,
+	.name = "altivecx$#",
 };
 
 #endif /* CONFIG_ALTIVEC */
diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
index bc3b1dd..e56fa06 100644
--- a/lib/raid6/avx2.c
+++ b/lib/raid6/avx2.c
@@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x1 = {
-	raid6_avx21_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx21_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x2 = {
-	raid6_avx22_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx22_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_avx2x4 = {
-	raid6_avx24_gen_syndrome,
-	raid6_have_avx2,
-	"avx2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_avx24_gen_syndrome,
+	.valid = raid6_have_avx2,
+	.name = "avx2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 #endif
 
diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
index 5b50f8d..35ad01a 100644
--- a/lib/raid6/int.uc
+++ b/lib/raid6/int.uc
@@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_intx$# = {
-	raid6_int$#_gen_syndrome,
-	NULL,		/* always valid */
-	"int" NSTRING "x$#",
-	0
+	.gen_syndrome = raid6_int$#_gen_syndrome,
+	.name = "int" NSTRING "x$#",
 };
 
 #endif
diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
index 590c71c..cdd7d02 100644
--- a/lib/raid6/mmx.c
+++ b/lib/raid6/mmx.c
@@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx1 = {
-	raid6_mmx1_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx1",
-	0
+	.gen_syndrome = raid6_mmx1_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx1",
 };
 
 /*
@@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_mmxx2 = {
-	raid6_mmx2_gen_syndrome,
-	raid6_have_mmx,
-	"mmxx2",
-	0
+	.gen_syndrome = raid6_mmx2_gen_syndrome,
+	.valid = raid6_have_mmx,
+	.name = "mmxx2",
 };
 
 #endif
diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
index 36ad470..99100dd 100644
--- a/lib/raid6/neon.c
+++ b/lib/raid6/neon.c
@@ -41,10 +41,9 @@
 		kernel_neon_end();					\
 	}								\
 	struct raid6_calls const raid6_neonx ## _n = {			\
-		raid6_neon ## _n ## _gen_syndrome,			\
-		raid6_have_neon,					\
-		"neonx" #_n,						\
-		0							\
+		.gen_syndrome = raid6_neon ## _n ## _gen_syndrome,	\
+		.valid = raid6_have_neon,				\
+		.name = "neonx" #_n,					\
 	}
 
 static int raid6_have_neon(void)
diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
index f762971..a9de46e 100644
--- a/lib/raid6/sse1.c
+++ b/lib/raid6/sse1.c
@@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x1 = {
-	raid6_sse11_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse11_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse1x2 = {
-	raid6_sse12_gen_syndrome,
-	raid6_have_sse1_or_mmxext,
-	"sse1x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse12_gen_syndrome,
+	.valid = raid6_have_sse1_or_mmxext,
+	.name = "sse1x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif
diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
index 85b82c8..cd262518aa 100644
--- a/lib/raid6/sse2.c
+++ b/lib/raid6/sse2.c
@@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x1 = {
-	raid6_sse21_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x1",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse21_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x1",
+	.prefer = 1,		/* Has cache hints */
 };
 
 /*
@@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x2 = {
-	raid6_sse22_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x2",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse22_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x2",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #ifdef CONFIG_X86_64
@@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_sse2x4 = {
-	raid6_sse24_gen_syndrome,
-	raid6_have_sse2,
-	"sse2x4",
-	1			/* Has cache hints */
+	.gen_syndrome = raid6_sse24_gen_syndrome,
+	.valid = raid6_have_sse2,
+	.name = "sse2x4",
+	.prefer = 1,		/* Has cache hints */
 };
 
 #endif /* CONFIG_X86_64 */
diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
index e7c2945..3077722 100644
--- a/lib/raid6/tilegx.uc
+++ b/lib/raid6/tilegx.uc
@@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t bytes, void **ptrs)
 }
 
 const struct raid6_calls raid6_tilegx$# = {
-	raid6_tilegx$#_gen_syndrome,
-	NULL,
-	"tilegx$#",
-	0
+	.gen_syndrome = raid6_tilegx$#_gen_syndrome,
+	.name = "tilegx$#",
 };
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: NeilBrown <neilb () suse ! de>
To: linux-kernel
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:10:55 +0000
Message-ID: <20140801111055.59419950 () notabene ! brown>
--------------------
--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
wrote:

> Mark raid6_calls and other structures containing function pointers with
> __designated_init.  Fix implementations in lib/raid6/ to use designated
> initializers; this also simplifies those initializers using the default
> initialization of fields to 0.
>=20
> Signed-off-by: Josh Triplett <josh@joshtriplett.org>

Looks like an excellent idea!
Feel free to forward this upstream on my behalf, or remind me once the first
patch is in -next, and I'll take this one myself - whichever you prefer.

 Acked-by: NeilBrown <neilb@suse.de>

Thanks,
NeilBrown

> ---
>  include/linux/raid/pq.h    |  4 ++--
>  include/linux/raid/xor.h   |  2 +-
>  include/linux/raid_class.h |  2 +-
>  lib/raid6/altivec.uc       |  7 +++----
>  lib/raid6/avx2.c           | 24 ++++++++++++------------
>  lib/raid6/int.uc           |  6 ++----
>  lib/raid6/mmx.c            | 14 ++++++--------
>  lib/raid6/neon.c           |  7 +++----
>  lib/raid6/sse1.c           | 16 ++++++++--------
>  lib/raid6/sse2.c           | 24 ++++++++++++------------
>  lib/raid6/tilegx.uc        |  6 ++----
>  11 files changed, 52 insertions(+), 60 deletions(-)
>=20
> diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
> index 73069cb..2147bff 100644
> --- a/include/linux/raid/pq.h
> +++ b/include/linux/raid/pq.h
> @@ -75,7 +75,7 @@ struct raid6_calls {
>  	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
>  	const char *name;	/* Name of this routine set */
>  	int prefer;		/* Has special performance attribute */
> -};
> +} __designated_init;
> =20
>  /* Selected algorithm */
>  extern struct raid6_calls raid6_call;
> @@ -109,7 +109,7 @@ struct raid6_recov_calls {
>  	int  (*valid)(void);
>  	const char *name;
>  	int priority;
> -};
> +} __designated_init;
> =20
>  extern const struct raid6_recov_calls raid6_recov_intx1;
>  extern const struct raid6_recov_calls raid6_recov_ssse3;
> diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
> index 5a21095..c7df59f 100644
> --- a/include/linux/raid/xor.h
> +++ b/include/linux/raid/xor.h
> @@ -17,6 +17,6 @@ struct xor_block_template {
>  		     unsigned long *, unsigned long *);
>  	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
>  		     unsigned long *, unsigned long *, unsigned long *);
> -};
> +} __designated_init;
> =20
>  #endif
> diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
> index 31e1ff6..603af94 100644
> --- a/include/linux/raid_class.h
> +++ b/include/linux/raid_class.h
> @@ -16,7 +16,7 @@ struct raid_function_template {
>  	int (*is_raid)(struct device *);
>  	void (*get_resync)(struct device *);
>  	void (*get_state)(struct device *);
> -};
> +} __designated_init;
> =20
>  enum raid_state {
>  	RAID_STATE_UNKNOWN =3D 0,
> diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
> index 7cc12b5..4ff138c 100644
> --- a/lib/raid6/altivec.uc
> +++ b/lib/raid6/altivec.uc
> @@ -118,10 +118,9 @@ int raid6_have_altivec(void)
>  #endif
> =20
>  const struct raid6_calls raid6_altivec$# =3D {
> -	raid6_altivec$#_gen_syndrome,
> -	raid6_have_altivec,
> -	"altivecx$#",
> -	0
> +	.gen_syndrome =3D raid6_altivec$#_gen_syndrome,
> +	.valid =3D raid6_have_altivec,
> +	.name =3D "altivecx$#",
>  };
> =20
>  #endif /* CONFIG_ALTIVEC */
> diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
> index bc3b1dd..e56fa06 100644
> --- a/lib/raid6/avx2.c
> +++ b/lib/raid6/avx2.c
> @@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x1 =3D {
> -	raid6_avx21_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx21_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x2 =3D {
> -	raid6_avx22_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx22_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x4 =3D {
> -	raid6_avx24_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx24_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
>  #endif
> =20
> diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
> index 5b50f8d..35ad01a 100644
> --- a/lib/raid6/int.uc
> +++ b/lib/raid6/int.uc
> @@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size=
_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_intx$# =3D {
> -	raid6_int$#_gen_syndrome,
> -	NULL,		/* always valid */
> -	"int" NSTRING "x$#",
> -	0
> +	.gen_syndrome =3D raid6_int$#_gen_syndrome,
> +	.name =3D "int" NSTRING "x$#",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
> index 590c71c..cdd7d02 100644
> --- a/lib/raid6/mmx.c
> +++ b/lib/raid6/mmx.c
> @@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t =
bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx1 =3D {
> -	raid6_mmx1_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx1",
> -	0
> +	.gen_syndrome =3D raid6_mmx1_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx1",
>  };
> =20
>  /*
> @@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx2 =3D {
> -	raid6_mmx2_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx2",
> -	0
> +	.gen_syndrome =3D raid6_mmx2_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx2",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
> index 36ad470..99100dd 100644
> --- a/lib/raid6/neon.c
> +++ b/lib/raid6/neon.c
> @@ -41,10 +41,9 @@
>  		kernel_neon_end();					\
>  	}								\
>  	struct raid6_calls const raid6_neonx ## _n =3D {			\
> -		raid6_neon ## _n ## _gen_syndrome,			\
> -		raid6_have_neon,					\
> -		"neonx" #_n,						\
> -		0							\
> +		.gen_syndrome =3D raid6_neon ## _n ## _gen_syndrome,	\
> +		.valid =3D raid6_have_neon,				\
> +		.name =3D "neonx" #_n,					\
>  	}
> =20
>  static int raid6_have_neon(void)
> diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
> index f762971..a9de46e 100644
> --- a/lib/raid6/sse1.c
> +++ b/lib/raid6/sse1.c
> @@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x1 =3D {
> -	raid6_sse11_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse11_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x2 =3D {
> -	raid6_sse12_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse12_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif
> diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
> index 85b82c8..cd262518aa 100644
> --- a/lib/raid6/sse2.c
> +++ b/lib/raid6/sse2.c
> @@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x1 =3D {
> -	raid6_sse21_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse21_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x2 =3D {
> -	raid6_sse22_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse22_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x4 =3D {
> -	raid6_sse24_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse24_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif /* CONFIG_X86_64 */
> diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
> index e7c2945..3077722 100644
> --- a/lib/raid6/tilegx.uc
> +++ b/lib/raid6/tilegx.uc
> @@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t byte=
s, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_tilegx$# =3D {
> -	raid6_tilegx$#_gen_syndrome,
> -	NULL,
> -	"tilegx$#",
> -	0
> +	.gen_syndrome =3D raid6_tilegx$#_gen_syndrome,
> +	.name =3D "tilegx$#",
>  };


--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIVAwUBU9rpHznsnt1WYoG5AQKbPA/+OcPpQdH7YF9IW003H72axTgVavamvgQT
SvQCGc3EBeBlErW+49TBvvRadNe81X4Qz4SKhFZxcC5S2QJU/bETohcm/72Zm5HX
H79y1yWD2CIxYPOlPGCas0lLMY16w75vTQ/e7pTgk/ItNd5oRWaxvMNGoKhVk+e6
cmhtAO44uN1+J6pf5dsSnAi9tBXcE1PqvyOwodkguoY52SrY8hRPeICokrkPfInt
/2hB43PmTfKfYsGl6RwxIMGmQ31V8AzyZ6nkVzMzszw9DzKls+xDCYfteSp6KgtZ
5G04FeF7h/LKXo9llPgu/VwPcmR+5Si55N+KoQehyi+XuV4yTQYzE0LfhPf18PZg
5iBssYeGketzAWg54/aB9ZIpjfPmUA8diWjrIw0azUOoarutoKw9QUkA3pkJJndb
X4t+nwDZQy3xOcx/vPL7gWeHylapugyOSjZBHD9SE/Xa9ZsvRcI2RemFzoqdPsyK
6+GY+MP6zyEnXp85Y2Ry1paJkdy/cAf8XVPrcBi1GNziDeZHJxt6qYtQ5oMjkzZd
/Fb6Kx7xN+qoyMkcZijtsJgZWgQk/EzsoeoR+aD5Zqz29HIprQUfWmGBcZ1/aIpw
PJeWm8VI9l4DYXun/5j0oB7BZB8DQbM9KGFDZfpndWdeCrrAZe5Uu4K4uX/otG5N
N5qXmEZVyO0=
=XH/S
-----END PGP SIGNATURE-----

--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: NeilBrown <neilb () suse ! de>
To: linux-fsdevel
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:10:55 +0000
Message-ID: <20140801111055.59419950 () notabene ! brown>
--------------------
--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
wrote:

> Mark raid6_calls and other structures containing function pointers with
> __designated_init.  Fix implementations in lib/raid6/ to use designated
> initializers; this also simplifies those initializers using the default
> initialization of fields to 0.
>=20
> Signed-off-by: Josh Triplett <josh@joshtriplett.org>

Looks like an excellent idea!
Feel free to forward this upstream on my behalf, or remind me once the first
patch is in -next, and I'll take this one myself - whichever you prefer.

 Acked-by: NeilBrown <neilb@suse.de>

Thanks,
NeilBrown

> ---
>  include/linux/raid/pq.h    |  4 ++--
>  include/linux/raid/xor.h   |  2 +-
>  include/linux/raid_class.h |  2 +-
>  lib/raid6/altivec.uc       |  7 +++----
>  lib/raid6/avx2.c           | 24 ++++++++++++------------
>  lib/raid6/int.uc           |  6 ++----
>  lib/raid6/mmx.c            | 14 ++++++--------
>  lib/raid6/neon.c           |  7 +++----
>  lib/raid6/sse1.c           | 16 ++++++++--------
>  lib/raid6/sse2.c           | 24 ++++++++++++------------
>  lib/raid6/tilegx.uc        |  6 ++----
>  11 files changed, 52 insertions(+), 60 deletions(-)
>=20
> diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
> index 73069cb..2147bff 100644
> --- a/include/linux/raid/pq.h
> +++ b/include/linux/raid/pq.h
> @@ -75,7 +75,7 @@ struct raid6_calls {
>  	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
>  	const char *name;	/* Name of this routine set */
>  	int prefer;		/* Has special performance attribute */
> -};
> +} __designated_init;
> =20
>  /* Selected algorithm */
>  extern struct raid6_calls raid6_call;
> @@ -109,7 +109,7 @@ struct raid6_recov_calls {
>  	int  (*valid)(void);
>  	const char *name;
>  	int priority;
> -};
> +} __designated_init;
> =20
>  extern const struct raid6_recov_calls raid6_recov_intx1;
>  extern const struct raid6_recov_calls raid6_recov_ssse3;
> diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
> index 5a21095..c7df59f 100644
> --- a/include/linux/raid/xor.h
> +++ b/include/linux/raid/xor.h
> @@ -17,6 +17,6 @@ struct xor_block_template {
>  		     unsigned long *, unsigned long *);
>  	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
>  		     unsigned long *, unsigned long *, unsigned long *);
> -};
> +} __designated_init;
> =20
>  #endif
> diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
> index 31e1ff6..603af94 100644
> --- a/include/linux/raid_class.h
> +++ b/include/linux/raid_class.h
> @@ -16,7 +16,7 @@ struct raid_function_template {
>  	int (*is_raid)(struct device *);
>  	void (*get_resync)(struct device *);
>  	void (*get_state)(struct device *);
> -};
> +} __designated_init;
> =20
>  enum raid_state {
>  	RAID_STATE_UNKNOWN =3D 0,
> diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
> index 7cc12b5..4ff138c 100644
> --- a/lib/raid6/altivec.uc
> +++ b/lib/raid6/altivec.uc
> @@ -118,10 +118,9 @@ int raid6_have_altivec(void)
>  #endif
> =20
>  const struct raid6_calls raid6_altivec$# =3D {
> -	raid6_altivec$#_gen_syndrome,
> -	raid6_have_altivec,
> -	"altivecx$#",
> -	0
> +	.gen_syndrome =3D raid6_altivec$#_gen_syndrome,
> +	.valid =3D raid6_have_altivec,
> +	.name =3D "altivecx$#",
>  };
> =20
>  #endif /* CONFIG_ALTIVEC */
> diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
> index bc3b1dd..e56fa06 100644
> --- a/lib/raid6/avx2.c
> +++ b/lib/raid6/avx2.c
> @@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x1 =3D {
> -	raid6_avx21_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx21_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x2 =3D {
> -	raid6_avx22_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx22_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x4 =3D {
> -	raid6_avx24_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx24_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
>  #endif
> =20
> diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
> index 5b50f8d..35ad01a 100644
> --- a/lib/raid6/int.uc
> +++ b/lib/raid6/int.uc
> @@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size=
_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_intx$# =3D {
> -	raid6_int$#_gen_syndrome,
> -	NULL,		/* always valid */
> -	"int" NSTRING "x$#",
> -	0
> +	.gen_syndrome =3D raid6_int$#_gen_syndrome,
> +	.name =3D "int" NSTRING "x$#",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
> index 590c71c..cdd7d02 100644
> --- a/lib/raid6/mmx.c
> +++ b/lib/raid6/mmx.c
> @@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t =
bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx1 =3D {
> -	raid6_mmx1_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx1",
> -	0
> +	.gen_syndrome =3D raid6_mmx1_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx1",
>  };
> =20
>  /*
> @@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx2 =3D {
> -	raid6_mmx2_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx2",
> -	0
> +	.gen_syndrome =3D raid6_mmx2_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx2",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
> index 36ad470..99100dd 100644
> --- a/lib/raid6/neon.c
> +++ b/lib/raid6/neon.c
> @@ -41,10 +41,9 @@
>  		kernel_neon_end();					\
>  	}								\
>  	struct raid6_calls const raid6_neonx ## _n =3D {			\
> -		raid6_neon ## _n ## _gen_syndrome,			\
> -		raid6_have_neon,					\
> -		"neonx" #_n,						\
> -		0							\
> +		.gen_syndrome =3D raid6_neon ## _n ## _gen_syndrome,	\
> +		.valid =3D raid6_have_neon,				\
> +		.name =3D "neonx" #_n,					\
>  	}
> =20
>  static int raid6_have_neon(void)
> diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
> index f762971..a9de46e 100644
> --- a/lib/raid6/sse1.c
> +++ b/lib/raid6/sse1.c
> @@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x1 =3D {
> -	raid6_sse11_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse11_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x2 =3D {
> -	raid6_sse12_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse12_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif
> diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
> index 85b82c8..cd262518aa 100644
> --- a/lib/raid6/sse2.c
> +++ b/lib/raid6/sse2.c
> @@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x1 =3D {
> -	raid6_sse21_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse21_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x2 =3D {
> -	raid6_sse22_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse22_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x4 =3D {
> -	raid6_sse24_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse24_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif /* CONFIG_X86_64 */
> diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
> index e7c2945..3077722 100644
> --- a/lib/raid6/tilegx.uc
> +++ b/lib/raid6/tilegx.uc
> @@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t byte=
s, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_tilegx$# =3D {
> -	raid6_tilegx$#_gen_syndrome,
> -	NULL,
> -	"tilegx$#",
> -	0
> +	.gen_syndrome =3D raid6_tilegx$#_gen_syndrome,
> +	.name =3D "tilegx$#",
>  };


--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIVAwUBU9rpHznsnt1WYoG5AQKbPA/+OcPpQdH7YF9IW003H72axTgVavamvgQT
SvQCGc3EBeBlErW+49TBvvRadNe81X4Qz4SKhFZxcC5S2QJU/bETohcm/72Zm5HX
H79y1yWD2CIxYPOlPGCas0lLMY16w75vTQ/e7pTgk/ItNd5oRWaxvMNGoKhVk+e6
cmhtAO44uN1+J6pf5dsSnAi9tBXcE1PqvyOwodkguoY52SrY8hRPeICokrkPfInt
/2hB43PmTfKfYsGl6RwxIMGmQ31V8AzyZ6nkVzMzszw9DzKls+xDCYfteSp6KgtZ
5G04FeF7h/LKXo9llPgu/VwPcmR+5Si55N+KoQehyi+XuV4yTQYzE0LfhPf18PZg
5iBssYeGketzAWg54/aB9ZIpjfPmUA8diWjrIw0azUOoarutoKw9QUkA3pkJJndb
X4t+nwDZQy3xOcx/vPL7gWeHylapugyOSjZBHD9SE/Xa9ZsvRcI2RemFzoqdPsyK
6+GY+MP6zyEnXp85Y2Ry1paJkdy/cAf8XVPrcBi1GNziDeZHJxt6qYtQ5oMjkzZd
/Fb6Kx7xN+qoyMkcZijtsJgZWgQk/EzsoeoR+aD5Zqz29HIprQUfWmGBcZ1/aIpw
PJeWm8VI9l4DYXun/5j0oB7BZB8DQbM9KGFDZfpndWdeCrrAZe5Uu4K4uX/otG5N
N5qXmEZVyO0=
=XH/S
-----END PGP SIGNATURE-----

--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh--
--
To unsubscribe from this list: send the line "unsubscribe linux-fsdevel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: NeilBrown <neilb () suse ! de>
To: linux-sparse
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:10:55 +0000
Message-ID: <20140801111055.59419950 () notabene ! brown>
--------------------
--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
wrote:

> Mark raid6_calls and other structures containing function pointers with
> __designated_init.  Fix implementations in lib/raid6/ to use designated
> initializers; this also simplifies those initializers using the default
> initialization of fields to 0.
>=20
> Signed-off-by: Josh Triplett <josh@joshtriplett.org>

Looks like an excellent idea!
Feel free to forward this upstream on my behalf, or remind me once the first
patch is in -next, and I'll take this one myself - whichever you prefer.

 Acked-by: NeilBrown <neilb@suse.de>

Thanks,
NeilBrown

> ---
>  include/linux/raid/pq.h    |  4 ++--
>  include/linux/raid/xor.h   |  2 +-
>  include/linux/raid_class.h |  2 +-
>  lib/raid6/altivec.uc       |  7 +++----
>  lib/raid6/avx2.c           | 24 ++++++++++++------------
>  lib/raid6/int.uc           |  6 ++----
>  lib/raid6/mmx.c            | 14 ++++++--------
>  lib/raid6/neon.c           |  7 +++----
>  lib/raid6/sse1.c           | 16 ++++++++--------
>  lib/raid6/sse2.c           | 24 ++++++++++++------------
>  lib/raid6/tilegx.uc        |  6 ++----
>  11 files changed, 52 insertions(+), 60 deletions(-)
>=20
> diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
> index 73069cb..2147bff 100644
> --- a/include/linux/raid/pq.h
> +++ b/include/linux/raid/pq.h
> @@ -75,7 +75,7 @@ struct raid6_calls {
>  	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
>  	const char *name;	/* Name of this routine set */
>  	int prefer;		/* Has special performance attribute */
> -};
> +} __designated_init;
> =20
>  /* Selected algorithm */
>  extern struct raid6_calls raid6_call;
> @@ -109,7 +109,7 @@ struct raid6_recov_calls {
>  	int  (*valid)(void);
>  	const char *name;
>  	int priority;
> -};
> +} __designated_init;
> =20
>  extern const struct raid6_recov_calls raid6_recov_intx1;
>  extern const struct raid6_recov_calls raid6_recov_ssse3;
> diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
> index 5a21095..c7df59f 100644
> --- a/include/linux/raid/xor.h
> +++ b/include/linux/raid/xor.h
> @@ -17,6 +17,6 @@ struct xor_block_template {
>  		     unsigned long *, unsigned long *);
>  	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
>  		     unsigned long *, unsigned long *, unsigned long *);
> -};
> +} __designated_init;
> =20
>  #endif
> diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
> index 31e1ff6..603af94 100644
> --- a/include/linux/raid_class.h
> +++ b/include/linux/raid_class.h
> @@ -16,7 +16,7 @@ struct raid_function_template {
>  	int (*is_raid)(struct device *);
>  	void (*get_resync)(struct device *);
>  	void (*get_state)(struct device *);
> -};
> +} __designated_init;
> =20
>  enum raid_state {
>  	RAID_STATE_UNKNOWN =3D 0,
> diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
> index 7cc12b5..4ff138c 100644
> --- a/lib/raid6/altivec.uc
> +++ b/lib/raid6/altivec.uc
> @@ -118,10 +118,9 @@ int raid6_have_altivec(void)
>  #endif
> =20
>  const struct raid6_calls raid6_altivec$# =3D {
> -	raid6_altivec$#_gen_syndrome,
> -	raid6_have_altivec,
> -	"altivecx$#",
> -	0
> +	.gen_syndrome =3D raid6_altivec$#_gen_syndrome,
> +	.valid =3D raid6_have_altivec,
> +	.name =3D "altivecx$#",
>  };
> =20
>  #endif /* CONFIG_ALTIVEC */
> diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
> index bc3b1dd..e56fa06 100644
> --- a/lib/raid6/avx2.c
> +++ b/lib/raid6/avx2.c
> @@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x1 =3D {
> -	raid6_avx21_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx21_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x2 =3D {
> -	raid6_avx22_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx22_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x4 =3D {
> -	raid6_avx24_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx24_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
>  #endif
> =20
> diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
> index 5b50f8d..35ad01a 100644
> --- a/lib/raid6/int.uc
> +++ b/lib/raid6/int.uc
> @@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size=
_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_intx$# =3D {
> -	raid6_int$#_gen_syndrome,
> -	NULL,		/* always valid */
> -	"int" NSTRING "x$#",
> -	0
> +	.gen_syndrome =3D raid6_int$#_gen_syndrome,
> +	.name =3D "int" NSTRING "x$#",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
> index 590c71c..cdd7d02 100644
> --- a/lib/raid6/mmx.c
> +++ b/lib/raid6/mmx.c
> @@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t =
bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx1 =3D {
> -	raid6_mmx1_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx1",
> -	0
> +	.gen_syndrome =3D raid6_mmx1_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx1",
>  };
> =20
>  /*
> @@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx2 =3D {
> -	raid6_mmx2_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx2",
> -	0
> +	.gen_syndrome =3D raid6_mmx2_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx2",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
> index 36ad470..99100dd 100644
> --- a/lib/raid6/neon.c
> +++ b/lib/raid6/neon.c
> @@ -41,10 +41,9 @@
>  		kernel_neon_end();					\
>  	}								\
>  	struct raid6_calls const raid6_neonx ## _n =3D {			\
> -		raid6_neon ## _n ## _gen_syndrome,			\
> -		raid6_have_neon,					\
> -		"neonx" #_n,						\
> -		0							\
> +		.gen_syndrome =3D raid6_neon ## _n ## _gen_syndrome,	\
> +		.valid =3D raid6_have_neon,				\
> +		.name =3D "neonx" #_n,					\
>  	}
> =20
>  static int raid6_have_neon(void)
> diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
> index f762971..a9de46e 100644
> --- a/lib/raid6/sse1.c
> +++ b/lib/raid6/sse1.c
> @@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x1 =3D {
> -	raid6_sse11_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse11_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x2 =3D {
> -	raid6_sse12_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse12_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif
> diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
> index 85b82c8..cd262518aa 100644
> --- a/lib/raid6/sse2.c
> +++ b/lib/raid6/sse2.c
> @@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x1 =3D {
> -	raid6_sse21_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse21_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x2 =3D {
> -	raid6_sse22_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse22_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x4 =3D {
> -	raid6_sse24_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse24_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif /* CONFIG_X86_64 */
> diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
> index e7c2945..3077722 100644
> --- a/lib/raid6/tilegx.uc
> +++ b/lib/raid6/tilegx.uc
> @@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t byte=
s, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_tilegx$# =3D {
> -	raid6_tilegx$#_gen_syndrome,
> -	NULL,
> -	"tilegx$#",
> -	0
> +	.gen_syndrome =3D raid6_tilegx$#_gen_syndrome,
> +	.name =3D "tilegx$#",
>  };


--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIVAwUBU9rpHznsnt1WYoG5AQKbPA/+OcPpQdH7YF9IW003H72axTgVavamvgQT
SvQCGc3EBeBlErW+49TBvvRadNe81X4Qz4SKhFZxcC5S2QJU/bETohcm/72Zm5HX
H79y1yWD2CIxYPOlPGCas0lLMY16w75vTQ/e7pTgk/ItNd5oRWaxvMNGoKhVk+e6
cmhtAO44uN1+J6pf5dsSnAi9tBXcE1PqvyOwodkguoY52SrY8hRPeICokrkPfInt
/2hB43PmTfKfYsGl6RwxIMGmQ31V8AzyZ6nkVzMzszw9DzKls+xDCYfteSp6KgtZ
5G04FeF7h/LKXo9llPgu/VwPcmR+5Si55N+KoQehyi+XuV4yTQYzE0LfhPf18PZg
5iBssYeGketzAWg54/aB9ZIpjfPmUA8diWjrIw0azUOoarutoKw9QUkA3pkJJndb
X4t+nwDZQy3xOcx/vPL7gWeHylapugyOSjZBHD9SE/Xa9ZsvRcI2RemFzoqdPsyK
6+GY+MP6zyEnXp85Y2Ry1paJkdy/cAf8XVPrcBi1GNziDeZHJxt6qYtQ5oMjkzZd
/Fb6Kx7xN+qoyMkcZijtsJgZWgQk/EzsoeoR+aD5Zqz29HIprQUfWmGBcZ1/aIpw
PJeWm8VI9l4DYXun/5j0oB7BZB8DQbM9KGFDZfpndWdeCrrAZe5Uu4K4uX/otG5N
N5qXmEZVyO0=
=XH/S
-----END PGP SIGNATURE-----

--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: NeilBrown <neilb () suse ! de>
To: linux-raid
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:10:55 +0000
Message-ID: <20140801111055.59419950 () notabene ! brown>
--------------------
--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
wrote:

> Mark raid6_calls and other structures containing function pointers with
> __designated_init.  Fix implementations in lib/raid6/ to use designated
> initializers; this also simplifies those initializers using the default
> initialization of fields to 0.
>=20
> Signed-off-by: Josh Triplett <josh@joshtriplett.org>

Looks like an excellent idea!
Feel free to forward this upstream on my behalf, or remind me once the first
patch is in -next, and I'll take this one myself - whichever you prefer.

 Acked-by: NeilBrown <neilb@suse.de>

Thanks,
NeilBrown

> ---
>  include/linux/raid/pq.h    |  4 ++--
>  include/linux/raid/xor.h   |  2 +-
>  include/linux/raid_class.h |  2 +-
>  lib/raid6/altivec.uc       |  7 +++----
>  lib/raid6/avx2.c           | 24 ++++++++++++------------
>  lib/raid6/int.uc           |  6 ++----
>  lib/raid6/mmx.c            | 14 ++++++--------
>  lib/raid6/neon.c           |  7 +++----
>  lib/raid6/sse1.c           | 16 ++++++++--------
>  lib/raid6/sse2.c           | 24 ++++++++++++------------
>  lib/raid6/tilegx.uc        |  6 ++----
>  11 files changed, 52 insertions(+), 60 deletions(-)
>=20
> diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
> index 73069cb..2147bff 100644
> --- a/include/linux/raid/pq.h
> +++ b/include/linux/raid/pq.h
> @@ -75,7 +75,7 @@ struct raid6_calls {
>  	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
>  	const char *name;	/* Name of this routine set */
>  	int prefer;		/* Has special performance attribute */
> -};
> +} __designated_init;
> =20
>  /* Selected algorithm */
>  extern struct raid6_calls raid6_call;
> @@ -109,7 +109,7 @@ struct raid6_recov_calls {
>  	int  (*valid)(void);
>  	const char *name;
>  	int priority;
> -};
> +} __designated_init;
> =20
>  extern const struct raid6_recov_calls raid6_recov_intx1;
>  extern const struct raid6_recov_calls raid6_recov_ssse3;
> diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
> index 5a21095..c7df59f 100644
> --- a/include/linux/raid/xor.h
> +++ b/include/linux/raid/xor.h
> @@ -17,6 +17,6 @@ struct xor_block_template {
>  		     unsigned long *, unsigned long *);
>  	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
>  		     unsigned long *, unsigned long *, unsigned long *);
> -};
> +} __designated_init;
> =20
>  #endif
> diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
> index 31e1ff6..603af94 100644
> --- a/include/linux/raid_class.h
> +++ b/include/linux/raid_class.h
> @@ -16,7 +16,7 @@ struct raid_function_template {
>  	int (*is_raid)(struct device *);
>  	void (*get_resync)(struct device *);
>  	void (*get_state)(struct device *);
> -};
> +} __designated_init;
> =20
>  enum raid_state {
>  	RAID_STATE_UNKNOWN =3D 0,
> diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
> index 7cc12b5..4ff138c 100644
> --- a/lib/raid6/altivec.uc
> +++ b/lib/raid6/altivec.uc
> @@ -118,10 +118,9 @@ int raid6_have_altivec(void)
>  #endif
> =20
>  const struct raid6_calls raid6_altivec$# =3D {
> -	raid6_altivec$#_gen_syndrome,
> -	raid6_have_altivec,
> -	"altivecx$#",
> -	0
> +	.gen_syndrome =3D raid6_altivec$#_gen_syndrome,
> +	.valid =3D raid6_have_altivec,
> +	.name =3D "altivecx$#",
>  };
> =20
>  #endif /* CONFIG_ALTIVEC */
> diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
> index bc3b1dd..e56fa06 100644
> --- a/lib/raid6/avx2.c
> +++ b/lib/raid6/avx2.c
> @@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x1 =3D {
> -	raid6_avx21_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx21_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x2 =3D {
> -	raid6_avx22_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx22_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x4 =3D {
> -	raid6_avx24_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx24_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
>  #endif
> =20
> diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
> index 5b50f8d..35ad01a 100644
> --- a/lib/raid6/int.uc
> +++ b/lib/raid6/int.uc
> @@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size=
_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_intx$# =3D {
> -	raid6_int$#_gen_syndrome,
> -	NULL,		/* always valid */
> -	"int" NSTRING "x$#",
> -	0
> +	.gen_syndrome =3D raid6_int$#_gen_syndrome,
> +	.name =3D "int" NSTRING "x$#",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
> index 590c71c..cdd7d02 100644
> --- a/lib/raid6/mmx.c
> +++ b/lib/raid6/mmx.c
> @@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t =
bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx1 =3D {
> -	raid6_mmx1_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx1",
> -	0
> +	.gen_syndrome =3D raid6_mmx1_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx1",
>  };
> =20
>  /*
> @@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx2 =3D {
> -	raid6_mmx2_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx2",
> -	0
> +	.gen_syndrome =3D raid6_mmx2_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx2",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
> index 36ad470..99100dd 100644
> --- a/lib/raid6/neon.c
> +++ b/lib/raid6/neon.c
> @@ -41,10 +41,9 @@
>  		kernel_neon_end();					\
>  	}								\
>  	struct raid6_calls const raid6_neonx ## _n =3D {			\
> -		raid6_neon ## _n ## _gen_syndrome,			\
> -		raid6_have_neon,					\
> -		"neonx" #_n,						\
> -		0							\
> +		.gen_syndrome =3D raid6_neon ## _n ## _gen_syndrome,	\
> +		.valid =3D raid6_have_neon,				\
> +		.name =3D "neonx" #_n,					\
>  	}
> =20
>  static int raid6_have_neon(void)
> diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
> index f762971..a9de46e 100644
> --- a/lib/raid6/sse1.c
> +++ b/lib/raid6/sse1.c
> @@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x1 =3D {
> -	raid6_sse11_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse11_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x2 =3D {
> -	raid6_sse12_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse12_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif
> diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
> index 85b82c8..cd262518aa 100644
> --- a/lib/raid6/sse2.c
> +++ b/lib/raid6/sse2.c
> @@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x1 =3D {
> -	raid6_sse21_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse21_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x2 =3D {
> -	raid6_sse22_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse22_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x4 =3D {
> -	raid6_sse24_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse24_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif /* CONFIG_X86_64 */
> diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
> index e7c2945..3077722 100644
> --- a/lib/raid6/tilegx.uc
> +++ b/lib/raid6/tilegx.uc
> @@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t byte=
s, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_tilegx$# =3D {
> -	raid6_tilegx$#_gen_syndrome,
> -	NULL,
> -	"tilegx$#",
> -	0
> +	.gen_syndrome =3D raid6_tilegx$#_gen_syndrome,
> +	.name =3D "tilegx$#",
>  };


--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIVAwUBU9rpHznsnt1WYoG5AQKbPA/+OcPpQdH7YF9IW003H72axTgVavamvgQT
SvQCGc3EBeBlErW+49TBvvRadNe81X4Qz4SKhFZxcC5S2QJU/bETohcm/72Zm5HX
H79y1yWD2CIxYPOlPGCas0lLMY16w75vTQ/e7pTgk/ItNd5oRWaxvMNGoKhVk+e6
cmhtAO44uN1+J6pf5dsSnAi9tBXcE1PqvyOwodkguoY52SrY8hRPeICokrkPfInt
/2hB43PmTfKfYsGl6RwxIMGmQ31V8AzyZ6nkVzMzszw9DzKls+xDCYfteSp6KgtZ
5G04FeF7h/LKXo9llPgu/VwPcmR+5Si55N+KoQehyi+XuV4yTQYzE0LfhPf18PZg
5iBssYeGketzAWg54/aB9ZIpjfPmUA8diWjrIw0azUOoarutoKw9QUkA3pkJJndb
X4t+nwDZQy3xOcx/vPL7gWeHylapugyOSjZBHD9SE/Xa9ZsvRcI2RemFzoqdPsyK
6+GY+MP6zyEnXp85Y2Ry1paJkdy/cAf8XVPrcBi1GNziDeZHJxt6qYtQ5oMjkzZd
/Fb6Kx7xN+qoyMkcZijtsJgZWgQk/EzsoeoR+aD5Zqz29HIprQUfWmGBcZ1/aIpw
PJeWm8VI9l4DYXun/5j0oB7BZB8DQbM9KGFDZfpndWdeCrrAZe5Uu4K4uX/otG5N
N5qXmEZVyO0=
=XH/S
-----END PGP SIGNATURE-----

--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh--
--
To unsubscribe from this list: send the line "unsubscribe linux-raid" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: NeilBrown <neilb () suse ! de>
To: linux-api
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:10:55 +0000
Message-ID: <20140801111055.59419950 () notabene ! brown>
--------------------
--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: quoted-printable

On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
wrote:

> Mark raid6_calls and other structures containing function pointers with
> __designated_init.  Fix implementations in lib/raid6/ to use designated
> initializers; this also simplifies those initializers using the default
> initialization of fields to 0.
>=20
> Signed-off-by: Josh Triplett <josh@joshtriplett.org>

Looks like an excellent idea!
Feel free to forward this upstream on my behalf, or remind me once the first
patch is in -next, and I'll take this one myself - whichever you prefer.

 Acked-by: NeilBrown <neilb@suse.de>

Thanks,
NeilBrown

> ---
>  include/linux/raid/pq.h    |  4 ++--
>  include/linux/raid/xor.h   |  2 +-
>  include/linux/raid_class.h |  2 +-
>  lib/raid6/altivec.uc       |  7 +++----
>  lib/raid6/avx2.c           | 24 ++++++++++++------------
>  lib/raid6/int.uc           |  6 ++----
>  lib/raid6/mmx.c            | 14 ++++++--------
>  lib/raid6/neon.c           |  7 +++----
>  lib/raid6/sse1.c           | 16 ++++++++--------
>  lib/raid6/sse2.c           | 24 ++++++++++++------------
>  lib/raid6/tilegx.uc        |  6 ++----
>  11 files changed, 52 insertions(+), 60 deletions(-)
>=20
> diff --git a/include/linux/raid/pq.h b/include/linux/raid/pq.h
> index 73069cb..2147bff 100644
> --- a/include/linux/raid/pq.h
> +++ b/include/linux/raid/pq.h
> @@ -75,7 +75,7 @@ struct raid6_calls {
>  	int  (*valid)(void);	/* Returns 1 if this routine set is usable */
>  	const char *name;	/* Name of this routine set */
>  	int prefer;		/* Has special performance attribute */
> -};
> +} __designated_init;
> =20
>  /* Selected algorithm */
>  extern struct raid6_calls raid6_call;
> @@ -109,7 +109,7 @@ struct raid6_recov_calls {
>  	int  (*valid)(void);
>  	const char *name;
>  	int priority;
> -};
> +} __designated_init;
> =20
>  extern const struct raid6_recov_calls raid6_recov_intx1;
>  extern const struct raid6_recov_calls raid6_recov_ssse3;
> diff --git a/include/linux/raid/xor.h b/include/linux/raid/xor.h
> index 5a21095..c7df59f 100644
> --- a/include/linux/raid/xor.h
> +++ b/include/linux/raid/xor.h
> @@ -17,6 +17,6 @@ struct xor_block_template {
>  		     unsigned long *, unsigned long *);
>  	void (*do_5)(unsigned long, unsigned long *, unsigned long *,
>  		     unsigned long *, unsigned long *, unsigned long *);
> -};
> +} __designated_init;
> =20
>  #endif
> diff --git a/include/linux/raid_class.h b/include/linux/raid_class.h
> index 31e1ff6..603af94 100644
> --- a/include/linux/raid_class.h
> +++ b/include/linux/raid_class.h
> @@ -16,7 +16,7 @@ struct raid_function_template {
>  	int (*is_raid)(struct device *);
>  	void (*get_resync)(struct device *);
>  	void (*get_state)(struct device *);
> -};
> +} __designated_init;
> =20
>  enum raid_state {
>  	RAID_STATE_UNKNOWN =3D 0,
> diff --git a/lib/raid6/altivec.uc b/lib/raid6/altivec.uc
> index 7cc12b5..4ff138c 100644
> --- a/lib/raid6/altivec.uc
> +++ b/lib/raid6/altivec.uc
> @@ -118,10 +118,9 @@ int raid6_have_altivec(void)
>  #endif
> =20
>  const struct raid6_calls raid6_altivec$# =3D {
> -	raid6_altivec$#_gen_syndrome,
> -	raid6_have_altivec,
> -	"altivecx$#",
> -	0
> +	.gen_syndrome =3D raid6_altivec$#_gen_syndrome,
> +	.valid =3D raid6_have_altivec,
> +	.name =3D "altivecx$#",
>  };
> =20
>  #endif /* CONFIG_ALTIVEC */
> diff --git a/lib/raid6/avx2.c b/lib/raid6/avx2.c
> index bc3b1dd..e56fa06 100644
> --- a/lib/raid6/avx2.c
> +++ b/lib/raid6/avx2.c
> @@ -88,10 +88,10 @@ static void raid6_avx21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x1 =3D {
> -	raid6_avx21_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx21_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -149,10 +149,10 @@ static void raid6_avx22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x2 =3D {
> -	raid6_avx22_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx22_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -241,10 +241,10 @@ static void raid6_avx24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_avx2x4 =3D {
> -	raid6_avx24_gen_syndrome,
> -	raid6_have_avx2,
> -	"avx2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_avx24_gen_syndrome,
> +	.valid =3D raid6_have_avx2,
> +	.name =3D "avx2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
>  #endif
> =20
> diff --git a/lib/raid6/int.uc b/lib/raid6/int.uc
> index 5b50f8d..35ad01a 100644
> --- a/lib/raid6/int.uc
> +++ b/lib/raid6/int.uc
> @@ -108,10 +108,8 @@ static void raid6_int$#_gen_syndrome(int disks, size=
_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_intx$# =3D {
> -	raid6_int$#_gen_syndrome,
> -	NULL,		/* always valid */
> -	"int" NSTRING "x$#",
> -	0
> +	.gen_syndrome =3D raid6_int$#_gen_syndrome,
> +	.name =3D "int" NSTRING "x$#",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/mmx.c b/lib/raid6/mmx.c
> index 590c71c..cdd7d02 100644
> --- a/lib/raid6/mmx.c
> +++ b/lib/raid6/mmx.c
> @@ -75,10 +75,9 @@ static void raid6_mmx1_gen_syndrome(int disks, size_t =
bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx1 =3D {
> -	raid6_mmx1_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx1",
> -	0
> +	.gen_syndrome =3D raid6_mmx1_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx1",
>  };
> =20
>  /*
> @@ -133,10 +132,9 @@ static void raid6_mmx2_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_mmxx2 =3D {
> -	raid6_mmx2_gen_syndrome,
> -	raid6_have_mmx,
> -	"mmxx2",
> -	0
> +	.gen_syndrome =3D raid6_mmx2_gen_syndrome,
> +	.valid =3D raid6_have_mmx,
> +	.name =3D "mmxx2",
>  };
> =20
>  #endif
> diff --git a/lib/raid6/neon.c b/lib/raid6/neon.c
> index 36ad470..99100dd 100644
> --- a/lib/raid6/neon.c
> +++ b/lib/raid6/neon.c
> @@ -41,10 +41,9 @@
>  		kernel_neon_end();					\
>  	}								\
>  	struct raid6_calls const raid6_neonx ## _n =3D {			\
> -		raid6_neon ## _n ## _gen_syndrome,			\
> -		raid6_have_neon,					\
> -		"neonx" #_n,						\
> -		0							\
> +		.gen_syndrome =3D raid6_neon ## _n ## _gen_syndrome,	\
> +		.valid =3D raid6_have_neon,				\
> +		.name =3D "neonx" #_n,					\
>  	}
> =20
>  static int raid6_have_neon(void)
> diff --git a/lib/raid6/sse1.c b/lib/raid6/sse1.c
> index f762971..a9de46e 100644
> --- a/lib/raid6/sse1.c
> +++ b/lib/raid6/sse1.c
> @@ -91,10 +91,10 @@ static void raid6_sse11_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x1 =3D {
> -	raid6_sse11_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse11_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -153,10 +153,10 @@ static void raid6_sse12_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse1x2 =3D {
> -	raid6_sse12_gen_syndrome,
> -	raid6_have_sse1_or_mmxext,
> -	"sse1x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse12_gen_syndrome,
> +	.valid =3D raid6_have_sse1_or_mmxext,
> +	.name =3D "sse1x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif
> diff --git a/lib/raid6/sse2.c b/lib/raid6/sse2.c
> index 85b82c8..cd262518aa 100644
> --- a/lib/raid6/sse2.c
> +++ b/lib/raid6/sse2.c
> @@ -89,10 +89,10 @@ static void raid6_sse21_gen_syndrome(int disks, size_=
t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x1 =3D {
> -	raid6_sse21_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x1",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse21_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x1",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  /*
> @@ -151,10 +151,10 @@ static void raid6_sse22_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x2 =3D {
> -	raid6_sse22_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x2",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse22_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x2",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #ifdef CONFIG_X86_64
> @@ -249,10 +249,10 @@ static void raid6_sse24_gen_syndrome(int disks, siz=
e_t bytes, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_sse2x4 =3D {
> -	raid6_sse24_gen_syndrome,
> -	raid6_have_sse2,
> -	"sse2x4",
> -	1			/* Has cache hints */
> +	.gen_syndrome =3D raid6_sse24_gen_syndrome,
> +	.valid =3D raid6_have_sse2,
> +	.name =3D "sse2x4",
> +	.prefer =3D 1,		/* Has cache hints */
>  };
> =20
>  #endif /* CONFIG_X86_64 */
> diff --git a/lib/raid6/tilegx.uc b/lib/raid6/tilegx.uc
> index e7c2945..3077722 100644
> --- a/lib/raid6/tilegx.uc
> +++ b/lib/raid6/tilegx.uc
> @@ -79,8 +79,6 @@ void raid6_tilegx$#_gen_syndrome(int disks, size_t byte=
s, void **ptrs)
>  }
> =20
>  const struct raid6_calls raid6_tilegx$# =3D {
> -	raid6_tilegx$#_gen_syndrome,
> -	NULL,
> -	"tilegx$#",
> -	0
> +	.gen_syndrome =3D raid6_tilegx$#_gen_syndrome,
> +	.name =3D "tilegx$#",
>  };


--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh
Content-Type: application/pgp-signature; name=signature.asc
Content-Disposition: attachment; filename=signature.asc

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIVAwUBU9rpHznsnt1WYoG5AQKbPA/+OcPpQdH7YF9IW003H72axTgVavamvgQT
SvQCGc3EBeBlErW+49TBvvRadNe81X4Qz4SKhFZxcC5S2QJU/bETohcm/72Zm5HX
H79y1yWD2CIxYPOlPGCas0lLMY16w75vTQ/e7pTgk/ItNd5oRWaxvMNGoKhVk+e6
cmhtAO44uN1+J6pf5dsSnAi9tBXcE1PqvyOwodkguoY52SrY8hRPeICokrkPfInt
/2hB43PmTfKfYsGl6RwxIMGmQ31V8AzyZ6nkVzMzszw9DzKls+xDCYfteSp6KgtZ
5G04FeF7h/LKXo9llPgu/VwPcmR+5Si55N+KoQehyi+XuV4yTQYzE0LfhPf18PZg
5iBssYeGketzAWg54/aB9ZIpjfPmUA8diWjrIw0azUOoarutoKw9QUkA3pkJJndb
X4t+nwDZQy3xOcx/vPL7gWeHylapugyOSjZBHD9SE/Xa9ZsvRcI2RemFzoqdPsyK
6+GY+MP6zyEnXp85Y2Ry1paJkdy/cAf8XVPrcBi1GNziDeZHJxt6qYtQ5oMjkzZd
/Fb6Kx7xN+qoyMkcZijtsJgZWgQk/EzsoeoR+aD5Zqz29HIprQUfWmGBcZ1/aIpw
PJeWm8VI9l4DYXun/5j0oB7BZB8DQbM9KGFDZfpndWdeCrrAZe5Uu4K4uX/otG5N
N5qXmEZVyO0=
=XH/S
-----END PGP SIGNATURE-----

--Sig_/M7cuTxQ/DXhWJ+vQv/kDnyh--
--
To unsubscribe from this list: send the line "unsubscribe linux-api" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-fsdevel
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:30:30 +0000
Message-ID: <20140801013030.GA20935 () thin>
--------------------
On Fri, Aug 01, 2014 at 11:10:55AM +1000, NeilBrown wrote:
> On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
> wrote:
> 
> > Mark raid6_calls and other structures containing function pointers with
> > __designated_init.  Fix implementations in lib/raid6/ to use designated
> > initializers; this also simplifies those initializers using the default
> > initialization of fields to 0.
> > 
> > Signed-off-by: Josh Triplett <josh@joshtriplett.org>
> 
> Looks like an excellent idea!
> Feel free to forward this upstream on my behalf, or remind me once the first
> patch is in -next, and I'll take this one myself - whichever you prefer.
> 
>  Acked-by: NeilBrown <neilb@suse.de>

Thanks!  Ideally, I'd like to see the whole series go in through one
tree, which is why I CCed Andrew.  I can easily produce several dozen
more patches like these, but I just included enough examples to motivate
patch 1, and I can send more in any order once that one goes in.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-fsdevel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:30:30 +0000
Message-ID: <20140801013030.GA20935 () thin>
--------------------
On Fri, Aug 01, 2014 at 11:10:55AM +1000, NeilBrown wrote:
> On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
> wrote:
> 
> > Mark raid6_calls and other structures containing function pointers with
> > __designated_init.  Fix implementations in lib/raid6/ to use designated
> > initializers; this also simplifies those initializers using the default
> > initialization of fields to 0.
> > 
> > Signed-off-by: Josh Triplett <josh@joshtriplett.org>
> 
> Looks like an excellent idea!
> Feel free to forward this upstream on my behalf, or remind me once the first
> patch is in -next, and I'll take this one myself - whichever you prefer.
> 
>  Acked-by: NeilBrown <neilb@suse.de>

Thanks!  Ideally, I'd like to see the whole series go in through one
tree, which is why I CCed Andrew.  I can easily produce several dozen
more patches like these, but I just included enough examples to motivate
patch 1, and I can send more in any order once that one goes in.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-raid
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:30:30 +0000
Message-ID: <20140801013030.GA20935 () thin>
--------------------
On Fri, Aug 01, 2014 at 11:10:55AM +1000, NeilBrown wrote:
> On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
> wrote:
> 
> > Mark raid6_calls and other structures containing function pointers with
> > __designated_init.  Fix implementations in lib/raid6/ to use designated
> > initializers; this also simplifies those initializers using the default
> > initialization of fields to 0.
> > 
> > Signed-off-by: Josh Triplett <josh@joshtriplett.org>
> 
> Looks like an excellent idea!
> Feel free to forward this upstream on my behalf, or remind me once the first
> patch is in -next, and I'll take this one myself - whichever you prefer.
> 
>  Acked-by: NeilBrown <neilb@suse.de>

Thanks!  Ideally, I'd like to see the whole series go in through one
tree, which is why I CCed Andrew.  I can easily produce several dozen
more patches like these, but I just included enough examples to motivate
patch 1, and I can send more in any order once that one goes in.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-raid" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kbuild
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:30:30 +0000
Message-ID: <20140801013030.GA20935 () thin>
--------------------
On Fri, Aug 01, 2014 at 11:10:55AM +1000, NeilBrown wrote:
> On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
> wrote:
> 
> > Mark raid6_calls and other structures containing function pointers with
> > __designated_init.  Fix implementations in lib/raid6/ to use designated
> > initializers; this also simplifies those initializers using the default
> > initialization of fields to 0.
> > 
> > Signed-off-by: Josh Triplett <josh@joshtriplett.org>
> 
> Looks like an excellent idea!
> Feel free to forward this upstream on my behalf, or remind me once the first
> patch is in -next, and I'll take this one myself - whichever you prefer.
> 
>  Acked-by: NeilBrown <neilb@suse.de>

Thanks!  Ideally, I'd like to see the whole series go in through one
tree, which is why I CCed Andrew.  I can easily produce several dozen
more patches like these, but I just included enough examples to motivate
patch 1, and I can send more in any order once that one goes in.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-kbuild" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-api
Subject: Re: [PATCH 2/5] raid: Require designated initialization of structures
Date: Fri, 01 Aug 2014 01:30:30 +0000
Message-ID: <20140801013030.GA20935 () thin>
--------------------
On Fri, Aug 01, 2014 at 11:10:55AM +1000, NeilBrown wrote:
> On Thu, 31 Jul 2014 16:47:35 -0700 Josh Triplett <josh@joshtriplett.org>
> wrote:
> 
> > Mark raid6_calls and other structures containing function pointers with
> > __designated_init.  Fix implementations in lib/raid6/ to use designated
> > initializers; this also simplifies those initializers using the default
> > initialization of fields to 0.
> > 
> > Signed-off-by: Josh Triplett <josh@joshtriplett.org>
> 
> Looks like an excellent idea!
> Feel free to forward this upstream on my behalf, or remind me once the first
> patch is in -next, and I'll take this one myself - whichever you prefer.
> 
>  Acked-by: NeilBrown <neilb@suse.de>

Thanks!  Ideally, I'd like to see the whole series go in through one
tree, which is why I CCed Andrew.  I can easily produce several dozen
more patches like these, but I just included enough examples to motivate
patch 1, and I can send more in any order once that one goes in.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-api" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/4] parse.c: remove duplicate 'may_alias' ignored_attributes ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 3/4] parse.c: remove duplicate 'may_alias' ignored_attributes
Date: Sat, 11 Oct 2014 19:58:14 +0000
Message-ID: <54398BD6.6070908 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 parse.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/parse.c b/parse.c
index 896420b..b43d683 100644
--- a/parse.c
+++ b/parse.c
@@ -548,8 +548,6 @@ const char *ignored_attributes[] = {
 	"__l1_data__",
 	"l2",
 	"__l2__",
-	"may_alias",
-	"__may_alias__",
 	"malloc",
 	"__malloc__",
 	"may_alias",
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/5] fs: Require designated initialization of structures ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH 3/5] fs: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:46 +0000
Message-ID: <4f1751d0f5c25be383d09272d05dc7b24ea4f577.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark various filesystem structures with __designated_init.  Fix the one
and only instance of positional initialization of those structures.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 fs/ioctl.c         |  2 +-
 include/linux/fs.h | 45 +++++++++++++++++++++++----------------------
 2 files changed, 24 insertions(+), 23 deletions(-)

diff --git a/fs/ioctl.c b/fs/ioctl.c
index 8ac3fad..2151968 100644
--- a/fs/ioctl.c
+++ b/fs/ioctl.c
@@ -174,7 +174,7 @@ static int ioctl_fiemap(struct file *filp, unsigned long arg)
 {
 	struct fiemap fiemap;
 	struct fiemap __user *ufiemap = (struct fiemap __user *) arg;
-	struct fiemap_extent_info fieinfo = { 0, };
+	struct fiemap_extent_info fieinfo = { };
 	struct inode *inode = file_inode(filp);
 	struct super_block *sb = inode->i_sb;
 	u64 len;
diff --git a/include/linux/fs.h b/include/linux/fs.h
index e11d60c..cec614b 100644
--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -366,7 +366,7 @@ struct address_space_operations {
 	int (*swap_activate)(struct swap_info_struct *sis, struct file *file,
 				sector_t *span);
 	void (*swap_deactivate)(struct file *file);
-};
+} __designated_init;
 
 extern const struct address_space_operations empty_aops;
 
@@ -401,7 +401,7 @@ struct address_space {
 	spinlock_t		private_lock;	/* for use by the address_space */
 	struct list_head	private_list;	/* ditto */
 	void			*private_data;	/* ditto */
-} __attribute__((aligned(sizeof(long))));
+} __designated_init __attribute__((aligned(sizeof(long))));
 	/*
 	 * On most architectures that alignment is already the case; but
 	 * must be enforced here for CRIS, to let the least significant bit
@@ -444,7 +444,7 @@ struct block_device {
 	int			bd_fsfreeze_count;
 	/* Mutex for freeze */
 	struct mutex		bd_fsfreeze_mutex;
-};
+} __designated_init;
 
 /*
  * Radix-tree tags, for tagging dirty and writeback pages within the pagecache
@@ -588,7 +588,7 @@ struct inode {
 #endif
 
 	void			*i_private; /* fs or device private pointer */
-};
+} __designated_init;
 
 static inline int inode_unhashed(struct inode *inode)
 {
@@ -719,7 +719,7 @@ struct fown_struct {
 	enum pid_type pid_type;	/* Kind of process group SIGIO should be sent to */
 	kuid_t uid, euid;	/* uid/euid of process setting the owner */
 	int signum;		/* posix.1b rt signal to be delivered on IO */
-};
+} __designated_init;
 
 /*
  * Track a single file's readahead state
@@ -733,7 +733,7 @@ struct file_ra_state {
 	unsigned int ra_pages;		/* Maximum readahead window */
 	unsigned int mmap_miss;		/* Cache miss stat for mmap accesses */
 	loff_t prev_pos;		/* Cache last read() position */
-};
+} __designated_init;
 
 /*
  * Check if @index falls in the readahead windows.
@@ -781,14 +781,15 @@ struct file {
 	struct list_head	f_tfile_llink;
 #endif /* #ifdef CONFIG_EPOLL */
 	struct address_space	*f_mapping;
-} __attribute__((aligned(4)));	/* lest something weird decides that 2 is OK */
+} __designated_init __attribute__((aligned(4)));
+/* lest something weird decides that 2 is OK */
 
 struct file_handle {
 	__u32 handle_bytes;
 	int handle_type;
 	/* file identifier */
 	unsigned char f_handle[0];
-};
+} __designated_init;
 
 static inline struct file *get_file(struct file *f)
 {
@@ -838,7 +839,7 @@ typedef struct files_struct *fl_owner_t;
 struct file_lock_operations {
 	void (*fl_copy_lock)(struct file_lock *, struct file_lock *);
 	void (*fl_release_private)(struct file_lock *);
-};
+} __designated_init;
 
 struct lock_manager_operations {
 	int (*lm_compare_owner)(struct file_lock *, struct file_lock *);
@@ -847,7 +848,7 @@ struct lock_manager_operations {
 	int (*lm_grant)(struct file_lock *, struct file_lock *, int);
 	void (*lm_break)(struct file_lock *);
 	int (*lm_change)(struct file_lock **, int);
-};
+} __designated_init;
 
 struct lock_manager {
 	struct list_head list;
@@ -909,7 +910,7 @@ struct file_lock {
 			int state;		/* state of grant or error if -ve */
 		} afs;
 	} fl_u;
-};
+} __designated_init;
 
 /* The following constant reflects the upper bound of the file/locking space */
 #ifndef OFFSET_MAX
@@ -1112,7 +1113,7 @@ struct fasync_struct {
 	struct fasync_struct	*fa_next; /* singly linked list */
 	struct file		*fa_file;
 	struct rcu_head		fa_rcu;
-};
+} __designated_init;
 
 #define FASYNC_MAGIC 0x4601
 
@@ -1170,7 +1171,7 @@ struct sb_writers {
 #ifdef CONFIG_DEBUG_LOCK_ALLOC
 	struct lockdep_map	lock_map[SB_FREEZE_LEVELS];
 #endif
-};
+} __designated_init;
 
 struct super_block {
 	struct list_head	s_list;		/* Keep this first */
@@ -1258,7 +1259,7 @@ struct super_block {
 	struct list_lru		s_dentry_lru ____cacheline_aligned_in_smp;
 	struct list_lru		s_inode_lru ____cacheline_aligned_in_smp;
 	struct rcu_head		rcu;
-};
+} __designated_init;
 
 extern struct timespec current_fs_time(struct super_block *sb);
 
@@ -1410,7 +1411,7 @@ struct fiemap_extent_info {
 	unsigned int fi_extents_max;	/* Size of fiemap_extent array */
 	struct fiemap_extent __user *fi_extents_start; /* Start of
 							fiemap_extent array */
-};
+} __designated_init;
 int fiemap_fill_next_extent(struct fiemap_extent_info *info, u64 logical,
 			    u64 phys, u64 len, u32 flags);
 int fiemap_check_flags(struct fiemap_extent_info *fieinfo, u32 fs_flags);
@@ -1441,7 +1442,7 @@ typedef int (*filldir_t)(void *, const char *, int, loff_t, u64, unsigned);
 struct dir_context {
 	const filldir_t actor;
 	loff_t pos;
-};
+} __designated_init;
 
 struct block_device_operations;
 
@@ -1484,7 +1485,7 @@ struct file_operations {
 	long (*fallocate)(struct file *file, int mode, loff_t offset,
 			  loff_t len);
 	int (*show_fdinfo)(struct seq_file *m, struct file *f);
-};
+} __designated_init;
 
 struct inode_operations {
 	struct dentry * (*lookup) (struct inode *,struct dentry *, unsigned int);
@@ -1520,7 +1521,7 @@ struct inode_operations {
 			   umode_t create_mode, int *opened);
 	int (*tmpfile) (struct inode *, struct dentry *, umode_t);
 	int (*set_acl)(struct inode *, struct posix_acl *, int);
-} ____cacheline_aligned;
+} __designated_init ____cacheline_aligned;
 
 ssize_t rw_copy_check_uvector(int type, const struct iovec __user * uvector,
 			      unsigned long nr_segs, unsigned long fast_segs,
@@ -1561,7 +1562,7 @@ struct super_operations {
 	int (*bdev_try_to_free_page)(struct super_block*, struct page*, gfp_t);
 	long (*nr_cached_objects)(struct super_block *, int);
 	long (*free_cached_objects)(struct super_block *, long, int);
-};
+} __designated_init;
 
 /*
  * Inode flags - they have no relation to superblock flags now
@@ -1771,7 +1772,7 @@ struct file_system_type {
 	struct lock_class_key i_lock_key;
 	struct lock_class_key i_mutex_key;
 	struct lock_class_key i_mutex_dir_key;
-};
+} __designated_init;
 
 #define MODULE_ALIAS_FS(NAME) MODULE_ALIAS("fs-" NAME)
 
@@ -2018,7 +2019,7 @@ struct filename {
 	const __user char	*uptr;	/* original userland pointer */
 	struct audit_names	*aname;
 	bool			separate; /* should "name" be freed? */
-};
+} __designated_init;
 
 extern long vfs_truncate(struct path *, loff_t);
 extern int do_truncate(struct dentry *, loff_t start, unsigned int time_attrs,
@@ -2647,7 +2648,7 @@ static inline ino_t parent_ino(struct dentry *dentry)
 struct simple_transaction_argresp {
 	ssize_t size;
 	char data[0];
-};
+} __designated_init;
 
 #define SIMPLE_TRANSACTION_LIMIT (PAGE_SIZE - sizeof(struct simple_transaction_argresp))
 
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/5] kbuild: LLVMLinux: Fix LINUX_COMPILER definition script for compilation with clang ===

From: behanw () converseincode ! com
To: linux-sparse
Subject: [PATCH 3/5] kbuild: LLVMLinux: Fix LINUX_COMPILER definition script for compilation with clang
Date: Wed, 26 Feb 2014 01:08:41 +0000
Message-ID: <1393376923-21892-4-git-send-email-behanw () converseincode ! com>
--------------------
From: Jan-Simon Mller <dl9pf@gmx.de>

When building the LINUX_COMPILER definition, instead of merely taking the last
line from "$(CC) -v", grep for ' version ' in the output. This supports both
gcc and clang.

Signed-off-by: Jan-Simon Mller <dl9pf@gmx.de>
Signed-off-by: Behan Webster <behanw@converseincode.com>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
Cc: PaX Team <pageexec@freemail.hu>
---
 scripts/mkcompile_h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/scripts/mkcompile_h b/scripts/mkcompile_h
index f221ddf..cfb8440 100755
--- a/scripts/mkcompile_h
+++ b/scripts/mkcompile_h
@@ -76,7 +76,7 @@ UTS_TRUNCATE="cut -b -$UTS_LEN"
   echo \#define LINUX_COMPILE_BY \"`echo $LINUX_COMPILE_BY | $UTS_TRUNCATE`\"
   echo \#define LINUX_COMPILE_HOST \"`echo $LINUX_COMPILE_HOST | $UTS_TRUNCATE`\"
 
-  echo \#define LINUX_COMPILER \"`$CC -v 2>&1 | tail -n 1`\"
+  echo \#define LINUX_COMPILER \"`$CC -v 2>&1 | grep ' version '`\"
 ) > .tmpcompile
 
 # Only replace the real compile.h if the new one is different,
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 3/7] atomic: Silence nested-externs warnings ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: [PATCH 3/7] atomic: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:36 +0000
Message-ID: <1411140580-20909-4-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Silence the nested-externs warnings for these, as they are
truly wanted.

CC: Peter Zijlstra <peterz@infradead.org>
CC: Ingo Molnar <mingo@kernel.org>
CC: "Paul E. McKenney" <paulmck@linux.vnet.ibm.com>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/atomic.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/include/linux/atomic.h b/include/linux/atomic.h
index fef3a80..81c7ad4 100644
--- a/include/linux/atomic.h
+++ b/include/linux/atomic.h
@@ -7,6 +7,7 @@
  * Provide __deprecated wrappers for the new interface, avoid flag day changes.
  * We need the ugly external functions to break header recursion hell.
  */
+DIAG_PUSH DIAG_IGNORE(nested-externs)
 #ifndef smp_mb__before_atomic_inc
 static inline void __deprecated smp_mb__before_atomic_inc(void)
 {
@@ -38,6 +39,7 @@ static inline void __deprecated smp_mb__after_atomic_dec(void)
 	__smp_mb__after_atomic();
 }
 #endif
+DIAG_POP
 
 /**
  * atomic_add_unless - add unless the number is already a given value
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-kernel
Subject: [PATCH 3/7] atomic: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:36 +0000
Message-ID: <1411140580-20909-4-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Silence the nested-externs warnings for these, as they are
truly wanted.

CC: Peter Zijlstra <peterz@infradead.org>
CC: Ingo Molnar <mingo@kernel.org>
CC: "Paul E. McKenney" <paulmck@linux.vnet.ibm.com>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/atomic.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/include/linux/atomic.h b/include/linux/atomic.h
index fef3a80..81c7ad4 100644
--- a/include/linux/atomic.h
+++ b/include/linux/atomic.h
@@ -7,6 +7,7 @@
  * Provide __deprecated wrappers for the new interface, avoid flag day changes.
  * We need the ugly external functions to break header recursion hell.
  */
+DIAG_PUSH DIAG_IGNORE(nested-externs)
 #ifndef smp_mb__before_atomic_inc
 static inline void __deprecated smp_mb__before_atomic_inc(void)
 {
@@ -38,6 +39,7 @@ static inline void __deprecated smp_mb__after_atomic_dec(void)
 	__smp_mb__after_atomic();
 }
 #endif
+DIAG_POP
 
 /**
  * atomic_add_unless - add unless the number is already a given value
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-kernel
Subject: Re: [PATCH 3/7] atomic: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 20:43:03 +0000
Message-ID: <20140919204303.GF2832 () worktop ! localdomain>
--------------------
On Fri, Sep 19, 2014 at 08:29:36AM -0700, Jeff Kirsher wrote:
> From: Mark Rustad <mark.d.rustad@intel.com>
> 
> Silence the nested-externs warnings for these, as they are
> truly wanted.
> 

You're patching an old tree.

---
commit 2e39465abc4b7856a0ea6fcf4f6b4668bb5db877
Author: Peter Zijlstra <peterz@infradead.org>
Date:   Mon Aug 4 12:07:15 2014 +0200

    locking: Remove deprecated smp_mb__() barriers
    
    Its been a while and there are no in-tree users left, so remove the
    deprecated barriers.
    
    Signed-off-by: Peter Zijlstra <peterz@infradead.org>
    Cc: Chen, Gong <gong.chen@linux.intel.com>
    Cc: Jacob Pan <jacob.jun.pan@linux.intel.com>
    Cc: Joe Perches <joe@perches.com>
    Cc: John Sullivan <jsrhbz@kanargh.force9.co.uk>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
    Cc: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
    Cc: Theodore Ts'o <tytso@mit.edu>
    Signed-off-by: Ingo Molnar <mingo@kernel.org>

diff --git a/include/linux/atomic.h b/include/linux/atomic.h
index fef3a80..5b08a85 100644
--- a/include/linux/atomic.h
+++ b/include/linux/atomic.h
@@ -3,42 +3,6 @@
 #define _LINUX_ATOMIC_H
 #include <asm/atomic.h>
 
-/*
- * Provide __deprecated wrappers for the new interface, avoid flag day changes.
- * We need the ugly external functions to break header recursion hell.
- */
-#ifndef smp_mb__before_atomic_inc
-static inline void __deprecated smp_mb__before_atomic_inc(void)
-{
-	extern void __smp_mb__before_atomic(void);
-	__smp_mb__before_atomic();
-}
-#endif
-
-#ifndef smp_mb__after_atomic_inc
-static inline void __deprecated smp_mb__after_atomic_inc(void)
-{
-	extern void __smp_mb__after_atomic(void);
-	__smp_mb__after_atomic();
-}
-#endif
-
-#ifndef smp_mb__before_atomic_dec
-static inline void __deprecated smp_mb__before_atomic_dec(void)
-{
-	extern void __smp_mb__before_atomic(void);
-	__smp_mb__before_atomic();
-}
-#endif
-
-#ifndef smp_mb__after_atomic_dec
-static inline void __deprecated smp_mb__after_atomic_dec(void)
-{
-	extern void __smp_mb__after_atomic(void);
-	__smp_mb__after_atomic();
-}
-#endif
-
 /**
  * atomic_add_unless - add unless the number is already a given value
  * @v: pointer of type atomic_t
diff --git a/include/linux/bitops.h b/include/linux/bitops.h
index cbc5833..be5fd38 100644
--- a/include/linux/bitops.h
+++ b/include/linux/bitops.h
@@ -32,26 +32,6 @@ extern unsigned long __sw_hweight64(__u64 w);
  */
 #include <asm/bitops.h>
 
-/*
- * Provide __deprecated wrappers for the new interface, avoid flag day changes.
- * We need the ugly external functions to break header recursion hell.
- */
-#ifndef smp_mb__before_clear_bit
-static inline void __deprecated smp_mb__before_clear_bit(void)
-{
-	extern void __smp_mb__before_atomic(void);
-	__smp_mb__before_atomic();
-}
-#endif
-
-#ifndef smp_mb__after_clear_bit
-static inline void __deprecated smp_mb__after_clear_bit(void)
-{
-	extern void __smp_mb__after_atomic(void);
-	__smp_mb__after_atomic();
-}
-#endif
-
 #define for_each_set_bit(bit, addr, size) \
 	for ((bit) = find_first_bit((addr), (size));		\
 	     (bit) < (size);					\
diff --git a/kernel/sched/core.c b/kernel/sched/core.c
index 1211575..76c518c 100644
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@ -90,22 +90,6 @@
 #define CREATE_TRACE_POINTS
 #include <trace/events/sched.h>
 
-#ifdef smp_mb__before_atomic
-void __smp_mb__before_atomic(void)
-{
-	smp_mb__before_atomic();
-}
-EXPORT_SYMBOL(__smp_mb__before_atomic);
-#endif
-
-#ifdef smp_mb__after_atomic
-void __smp_mb__after_atomic(void)
-{
-	smp_mb__after_atomic();
-}
-EXPORT_SYMBOL(__smp_mb__after_atomic);
-#endif
-
 void start_bandwidth_timer(struct hrtimer *period_timer, ktime_t period)
 {
 	unsigned long delta;
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: Re: [PATCH 3/7] atomic: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 20:53:53 +0000
Message-ID: <1411160033.2513.28.camel () jtkirshe-mobl>
--------------------

--=-zb3dReDmJd9HCh0K3LLP
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

On Fri, 2014-09-19 at 22:43 +0200, Peter Zijlstra wrote:
> On Fri, Sep 19, 2014 at 08:29:36AM -0700, Jeff Kirsher wrote:
> > From: Mark Rustad <mark.d.rustad@intel.com>
> >=20
> > Silence the nested-externs warnings for these, as they are
> > truly wanted.
> >=20
>=20
> You're patching an old tree.

Sorry, I used Linus's latest tree (as of last night) because of number
of the patches in the series went to various trees, so I used Linus's
tree.

>=20
> ---
> commit 2e39465abc4b7856a0ea6fcf4f6b4668bb5db877
> Author: Peter Zijlstra <peterz@infradead.org>
> Date:   Mon Aug 4 12:07:15 2014 +0200
>=20
>     locking: Remove deprecated smp_mb__() barriers
>    =20
>     Its been a while and there are no in-tree users left, so remove the
>     deprecated barriers.
>    =20
>     Signed-off-by: Peter Zijlstra <peterz@infradead.org>
>     Cc: Chen, Gong <gong.chen@linux.intel.com>
>     Cc: Jacob Pan <jacob.jun.pan@linux.intel.com>
>     Cc: Joe Perches <joe@perches.com>
>     Cc: John Sullivan <jsrhbz@kanargh.force9.co.uk>
>     Cc: Linus Torvalds <torvalds@linux-foundation.org>
>     Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
>     Cc: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
>     Cc: Theodore Ts'o <tytso@mit.edu>
>     Signed-off-by: Ingo Molnar <mingo@kernel.org>
>=20
> diff --git a/include/linux/atomic.h b/include/linux/atomic.h
> index fef3a80..5b08a85 100644
> --- a/include/linux/atomic.h
> +++ b/include/linux/atomic.h
> @@ -3,42 +3,6 @@
>  #define _LINUX_ATOMIC_H
>  #include <asm/atomic.h>
> =20
> -/*
> - * Provide __deprecated wrappers for the new interface, avoid flag day c=
hanges.
> - * We need the ugly external functions to break header recursion hell.
> - */
> -#ifndef smp_mb__before_atomic_inc
> -static inline void __deprecated smp_mb__before_atomic_inc(void)
> -{
> -	extern void __smp_mb__before_atomic(void);
> -	__smp_mb__before_atomic();
> -}
> -#endif
> -
> -#ifndef smp_mb__after_atomic_inc
> -static inline void __deprecated smp_mb__after_atomic_inc(void)
> -{
> -	extern void __smp_mb__after_atomic(void);
> -	__smp_mb__after_atomic();
> -}
> -#endif
> -
> -#ifndef smp_mb__before_atomic_dec
> -static inline void __deprecated smp_mb__before_atomic_dec(void)
> -{
> -	extern void __smp_mb__before_atomic(void);
> -	__smp_mb__before_atomic();
> -}
> -#endif
> -
> -#ifndef smp_mb__after_atomic_dec
> -static inline void __deprecated smp_mb__after_atomic_dec(void)
> -{
> -	extern void __smp_mb__after_atomic(void);
> -	__smp_mb__after_atomic();
> -}
> -#endif
> -
>  /**
>   * atomic_add_unless - add unless the number is already a given value
>   * @v: pointer of type atomic_t
> diff --git a/include/linux/bitops.h b/include/linux/bitops.h
> index cbc5833..be5fd38 100644
> --- a/include/linux/bitops.h
> +++ b/include/linux/bitops.h
> @@ -32,26 +32,6 @@ extern unsigned long __sw_hweight64(__u64 w);
>   */
>  #include <asm/bitops.h>
> =20
> -/*
> - * Provide __deprecated wrappers for the new interface, avoid flag day c=
hanges.
> - * We need the ugly external functions to break header recursion hell.
> - */
> -#ifndef smp_mb__before_clear_bit
> -static inline void __deprecated smp_mb__before_clear_bit(void)
> -{
> -	extern void __smp_mb__before_atomic(void);
> -	__smp_mb__before_atomic();
> -}
> -#endif
> -
> -#ifndef smp_mb__after_clear_bit
> -static inline void __deprecated smp_mb__after_clear_bit(void)
> -{
> -	extern void __smp_mb__after_atomic(void);
> -	__smp_mb__after_atomic();
> -}
> -#endif
> -
>  #define for_each_set_bit(bit, addr, size) \
>  	for ((bit) =3D find_first_bit((addr), (size));		\
>  	     (bit) < (size);					\
> diff --git a/kernel/sched/core.c b/kernel/sched/core.c
> index 1211575..76c518c 100644
> --- a/kernel/sched/core.c
> +++ b/kernel/sched/core.c
> @@ -90,22 +90,6 @@
>  #define CREATE_TRACE_POINTS
>  #include <trace/events/sched.h>
> =20
> -#ifdef smp_mb__before_atomic
> -void __smp_mb__before_atomic(void)
> -{
> -	smp_mb__before_atomic();
> -}
> -EXPORT_SYMBOL(__smp_mb__before_atomic);
> -#endif
> -
> -#ifdef smp_mb__after_atomic
> -void __smp_mb__after_atomic(void)
> -{
> -	smp_mb__after_atomic();
> -}
> -EXPORT_SYMBOL(__smp_mb__after_atomic);
> -#endif
> -
>  void start_bandwidth_timer(struct hrtimer *period_timer, ktime_t period)
>  {
>  	unsigned long delta;



--=-zb3dReDmJd9HCh0K3LLP
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: This is a digitally signed message part
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAABCgAGBQJUHJfhAAoJEOVv75VaS+3OeKEP/2yP2pTsozxo4bzqf+EAEoOT
E8FE7UJwr0CU3G02DhR5+Kii1P10/VHXpl3uZAj3TE5TT1kqKvVsKzu0ca+awIzs
nfSh9BWlYb2Loqv+/AC1lbEzQkjwcS+fgixK09vhgosQcn/UBNTKEn/fSjtzbF2v
82VX2hSCQGhWHXLOrHgQfeWc9NT86us4MXbSUm6HWH7x0+RrdO4eVL+5+O+1Rzow
LDCY8VR8DDgcmYpRHCeBQLed2QuvFEPfY7z6x6iyxJd908iEwsJNUIQ61aC4RsHD
xBVy9Cp0y8edsK/MO5lW03dMBAuFW6h4hTxIyQzT42UX1s/nplrI+2a/QZIUS1AF
qk2oR/tBe44z9JkOPJeCtfewccY2FU6p2P0aqJGuG3tV169XsZb1VS7UyFXuZ25r
fiC24/3j9HtlHUjfilZaaij/9ug1ghV/7F+e/GrnM1bHXyJUTSQ3Ez2HWByxyboV
nVCS9uh+fxadfknKlTXDdMIoC/4vmaNeMbpgfWB3uEGgawU0+Q5/WEFxQX7yYS/y
bZtUDv3mhBE3A2lGdoK7F/9mf0l+5r5v4X5W2fQn1pbD8BeXh7AeCypB4099/Kon
WqKe41qAhZRFOhkODIMxUdzJ8MFR0yaOdYgSa7vJOH0Y/LBA7v0PDvrU1WJRtLTM
C+UIW/mf0OIZHXFTmnIj
=I0eW
-----END PGP SIGNATURE-----

--=-zb3dReDmJd9HCh0K3LLP--

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 4/4] compile: remove the unmaintained compile program ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH 4/4] compile: remove the unmaintained compile program
Date: Sat, 11 Oct 2014 20:00:17 +0000
Message-ID: <54398C51.3080301 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---
 .gitignore     |    1 -
 Makefile       |    4 +-
 compile-i386.c | 2407 --------------------------------------------------------
 compile.c      |   84 --
 compile.h      |   10 -
 5 files changed, 1 insertion(+), 2505 deletions(-)
 delete mode 100644 compile-i386.c
 delete mode 100644 compile.c
 delete mode 100644 compile.h

diff --git a/.gitignore b/.gitignore
index d32d063..7d4cdf2 100644
--- a/.gitignore
+++ b/.gitignore
@@ -16,7 +16,6 @@ test-lexing
 test-parsing
 obfuscate
 sparse
-compile
 graph
 test-dissect
 test-linearize
diff --git a/Makefile b/Makefile
index 3f3c71a..8effeb4 100644
--- a/Makefile
+++ b/Makefile
@@ -52,7 +52,7 @@ MAN1DIR=$(MANDIR)/man1
 INCLUDEDIR=$(PREFIX)/include
 PKGCONFIGDIR=$(LIBDIR)/pkgconfig
 
-PROGRAMS=test-lexing test-parsing obfuscate compile graph sparse \
+PROGRAMS=test-lexing test-parsing obfuscate graph sparse \
 	 test-linearize example test-unssa test-dissect ctags
 INST_PROGRAMS=sparse cgcc
 INST_MAN1=sparse.1 cgcc.1
@@ -171,8 +171,6 @@ sparse.pc: sparse.pc.in
 	$(QUIET_GEN)sed $(SED_PC_CMD) sparse.pc.in > sparse.pc
 
 
-compile_EXTRA_DEPS = compile-i386.o
-
 $(foreach p,$(PROGRAMS),$(eval $(p): $($(p)_EXTRA_DEPS) $(LIBS)))
 $(PROGRAMS): % : %.o 
 	$(QUIET_LINK)$(LD) $(LDFLAGS) -o $@ $^ $($@_EXTRA_OBJS)
diff --git a/compile-i386.c b/compile-i386.c
deleted file mode 100644
index 88169ec..0000000
--- a/compile-i386.c
+++ /dev/null
@@ -1,2407 +0,0 @@
-/*
- * sparse/compile-i386.c
- *
- * Copyright (C) 2003 Transmeta Corp.
- *               2003 Linus Torvalds
- * Copyright 2003 Jeff Garzik
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
- * THE SOFTWARE.
- *
- * x86 backend
- *
- * TODO list:
- * in general, any non-32bit SYM_BASETYPE is unlikely to work.
- * complex initializers
- * bitfields
- * global struct/union variables
- * addressing structures, and members of structures (as opposed to
- *     scalars) on the stack.  Requires smarter stack frame allocation.
- * labels / goto
- * any function argument that isn't 32 bits (or promoted to such)
- * inline asm
- * floating point
- *
- */
-#include <stdarg.h>
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#include <ctype.h>
-#include <unistd.h>
-#include <fcntl.h>
-#include <assert.h>
-
-#include "lib.h"
-#include "allocate.h"
-#include "token.h"
-#include "parse.h"
-#include "symbol.h"
-#include "scope.h"
-#include "expression.h"
-#include "target.h"
-#include "compile.h"
-#include "bitmap.h"
-
-struct textbuf {
-	unsigned int	len;	/* does NOT include terminating null */
-	char		*text;
-	struct textbuf	*next;
-	struct textbuf	*prev;
-};
-
-struct loop_stack {
-	int		continue_lbl;
-	int		loop_bottom_lbl;
-	struct loop_stack *next;
-};
-
-struct atom;
-struct storage;
-DECLARE_PTR_LIST(str_list, struct atom);
-DECLARE_PTR_LIST(atom_list, struct atom);
-DECLARE_PTR_LIST(storage_list, struct storage);
-
-struct function {
-	int stack_size;
-	int pseudo_nr;
-	struct storage_list *pseudo_list;
-	struct atom_list *atom_list;
-	struct str_list *str_list;
-	struct loop_stack *loop_stack;
-	struct symbol **argv;
-	unsigned int argc;
-	int ret_target;
-};
-
-enum storage_type {
-	STOR_PSEUDO,	/* variable stored on the stack */
-	STOR_ARG,	/* function argument */
-	STOR_SYM,	/* a symbol we can directly ref in the asm */
-	STOR_REG,	/* scratch register */
-	STOR_VALUE,	/* integer constant */
-	STOR_LABEL,	/* label / jump target */
-	STOR_LABELSYM,	/* label generated from symbol's pointer value */
-};
-
-struct reg_info {
-	const char	*name;
-	struct storage	*contains;
-	const unsigned char aliases[12];
-#define own_regno aliases[0]
-};
-
-struct storage {
-	enum storage_type type;
-	unsigned long flags;
-
-	/* STOR_REG */
-	struct reg_info *reg;
-	struct symbol *ctype;
-
-	union {
-		/* STOR_PSEUDO */
-		struct {
-			int pseudo;
-			int offset;
-			int size;
-		};
-		/* STOR_ARG */
-		struct {
-			int idx;
-		};
-		/* STOR_SYM */
-		struct {
-			struct symbol *sym;
-		};
-		/* STOR_VALUE */
-		struct {
-			long long value;
-		};
-		/* STOR_LABEL */
-		struct {
-			int label;
-		};
-		/* STOR_LABELSYM */
-		struct {
-			struct symbol *labelsym;
-		};
-	};
-};
-
-enum {
-	STOR_LABEL_VAL	= (1 << 0),
-	STOR_WANTS_FREE	= (1 << 1),
-};
-
-struct symbol_private {
-	struct storage *addr;
-};
-
-enum atom_type {
-	ATOM_TEXT,
-	ATOM_INSN,
-	ATOM_CSTR,
-};
-
-struct atom {
-	enum atom_type type;
-	union {
-		/* stuff for text */
-		struct {
-			char *text;
-			unsigned int text_len;  /* w/o terminating null */
-		};
-
-		/* stuff for insns */
-		struct {
-			char insn[32];
-			char comment[40];
-			struct storage *op1;
-			struct storage *op2;
-		};
-
-		/* stuff for C strings */
-		struct {
-			struct string *string;
-			int label;
-		};
-	};
-};
-
-
-static struct function *current_func = NULL;
-static struct textbuf *unit_post_text = NULL;
-static const char *current_section;
-
-static void emit_comment(const char * fmt, ...) FORMAT_ATTR(1);
-static void emit_move(struct storage *src, struct storage *dest,
-		      struct symbol *ctype, const char *comment);
-static int type_is_signed(struct symbol *sym);
-static struct storage *x86_address_gen(struct expression *expr);
-static struct storage *x86_symbol_expr(struct symbol *sym);
-static void x86_symbol(struct symbol *sym);
-static struct storage *x86_statement(struct statement *stmt);
-static struct storage *x86_expression(struct expression *expr);
-
-enum registers {
-	NOREG,
-	 AL,  DL,  CL,  BL,  AH,  DH,  CH,  BH,	// 8-bit
-	 AX,  DX,  CX,  BX,  SI,  DI,  BP,  SP,	// 16-bit
-	EAX, EDX, ECX, EBX, ESI, EDI, EBP, ESP,	// 32-bit
-	EAX_EDX, ECX_EBX, ESI_EDI,		// 64-bit
-};
-
-/* This works on regno's, reg_info's and hardreg_storage's */
-#define byte_reg(reg) ((reg) - 16)
-#define highbyte_reg(reg) ((reg)-12)
-#define word_reg(reg) ((reg)-8)
-
-#define REGINFO(nr, str, conflicts...)	[nr] = { .name = str, .aliases = { nr , conflicts } }
-
-static struct reg_info reg_info_table[] = {
-	REGINFO( AL,  "%al", AX, EAX, EAX_EDX),
-	REGINFO( DL,  "%dl", DX, EDX, EAX_EDX),
-	REGINFO( CL,  "%cl", CX, ECX, ECX_EBX),
-	REGINFO( BL,  "%bl", BX, EBX, ECX_EBX),
-	REGINFO( AH,  "%ah", AX, EAX, EAX_EDX),
-	REGINFO( DH,  "%dh", DX, EDX, EAX_EDX),
-	REGINFO( CH,  "%ch", CX, ECX, ECX_EBX),
-	REGINFO( BH,  "%bh", BX, EBX, ECX_EBX),
-	REGINFO( AX,  "%ax", AL, AH, EAX, EAX_EDX),
-	REGINFO( DX,  "%dx", DL, DH, EDX, EAX_EDX),
-	REGINFO( CX,  "%cx", CL, CH, ECX, ECX_EBX),
-	REGINFO( BX,  "%bx", BL, BH, EBX, ECX_EBX),
-	REGINFO( SI,  "%si", ESI, ESI_EDI),
-	REGINFO( DI,  "%di", EDI, ESI_EDI),
-	REGINFO( BP,  "%bp", EBP),
-	REGINFO( SP,  "%sp", ESP),
-	REGINFO(EAX, "%eax", AL, AH, AX, EAX_EDX),
-	REGINFO(EDX, "%edx", DL, DH, DX, EAX_EDX),
-	REGINFO(ECX, "%ecx", CL, CH, CX, ECX_EBX),
-	REGINFO(EBX, "%ebx", BL, BH, BX, ECX_EBX),
-	REGINFO(ESI, "%esi", SI, ESI_EDI),
-	REGINFO(EDI, "%edi", DI, ESI_EDI),
-	REGINFO(EBP, "%ebp", BP),
-	REGINFO(ESP, "%esp", SP),
-	REGINFO(EAX_EDX, "%eax:%edx", AL, AH, AX, EAX, DL, DH, DX, EDX),
-	REGINFO(ECX_EBX, "%ecx:%ebx", CL, CH, CX, ECX, BL, BH, BX, EBX),
-	REGINFO(ESI_EDI, "%esi:%edi", SI, ESI, DI, EDI),
-};
-
-#define REGSTORAGE(nr) [nr] = { .type = STOR_REG, .reg = reg_info_table + (nr) }
-
-static struct storage hardreg_storage_table[] = {
-	REGSTORAGE(AL), REGSTORAGE(DL), REGSTORAGE(CL), REGSTORAGE(BL),
-	REGSTORAGE(AH), REGSTORAGE(DH), REGSTORAGE(CH), REGSTORAGE(BH),
-	REGSTORAGE(AX), REGSTORAGE(DX), REGSTORAGE(CX), REGSTORAGE(BX),
-	REGSTORAGE(SI), REGSTORAGE(DI), REGSTORAGE(BP), REGSTORAGE(SP),
-	REGSTORAGE(EAX), REGSTORAGE(EDX), REGSTORAGE(ECX), REGSTORAGE(EBX),
-	REGSTORAGE(ESI), REGSTORAGE(EDI), REGSTORAGE(EBP), REGSTORAGE(ESP),
-	REGSTORAGE(EAX_EDX), REGSTORAGE(ECX_EBX), REGSTORAGE(ESI_EDI),
-};
-
-#define REG_EAX (&hardreg_storage_table[EAX])
-#define REG_ECX (&hardreg_storage_table[ECX])
-#define REG_EDX (&hardreg_storage_table[EDX])
-#define REG_ESP (&hardreg_storage_table[ESP])
-#define REG_DL	(&hardreg_storage_table[DL])
-#define REG_DX	(&hardreg_storage_table[DX])
-#define REG_AL	(&hardreg_storage_table[AL])
-#define REG_AX	(&hardreg_storage_table[AX])
-
-static DECLARE_BITMAP(regs_in_use, 256);
-
-static inline struct storage * reginfo_reg(struct reg_info *info)
-{
-	return hardreg_storage_table + info->own_regno;
-}
-
-static struct storage * get_hardreg(struct storage *reg, int clear)
-{
-	struct reg_info *info = reg->reg;
-	const unsigned char *aliases;
-	int regno;
-
-	aliases = info->aliases;
-	while ((regno = *aliases++) != NOREG) {
-		if (test_bit(regno, regs_in_use))
-			goto busy;
-		if (clear)
-			reg_info_table[regno].contains = NULL;
-	}
-	set_bit(info->own_regno, regs_in_use);
-	return reg;
-busy:
-	fprintf(stderr, "register %s is busy\n", info->name);
-	if (regno + reg_info_table != info)
-		fprintf(stderr, "  conflicts with %s\n", reg_info_table[regno].name);
-	exit(1);
-}
-
-static void put_reg(struct storage *reg)
-{
-	struct reg_info *info = reg->reg;
-	int regno = info->own_regno;
-
-	if (test_and_clear_bit(regno, regs_in_use))
-		return;
-	fprintf(stderr, "freeing already free'd register %s\n", reg_info_table[regno].name);
-}
-
-struct regclass {
-	const char *name;
-	const unsigned char regs[30];
-};
-
-static struct regclass regclass_8 = { "8-bit", { AL, DL, CL, BL, AH, DH, CH, BH }};
-static struct regclass regclass_16 = { "16-bit", { AX, DX, CX, BX, SI, DI, BP }};
-static struct regclass regclass_32 = { "32-bit", { EAX, EDX, ECX, EBX, ESI, EDI, EBP }};
-static struct regclass regclass_64 = { "64-bit", { EAX_EDX, ECX_EBX, ESI_EDI }};
-
-static struct regclass regclass_32_8 = { "32-bit bytes", { EAX, EDX, ECX, EBX }};
-
-static struct regclass *get_regclass_bits(int bits)
-{
-	switch (bits) {
-	case 8: return &regclass_8;
-	case 16: return &regclass_16;
-	case 64: return &regclass_64;
-	default: return &regclass_32;
-	}
-}
-
-static struct regclass *get_regclass(struct expression *expr)
-{
-	return get_regclass_bits(expr->ctype->bit_size);
-}
-
-static int register_busy(int regno)
-{
-	if (!test_bit(regno, regs_in_use)) {
-		struct reg_info *info = reg_info_table + regno;
-		const unsigned char *regs = info->aliases+1;
-
-		while ((regno = *regs) != NOREG) {
-			regs++;
-			if (test_bit(regno, regs_in_use))
-				goto busy;
-		}
-		return 0;
-	}
-busy:
-	return 1;
-}
-
-static struct storage *get_reg(struct regclass *class)
-{
-	const unsigned char *regs = class->regs;
-	int regno;
-
-	while ((regno = *regs) != NOREG) {
-		regs++;
-		if (register_busy(regno))
-			continue;
-		return get_hardreg(hardreg_storage_table + regno, 1);
-	}
-	fprintf(stderr, "Ran out of %s registers\n", class->name);
-	exit(1);
-}
-
-static struct storage *get_reg_value(struct storage *value, struct regclass *class)
-{
-	struct reg_info *info;
-	struct storage *reg;
-
-	/* Do we already have it somewhere */
-	info = value->reg;
-	if (info && info->contains == value) {
-		emit_comment("already have register %s", info->name);
-		return get_hardreg(hardreg_storage_table + info->own_regno, 0);
-	}
-
-	reg = get_reg(class);
-	emit_move(value, reg, value->ctype, "reload register");
-	info = reg->reg;
-	info->contains = value;
-	value->reg = info;
-	return reg;
-}
-
-static struct storage *temp_from_bits(unsigned int bit_size)
-{
-	return get_reg(get_regclass_bits(bit_size));
-}
-
-static inline unsigned int pseudo_offset(struct storage *s)
-{
-	if (s->type != STOR_PSEUDO)
-		return 123456;	/* intentionally bogus value */
-
-	return s->offset;
-}
-
-static inline unsigned int arg_offset(struct storage *s)
-{
-	if (s->type != STOR_ARG)
-		return 123456;	/* intentionally bogus value */
-
-	/* FIXME: this is wrong wrong wrong */
-	return current_func->stack_size + ((1 + s->idx) * 4);
-}
-
-static const char *pretty_offset(int ofs)
-{
-	static char esp_buf[64];
-
-	if (ofs)
-		sprintf(esp_buf, "%d(%%esp)", ofs);
-	else
-		strcpy(esp_buf, "(%esp)");
-
-	return esp_buf;
-}
-
-static void stor_sym_init(struct symbol *sym)
-{
-	struct storage *stor;
-	struct symbol_private *priv;
-
-	priv = calloc(1, sizeof(*priv) + sizeof(*stor));
-	if (!priv)
-		die("OOM in stor_sym_init");
-
-	stor = (struct storage *) (priv + 1);
-
-	priv->addr = stor;
-	stor->type = STOR_SYM;
-	stor->sym = sym;
-}
-
-static const char *stor_op_name(struct storage *s)
-{
-	static char name[32];
-
-	switch (s->type) {
-	case STOR_PSEUDO:
-		strcpy(name, pretty_offset((int) pseudo_offset(s)));
-		break;
-	case STOR_ARG:
-		strcpy(name, pretty_offset((int) arg_offset(s)));
-		break;
-	case STOR_SYM:
-		strcpy(name, show_ident(s->sym->ident));
-		break;
-	case STOR_REG:
-		strcpy(name, s->reg->name);
-		break;
-	case STOR_VALUE:
-		sprintf(name, "$%Ld", s->value);
-		break;
-	case STOR_LABEL:
-		sprintf(name, "%s.L%d", s->flags & STOR_LABEL_VAL ? "$" : "",
-			s->label);
-		break;
-	case STOR_LABELSYM:
-		sprintf(name, "%s.LS%p", s->flags & STOR_LABEL_VAL ? "$" : "",
-			s->labelsym);
-		break;
-	}
-
-	return name;
-}
-
-static struct atom *new_atom(enum atom_type type)
-{
-	struct atom *atom;
-
-	atom = calloc(1, sizeof(*atom));	/* TODO: chunked alloc */
-	if (!atom)
-		die("nuclear OOM");
-
-	atom->type = type;
-
-	return atom;
-}
-
-static inline void push_cstring(struct function *f, struct string *str,
-				int label)
-{
-	struct atom *atom;
-
-	atom = new_atom(ATOM_CSTR);
-	atom->string = str;
-	atom->label = label;
-
-	add_ptr_list(&f->str_list, atom);	/* note: _not_ atom_list */
-}
-
-static inline void push_atom(struct function *f, struct atom *atom)
-{
-	add_ptr_list(&f->atom_list, atom);
-}
-
-static void push_text_atom(struct function *f, const char *text)
-{
-	struct atom *atom = new_atom(ATOM_TEXT);
-
-	atom->text = strdup(text);
-	atom->text_len = strlen(text);
-
-	push_atom(f, atom);
-}
-
-static struct storage *new_storage(enum storage_type type)
-{
-	struct storage *stor;
-
-	stor = calloc(1, sizeof(*stor));
-	if (!stor)
-		die("OOM in new_storage");
-
-	stor->type = type;
-
-	return stor;
-}
-
-static struct storage *stack_alloc(int n_bytes)
-{
-	struct function *f = current_func;
-	struct storage *stor;
-
-	assert(f != NULL);
-
-	stor = new_storage(STOR_PSEUDO);
-	stor->type = STOR_PSEUDO;
-	stor->pseudo = f->pseudo_nr;
-	stor->offset = f->stack_size; /* FIXME: stack req. natural align */
-	stor->size = n_bytes;
-	f->stack_size += n_bytes;
-	f->pseudo_nr++;
-
-	add_ptr_list(&f->pseudo_list, stor);
-
-	return stor;
-}
-
-static struct storage *new_labelsym(struct symbol *sym)
-{
-	struct storage *stor;
-
-	stor = new_storage(STOR_LABELSYM);
-
-	if (stor) {
-		stor->flags |= STOR_WANTS_FREE;
-		stor->labelsym = sym;
-	}
-
-	return stor;
-}
-
-static struct storage *new_val(long long value)
-{
-	struct storage *stor;
-
-	stor = new_storage(STOR_VALUE);
-
-	if (stor) {
-		stor->flags |= STOR_WANTS_FREE;
-		stor->value = value;
-	}
-
-	return stor;
-}
-
-static int new_label(void)
-{
-	static int label = 0;
-	return ++label;
-}
-
-static void textbuf_push(struct textbuf **buf_p, const char *text)
-{
-	struct textbuf *tmp, *list = *buf_p;
-	unsigned int text_len = strlen(text);
-	unsigned int alloc_len = text_len + 1 + sizeof(*list);
-
-	tmp = calloc(1, alloc_len);
-	if (!tmp)
-		die("OOM on textbuf alloc");
-
-	tmp->text = ((void *) tmp) + sizeof(*tmp);
-	memcpy(tmp->text, text, text_len + 1);
-	tmp->len = text_len;
-
-	/* add to end of list */
-	if (!list) {
-		list = tmp;
-		tmp->prev = tmp;
-	} else {
-		tmp->prev = list->prev;
-		tmp->prev->next = tmp;
-		list->prev = tmp;
-	}
-	tmp->next = list;
-
-	*buf_p = list;
-}
-
-static void textbuf_emit(struct textbuf **buf_p)
-{
-	struct textbuf *tmp, *list = *buf_p;
-
-	while (list) {
-		tmp = list;
-		if (tmp->next == tmp)
-			list = NULL;
-		else {
-			tmp->prev->next = tmp->next;
-			tmp->next->prev = tmp->prev;
-			list = tmp->next;
-		}
-
-		fputs(tmp->text, stdout);
-
-		free(tmp);
-	}
-
-	*buf_p = list;
-}
-
-static void insn(const char *insn, struct storage *op1, struct storage *op2,
-		 const char *comment_in)
-{
-	struct function *f = current_func;
-	struct atom *atom = new_atom(ATOM_INSN);
-
-	assert(insn != NULL);
-
-	strcpy(atom->insn, insn);
-	if (comment_in && (*comment_in))
-		strncpy(atom->comment, comment_in,
-			sizeof(atom->comment) - 1);
-
-	atom->op1 = op1;
-	atom->op2 = op2;
-
-	push_atom(f, atom);
-}
-
-static void emit_comment(const char *fmt, ...)
-{
-	struct function *f = current_func;
-	static char tmpbuf[100] = "\t# ";
-	va_list args;
-	int i;
-
-	va_start(args, fmt);
-	i = vsnprintf(tmpbuf+3, sizeof(tmpbuf)-4, fmt, args);
-	va_end(args);
-	tmpbuf[i+3] = '\n';
-	tmpbuf[i+4] = '\0';
-	push_text_atom(f, tmpbuf);
-}
-
-static void emit_label (int label, const char *comment)
-{
-	struct function *f = current_func;
-	char s[64];
-
-	if (!comment)
-		sprintf(s, ".L%d:\n", label);
-	else
-		sprintf(s, ".L%d:\t\t\t\t\t# %s\n", label, comment);
-
-	push_text_atom(f, s);
-}
-
-static void emit_labelsym (struct symbol *sym, const char *comment)
-{
-	struct function *f = current_func;
-	char s[64];
-
-	if (!comment)
-		sprintf(s, ".LS%p:\n", sym);
-	else
-		sprintf(s, ".LS%p:\t\t\t\t# %s\n", sym, comment);
-
-	push_text_atom(f, s);
-}
-
-void emit_unit_begin(const char *basename)
-{
-	printf("\t.file\t\"%s\"\n", basename);
-}
-
-void emit_unit_end(void)
-{
-	textbuf_emit(&unit_post_text);
-	printf("\t.ident\t\"sparse silly x86 backend (built %s)\"\n", __DATE__);
-}
-
-/* conditionally switch sections */
-static void emit_section(const char *s)
-{
-	if (s == current_section)
-		return;
-	if (current_section && (!strcmp(s, current_section)))
-		return;
-
-	printf("\t%s\n", s);
-	current_section = s;
-}
-
-static void emit_insn_atom(struct function *f, struct atom *atom)
-{
-	char s[128];
-	char comment[64];
-	struct storage *op1 = atom->op1;
-	struct storage *op2 = atom->op2;
-
-	if (atom->comment[0])
-		sprintf(comment, "\t\t# %s", atom->comment);
-	else
-		comment[0] = 0;
-
-	if (atom->op2) {
-		char tmp[16];
-		strcpy(tmp, stor_op_name(op1));
-		sprintf(s, "\t%s\t%s, %s%s\n",
-			atom->insn, tmp, stor_op_name(op2), comment);
-	} else if (atom->op1)
-		sprintf(s, "\t%s\t%s%s%s\n",
-			atom->insn, stor_op_name(op1),
-			comment[0] ? "\t" : "", comment);
-	else
-		sprintf(s, "\t%s\t%s%s\n",
-			atom->insn,
-			comment[0] ? "\t\t" : "", comment);
-
-	write(STDOUT_FILENO, s, strlen(s));
-}
-
-static void emit_atom_list(struct function *f)
-{
-	struct atom *atom;
-
-	FOR_EACH_PTR(f->atom_list, atom) {
-		switch (atom->type) {
-		case ATOM_TEXT: {
-			ssize_t rc = write(STDOUT_FILENO, atom->text,
-					   atom->text_len);
-			(void) rc;	/* FIXME */
-			break;
-		}
-		case ATOM_INSN:
-			emit_insn_atom(f, atom);
-			break;
-		case ATOM_CSTR:
-			assert(0);
-			break;
-		}
-	} END_FOR_EACH_PTR(atom);
-}
-
-static void emit_string_list(struct function *f)
-{
-	struct atom *atom;
-
-	emit_section(".section\t.rodata");
-
-	FOR_EACH_PTR(f->str_list, atom) {
-		/* FIXME: escape " in string */
-		printf(".L%d:\n", atom->label);
-		printf("\t.string\t%s\n", show_string(atom->string));
-
-		free(atom);
-	} END_FOR_EACH_PTR(atom);
-}
-
-static void func_cleanup(struct function *f)
-{
-	struct storage *stor;
-	struct atom *atom;
-
-	FOR_EACH_PTR(f->atom_list, atom) {
-		if ((atom->type == ATOM_TEXT) && (atom->text))
-			free(atom->text);
-		if (atom->op1 && (atom->op1->flags & STOR_WANTS_FREE))
-			free(atom->op1);
-		if (atom->op2 && (atom->op2->flags & STOR_WANTS_FREE))
-			free(atom->op2);
-		free(atom);
-	} END_FOR_EACH_PTR(atom);
-
-	FOR_EACH_PTR(f->pseudo_list, stor) {
-		free(stor);
-	} END_FOR_EACH_PTR(stor);
-
-	free_ptr_list(&f->pseudo_list);
-	free(f);
-}
-
-/* function prologue */
-static void emit_func_pre(struct symbol *sym)
-{
-	struct function *f;
-	struct symbol *arg;
-	unsigned int i, argc = 0, alloc_len;
-	unsigned char *mem;
-	struct symbol_private *privbase;
-	struct storage *storage_base;
-	struct symbol *base_type = sym->ctype.base_type;
-
-	FOR_EACH_PTR(base_type->arguments, arg) {
-		argc++;
-	} END_FOR_EACH_PTR(arg);
-
-	alloc_len =
-		sizeof(*f) +
-		(argc * sizeof(struct symbol *)) +
-		(argc * sizeof(struct symbol_private)) +
-		(argc * sizeof(struct storage));
-	mem = calloc(1, alloc_len);
-	if (!mem)
-		die("OOM on func info");
-
-	f		=  (struct function *) mem;
-	mem		+= sizeof(*f);
-	f->argv		=  (struct symbol **) mem;
-	mem		+= (argc * sizeof(struct symbol *));
-	privbase	=  (struct symbol_private *) mem;
-	mem		+= (argc * sizeof(struct symbol_private));
-	storage_base	=  (struct storage *) mem;
-
-	f->argc = argc;
-	f->ret_target = new_label();
-
-	i = 0;
-	FOR_EACH_PTR(base_type->arguments, arg) {
-		f->argv[i] = arg;
-		arg->aux = &privbase[i];
-		storage_base[i].type = STOR_ARG;
-		storage_base[i].idx = i;
-		privbase[i].addr = &storage_base[i];
-		i++;
-	} END_FOR_EACH_PTR(arg);
-
-	assert(current_func == NULL);
-	current_func = f;
-}
-
-/* function epilogue */
-static void emit_func_post(struct symbol *sym)
-{
-	const char *name = show_ident(sym->ident);
-	struct function *f = current_func;
-	int stack_size = f->stack_size;
-
-	if (f->str_list)
-		emit_string_list(f);
-
-	/* function prologue */
-	emit_section(".text");
-	if ((sym->ctype.modifiers & MOD_STATIC) == 0)
-		printf(".globl %s\n", name);
-	printf("\t.type\t%s, @function\n", name);
-	printf("%s:\n", name);
-
-	if (stack_size) {
-		char pseudo_const[16];
-
-		sprintf(pseudo_const, "$%d", stack_size);
-		printf("\tsubl\t%s, %%esp\n", pseudo_const);
-	}
-
-	/* function epilogue */
-
-	/* jump target for 'return' statements */
-	emit_label(f->ret_target, NULL);
-
-	if (stack_size) {
-		struct storage *val;
-
-		val = new_storage(STOR_VALUE);
-		val->value = (long long) (stack_size);
-		val->flags = STOR_WANTS_FREE;
-
-		insn("addl", val, REG_ESP, NULL);
-	}
-
-	insn("ret", NULL, NULL, NULL);
-
-	/* output everything to stdout */
-	fflush(stdout);		/* paranoia; needed? */
-	emit_atom_list(f);
-
-	/* function footer */
-	name = show_ident(sym->ident);
-	printf("\t.size\t%s, .-%s\n", name, name);
-
-	func_cleanup(f);
-	current_func = NULL;
-}
-
-/* emit object (a.k.a. variable, a.k.a. data) prologue */
-static void emit_object_pre(const char *name, unsigned long modifiers,
-			    unsigned long alignment, unsigned int byte_size)
-{
-	if ((modifiers & MOD_STATIC) == 0)
-		printf(".globl %s\n", name);
-	emit_section(".data");
-	if (alignment)
-		printf("\t.align %lu\n", alignment);
-	printf("\t.type\t%s, @object\n", name);
-	printf("\t.size\t%s, %d\n", name, byte_size);
-	printf("%s:\n", name);
-}
-
-/* emit value (only) for an initializer scalar */
-static void emit_scalar(struct expression *expr, unsigned int bit_size)
-{
-	const char *type;
-	long long ll;
-
-	assert(expr->type == EXPR_VALUE);
-
-	if (expr->value == 0ULL) {
-		printf("\t.zero\t%d\n", bit_size / 8);
-		return;
-	}
-
-	ll = (long long) expr->value;
-
-	switch (bit_size) {
-	case 8:		type = "byte";	ll = (char) ll; break;
-	case 16:	type = "value";	ll = (short) ll; break;
-	case 32:	type = "long";	ll = (int) ll; break;
-	case 64:	type = "quad";	break;
-	default:	type = NULL;	break;
-	}
-
-	assert(type != NULL);
-
-	printf("\t.%s\t%Ld\n", type, ll);
-}
-
-static void emit_global_noinit(const char *name, unsigned long modifiers,
-			       unsigned long alignment, unsigned int byte_size)
-{
-	char s[64];
-
-	if (modifiers & MOD_STATIC) {
-		sprintf(s, "\t.local\t%s\n", name);
-		textbuf_push(&unit_post_text, s);
-	}
-	if (alignment)
-		sprintf(s, "\t.comm\t%s,%d,%lu\n", name, byte_size, alignment);
-	else
-		sprintf(s, "\t.comm\t%s,%d\n", name, byte_size);
-	textbuf_push(&unit_post_text, s);
-}
-
-static int ea_current, ea_last;
-
-static void emit_initializer(struct symbol *sym,
-			     struct expression *expr)
-{
-	int distance = ea_current - ea_last - 1;
-
-	if (distance > 0)
-		printf("\t.zero\t%d\n", (sym->bit_size / 8) * distance);
-
-	if (expr->type == EXPR_VALUE) {
-		struct symbol *base_type = sym->ctype.base_type;
-		assert(base_type != NULL);
-
-		emit_scalar(expr, sym->bit_size / get_expression_value(base_type->array_size));
-		return;
-	}
-	if (expr->type != EXPR_INITIALIZER)
-		return;
-
-	assert(0); /* FIXME */
-}
-
-static int sort_array_cmp(const struct expression *a,
-			  const struct expression *b)
-{
-	int a_ofs = 0, b_ofs = 0;
-
-	if (a->type == EXPR_POS)
-		a_ofs = (int) a->init_offset;
-	if (b->type == EXPR_POS)
-		b_ofs = (int) b->init_offset;
-
-	return a_ofs - b_ofs;
-}
-
-/* move to front-end? */
-static void sort_array(struct expression *expr)
-{
-	struct expression *entry, **list;
-	unsigned int elem, sorted, i;
-
-	elem = 0;
-	FOR_EACH_PTR(expr->expr_list, entry) {
-		elem++;
-	} END_FOR_EACH_PTR(entry);
-
-	if (!elem)
-		return;
-
-	list = malloc(sizeof(entry) * elem);
-	if (!list)
-		die("OOM in sort_array");
-
-	/* this code is no doubt evil and ignores EXPR_INDEX possibly
-	 * to its detriment and other nasty things.  improvements
-	 * welcome.
-	 */
-	i = 0;
-	sorted = 0;
-	FOR_EACH_PTR(expr->expr_list, entry) {
-		if ((entry->type == EXPR_POS) || (entry->type == EXPR_VALUE)) {
-			/* add entry to list[], in sorted order */
-			if (sorted == 0) {
-				list[0] = entry;
-				sorted = 1;
-			} else {
-				for (i = 0; i < sorted; i++)
-					if (sort_array_cmp(entry, list[i]) <= 0)
-						break;
-
-				/* If inserting into the middle of list[]
-				 * instead of appending, we memmove.
-				 * This is ugly, but thankfully
-				 * uncommon.  Input data with tons of
-				 * entries very rarely have explicit
-				 * offsets.  convert to qsort eventually...
-				 */
-				if (i != sorted)
-					memmove(&list[i + 1], &list[i],
-						(sorted - i) * sizeof(entry));
-				list[i] = entry;
-				sorted++;
-			}
-		}
-	} END_FOR_EACH_PTR(entry);
-
-	i = 0;
-	FOR_EACH_PTR(expr->expr_list, entry) {
-		if ((entry->type == EXPR_POS) || (entry->type == EXPR_VALUE))
-			*THIS_ADDRESS(entry) = list[i++];
-	} END_FOR_EACH_PTR(entry);
-
-}
-
-static void emit_array(struct symbol *sym)
-{
-	struct symbol *base_type = sym->ctype.base_type;
-	struct expression *expr = sym->initializer;
-	struct expression *entry;
-
-	assert(base_type != NULL);
-
-	stor_sym_init(sym);
-
-	ea_last = -1;
-
-	emit_object_pre(show_ident(sym->ident), sym->ctype.modifiers,
-		        sym->ctype.alignment,
-			sym->bit_size / 8);
-
-	sort_array(expr);
-
-	FOR_EACH_PTR(expr->expr_list, entry) {
-		if (entry->type == EXPR_VALUE) {
-			ea_current = 0;
-			emit_initializer(sym, entry);
-			ea_last = ea_current;
-		} else if (entry->type == EXPR_POS) {
-			ea_current =
-			    entry->init_offset / (base_type->bit_size / 8);
-			emit_initializer(sym, entry->init_expr);
-			ea_last = ea_current;
-		}
-	} END_FOR_EACH_PTR(entry);
-}
-
-void emit_one_symbol(struct symbol *sym)
-{
-	x86_symbol(sym);
-}
-
-static void emit_copy(struct storage *dest, struct storage *src,
-		      struct symbol *ctype)
-{
-	struct storage *reg = NULL;
-	unsigned int bit_size;
-
-	/* FIXME: Bitfield copy! */
-
-	bit_size = src->size * 8;
-	if (!bit_size)
-		bit_size = 32;
-	if ((src->type == STOR_ARG) && (bit_size < 32))
-		bit_size = 32;
-
-	reg = temp_from_bits(bit_size);
-	emit_move(src, reg, ctype, "begin copy ..");
-
-	bit_size = dest->size * 8;
-	if (!bit_size)
-		bit_size = 32;
-	if ((dest->type == STOR_ARG) && (bit_size < 32))
-		bit_size = 32;
-
-	emit_move(reg, dest, ctype, ".... end copy");
-	put_reg(reg);
-}
-
-static void emit_store(struct expression *dest_expr, struct storage *dest,
-		       struct storage *src, int bits)
-{
-	/* FIXME: Bitfield store! */
-	printf("\tst.%d\t\tv%d,[v%d]\n", bits, src->pseudo, dest->pseudo);
-}
-
-static void emit_scalar_noinit(struct symbol *sym)
-{
-	emit_global_noinit(show_ident(sym->ident),
-			   sym->ctype.modifiers, sym->ctype.alignment,
-			   sym->bit_size / 8);
-	stor_sym_init(sym);
-}
-
-static void emit_array_noinit(struct symbol *sym)
-{
-	emit_global_noinit(show_ident(sym->ident),
-			   sym->ctype.modifiers, sym->ctype.alignment,
-			   get_expression_value(sym->array_size) * (sym->bit_size / 8));
-	stor_sym_init(sym);
-}
-
-static const char *opbits(const char *insn, unsigned int bits)
-{
-	static char opbits_str[32];
-	char c;
-
-	switch (bits) {
-	case 8:	 c = 'b'; break;
-	case 16: c = 'w'; break;
-	case 32: c = 'l'; break;
-	case 64: c = 'q'; break;
-	default: abort(); break;
-	}
-
-	sprintf(opbits_str, "%s%c", insn, c);
-
-	return opbits_str;
-}
-
-static void emit_move(struct storage *src, struct storage *dest,
-		      struct symbol *ctype, const char *comment)
-{
-	unsigned int bits;
-	unsigned int is_signed;
-	unsigned int is_dest = (src->type == STOR_REG);
-	const char *opname;
-
-	if (ctype) {
-		bits = ctype->bit_size;
-		is_signed = type_is_signed(ctype);
-	} else {
-		bits = 32;
-		is_signed = 0;
-	}
-
-	/*
-	 * Are we moving from a register to a register?
-	 * Make the new reg to be the "cache".
-	 */
-	if ((dest->type == STOR_REG) && (src->type == STOR_REG)) {
-		struct storage *backing;
-
-reg_reg_move:
-		if (dest == src)
-			return;
-
-		backing = src->reg->contains;
-		if (backing) {
-			/* Is it still valid? */
-			if (backing->reg != src->reg)
-				backing = NULL;
-			else
-				backing->reg = dest->reg;
-		}
-		dest->reg->contains = backing;
-		insn("mov", src, dest, NULL);
-		return;
-	}
-
-	/*
-	 * Are we moving to a register from a non-reg?
-	 *
-	 * See if we have the non-reg source already cached
-	 * in a register..
-	 */
-	if (dest->type == STOR_REG) {
-		if (src->reg) {
-			struct reg_info *info = src->reg;
-			if (info->contains == src) {
-				src = reginfo_reg(info);
-				goto reg_reg_move;
-			}
-		}
-		dest->reg->contains = src;
-		src->reg = dest->reg;
-	}
-
-	if (src->type == STOR_REG) {
-		/* We could just mark the register dirty here and do lazy store.. */
-		src->reg->contains = dest;
-		dest->reg = src->reg;
-	}
-
-	if ((bits == 8) || (bits == 16)) {
-		if (is_dest)
-			opname = "mov";
-		else
-			opname = is_signed ? "movsx" : "movzx";
-	} else
-		opname = "mov";
-
-	insn(opbits(opname, bits), src, dest, comment);
-}
-
-static struct storage *emit_compare(struct expression *expr)
-{
-	struct storage *left = x86_expression(expr->left);
-	struct storage *right = x86_expression(expr->right);
-	struct storage *reg1, *reg2;
-	struct storage *new, *val;
-	const char *opname = NULL;
-	unsigned int right_bits = expr->right->ctype->bit_size;
-
-	switch(expr->op) {
-	case '<': 		opname = "setl";	break;
-	case '>':		opname = "setg";	break;
-	case SPECIAL_LTE:
-				opname = "setle";	break;
-	case SPECIAL_GTE:
-				opname = "setge";	break;
-	case SPECIAL_EQUAL:	opname = "sete";	break;
-	case SPECIAL_NOTEQUAL:	opname = "setne";	break;
-	case SPECIAL_UNSIGNED_LT:
-				opname = "setb";	break;
-	case SPECIAL_UNSIGNED_GT:
-				opname = "seta";	break;
-	case SPECIAL_UNSIGNED_LTE:
-				opname = "setb";	break;
-	case SPECIAL_UNSIGNED_GTE:
-				opname = "setae";	break;
-	default:
-		assert(0);
-		break;
-	}
-
-	/* init EDX to 0 */
-	val = new_storage(STOR_VALUE);
-	val->flags = STOR_WANTS_FREE;
-
-	reg1 = get_reg(&regclass_32_8);
-	emit_move(val, reg1, NULL, NULL);
-
-	/* move op1 into EAX */
-	reg2 = get_reg_value(left, get_regclass(expr->left));
-
-	/* perform comparison, RHS (op1, right) and LHS (op2, EAX) */
-	insn(opbits("cmp", right_bits), right, reg2, NULL);
-	put_reg(reg2);
-
-	/* store result of operation, 0 or 1, in DL using SETcc */
-	insn(opname, byte_reg(reg1), NULL, NULL);
-
-	/* finally, store the result (DL) in a new pseudo / stack slot */
-	new = stack_alloc(4);
-	emit_move(reg1, new, NULL, "end EXPR_COMPARE");
-	put_reg(reg1);
-
-	return new;
-}
-
-static struct storage *emit_value(struct expression *expr)
-{
-#if 0 /* old and slow way */
-	struct storage *new = stack_alloc(4);
-	struct storage *val;
-
-	val = new_storage(STOR_VALUE);
-	val->value = (long long) expr->value;
-	val->flags = STOR_WANTS_FREE;
-	insn("movl", val, new, NULL);
-
-	return new;
-#else
-	struct storage *val;
-
-	val = new_storage(STOR_VALUE);
-	val->value = (long long) expr->value;
-
-	return val;	/* FIXME: memory leak */
-#endif
-}
-
-static struct storage *emit_divide(struct expression *expr, struct storage *left, struct storage *right)
-{
-	struct storage *eax_edx;
-	struct storage *reg, *new;
-	struct storage *val = new_storage(STOR_VALUE);
-
-	emit_comment("begin DIVIDE");
-	eax_edx = get_hardreg(hardreg_storage_table + EAX_EDX, 1);
-
-	/* init EDX to 0 */
-	val->flags = STOR_WANTS_FREE;
-	emit_move(val, REG_EDX, NULL, NULL);
-
-	new = stack_alloc(expr->ctype->bit_size / 8);
-
-	/* EAX is dividend */
-	emit_move(left, REG_EAX, NULL, NULL);
-
-	reg = get_reg_value(right, &regclass_32);
-
-	/* perform binop */
-	insn("div", reg, REG_EAX, NULL);
-	put_reg(reg);
-
-	reg = REG_EAX;
-	if (expr->op == '%')
-		reg = REG_EDX;
-	emit_move(reg, new, NULL, NULL);
-
-	put_reg(eax_edx);
-	emit_comment("end DIVIDE");
-	return new;
-}
-
-static struct storage *emit_binop(struct expression *expr)
-{
-	struct storage *left = x86_expression(expr->left);
-	struct storage *right = x86_expression(expr->right);
-	struct storage *new;
-	struct storage *dest, *src;
-	const char *opname = NULL;
-	const char *suffix = NULL;
-	char opstr[16];
-	int is_signed;
-
-	/* Divides have special register constraints */
-	if ((expr->op == '/') || (expr->op == '%'))
-		return emit_divide(expr, left, right);
-
-	is_signed = type_is_signed(expr->ctype);
-
-	switch (expr->op) {
-	case '+':
-		opname = "add";
-		break;
-	case '-':
-		opname = "sub";
-		break;
-	case '&':
-		opname = "and";
-		break;
-	case '|':
-		opname = "or";
-		break;
-	case '^':
-		opname = "xor";
-		break;
-	case SPECIAL_LEFTSHIFT:
-		opname = "shl";
-		break;
-	case SPECIAL_RIGHTSHIFT:
-		if (is_signed)
-			opname = "sar";
-		else
-			opname = "shr";
-		break;
-	case '*':
-		if (is_signed)
-			opname = "imul";
-		else
-			opname = "mul";
-		break;
-	case SPECIAL_LOGICAL_AND:
-		warning(expr->pos, "bogus bitwise and for logical op (should use '2*setne + and' or something)");
-		opname = "and";
-		break;
-	case SPECIAL_LOGICAL_OR:
-		warning(expr->pos, "bogus bitwise or for logical op (should use 'or + setne' or something)");
-		opname = "or";
-		break;
-	default:
-		error_die(expr->pos, "unhandled binop '%s'\n", show_special(expr->op));
-		break;
-	}
-
-	dest = get_reg_value(right, &regclass_32);
-	src = get_reg_value(left, &regclass_32);
-	switch (expr->ctype->bit_size) {
-	case 8:
-		suffix = "b";
-		break;
-	case 16:
-		suffix = "w";
-		break;
-	case 32:
-		suffix = "l";
-		break;
-	case 64:
-		suffix = "q";		/* FIXME */
-		break;
-	default:
-		assert(0);
-		break;
-	}
-
-	snprintf(opstr, sizeof(opstr), "%s%s", opname, suffix);
-
-	/* perform binop */
-	insn(opstr, src, dest, NULL);
-	put_reg(src);
-
-	/* store result in new pseudo / stack slot */
-	new = stack_alloc(expr->ctype->bit_size / 8);
-	emit_move(dest, new, NULL, "end EXPR_BINOP");
-
-	put_reg(dest);
-
-	return new;
-}
-
-static int emit_conditional_test(struct storage *val)
-{
-	struct storage *reg;
-	struct storage *target_val;
-	int target_false;
-
-	/* load result into EAX */
-	emit_comment("begin if/conditional");
-	reg = get_reg_value(val, &regclass_32);
-
-	/* compare result with zero */
-	insn("test", reg, reg, NULL);
-	put_reg(reg);
-
-	/* create conditional-failed label to jump to */
-	target_false = new_label();
-	target_val = new_storage(STOR_LABEL);
-	target_val->label = target_false;
-	target_val->flags = STOR_WANTS_FREE;
-	insn("jz", target_val, NULL, NULL);
-
-	return target_false;
-}
-
-static int emit_conditional_end(int target_false)
-{
-	struct storage *cond_end_st;
-	int cond_end;
-
-	/* finished generating code for if-true statement.
-	 * add a jump-to-end jump to avoid falling through
-	 * to the if-false statement code.
-	 */
-	cond_end = new_label();
-	cond_end_st = new_storage(STOR_LABEL);
-	cond_end_st->label = cond_end;
-	cond_end_st->flags = STOR_WANTS_FREE;
-	insn("jmp", cond_end_st, NULL, NULL);
-
-	/* if we have both if-true and if-false statements,
-	 * the failed-conditional case will fall through to here
-	 */
-	emit_label(target_false, NULL);
-
-	return cond_end;
-}
-
-static void emit_if_conditional(struct statement *stmt)
-{
-	struct storage *val;
-	int cond_end;
-
-	/* emit test portion of conditional */
-	val = x86_expression(stmt->if_conditional);
-	cond_end = emit_conditional_test(val);
-
-	/* emit if-true statement */
-	x86_statement(stmt->if_true);
-
-	/* emit if-false statement, if present */
-	if (stmt->if_false) {
-		cond_end = emit_conditional_end(cond_end);
-		x86_statement(stmt->if_false);
-	}
-
-	/* end of conditional; jump target for if-true branch */
-	emit_label(cond_end, "end if");
-}
-
-static struct storage *emit_inc_dec(struct expression *expr, int postop)
-{
-	struct storage *addr = x86_address_gen(expr->unop);
-	struct storage *retval;
-	char opname[16];
-
-	strcpy(opname, opbits(expr->op == SPECIAL_INCREMENT ? "inc" : "dec",
-			      expr->ctype->bit_size));
-
-	if (postop) {
-		struct storage *new = stack_alloc(4);
-
-		emit_copy(new, addr, expr->unop->ctype);
-
-		retval = new;
-	} else
-		retval = addr;
-
-	insn(opname, addr, NULL, NULL);
-
-	return retval;
-}
-
-static struct storage *emit_postop(struct expression *expr)
-{
-	return emit_inc_dec(expr, 1);
-}
-
-static struct storage *emit_return_stmt(struct statement *stmt)
-{
-	struct function *f = current_func;
-	struct expression *expr = stmt->ret_value;
-	struct storage *val = NULL, *jmplbl;
-
-	if (expr && expr->ctype) {
-		val = x86_expression(expr);
-		assert(val != NULL);
-		emit_move(val, REG_EAX, expr->ctype, "return");
-	}
-
-	jmplbl = new_storage(STOR_LABEL);
-	jmplbl->flags |= STOR_WANTS_FREE;
-	jmplbl->label = f->ret_target;
-	insn("jmp", jmplbl, NULL, NULL);
-
-	return val;
-}
-
-static struct storage *emit_conditional_expr(struct expression *expr)
-{
-	struct storage *cond, *true = NULL, *false = NULL;
-	struct storage *new = stack_alloc(expr->ctype->bit_size / 8);
-	int target_false, cond_end;
-
-	/* evaluate conditional */
-	cond = x86_expression(expr->conditional);
-	target_false = emit_conditional_test(cond);
-
-	/* handle if-true part of the expression */
-	true = x86_expression(expr->cond_true);
-
-	emit_copy(new, true, expr->ctype);
-
-	cond_end = emit_conditional_end(target_false);
-
-	/* handle if-false part of the expression */
-	false = x86_expression(expr->cond_false);
-
-	emit_copy(new, false, expr->ctype);
-
-	/* end of conditional; jump target for if-true branch */
-	emit_label(cond_end, "end conditional");
-
-	return new;
-}
-
-static struct storage *emit_select_expr(struct expression *expr)
-{
-	struct storage *cond = x86_expression(expr->conditional);
-	struct storage *true = x86_expression(expr->cond_true);
-	struct storage *false = x86_expression(expr->cond_false);
-	struct storage *reg_cond, *reg_true, *reg_false;
-	struct storage *new = stack_alloc(4);
-
-	emit_comment("begin SELECT");
-	reg_cond = get_reg_value(cond, get_regclass(expr->conditional));
-	reg_true = get_reg_value(true, get_regclass(expr));
-	reg_false = get_reg_value(false, get_regclass(expr));
-
-	/*
-	 * Do the actual select: check the conditional for zero,
-	 * move false over true if zero
-	 */ 
-	insn("test", reg_cond, reg_cond, NULL);
-	insn("cmovz", reg_false, reg_true, NULL);
-
-	/* Store it back */
-	emit_move(reg_true, new, expr->ctype, NULL);
-	put_reg(reg_cond);
-	put_reg(reg_true);
-	put_reg(reg_false);
-	emit_comment("end SELECT");
-	return new;
-}
-
-static struct storage *emit_symbol_expr_init(struct symbol *sym)
-{
-	struct expression *expr = sym->initializer;
-	struct symbol_private *priv = sym->aux;
-
-	if (priv == NULL) {
-		priv = calloc(1, sizeof(*priv));
-		sym->aux = priv;
-
-		if (expr == NULL) {
-			struct storage *new = stack_alloc(4);
-			fprintf(stderr, "FIXME! no value for symbol %s.  creating pseudo %d (stack offset %d)\n",
-				show_ident(sym->ident),
-				new->pseudo, new->pseudo * 4);
-			priv->addr = new;
-		} else {
-			priv->addr = x86_expression(expr);
-		}
-	}
-
-	return priv->addr;
-}
-
-static struct storage *emit_string_expr(struct expression *expr)
-{
-	struct function *f = current_func;
-	int label = new_label();
-	struct storage *new;
-
-	push_cstring(f, expr->string, label);
-
-	new = new_storage(STOR_LABEL);
-	new->label = label;
-	new->flags = STOR_LABEL_VAL | STOR_WANTS_FREE;
-	return new;
-}
-
-static struct storage *emit_cast_expr(struct expression *expr)
-{
-	struct symbol *old_type, *new_type;
-	struct storage *op = x86_expression(expr->cast_expression);
-	int oldbits, newbits;
-	struct storage *new;
-
-	old_type = expr->cast_expression->ctype;
-	new_type = expr->cast_type;
-
-	oldbits = old_type->bit_size;
-	newbits = new_type->bit_size;
-	if (oldbits >= newbits)
-		return op;
-
-	emit_move(op, REG_EAX, old_type, "begin cast ..");
-
-	new = stack_alloc(newbits / 8);
-	emit_move(REG_EAX, new, new_type, ".... end cast");
-
-	return new;
-}
-
-static struct storage *emit_regular_preop(struct expression *expr)
-{
-	struct storage *target = x86_expression(expr->unop);
-	struct storage *val, *new = stack_alloc(4);
-	const char *opname = NULL;
-
-	switch (expr->op) {
-	case '!':
-		val = new_storage(STOR_VALUE);
-		val->flags = STOR_WANTS_FREE;
-		emit_move(val, REG_EDX, NULL, NULL);
-		emit_move(target, REG_EAX, expr->unop->ctype, NULL);
-		insn("test", REG_EAX, REG_EAX, NULL);
-		insn("setz", REG_DL, NULL, NULL);
-		emit_move(REG_EDX, new, expr->unop->ctype, NULL);
-
-		break;
-	case '~':
-		opname = "not";
-	case '-':
-		if (!opname)
-			opname = "neg";
-		emit_move(target, REG_EAX, expr->unop->ctype, NULL);
-		insn(opname, REG_EAX, NULL, NULL);
-		emit_move(REG_EAX, new, expr->unop->ctype, NULL);
-		break;
-	default:
-		assert(0);
-		break;
-	}
-
-	return new;
-}
-
-static void emit_case_statement(struct statement *stmt)
-{
-	emit_labelsym(stmt->case_label, NULL);
-	x86_statement(stmt->case_statement);
-}
-
-static void emit_switch_statement(struct statement *stmt)
-{
-	struct storage *val = x86_expression(stmt->switch_expression);
-	struct symbol *sym, *default_sym = NULL;
-	struct storage *labelsym, *label;
-	int switch_end = 0;
-
-	emit_move(val, REG_EAX, stmt->switch_expression->ctype, "begin case");
-
-	/*
-	 * This is where a _real_ back-end would go through the
-	 * cases to decide whether to use a lookup table or a
-	 * series of comparisons etc
-	 */
-	FOR_EACH_PTR(stmt->switch_case->symbol_list, sym) {
-		struct statement *case_stmt = sym->stmt;
-		struct expression *expr = case_stmt->case_expression;
-		struct expression *to = case_stmt->case_to;
-
-		/* default: */
-		if (!expr)
-			default_sym = sym;
-
-		/* case NNN: */
-		else {
-			struct storage *case_val = new_val(expr->value);
-
-			assert (expr->type == EXPR_VALUE);
-
-			insn("cmpl", case_val, REG_EAX, NULL);
-
-			if (!to) {
-				labelsym = new_labelsym(sym);
-				insn("je", labelsym, NULL, NULL);
-			} else {
-				int next_test;
-
-				label = new_storage(STOR_LABEL);
-				label->flags |= STOR_WANTS_FREE;
-				label->label = next_test = new_label();
-
-				/* FIXME: signed/unsigned */
-				insn("jl", label, NULL, NULL);
-
-				case_val = new_val(to->value);
-				insn("cmpl", case_val, REG_EAX, NULL);
-
-				/* TODO: implement and use refcounting... */
-				label = new_storage(STOR_LABEL);
-				label->flags |= STOR_WANTS_FREE;
-				label->label = next_test;
-
-				/* FIXME: signed/unsigned */
-				insn("jg", label, NULL, NULL);
-
-				labelsym = new_labelsym(sym);
-				insn("jmp", labelsym, NULL, NULL);
-
-				emit_label(next_test, NULL);
-			}
-		}
-	} END_FOR_EACH_PTR(sym);
-
-	if (default_sym) {
-		labelsym = new_labelsym(default_sym);
-		insn("jmp", labelsym, NULL, "default");
-	} else {
-		label = new_storage(STOR_LABEL);
-		label->flags |= STOR_WANTS_FREE;
-		label->label = switch_end = new_label();
-		insn("jmp", label, NULL, "goto end of switch");
-	}
-
-	x86_statement(stmt->switch_statement);
-
-	if (stmt->switch_break->used)
-		emit_labelsym(stmt->switch_break, NULL);
-
-	if (switch_end)
-		emit_label(switch_end, NULL);
-}
-
-static void x86_struct_member(struct symbol *sym)
-{
-	printf("\t%s:%d:%ld at offset %ld.%d", show_ident(sym->ident), sym->bit_size, sym->ctype.alignment, sym->offset, sym->bit_offset);
-	printf("\n");
-}
-
-static void x86_symbol(struct symbol *sym)
-{
-	struct symbol *type;
-
-	if (!sym)
-		return;
-
-	type = sym->ctype.base_type;
-	if (!type)
-		return;
-
-	/*
-	 * Show actual implementation information
-	 */
-	switch (type->type) {
-
-	case SYM_ARRAY:
-		if (sym->initializer)
-			emit_array(sym);
-		else
-			emit_array_noinit(sym);
-		break;
-
-	case SYM_BASETYPE:
-		if (sym->initializer) {
-			emit_object_pre(show_ident(sym->ident),
-					sym->ctype.modifiers,
-				        sym->ctype.alignment,
-					sym->bit_size / 8);
-			emit_scalar(sym->initializer, sym->bit_size);
-			stor_sym_init(sym);
-		} else
-			emit_scalar_noinit(sym);
-		break;
-
-	case SYM_STRUCT:
-	case SYM_UNION: {
-		struct symbol *member;
-
-		printf(" {\n");
-		FOR_EACH_PTR(type->symbol_list, member) {
-			x86_struct_member(member);
-		} END_FOR_EACH_PTR(member);
-		printf("}\n");
-		break;
-	}
-
-	case SYM_FN: {
-		struct statement *stmt = type->stmt;
-		if (stmt) {
-			emit_func_pre(sym);
-			x86_statement(stmt);
-			emit_func_post(sym);
-		}
-		break;
-	}
-
-	default:
-		break;
-	}
-
-	if (sym->initializer && (type->type != SYM_BASETYPE) &&
-	    (type->type != SYM_ARRAY)) {
-		printf(" = \n");
-		x86_expression(sym->initializer);
-	}
-}
-
-static void x86_symbol_init(struct symbol *sym);
-
-static void x86_symbol_decl(struct symbol_list *syms)
-{
-	struct symbol *sym;
-	FOR_EACH_PTR(syms, sym) {
-		x86_symbol_init(sym);
-	} END_FOR_EACH_PTR(sym);
-}
-
-static void loopstk_push(int cont_lbl, int loop_bottom_lbl)
-{
-	struct function *f = current_func;
-	struct loop_stack *ls;
-
-	ls = malloc(sizeof(*ls));
-	ls->continue_lbl = cont_lbl;
-	ls->loop_bottom_lbl = loop_bottom_lbl;
-	ls->next = f->loop_stack;
-	f->loop_stack = ls;
-}
-
-static void loopstk_pop(void)
-{
-	struct function *f = current_func;
-	struct loop_stack *ls;
-
-	assert(f->loop_stack != NULL);
-	ls = f->loop_stack;
-	f->loop_stack = f->loop_stack->next;
-	free(ls);
-}
-
-static int loopstk_break(void)
-{
-	return current_func->loop_stack->loop_bottom_lbl;
-}
-
-static int loopstk_continue(void)
-{
-	return current_func->loop_stack->continue_lbl;
-}
-
-static void emit_loop(struct statement *stmt)
-{
-	struct statement  *pre_statement = stmt->iterator_pre_statement;
-	struct expression *pre_condition = stmt->iterator_pre_condition;
-	struct statement  *statement = stmt->iterator_statement;
-	struct statement  *post_statement = stmt->iterator_post_statement;
-	struct expression *post_condition = stmt->iterator_post_condition;
-	int loop_top = 0, loop_bottom, loop_continue;
-	int have_bottom = 0;
-	struct storage *val;
-
-	loop_bottom = new_label();
-	loop_continue = new_label();
-	loopstk_push(loop_continue, loop_bottom);
-
-	x86_symbol_decl(stmt->iterator_syms);
-	x86_statement(pre_statement);
-	if (!post_condition || post_condition->type != EXPR_VALUE || post_condition->value) {
-		loop_top = new_label();
-		emit_label(loop_top, "loop top");
-	}
-	if (pre_condition) {
-		if (pre_condition->type == EXPR_VALUE) {
-			if (!pre_condition->value) {
-				struct storage *lbv;
-				lbv = new_storage(STOR_LABEL);
-				lbv->label = loop_bottom;
-				lbv->flags = STOR_WANTS_FREE;
-				insn("jmp", lbv, NULL, "go to loop bottom");
-				have_bottom = 1;
-			}
-		} else {
-			struct storage *lbv = new_storage(STOR_LABEL);
-			lbv->label = loop_bottom;
-			lbv->flags = STOR_WANTS_FREE;
-			have_bottom = 1;
-
-			val = x86_expression(pre_condition);
-
-			emit_move(val, REG_EAX, NULL, "loop pre condition");
-			insn("test", REG_EAX, REG_EAX, NULL);
-			insn("jz", lbv, NULL, NULL);
-		}
-	}
-	x86_statement(statement);
-	if (stmt->iterator_continue->used)
-		emit_label(loop_continue, "'continue' iterator");
-	x86_statement(post_statement);
-	if (!post_condition) {
-		struct storage *lbv = new_storage(STOR_LABEL);
-		lbv->label = loop_top;
-		lbv->flags = STOR_WANTS_FREE;
-		insn("jmp", lbv, NULL, "go to loop top");
-	} else if (post_condition->type == EXPR_VALUE) {
-		if (post_condition->value) {
-			struct storage *lbv = new_storage(STOR_LABEL);
-			lbv->label = loop_top;
-			lbv->flags = STOR_WANTS_FREE;
-			insn("jmp", lbv, NULL, "go to loop top");
-		}
-	} else {
-		struct storage *lbv = new_storage(STOR_LABEL);
-		lbv->label = loop_top;
-		lbv->flags = STOR_WANTS_FREE;
-
-		val = x86_expression(post_condition);
-
-		emit_move(val, REG_EAX, NULL, "loop post condition");
-		insn("test", REG_EAX, REG_EAX, NULL);
-		insn("jnz", lbv, NULL, NULL);
-	}
-	if (have_bottom || stmt->iterator_break->used)
-		emit_label(loop_bottom, "loop bottom");
-
-	loopstk_pop();
-}
-
-/*
- * Print out a statement
- */
-static struct storage *x86_statement(struct statement *stmt)
-{
-	if (!stmt)
-		return NULL;
-	switch (stmt->type) {
-	default:
-		return NULL;
-	case STMT_RETURN:
-		return emit_return_stmt(stmt);
-	case STMT_DECLARATION:
-		x86_symbol_decl(stmt->declaration);
-		break;
-	case STMT_COMPOUND: {
-		struct statement *s;
-		struct storage *last = NULL;
-
-		FOR_EACH_PTR(stmt->stmts, s) {
-			last = x86_statement(s);
-		} END_FOR_EACH_PTR(s);
-
-		return last;
-	}
-
-	case STMT_EXPRESSION:
-		return x86_expression(stmt->expression);
-	case STMT_IF:
-		emit_if_conditional(stmt);
-		return NULL;
-
-	case STMT_CASE:
-		emit_case_statement(stmt);
-		break;
-	case STMT_SWITCH:
-		emit_switch_statement(stmt);
-		break;
-
-	case STMT_ITERATOR:
-		emit_loop(stmt);
-		break;
-
-	case STMT_NONE:
-		break;
-
-	case STMT_LABEL:
-		printf(".L%p:\n", stmt->label_identifier);
-		x86_statement(stmt->label_statement);
-		break;
-
-	case STMT_GOTO:
-		if (stmt->goto_expression) {
-			struct storage *val = x86_expression(stmt->goto_expression);
-			printf("\tgoto *v%d\n", val->pseudo);
-		} else if (!strcmp("break", show_ident(stmt->goto_label->ident))) {
-			struct storage *lbv = new_storage(STOR_LABEL);
-			lbv->label = loopstk_break();
-			lbv->flags = STOR_WANTS_FREE;
-			insn("jmp", lbv, NULL, "'break'; go to loop bottom");
-		} else if (!strcmp("continue", show_ident(stmt->goto_label->ident))) {
-			struct storage *lbv = new_storage(STOR_LABEL);
-			lbv->label = loopstk_continue();
-			lbv->flags = STOR_WANTS_FREE;
-			insn("jmp", lbv, NULL, "'continue'; go to loop top");
-		} else {
-			struct storage *labelsym = new_labelsym(stmt->goto_label);
-			insn("jmp", labelsym, NULL, NULL);
-		}
-		break;
-	case STMT_ASM:
-		printf("\tasm( .... )\n");
-		break;
-	}
-	return NULL;
-}
-
-static struct storage *x86_call_expression(struct expression *expr)
-{
-	struct function *f = current_func;
-	struct symbol *direct;
-	struct expression *arg, *fn;
-	struct storage *retval, *fncall;
-	int framesize;
-	char s[64];
-
-	if (!expr->ctype) {
-		warning(expr->pos, "\tcall with no type!");
-		return NULL;
-	}
-
-	framesize = 0;
-	FOR_EACH_PTR_REVERSE(expr->args, arg) {
-		struct storage *new = x86_expression(arg);
-		int size = arg->ctype->bit_size;
-
-		/*
-		 * FIXME: i386 SysV ABI dictates that values
-		 * smaller than 32 bits should be placed onto
-		 * the stack as 32-bit objects.  We should not
-		 * blindly do a 32-bit push on objects smaller
-		 * than 32 bits.
-		 */
-		if (size < 32)
-			size = 32;
-		insn("pushl", new, NULL,
-		     !framesize ? "begin function call" : NULL);
-
-		framesize += bits_to_bytes(size);
-	} END_FOR_EACH_PTR_REVERSE(arg);
-
-	fn = expr->fn;
-
-	/* Remove dereference, if any */
-	direct = NULL;
-	if (fn->type == EXPR_PREOP) {
-		if (fn->unop->type == EXPR_SYMBOL) {
-			struct symbol *sym = fn->unop->symbol;
-			if (sym->ctype.base_type->type == SYM_FN)
-				direct = sym;
-		}
-	}
-	if (direct) {
-		struct storage *direct_stor = new_storage(STOR_SYM);
-		direct_stor->flags |= STOR_WANTS_FREE;
-		direct_stor->sym = direct;
-		insn("call", direct_stor, NULL, NULL);
-	} else {
-		fncall = x86_expression(fn);
-		emit_move(fncall, REG_EAX, fn->ctype, NULL);
-
-		strcpy(s, "\tcall\t*%eax\n");
-		push_text_atom(f, s);
-	}
-
-	/* FIXME: pay attention to BITS_IN_POINTER */
-	if (framesize) {
-		struct storage *val = new_storage(STOR_VALUE);
-		val->value = (long long) framesize;
-		val->flags = STOR_WANTS_FREE;
-		insn("addl", val, REG_ESP, NULL);
-	}
-
-	retval = stack_alloc(4);
-	emit_move(REG_EAX, retval, NULL, "end function call");
-
-	return retval;
-}
-
-static struct storage *x86_address_gen(struct expression *expr)
-{
-	struct function *f = current_func;
-	struct storage *addr;
-	struct storage *new;
-	char s[32];
-
-	addr = x86_expression(expr->unop);
-	if (expr->unop->type == EXPR_SYMBOL)
-		return addr;
-
-	emit_move(addr, REG_EAX, NULL, "begin deref ..");
-
-	/* FIXME: operand size */
-	strcpy(s, "\tmovl\t(%eax), %ecx\n");
-	push_text_atom(f, s);
-
-	new = stack_alloc(4);
-	emit_move(REG_ECX, new, NULL, ".... end deref");
-
-	return new;
-}
-
-static struct storage *x86_assignment(struct expression *expr)
-{
-	struct expression *target = expr->left;
-	struct storage *val, *addr;
-
-	if (!expr->ctype)
-		return NULL;
-
-	val = x86_expression(expr->right);
-	addr = x86_address_gen(target);
-
-	switch (val->type) {
-	/* copy, where both operands are memory */
-	case STOR_PSEUDO:
-	case STOR_ARG:
-		emit_copy(addr, val, expr->ctype);
-		break;
-
-	/* copy, one or zero operands are memory */
-	case STOR_REG:
-	case STOR_SYM:
-	case STOR_VALUE:
-	case STOR_LABEL:
-		emit_move(val, addr, expr->left->ctype, NULL);
-		break;
-
-	case STOR_LABELSYM:
-		assert(0);
-		break;
-	}
-	return val;
-}
-
-static int x86_initialization(struct symbol *sym, struct expression *expr)
-{
-	struct storage *val, *addr;
-	int bits;
-
-	if (!expr->ctype)
-		return 0;
-
-	bits = expr->ctype->bit_size;
-	val = x86_expression(expr);
-	addr = x86_symbol_expr(sym);
-	// FIXME! The "target" expression is for bitfield store information.
-	// Leave it NULL, which works fine.
-	emit_store(NULL, addr, val, bits);
-	return 0;
-}
-
-static struct storage *x86_access(struct expression *expr)
-{
-	return x86_address_gen(expr);
-}
-
-static struct storage *x86_preop(struct expression *expr)
-{
-	/*
-	 * '*' is an lvalue access, and is fundamentally different
-	 * from an arithmetic operation. Maybe it should have an
-	 * expression type of its own..
-	 */
-	if (expr->op == '*')
-		return x86_access(expr);
-	if (expr->op == SPECIAL_INCREMENT || expr->op == SPECIAL_DECREMENT)
-		return emit_inc_dec(expr, 0);
-	return emit_regular_preop(expr);
-}
-
-static struct storage *x86_symbol_expr(struct symbol *sym)
-{
-	struct storage *new = stack_alloc(4);
-
-	if (sym->ctype.modifiers & (MOD_TOPLEVEL | MOD_EXTERN | MOD_STATIC)) {
-		printf("\tmovi.%d\t\tv%d,$%s\n", bits_in_pointer, new->pseudo, show_ident(sym->ident));
-		return new;
-	}
-	if (sym->ctype.modifiers & MOD_ADDRESSABLE) {
-		printf("\taddi.%d\t\tv%d,vFP,$%lld\n", bits_in_pointer, new->pseudo, sym->value);
-		return new;
-	}
-	printf("\taddi.%d\t\tv%d,vFP,$offsetof(%s:%p)\n", bits_in_pointer, new->pseudo, show_ident(sym->ident), sym);
-	return new;
-}
-
-static void x86_symbol_init(struct symbol *sym)
-{
-	struct symbol_private *priv = sym->aux;
-	struct expression *expr = sym->initializer;
-	struct storage *new;
-
-	if (expr)
-		new = x86_expression(expr);
-	else
-		new = stack_alloc(sym->bit_size / 8);
-
-	if (!priv) {
-		priv = calloc(1, sizeof(*priv));
-		sym->aux = priv;
-		/* FIXME: leak! we don't free... */
-		/* (well, we don't free symbols either) */
-	}
-
-	priv->addr = new;
-}
-
-static int type_is_signed(struct symbol *sym)
-{
-	if (sym->type == SYM_NODE)
-		sym = sym->ctype.base_type;
-	if (sym->type == SYM_PTR)
-		return 0;
-	return !(sym->ctype.modifiers & MOD_UNSIGNED);
-}
-
-static struct storage *x86_label_expr(struct expression *expr)
-{
-	struct storage *new = stack_alloc(4);
-	printf("\tmovi.%d\t\tv%d,.L%p\n", bits_in_pointer, new->pseudo, expr->label_symbol);
-	return new;
-}
-
-static struct storage *x86_statement_expr(struct expression *expr)
-{
-	return x86_statement(expr->statement);
-}
-
-static int x86_position_expr(struct expression *expr, struct symbol *base)
-{
-	struct storage *new = x86_expression(expr->init_expr);
-	struct symbol *ctype = expr->init_expr->ctype;
-
-	printf("\tinsert v%d at [%d:%d] of %s\n", new->pseudo,
-		expr->init_offset, ctype->bit_offset,
-		show_ident(base->ident));
-	return 0;
-}
-
-static void x86_initializer_expr(struct expression *expr, struct symbol *ctype)
-{
-	struct expression *entry;
-
-	FOR_EACH_PTR(expr->expr_list, entry) {
-		// Nested initializers have their positions already
-		// recursively calculated - just output them too
-		if (entry->type == EXPR_INITIALIZER) {
-			x86_initializer_expr(entry, ctype);
-			continue;
-		}
-
-		// Ignore initializer indexes and identifiers - the
-		// evaluator has taken them into account
-		if (entry->type == EXPR_IDENTIFIER || entry->type == EXPR_INDEX)
-			continue;
-		if (entry->type == EXPR_POS) {
-			x86_position_expr(entry, ctype);
-			continue;
-		}
-		x86_initialization(ctype, entry);
-	} END_FOR_EACH_PTR(entry);
-}
-
-/*
- * Print out an expression. Return the pseudo that contains the
- * variable.
- */
-static struct storage *x86_expression(struct expression *expr)
-{
-	if (!expr)
-		return NULL;
-
-	if (!expr->ctype) {
-		struct position *pos = &expr->pos;
-		printf("\tno type at %s:%d:%d\n",
-			stream_name(pos->stream),
-			pos->line, pos->pos);
-		return NULL;
-	}
-
-	switch (expr->type) {
-	default:
-		return NULL;
-	case EXPR_CALL:
-		return x86_call_expression(expr);
-
-	case EXPR_ASSIGNMENT:
-		return x86_assignment(expr);
-
-	case EXPR_COMPARE:
-		return emit_compare(expr);
-	case EXPR_BINOP:
-	case EXPR_COMMA:
-	case EXPR_LOGICAL:
-		return emit_binop(expr);
-	case EXPR_PREOP:
-		return x86_preop(expr);
-	case EXPR_POSTOP:
-		return emit_postop(expr);
-	case EXPR_SYMBOL:
-		return emit_symbol_expr_init(expr->symbol);
-	case EXPR_DEREF:
-	case EXPR_SIZEOF:
-	case EXPR_ALIGNOF:
-		warning(expr->pos, "invalid expression after evaluation");
-		return NULL;
-	case EXPR_CAST:
-	case EXPR_FORCE_CAST:
-	case EXPR_IMPLIED_CAST:
-		return emit_cast_expr(expr);
-	case EXPR_VALUE:
-		return emit_value(expr);
-	case EXPR_STRING:
-		return emit_string_expr(expr);
-	case EXPR_INITIALIZER:
-		x86_initializer_expr(expr, expr->ctype);
-		return NULL;
-	case EXPR_SELECT:
-		return emit_select_expr(expr);
-	case EXPR_CONDITIONAL:
-		return emit_conditional_expr(expr);
-	case EXPR_STATEMENT:
-		return x86_statement_expr(expr);
-	case EXPR_LABEL:
-		return x86_label_expr(expr);
-
-	// None of these should exist as direct expressions: they are only
-	// valid as sub-expressions of initializers.
-	case EXPR_POS:
-		warning(expr->pos, "unable to show plain initializer position expression");
-		return NULL;
-	case EXPR_IDENTIFIER:
-		warning(expr->pos, "unable to show identifier expression");
-		return NULL;
-	case EXPR_INDEX:
-		warning(expr->pos, "unable to show index expression");
-		return NULL;
-	case EXPR_TYPE:
-		warning(expr->pos, "unable to show type expression");
-		return NULL;
-	case EXPR_FVALUE:
-		warning(expr->pos, "floating point support is not implemented");
-		return NULL;
-	}
-	return NULL;
-}
diff --git a/compile.c b/compile.c
deleted file mode 100644
index 48f9c70..0000000
--- a/compile.c
+++ /dev/null
@@ -1,84 +0,0 @@
-/*
- * Example trivial client program that uses the sparse library
- * and x86 backend.
- *
- * Copyright (C) 2003 Transmeta Corp.
- *               2003 Linus Torvalds
- * Copyright 2003 Jeff Garzik
- *
- * Permission is hereby granted, free of charge, to any person obtaining a copy
- * of this software and associated documentation files (the "Software"), to deal
- * in the Software without restriction, including without limitation the rights
- * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
- * copies of the Software, and to permit persons to whom the Software is
- * furnished to do so, subject to the following conditions:
- *
- * The above copyright notice and this permission notice shall be included in
- * all copies or substantial portions of the Software.
- *
- * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
- * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
- * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
- * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
- * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
- * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
- * THE SOFTWARE.
- *
- */
-#include <stdarg.h>
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#include <ctype.h>
-#include <unistd.h>
-#include <fcntl.h>
-
-#include "lib.h"
-#include "allocate.h"
-#include "token.h"
-#include "parse.h"
-#include "symbol.h"
-#include "expression.h"
-#include "compile.h"
-
-static void clean_up_symbols(struct symbol_list *list)
-{
-	struct symbol *sym;
-
-	FOR_EACH_PTR(list, sym) {
-		expand_symbol(sym);
-		emit_one_symbol(sym);
-	} END_FOR_EACH_PTR(sym);
-}
-
-int main(int argc, char **argv)
-{
-	char *file;
-	struct string_list *filelist = NULL;
-
-	clean_up_symbols(sparse_initialize(argc, argv, &filelist));
-	FOR_EACH_PTR_NOTAG(filelist, file) {
-		struct symbol_list *list;
-		const char *basename = strrchr(file, '/');
-		basename = basename ?  basename+1 : file;
-
-		list = sparse(file);
-
-		// Do type evaluation and simplification
-		emit_unit_begin(basename);
-		clean_up_symbols(list);
-		emit_unit_end();
-	} END_FOR_EACH_PTR_NOTAG(file);
-
-#if 0
-	// And show the allocation statistics
-	show_ident_alloc();
-	show_token_alloc();
-	show_symbol_alloc();
-	show_expression_alloc();
-	show_statement_alloc();
-	show_string_alloc();
-	show_bytes_alloc();
-#endif
-	return 0;
-}
diff --git a/compile.h b/compile.h
deleted file mode 100644
index 177363a..0000000
--- a/compile.h
+++ /dev/null
@@ -1,10 +0,0 @@
-#ifndef COMPILE_H
-#define COMPILE_H
-
-struct symbol;
-
-extern void emit_one_symbol(struct symbol *);
-extern void emit_unit_begin(const char *);
-extern void emit_unit_end(void);
-
-#endif /* COMPILE_H */
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 4/5] LLVMLinux: Add support for clang to compiler.h and new compiler-clang.h ===

From: behanw () converseincode ! com
To: linux-sparse
Subject: [PATCH 4/5] LLVMLinux: Add support for clang to compiler.h and new compiler-clang.h
Date: Wed, 26 Feb 2014 01:08:42 +0000
Message-ID: <1393376923-21892-5-git-send-email-behanw () converseincode ! com>
--------------------
From: Mark Charlebois <charlebm@gmail.com>

Add a compiler-clang.h file to add specific macros needed for compiling the
kernel with clang.

Initially the only override required is the macro for silencing the
compiler for a purposefully uninintialized variable.

Author: Mark Charlebois <charlebm@gmail.com>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
Signed-off-by: Behan Webster <behanw@converseincode.com>
---
 include/linux/compiler-clang.h | 12 ++++++++++++
 include/linux/compiler.h       |  7 +++++++
 2 files changed, 19 insertions(+)
 create mode 100644 include/linux/compiler-clang.h

diff --git a/include/linux/compiler-clang.h b/include/linux/compiler-clang.h
new file mode 100644
index 0000000..d1e49d5
--- /dev/null
+++ b/include/linux/compiler-clang.h
@@ -0,0 +1,12 @@
+#ifndef __LINUX_COMPILER_H
+#error "Please don't include <linux/compiler-clang.h> directly, include <linux/compiler.h> instead."
+#endif
+
+/* Some compiler specific definitions are overwritten here
+ * for Clang compiler
+ */
+
+#ifdef uninitialized_var
+#undef uninitialized_var
+#define uninitialized_var(x) x = *(&(x))
+#endif
diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index 2472740..ee7239e 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -63,6 +63,13 @@ extern void __chk_io_ptr(const volatile void __iomem *);
 # include <linux/compiler-intel.h>
 #endif
 
+/* Clang compiler defines __GNUC__. So we will overwrite implementations
+ * coming from above header files here
+ */
+#ifdef __clang__
+#include <linux/compiler-clang.h>
+#endif
+
 /*
  * Generic compiler-dependent macros required for kernel
  * build go below this comment. Actual compiler/compiler version
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 4/5] ftrace: Require designated initialization of structures ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH 4/5] ftrace: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:47:59 +0000
Message-ID: <bf79fbd5a2a1b24a4df6a4ee14c8b81be6b0b2ff.1406850006.git.josh () joshtriplett ! org>
--------------------
Mark various ftrace structures with __designated_init.  Fix some ftrace
macros to use designated initializers for those structures.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/ftrace.h       | 4 ++--
 include/linux/ftrace_event.h | 4 ++--
 include/linux/syscalls.h     | 8 ++------
 include/trace/ftrace.h       | 8 ++------
 kernel/trace/trace_export.c  | 4 +---
 5 files changed, 9 insertions(+), 19 deletions(-)

diff --git a/include/linux/ftrace.h b/include/linux/ftrace.h
index 404a686..cb2d023 100644
--- a/include/linux/ftrace.h
+++ b/include/linux/ftrace.h
@@ -260,7 +260,7 @@ struct ftrace_func_command {
 	int			(*func)(struct ftrace_hash *hash,
 					char *func, char *cmd,
 					char *params, int enable);
-};
+} __designated_init;
 
 #ifdef CONFIG_DYNAMIC_FTRACE
 
@@ -283,7 +283,7 @@ struct ftrace_probe_ops {
 					 unsigned long ip,
 					 struct ftrace_probe_ops *ops,
 					 void *data);
-};
+} __designated_init;
 
 extern int
 register_ftrace_function_probe(char *glob, struct ftrace_probe_ops *ops,
diff --git a/include/linux/ftrace_event.h b/include/linux/ftrace_event.h
index cff3106..25af313 100644
--- a/include/linux/ftrace_event.h
+++ b/include/linux/ftrace_event.h
@@ -198,7 +198,7 @@ struct ftrace_event_class {
 	struct list_head	*(*get_fields)(struct ftrace_event_call *);
 	struct list_head	fields;
 	int			(*raw_init)(struct ftrace_event_call *);
-};
+} __designated_init;
 
 extern int ftrace_event_reg(struct ftrace_event_call *event,
 			    enum trace_reg type, void *data);
@@ -293,7 +293,7 @@ struct ftrace_event_call {
 	int	(*perf_perm)(struct ftrace_event_call *,
 			     struct perf_event *);
 #endif
-};
+} __designated_init;
 
 static inline const char *
 ftrace_event_name(struct ftrace_event_call *call)
diff --git a/include/linux/syscalls.h b/include/linux/syscalls.h
index b0881a0..3002648 100644
--- a/include/linux/syscalls.h
+++ b/include/linux/syscalls.h
@@ -120,9 +120,7 @@ extern struct trace_event_functions exit_syscall_print_funcs;
 	static struct ftrace_event_call __used				\
 	  event_enter_##sname = {					\
 		.class			= &event_class_syscall_enter,	\
-		{							\
-			.name                   = "sys_enter"#sname,	\
-		},							\
+		.name                   = "sys_enter"#sname,		\
 		.event.funcs            = &enter_syscall_print_funcs,	\
 		.data			= (void *)&__syscall_meta_##sname,\
 		.flags                  = TRACE_EVENT_FL_CAP_ANY,	\
@@ -136,9 +134,7 @@ extern struct trace_event_functions exit_syscall_print_funcs;
 	static struct ftrace_event_call __used				\
 	  event_exit_##sname = {					\
 		.class			= &event_class_syscall_exit,	\
-		{							\
-			.name                   = "sys_exit"#sname,	\
-		},							\
+		.name                   = "sys_exit"#sname,		\
 		.event.funcs		= &exit_syscall_print_funcs,	\
 		.data			= (void *)&__syscall_meta_##sname,\
 		.flags                  = TRACE_EVENT_FL_CAP_ANY,	\
diff --git a/include/trace/ftrace.h b/include/trace/ftrace.h
index 26b4f2e..095aaca 100644
--- a/include/trace/ftrace.h
+++ b/include/trace/ftrace.h
@@ -699,9 +699,7 @@ static struct ftrace_event_class __used __refdata event_class_##call = { \
 									\
 static struct ftrace_event_call __used event_##call = {			\
 	.class			= &event_class_##template,		\
-	{								\
-		.tp			= &__tracepoint_##call,		\
-	},								\
+	.tp			= &__tracepoint_##call,			\
 	.event.funcs		= &ftrace_event_type_funcs_##template,	\
 	.print_fmt		= print_fmt_##template,			\
 	.flags			= TRACE_EVENT_FL_TRACEPOINT,		\
@@ -716,9 +714,7 @@ static const char print_fmt_##call[] = print;				\
 									\
 static struct ftrace_event_call __used event_##call = {			\
 	.class			= &event_class_##template,		\
-	{								\
-		.tp			= &__tracepoint_##call,		\
-	},								\
+	.tp			= &__tracepoint_##call,			\
 	.event.funcs		= &ftrace_event_type_funcs_##call,	\
 	.print_fmt		= print_fmt_##call,			\
 	.flags			= TRACE_EVENT_FL_TRACEPOINT,		\
diff --git a/kernel/trace/trace_export.c b/kernel/trace/trace_export.c
index d4ddde2..40f472f 100644
--- a/kernel/trace/trace_export.c
+++ b/kernel/trace/trace_export.c
@@ -174,9 +174,7 @@ struct ftrace_event_class __refdata event_class_ftrace_##call = {	\
 									\
 struct ftrace_event_call __used event_##call = {			\
 	.class			= &event_class_ftrace_##call,		\
-	{								\
-		.name			= #call,			\
-	},								\
+	.name			= #call,				\
 	.event.type		= etype,				\
 	.print_fmt		= print,				\
 	.flags			= TRACE_EVENT_FL_IGNORE_ENABLE | TRACE_EVENT_FL_USE_CALL_FILTER, \
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 4/7] bitops: Silence nested-externs warnings ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: [PATCH 4/7] bitops: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:37 +0000
Message-ID: <1411140580-20909-5-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Use the diagnostic control macros to ignore nested-externs warnings
in these caes.

CC: Ingo Molnar <mingo@kernel.org>
CC: Jacob Pan <jacob.jun.pan@linux.intel.com>
CC: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
CC: Peter Zijlstra <peterz@infradead.org>
CC: "Theodore Ts'o" <tytso@mit.edu>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/bitops.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/include/linux/bitops.h b/include/linux/bitops.h
index cbc5833..0e072bd 100644
--- a/include/linux/bitops.h
+++ b/include/linux/bitops.h
@@ -36,6 +36,7 @@ extern unsigned long __sw_hweight64(__u64 w);
  * Provide __deprecated wrappers for the new interface, avoid flag day changes.
  * We need the ugly external functions to break header recursion hell.
  */
+DIAG_PUSH DIAG_IGNORE(nested-externs)
 #ifndef smp_mb__before_clear_bit
 static inline void __deprecated smp_mb__before_clear_bit(void)
 {
@@ -51,6 +52,7 @@ static inline void __deprecated smp_mb__after_clear_bit(void)
 	__smp_mb__after_atomic();
 }
 #endif
+DIAG_POP
 
 #define for_each_set_bit(bit, addr, size) \
 	for ((bit) = find_first_bit((addr), (size));		\
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 5/5] include/linux/interrupt.h: Require designated initialization of structures ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH 5/5] include/linux/interrupt.h: Require designated initialization of structures
Date: Thu, 31 Jul 2014 23:48:08 +0000
Message-ID: <93a72e881cbdf060f6aefa16f0ac01f546eace4f.1406850006.git.josh () joshtriplett ! org>
--------------------
Fix the corresponding tasklet initialization macros to use designated
initializers, which simplifies those initializers using the default
initialization of fields to 0.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 include/linux/interrupt.h | 25 ++++++++++++++++---------
 1 file changed, 16 insertions(+), 9 deletions(-)

diff --git a/include/linux/interrupt.h b/include/linux/interrupt.h
index 698ad05..559ef98 100644
--- a/include/linux/interrupt.h
+++ b/include/linux/interrupt.h
@@ -217,7 +217,7 @@ struct irq_affinity_notify {
 	struct work_struct work;
 	void (*notify)(struct irq_affinity_notify *, const cpumask_t *mask);
 	void (*release)(struct kref *ref);
-};
+} __designated_init;
 
 #if defined(CONFIG_SMP)
 
@@ -419,7 +419,7 @@ extern const char * const softirq_to_name[NR_SOFTIRQS];
 struct softirq_action
 {
 	void	(*action)(struct softirq_action *);
-};
+} __designated_init;
 
 asmlinkage void do_softirq(void);
 asmlinkage void __do_softirq(void);
@@ -474,14 +474,21 @@ struct tasklet_struct
 	atomic_t count;
 	void (*func)(unsigned long);
 	unsigned long data;
-};
-
-#define DECLARE_TASKLET(name, func, data) \
-struct tasklet_struct name = { NULL, 0, ATOMIC_INIT(0), func, data }
+} __designated_init;
 
-#define DECLARE_TASKLET_DISABLED(name, func, data) \
-struct tasklet_struct name = { NULL, 0, ATOMIC_INIT(1), func, data }
+#define DECLARE_TASKLET(name, tsfunc, tsdata) \
+struct tasklet_struct name = {		\
+	.count = ATOMIC_INIT(0),	\
+	.func = tsfunc,			\
+	.data = tsdata,			\
+}
 
+#define DECLARE_TASKLET_DISABLED(name, tsfunc, tsdata) \
+struct tasklet_struct name = {		\
+	.count = ATOMIC_INIT(1),	\
+	.func = tsfunc,			\
+	.data = tsdata,			\
+}
 
 enum
 {
@@ -576,7 +583,7 @@ struct tasklet_hrtimer {
 	struct hrtimer		timer;
 	struct tasklet_struct	tasklet;
 	enum hrtimer_restart	(*function)(struct hrtimer *);
-};
+} __designated_init;
 
 extern void
 tasklet_hrtimer_init(struct tasklet_hrtimer *ttimer,
-- 
2.0.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang ===

From: behanw () converseincode ! com
To: linux-kernel
Subject: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:08:43 +0000
Message-ID: <1393376923-21892-6-git-send-email-behanw () converseincode ! com>
--------------------
From: Jan-Simon Mller <dl9pf@gmx.de>

Protect more options for x86 with cc-option so that we don't get errors when
using clang instead of gcc.  Add more or different options when using clang as
well. Also need to enforce that SSE is off for clang and the stack is 8-byte
aligned.

Signed-off-by: Jan-Simon Mller <dl9pf@gmx.de>
Signed-off-by: Behan Webster <behanw@converseincode.com>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
---
 arch/x86/Makefile | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/x86/Makefile b/arch/x86/Makefile
index eeda43a..852d8f0 100644
--- a/arch/x86/Makefile
+++ b/arch/x86/Makefile
@@ -108,7 +108,7 @@ else
 
         # this works around some issues with generating unwind tables in older gccs
         # newer gccs do it by default
-        KBUILD_CFLAGS += -maccumulate-outgoing-args
+        KBUILD_CFLAGS += $(call cc-option,-maccumulate-outgoing-args)
 endif
 
 # Make sure compiler does not have buggy stack-protector support.
@@ -144,6 +144,12 @@ endif
 sp-$(CONFIG_X86_32) := esp
 sp-$(CONFIG_X86_64) := rsp
 
+# enforce no-sse for clang
+ifneq ($(COMPILER),clang)
+        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
+        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
+endif
+
 # do binutils support CFI?
 cfi := $(call as-instr,.cfi_startproc\n.cfi_rel_offset $(sp-y)$(comma)0\n.cfi_endproc,-DCONFIG_AS_CFI=1)
 # is .cfi_signal_frame supported too?
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: behanw () converseincode ! com
To: linux-kbuild
Subject: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:08:43 +0000
Message-ID: <1393376923-21892-6-git-send-email-behanw () converseincode ! com>
--------------------
From: Jan-Simon Mller <dl9pf@gmx.de>

Protect more options for x86 with cc-option so that we don't get errors when
using clang instead of gcc.  Add more or different options when using clang as
well. Also need to enforce that SSE is off for clang and the stack is 8-byte
aligned.

Signed-off-by: Jan-Simon Mller <dl9pf@gmx.de>
Signed-off-by: Behan Webster <behanw@converseincode.com>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
---
 arch/x86/Makefile | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/x86/Makefile b/arch/x86/Makefile
index eeda43a..852d8f0 100644
--- a/arch/x86/Makefile
+++ b/arch/x86/Makefile
@@ -108,7 +108,7 @@ else
 
         # this works around some issues with generating unwind tables in older gccs
         # newer gccs do it by default
-        KBUILD_CFLAGS += -maccumulate-outgoing-args
+        KBUILD_CFLAGS += $(call cc-option,-maccumulate-outgoing-args)
 endif
 
 # Make sure compiler does not have buggy stack-protector support.
@@ -144,6 +144,12 @@ endif
 sp-$(CONFIG_X86_32) := esp
 sp-$(CONFIG_X86_64) := rsp
 
+# enforce no-sse for clang
+ifneq ($(COMPILER),clang)
+        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
+        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
+endif
+
 # do binutils support CFI?
 cfi := $(call as-instr,.cfi_startproc\n.cfi_rel_offset $(sp-y)$(comma)0\n.cfi_endproc,-DCONFIG_AS_CFI=1)
 # is .cfi_signal_frame supported too?
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-kbuild" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: behanw () converseincode ! com
To: linux-sparse
Subject: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:08:43 +0000
Message-ID: <1393376923-21892-6-git-send-email-behanw () converseincode ! com>
--------------------
From: Jan-Simon Mller <dl9pf@gmx.de>

Protect more options for x86 with cc-option so that we don't get errors when
using clang instead of gcc.  Add more or different options when using clang as
well. Also need to enforce that SSE is off for clang and the stack is 8-byte
aligned.

Signed-off-by: Jan-Simon Mller <dl9pf@gmx.de>
Signed-off-by: Behan Webster <behanw@converseincode.com>
Signed-off-by: Mark Charlebois <charlebm@gmail.com>
---
 arch/x86/Makefile | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/x86/Makefile b/arch/x86/Makefile
index eeda43a..852d8f0 100644
--- a/arch/x86/Makefile
+++ b/arch/x86/Makefile
@@ -108,7 +108,7 @@ else
 
         # this works around some issues with generating unwind tables in older gccs
         # newer gccs do it by default
-        KBUILD_CFLAGS += -maccumulate-outgoing-args
+        KBUILD_CFLAGS += $(call cc-option,-maccumulate-outgoing-args)
 endif
 
 # Make sure compiler does not have buggy stack-protector support.
@@ -144,6 +144,12 @@ endif
 sp-$(CONFIG_X86_32) := esp
 sp-$(CONFIG_X86_64) := rsp
 
+# enforce no-sse for clang
+ifneq ($(COMPILER),clang)
+        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
+        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
+endif
+
 # do binutils support CFI?
 cfi := $(call as-instr,.cfi_startproc\n.cfi_rel_offset $(sp-y)$(comma)0\n.cfi_endproc,-DCONFIG_AS_CFI=1)
 # is .cfi_signal_frame supported too?
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-kbuild
Subject: Re: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:32:53 +0000
Message-ID: <530D4445.8060304 () zytor ! com>
--------------------
On 02/25/2014 05:08 PM, behanw@converseincode.com wrote:
>  
> +# enforce no-sse for clang
> +ifneq ($(COMPILER),clang)
> +        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
> +        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
> +endif
> +

I'm *very* confused.  You're doing ifneq here but you're talking about
it as if you are *adding* them for Clang, also these options are already
added elsewhere (lines 57, 64, 86, 89) so why add them here?

	-hpa

--
To unsubscribe from this list: send the line "unsubscribe linux-kbuild" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:32:53 +0000
Message-ID: <530D4445.8060304 () zytor ! com>
--------------------
On 02/25/2014 05:08 PM, behanw@converseincode.com wrote:
>  
> +# enforce no-sse for clang
> +ifneq ($(COMPILER),clang)
> +        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
> +        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
> +endif
> +

I'm *very* confused.  You're doing ifneq here but you're talking about
it as if you are *adding* them for Clang, also these options are already
added elsewhere (lines 57, 64, 86, 89) so why add them here?

	-hpa

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Behan Webster <behanw () converseincode ! com>
To: linux-kbuild
Subject: Re: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:44:15 +0000
Message-ID: <530D46EF.6010103 () converseincode ! com>
--------------------
On 02/25/14 17:32, H. Peter Anvin wrote:
> On 02/25/2014 05:08 PM, behanw@converseincode.com wrote:
>>   
>> +# enforce no-sse for clang
>> +ifneq ($(COMPILER),clang)
>> +        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
>> +        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
>> +endif
>> +
> I'm *very* confused.  You're doing ifneq here but you're talking about
> it as if you are *adding* them for Clang, also these options are already
> added elsewhere (lines 57, 64, 86, 89) so why add them here?
Because when David Woodhouse's recent .code16 changes made it upstream 
(which invalidated most of our original patch) it seems I didn't remove 
this properly from our patch as well. :)

Thanks David for your patches. Thanks Peter for your sharp eyes!

Another example of why reviewing code on the mailing list works so well.

I will fix and resend.

Behan

-- 
Behan Webster
behanw@converseincode.com

--
To unsubscribe from this list: send the line "unsubscribe linux-kbuild" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Behan Webster <behanw () converseincode ! com>
To: linux-sparse
Subject: Re: [PATCH 5/5] x86 kbuild: LLVMLinux: More cc-options added for clang
Date: Wed, 26 Feb 2014 01:44:15 +0000
Message-ID: <530D46EF.6010103 () converseincode ! com>
--------------------
On 02/25/14 17:32, H. Peter Anvin wrote:
> On 02/25/2014 05:08 PM, behanw@converseincode.com wrote:
>>   
>> +# enforce no-sse for clang
>> +ifneq ($(COMPILER),clang)
>> +        KBUILD_CFLAGS += $(call cc-option,-mno-sse)
>> +        KBUILD_CFLAGS += $(call cc-option,-mpreferred-stack-boundary=3)
>> +endif
>> +
> I'm *very* confused.  You're doing ifneq here but you're talking about
> it as if you are *adding* them for Clang, also these options are already
> added elsewhere (lines 57, 64, 86, 89) so why add them here?
Because when David Woodhouse's recent .code16 changes made it upstream 
(which invalidated most of our original patch) it seems I didn't remove 
this properly from our patch as well. :)

Thanks David for your patches. Thanks Peter for your sharp eyes!

Another example of why reviewing code on the mailing list works so well.

I will fix and resend.

Behan

-- 
Behan Webster
behanw@converseincode.com

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 5/7] signal: Silence nested-externs warnings ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:38 +0000
Message-ID: <1411140580-20909-6-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Silence nested-externs warnings for these, as these nested
externs are truly wanted.

CC: Oleg Nesterov <oleg@redhat.com>
CC: Andrew Morton <akpm@linux-foundation.org>
CC: Geert Uytterhoeven <geert@linux-m68k.org>
CC: Richard Weinberger <richard@nod.at>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/signal.h | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/include/linux/signal.h b/include/linux/signal.h
index 750196f..e68ae6b 100644
--- a/include/linux/signal.h
+++ b/include/linux/signal.h
@@ -67,7 +67,9 @@ static inline int sigismember(sigset_t *set, int _sig)
 
 static inline int sigisemptyset(sigset_t *set)
 {
+	DIAG_PUSH DIAG_IGNORE(nested-externs)
 	extern void _NSIG_WORDS_is_unsupported_size(void);
+	DIAG_POP
 	switch (_NSIG_WORDS) {
 	case 4:
 		return (set->sig[3] | set->sig[2] |
@@ -90,7 +92,9 @@ static inline int sigisemptyset(sigset_t *set)
 #define _SIG_SET_BINOP(name, op)					\
 static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
 {									\
+	DIAG_PUSH DIAG_IGNORE(nested-externs)				\
 	extern void _NSIG_WORDS_is_unsupported_size(void);		\
+	DIAG_POP							\
 	unsigned long a0, a1, a2, a3, b0, b1, b2, b3;			\
 									\
 	switch (_NSIG_WORDS) {						\
@@ -128,7 +132,9 @@ _SIG_SET_BINOP(sigandnsets, _sig_andn)
 #define _SIG_SET_OP(name, op)						\
 static inline void name(sigset_t *set)					\
 {									\
+	DIAG_PUSH DIAG_IGNORE(nested-externs)				\
 	extern void _NSIG_WORDS_is_unsupported_size(void);		\
+	DIAG_POP							\
 									\
 	switch (_NSIG_WORDS) {						\
 	    case 4: set->sig[3] = op(set->sig[3]);			\
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-kernel
Subject: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:38 +0000
Message-ID: <1411140580-20909-6-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Silence nested-externs warnings for these, as these nested
externs are truly wanted.

CC: Oleg Nesterov <oleg@redhat.com>
CC: Andrew Morton <akpm@linux-foundation.org>
CC: Geert Uytterhoeven <geert@linux-m68k.org>
CC: Richard Weinberger <richard@nod.at>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/signal.h | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/include/linux/signal.h b/include/linux/signal.h
index 750196f..e68ae6b 100644
--- a/include/linux/signal.h
+++ b/include/linux/signal.h
@@ -67,7 +67,9 @@ static inline int sigismember(sigset_t *set, int _sig)
 
 static inline int sigisemptyset(sigset_t *set)
 {
+	DIAG_PUSH DIAG_IGNORE(nested-externs)
 	extern void _NSIG_WORDS_is_unsupported_size(void);
+	DIAG_POP
 	switch (_NSIG_WORDS) {
 	case 4:
 		return (set->sig[3] | set->sig[2] |
@@ -90,7 +92,9 @@ static inline int sigisemptyset(sigset_t *set)
 #define _SIG_SET_BINOP(name, op)					\
 static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
 {									\
+	DIAG_PUSH DIAG_IGNORE(nested-externs)				\
 	extern void _NSIG_WORDS_is_unsupported_size(void);		\
+	DIAG_POP							\
 	unsigned long a0, a1, a2, a3, b0, b1, b2, b3;			\
 									\
 	switch (_NSIG_WORDS) {						\
@@ -128,7 +132,9 @@ _SIG_SET_BINOP(sigandnsets, _sig_andn)
 #define _SIG_SET_OP(name, op)						\
 static inline void name(sigset_t *set)					\
 {									\
+	DIAG_PUSH DIAG_IGNORE(nested-externs)				\
 	extern void _NSIG_WORDS_is_unsupported_size(void);		\
+	DIAG_POP							\
 									\
 	switch (_NSIG_WORDS) {						\
 	    case 4: set->sig[3] = op(set->sig[3]);			\
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Richard Weinberger <richard () nod ! at>
To: linux-kernel
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:35:51 +0000
Message-ID: <541C4D57.9050507 () nod ! at>
--------------------
Am 19.09.2014 17:29, schrieb Jeff Kirsher:
> From: Mark Rustad <mark.d.rustad@intel.com>
> 
> Silence nested-externs warnings for these, as these nested
> externs are truly wanted.
> 
> CC: Oleg Nesterov <oleg@redhat.com>
> CC: Andrew Morton <akpm@linux-foundation.org>
> CC: Geert Uytterhoeven <geert@linux-m68k.org>
> CC: Richard Weinberger <richard@nod.at>
> CC: Brian Norris <computersforpeace@gmail.com>
> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
> ---
>  include/linux/signal.h | 6 ++++++
>  1 file changed, 6 insertions(+)
> 
> diff --git a/include/linux/signal.h b/include/linux/signal.h
> index 750196f..e68ae6b 100644
> --- a/include/linux/signal.h
> +++ b/include/linux/signal.h
> @@ -67,7 +67,9 @@ static inline int sigismember(sigset_t *set, int _sig)
>  
>  static inline int sigisemptyset(sigset_t *set)
>  {
> +	DIAG_PUSH DIAG_IGNORE(nested-externs)

Do we really want to clutter the source with such tags?
Does this even build? i.e. how does gcc know to ignore that?

rw@azrael:~/linux (ubi-wlcrash $)> git grep DIAG_PUSH | wc -l
0

Thanks,
//richard
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:37:22 +0000
Message-ID: <1411141042.2513.3.camel () jtkirshe-mobl>
--------------------

--=-UpjXBBNZGFIz/2ACVmse
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

On Fri, 2014-09-19 at 17:35 +0200, Richard Weinberger wrote:
> Am 19.09.2014 17:29, schrieb Jeff Kirsher:
> > From: Mark Rustad <mark.d.rustad@intel.com>
> >=20
> > Silence nested-externs warnings for these, as these nested
> > externs are truly wanted.
> >=20
> > CC: Oleg Nesterov <oleg@redhat.com>
> > CC: Andrew Morton <akpm@linux-foundation.org>
> > CC: Geert Uytterhoeven <geert@linux-m68k.org>
> > CC: Richard Weinberger <richard@nod.at>
> > CC: Brian Norris <computersforpeace@gmail.com>
> > Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
> > Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
> > ---
> >  include/linux/signal.h | 6 ++++++
> >  1 file changed, 6 insertions(+)
> >=20
> > diff --git a/include/linux/signal.h b/include/linux/signal.h
> > index 750196f..e68ae6b 100644
> > --- a/include/linux/signal.h
> > +++ b/include/linux/signal.h
> > @@ -67,7 +67,9 @@ static inline int sigismember(sigset_t *set, int _sig=
)
> > =20
> >  static inline int sigisemptyset(sigset_t *set)
> >  {
> > +	DIAG_PUSH DIAG_IGNORE(nested-externs)
>=20
> Do we really want to clutter the source with such tags?
> Does this even build? i.e. how does gcc know to ignore that?
>=20
> rw@azrael:~/linux (ubi-wlcrash $)> git grep DIAG_PUSH | wc -l
> 0
>=20
> Thanks,
> //richard

See patch 1 of the series.

--=-UpjXBBNZGFIz/2ACVmse
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: This is a digitally signed message part
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAABCgAGBQJUHE2yAAoJEOVv75VaS+3O134P/R4Dj5kmTy/h9SzTbOb4ioct
suvJZrWiSLBs7U/sa55iwgW/HuRjdFwuzo4Ufv9xPIL/PtSi1igmj3sEPjmf2eMc
Kvv8ipXJ+T1408MOJyHZ5tqW3kF+dRJ3hBhA/VgEJzykP9SF4jkwCR5rVgBfx4sf
xRkFCJA2gPVNRomCA76rgGN6tzKWGTRzt+ztZRGKdjeDvdf3LnqexNtbxIOGJFNp
RycMGNplTqd23dx1KbnI5To+FaVd/UbgAd6f0L+Mj9Y9VnmhBBMDeXawn2qeqRRZ
mN86djJ3r/kctB56+xnS7ElDoJgBQTMUEX1ESLrGBIp7smqOvA7QgNObu4rosQNE
XTfi5G73XOtRss9UJ/j0ojP6OOAqsqqmlAl/pvnlDA7Tcrg6hIC9OInstNAejk8N
St2j2GUu0pNl7Jakv0afcEji1IZgfTHTC2sTGfJVypDgpB1rk89wZmYTEAejFWjc
tcSKcMEXqkwZhyHBOqCyRYzT+LflrpV4arBe8WGGPh802ASgqclYc3ut+dIkUYB6
ZhysyQBzINqW1U4/H5kq1iBknNODzwoJXkoGU0Z/YnAgUdJlk7CHDlWcGU7E5yar
pr99YxsbCnbCaCEoNMntZlpkb2WUVX2x5sjQ+f6NNKpGrkXA4d674gVhNXXXRTze
hMbcU7aV5ls1mppgOmnO
=kaEw
-----END PGP SIGNATURE-----

--=-UpjXBBNZGFIz/2ACVmse--

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Richard Weinberger <richard () nod ! at>
To: linux-kernel
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:39:00 +0000
Message-ID: <541C4E14.9010000 () nod ! at>
--------------------
This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--TOrcJmsDrISW6q1ooOcilVRpNO1IIObvi
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Am 19.09.2014 17:37, schrieb Jeff Kirsher:
> On Fri, 2014-09-19 at 17:35 +0200, Richard Weinberger wrote:
>> Am 19.09.2014 17:29, schrieb Jeff Kirsher:
>>> From: Mark Rustad <mark.d.rustad@intel.com>
>>>
>>> Silence nested-externs warnings for these, as these nested
>>> externs are truly wanted.
>>>
>>> CC: Oleg Nesterov <oleg@redhat.com>
>>> CC: Andrew Morton <akpm@linux-foundation.org>
>>> CC: Geert Uytterhoeven <geert@linux-m68k.org>
>>> CC: Richard Weinberger <richard@nod.at>
>>> CC: Brian Norris <computersforpeace@gmail.com>
>>> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
>>> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
>>> ---
>>>  include/linux/signal.h | 6 ++++++
>>>  1 file changed, 6 insertions(+)
>>>
>>> diff --git a/include/linux/signal.h b/include/linux/signal.h
>>> index 750196f..e68ae6b 100644
>>> --- a/include/linux/signal.h
>>> +++ b/include/linux/signal.h
>>> @@ -67,7 +67,9 @@ static inline int sigismember(sigset_t *set, int _s=
ig)
>>> =20
>>>  static inline int sigisemptyset(sigset_t *set)
>>>  {
>>> +	DIAG_PUSH DIAG_IGNORE(nested-externs)
>>
>> Do we really want to clutter the source with such tags?
>> Does this even build? i.e. how does gcc know to ignore that?
>>
>> rw@azrael:~/linux (ubi-wlcrash $)> git grep DIAG_PUSH | wc -l
>> 0
>>
>> Thanks,
>> //richard
>=20
> See patch 1 of the series.

I was not CC'ed...

Thanks,
//richard


--TOrcJmsDrISW6q1ooOcilVRpNO1IIObvi
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIcBAEBAgAGBQJUHE4YAAoJEPmeIjfg4Uaa61kP/AzwwgHhL7uWhU0TRrwlVZKT
Vi/81lLaKUntIkpjbGLPkpR/vN5hGAVlYt/SpzyCw+hffRz51FZa0yWEgZ07g5tr
x2guQfNX5dgfYjW9SRSjSCaHYcCTNb/fu7rWZCdvbmQ6e0zHHf4px2EzA/k6hEZs
+f9/GxwB5nJaFBilIvGfppKTd+Mg+sVXgq8pl9Dxf1UWZae8AH5Nk92FvPprwsh4
e5YMxj7HnbfDIpuGamMyWgi9rzTjcC8DEcbA0S4BYA/Jtn0paJ1CY++lg1FRtKus
V73bNUtVDN6s28gLcCqyVjOH8YtYMr6ekUo75hsjgkaCw8gBuTyGIaovvQQhL/A+
dNmBrHB3/rg/SHlADKW6tzEGi9bGqO1Ouhw8w2Eub4xaXmfS1Rib1DTZPVRUDKXa
UC/OBghKXXxmC2IzljUDm4ineyjLpYN69i/maWyhI/IHdk64gm7f2ORGVSan5LrW
mm08rbAHzV/GsPCBRyCSQ34VIXTrpKVxA4bHJrERMxij857Qqj7xds8WnPI1qe3n
I3v8ra9O1gRsFXS7kbNyyXYOQayYOcie7NDnb0b3jQL18JOYCqY1nqcZ6XIkzST6
6lFY8J4eQwiangCT8XxRUZbsn3Qvu69qS8uJ2KBC4mOReb0vfT+QOdab/tqq4RkX
CPhcvxRYOwP4lRKzHzdW
=Af+j
-----END PGP SIGNATURE-----

--TOrcJmsDrISW6q1ooOcilVRpNO1IIObvi--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Richard Weinberger <richard () nod ! at>
To: linux-sparse
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:39:00 +0000
Message-ID: <541C4E14.9010000 () nod ! at>
--------------------
This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--TOrcJmsDrISW6q1ooOcilVRpNO1IIObvi
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

Am 19.09.2014 17:37, schrieb Jeff Kirsher:
> On Fri, 2014-09-19 at 17:35 +0200, Richard Weinberger wrote:
>> Am 19.09.2014 17:29, schrieb Jeff Kirsher:
>>> From: Mark Rustad <mark.d.rustad@intel.com>
>>>
>>> Silence nested-externs warnings for these, as these nested
>>> externs are truly wanted.
>>>
>>> CC: Oleg Nesterov <oleg@redhat.com>
>>> CC: Andrew Morton <akpm@linux-foundation.org>
>>> CC: Geert Uytterhoeven <geert@linux-m68k.org>
>>> CC: Richard Weinberger <richard@nod.at>
>>> CC: Brian Norris <computersforpeace@gmail.com>
>>> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
>>> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
>>> ---
>>>  include/linux/signal.h | 6 ++++++
>>>  1 file changed, 6 insertions(+)
>>>
>>> diff --git a/include/linux/signal.h b/include/linux/signal.h
>>> index 750196f..e68ae6b 100644
>>> --- a/include/linux/signal.h
>>> +++ b/include/linux/signal.h
>>> @@ -67,7 +67,9 @@ static inline int sigismember(sigset_t *set, int _s=
ig)
>>> =20
>>>  static inline int sigisemptyset(sigset_t *set)
>>>  {
>>> +	DIAG_PUSH DIAG_IGNORE(nested-externs)
>>
>> Do we really want to clutter the source with such tags?
>> Does this even build? i.e. how does gcc know to ignore that?
>>
>> rw@azrael:~/linux (ubi-wlcrash $)> git grep DIAG_PUSH | wc -l
>> 0
>>
>> Thanks,
>> //richard
>=20
> See patch 1 of the series.

I was not CC'ed...

Thanks,
//richard


--TOrcJmsDrISW6q1ooOcilVRpNO1IIObvi
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIcBAEBAgAGBQJUHE4YAAoJEPmeIjfg4Uaa61kP/AzwwgHhL7uWhU0TRrwlVZKT
Vi/81lLaKUntIkpjbGLPkpR/vN5hGAVlYt/SpzyCw+hffRz51FZa0yWEgZ07g5tr
x2guQfNX5dgfYjW9SRSjSCaHYcCTNb/fu7rWZCdvbmQ6e0zHHf4px2EzA/k6hEZs
+f9/GxwB5nJaFBilIvGfppKTd+Mg+sVXgq8pl9Dxf1UWZae8AH5Nk92FvPprwsh4
e5YMxj7HnbfDIpuGamMyWgi9rzTjcC8DEcbA0S4BYA/Jtn0paJ1CY++lg1FRtKus
V73bNUtVDN6s28gLcCqyVjOH8YtYMr6ekUo75hsjgkaCw8gBuTyGIaovvQQhL/A+
dNmBrHB3/rg/SHlADKW6tzEGi9bGqO1Ouhw8w2Eub4xaXmfS1Rib1DTZPVRUDKXa
UC/OBghKXXxmC2IzljUDm4ineyjLpYN69i/maWyhI/IHdk64gm7f2ORGVSan5LrW
mm08rbAHzV/GsPCBRyCSQ34VIXTrpKVxA4bHJrERMxij857Qqj7xds8WnPI1qe3n
I3v8ra9O1gRsFXS7kbNyyXYOQayYOcie7NDnb0b3jQL18JOYCqY1nqcZ6XIkzST6
6lFY8J4eQwiangCT8XxRUZbsn3Qvu69qS8uJ2KBC4mOReb0vfT+QOdab/tqq4RkX
CPhcvxRYOwP4lRKzHzdW
=Af+j
-----END PGP SIGNATURE-----

--TOrcJmsDrISW6q1ooOcilVRpNO1IIObvi--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Oleg Nesterov <oleg () redhat ! com>
To: linux-kernel
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 17:20:30 +0000
Message-ID: <20140919172030.GA22293 () redhat ! com>
--------------------
On 09/19, Richard Weinberger wrote:
>
> Am 19.09.2014 17:37, schrieb Jeff Kirsher:
> >
> > See patch 1 of the series.
>
> I was not CC'ed...

Me too, and thus I don't understand this patch.

But I have to admit it looks a bit ugly to me anyway.
Can't we simply kill _NSIG_WORDS_is_unsupported_size ?

Oleg.
---

diff --git a/include/linux/signal.h b/include/linux/signal.h
index 750196f..679c9b4 100644
--- a/include/linux/signal.h
+++ b/include/linux/signal.h
@@ -67,7 +67,6 @@ static inline int sigismember(sigset_t *set, int _sig)
 
 static inline int sigisemptyset(sigset_t *set)
 {
-	extern void _NSIG_WORDS_is_unsupported_size(void);
 	switch (_NSIG_WORDS) {
 	case 4:
 		return (set->sig[3] | set->sig[2] |
@@ -77,7 +76,7 @@ static inline int sigisemptyset(sigset_t *set)
 	case 1:
 		return set->sig[0] == 0;
 	default:
-		_NSIG_WORDS_is_unsupported_size();
+		BUILD_BUG();
 		return 0;
 	}
 }
@@ -90,7 +89,6 @@ static inline int sigisemptyset(sigset_t *set)
 #define _SIG_SET_BINOP(name, op)					\
 static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
 {									\
-	extern void _NSIG_WORDS_is_unsupported_size(void);		\
 	unsigned long a0, a1, a2, a3, b0, b1, b2, b3;			\
 									\
 	switch (_NSIG_WORDS) {						\
@@ -107,7 +105,7 @@ static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
 		r->sig[0] = op(a0, b0);					\
 		break;							\
 	    default:							\
-		_NSIG_WORDS_is_unsupported_size();			\
+	    	BUILD_BUG();						\
 	}								\
 }
 
@@ -128,8 +126,6 @@ _SIG_SET_BINOP(sigandnsets, _sig_andn)
 #define _SIG_SET_OP(name, op)						\
 static inline void name(sigset_t *set)					\
 {									\
-	extern void _NSIG_WORDS_is_unsupported_size(void);		\
-									\
 	switch (_NSIG_WORDS) {						\
 	    case 4: set->sig[3] = op(set->sig[3]);			\
 		    set->sig[2] = op(set->sig[2]);			\
@@ -137,7 +133,7 @@ static inline void name(sigset_t *set)					\
 	    case 1: set->sig[0] = op(set->sig[0]);			\
 		    break;						\
 	    default:							\
-		_NSIG_WORDS_is_unsupported_size();			\
+		BUILD_BUG();						\
 	}								\
 }
 

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 21:21:28 +0000
Message-ID: <20140919212128.GP26432 () jtriplet-mobl1>
--------------------
On Fri, Sep 19, 2014 at 07:20:30PM +0200, Oleg Nesterov wrote:
> On 09/19, Richard Weinberger wrote:
> >
> > Am 19.09.2014 17:37, schrieb Jeff Kirsher:
> > >
> > > See patch 1 of the series.
> >
> > I was not CC'ed...
> 
> Me too, and thus I don't understand this patch.
> 
> But I have to admit it looks a bit ugly to me anyway.
> Can't we simply kill _NSIG_WORDS_is_unsupported_size ?

This looks quite preferable.  Can you post that with a commit message
and signoff?  Also, the indentation on the second of the three BUILD_BUG
calls has some spaces in it, which it shouldn't.  With those fixed:
Reviewed-by: Josh Triplett <josh@joshtriplett.org>

> diff --git a/include/linux/signal.h b/include/linux/signal.h
> index 750196f..679c9b4 100644
> --- a/include/linux/signal.h
> +++ b/include/linux/signal.h
> @@ -67,7 +67,6 @@ static inline int sigismember(sigset_t *set, int _sig)
>  
>  static inline int sigisemptyset(sigset_t *set)
>  {
> -	extern void _NSIG_WORDS_is_unsupported_size(void);
>  	switch (_NSIG_WORDS) {
>  	case 4:
>  		return (set->sig[3] | set->sig[2] |
> @@ -77,7 +76,7 @@ static inline int sigisemptyset(sigset_t *set)
>  	case 1:
>  		return set->sig[0] == 0;
>  	default:
> -		_NSIG_WORDS_is_unsupported_size();
> +		BUILD_BUG();
>  		return 0;
>  	}
>  }
> @@ -90,7 +89,6 @@ static inline int sigisemptyset(sigset_t *set)
>  #define _SIG_SET_BINOP(name, op)					\
>  static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
>  {									\
> -	extern void _NSIG_WORDS_is_unsupported_size(void);		\
>  	unsigned long a0, a1, a2, a3, b0, b1, b2, b3;			\
>  									\
>  	switch (_NSIG_WORDS) {						\
> @@ -107,7 +105,7 @@ static inline void name(sigset_t *r, const sigset_t *a, const sigset_t *b) \
>  		r->sig[0] = op(a0, b0);					\
>  		break;							\
>  	    default:							\
> -		_NSIG_WORDS_is_unsupported_size();			\
> +	    	BUILD_BUG();						\
>  	}								\
>  }
>  
> @@ -128,8 +126,6 @@ _SIG_SET_BINOP(sigandnsets, _sig_andn)
>  #define _SIG_SET_OP(name, op)						\
>  static inline void name(sigset_t *set)					\
>  {									\
> -	extern void _NSIG_WORDS_is_unsupported_size(void);		\
> -									\
>  	switch (_NSIG_WORDS) {						\
>  	    case 4: set->sig[3] = op(set->sig[3]);			\
>  		    set->sig[2] = op(set->sig[2]);			\
> @@ -137,7 +133,7 @@ static inline void name(sigset_t *set)					\
>  	    case 1: set->sig[0] = op(set->sig[0]);			\
>  		    break;						\
>  	    default:							\
> -		_NSIG_WORDS_is_unsupported_size();			\
> +		BUILD_BUG();						\
>  	}								\
>  }
>  
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: Re: [PATCH 5/7] signal: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 21:26:20 +0000
Message-ID: <DCC876B0-D2AC-44F0-A774-D8DFA6F17905 () intel ! com>
--------------------
--Apple-Mail=_39C6AC14-3000-424C-B0F0-6CE1F08FE247
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 19, 2014, at 2:21 PM, Josh Triplett <josh@joshtriplett.org> =
wrote:

> On Fri, Sep 19, 2014 at 07:20:30PM +0200, Oleg Nesterov wrote:
>> On 09/19, Richard Weinberger wrote:
>>>=20
>>> Am 19.09.2014 17:37, schrieb Jeff Kirsher:
>>>>=20
>>>> See patch 1 of the series.
>>>=20
>>> I was not CC'ed...
>>=20
>> Me too, and thus I don't understand this patch.
>>=20
>> But I have to admit it looks a bit ugly to me anyway.
>> Can't we simply kill _NSIG_WORDS_is_unsupported_size ?
>=20
> This looks quite preferable.  Can you post that with a commit message
> and signoff?  Also, the indentation on the second of the three =
BUILD_BUG
> calls has some spaces in it, which it shouldn't.  With those fixed:
> Reviewed-by: Josh Triplett <josh@joshtriplett.org>

I haven't tried this patch myself yet, but assuming that it works, it is =
a far better way to go.

>> diff --git a/include/linux/signal.h b/include/linux/signal.h
>> index 750196f..679c9b4 100644
>> --- a/include/linux/signal.h
>> +++ b/include/linux/signal.h
>> @@ -67,7 +67,6 @@ static inline int sigismember(sigset_t *set, int =
_sig)
>>=20
>> static inline int sigisemptyset(sigset_t *set)
>> {
>> -	extern void _NSIG_WORDS_is_unsupported_size(void);
>> 	switch (_NSIG_WORDS) {
>> 	case 4:
>> 		return (set->sig[3] | set->sig[2] |
>> @@ -77,7 +76,7 @@ static inline int sigisemptyset(sigset_t *set)
>> 	case 1:
>> 		return set->sig[0] =3D=3D 0;
>> 	default:
>> -		_NSIG_WORDS_is_unsupported_size();
>> +		BUILD_BUG();
>> 		return 0;
>> 	}
>> }
>> @@ -90,7 +89,6 @@ static inline int sigisemptyset(sigset_t *set)
>> #define _SIG_SET_BINOP(name, op)					=
\
>> static inline void name(sigset_t *r, const sigset_t *a, const =
sigset_t *b) \
>> {									=
\
>> -	extern void _NSIG_WORDS_is_unsupported_size(void);		=
\
>> 	unsigned long a0, a1, a2, a3, b0, b1, b2, b3;			=
\
>> 									=
\
>> 	switch (_NSIG_WORDS) {						=
\
>> @@ -107,7 +105,7 @@ static inline void name(sigset_t *r, const =
sigset_t *a, const sigset_t *b) \
>> 		r->sig[0] =3D op(a0, b0);					=
\
>> 		break;							=
\
>> 	    default:							=
\
>> -		_NSIG_WORDS_is_unsupported_size();			=
\
>> +	    	BUILD_BUG();						=
\
>> 	}								=
\
>> }
>>=20
>> @@ -128,8 +126,6 @@ _SIG_SET_BINOP(sigandnsets, _sig_andn)
>> #define _SIG_SET_OP(name, op)						=
\
>> static inline void name(sigset_t *set)					=
\
>> {									=
\
>> -	extern void _NSIG_WORDS_is_unsupported_size(void);		=
\
>> -									=
\
>> 	switch (_NSIG_WORDS) {						=
\
>> 	    case 4: set->sig[3] =3D op(set->sig[3]);			=
\
>> 		    set->sig[2] =3D op(set->sig[2]);			=
\
>> @@ -137,7 +133,7 @@ static inline void name(sigset_t *set)			=
		\
>> 	    case 1: set->sig[0] =3D op(set->sig[0]);			=
\
>> 		    break;						=
\
>> 	    default:							=
\
>> -		_NSIG_WORDS_is_unsupported_size();			=
\
>> +		BUILD_BUG();						=
\
>> 	}								=
\
>> }

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_39C6AC14-3000-424C-B0F0-6CE1F08FE247
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUHJ95AAoJEDwO/+eO4+5uh+IP/28hXL8cFCfeaavuo5hJxuKm
8Ef08NYGmvPCpkNWNjiCTaXKCTqzsOjjmBNgrEcUrXa0mitvMOPidSj9rRtPDtAg
x9hTAG1uihTxFsCXxei0I0nLNRd+Phu9ENDzty0zHypUcQg9GqOCWdM0bj4iiVMM
hvRsUyIDj3h9JqvWKj+TsgGB+iN7QykFAbPwIqx13XxEHkJYEmGjeBPj4f2uTgcX
kpcTMWZo+JQ5jsYeJ7ir0xqHDmeT9+t/qHkfM/jFseQm3PjbPsO8tAVFM6I5gIKD
bYdJM8ln5skN0B+1NqWM7iBFk0jYhI2VLW0Wf+7fhXqG8iwXDFK6cJP3z1lYqCLT
NReDtkq6x9HdEYt1lCo/Z1iOf5M/prCnlvGq2j3jZsvzVRtLfcyRS/Db7wbcUC0f
DJJiaTgh1FvigVOZLJbWgTYEFdAA3CoywJCUdEKea1McB7W5vm7z34OMAkvfKGiW
q1uZOMDCsKzwmOQCTHFXDnb+Cev2kd5yrz+QsWIhXc9dusZV9kQpGjbEUCEsf2gk
/CGX05JB6ydw3TqFBGobH/lBsNtf0sfV16hhmZnQpiyvsHk8FLCKizdH3cXZI+Az
8BUl/5qXmtQ42vv23JSlY9E+uSRep7Go+Af12OlTIzo2qqMy49/JVBn0XVU8r9II
WMcmTrZTLpeVZJUnb78P
=IlWe
-----END PGP SIGNATURE-----

--Apple-Mail=_39C6AC14-3000-424C-B0F0-6CE1F08FE247--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH 6/7] mm: Silence nested-externs warnings ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: [PATCH 6/7] mm: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:39 +0000
Message-ID: <1411140580-20909-7-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Use diagnostic control macros to ignore nested-externs warnings
in this case.

CC: Andrew Morton <akpm@linux-foundation.org>
CC: <linux-mm@kvack.org>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/mm.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/include/linux/mm.h b/include/linux/mm.h
index 8981cc8..9bf2c7e 100644
--- a/include/linux/mm.h
+++ b/include/linux/mm.h
@@ -1623,7 +1623,9 @@ static inline void mark_page_reserved(struct page *page)
  */
 static inline unsigned long free_initmem_default(int poison)
 {
+	DIAG_PUSH DIAG_IGNORE(nested-externs)
 	extern char __init_begin[], __init_end[];
+	DIAG_POP
 
 	return free_reserved_area(&__init_begin, &__init_end,
 				  poison, "unused kernel");
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH 7/7] sched: Silence nested-externs warnings ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-kernel
Subject: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:40 +0000
Message-ID: <1411140580-20909-8-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Use diagnostic control macros to ignore nested-externs warnings
in this case.

CC: Ingo Molnar <mingo@redhat.com>
CC: Peter Zijlstra <peterz@infradead.org>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/sched.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/include/linux/sched.h b/include/linux/sched.h
index 5c2c885..ed52c76 100644
--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -832,7 +832,9 @@ static inline int sched_info_on(void)
 #ifdef CONFIG_SCHEDSTATS
 	return 1;
 #elif defined(CONFIG_TASK_DELAY_ACCT)
+	DIAG_PUSH DIAG_IGNORE(nested-externs)
 	extern int delayacct_on;
+	DIAG_POP
 	return delayacct_on;
 #else
 	return 0;
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-sparse
Subject: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 15:29:40 +0000
Message-ID: <1411140580-20909-8-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

Use diagnostic control macros to ignore nested-externs warnings
in this case.

CC: Ingo Molnar <mingo@redhat.com>
CC: Peter Zijlstra <peterz@infradead.org>
CC: Brian Norris <computersforpeace@gmail.com>
Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/sched.h | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/include/linux/sched.h b/include/linux/sched.h
index 5c2c885..ed52c76 100644
--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -832,7 +832,9 @@ static inline int sched_info_on(void)
 #ifdef CONFIG_SCHEDSTATS
 	return 1;
 #elif defined(CONFIG_TASK_DELAY_ACCT)
+	DIAG_PUSH DIAG_IGNORE(nested-externs)
 	extern int delayacct_on;
+	DIAG_POP
 	return delayacct_on;
 #else
 	return 0;
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Richard Weinberger <richard.weinberger () gmail ! com>
To: linux-kernel
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 19:34:43 +0000
Message-ID: <CAFLxGvwfuE-458duC9ARMLLMBCvZaBQnwDjPW6uJC4FAViBXjQ () mail ! gmail ! com>
--------------------
On Fri, Sep 19, 2014 at 5:29 PM, Jeff Kirsher
<jeffrey.t.kirsher@intel.com> wrote:
> From: Mark Rustad <mark.d.rustad@intel.com>
>
> Use diagnostic control macros to ignore nested-externs warnings
> in this case.
>
> CC: Ingo Molnar <mingo@redhat.com>
> CC: Peter Zijlstra <peterz@infradead.org>
> CC: Brian Norris <computersforpeace@gmail.com>
> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
> ---
>  include/linux/sched.h | 2 ++
>  1 file changed, 2 insertions(+)
>
> diff --git a/include/linux/sched.h b/include/linux/sched.h
> index 5c2c885..ed52c76 100644
> --- a/include/linux/sched.h
> +++ b/include/linux/sched.h
> @@ -832,7 +832,9 @@ static inline int sched_info_on(void)
>  #ifdef CONFIG_SCHEDSTATS
>         return 1;
>  #elif defined(CONFIG_TASK_DELAY_ACCT)
> +       DIAG_PUSH DIAG_IGNORE(nested-externs)
>         extern int delayacct_on;
> +       DIAG_POP

This ridiculous, please try to move this extern into the appropriate header file
instead of surrounding it with these macros.

-- 
Thanks,
//richard
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 20:34:59 +0000
Message-ID: <11081C57-805A-44F8-9768-271DC6B27F76 () intel ! com>
--------------------
--Apple-Mail=_95907DD6-03E2-4FAD-AA49-8185C35F39E0
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 19, 2014, at 12:34 PM, Richard Weinberger =
<richard.weinberger@gmail.com> wrote:

> On Fri, Sep 19, 2014 at 5:29 PM, Jeff Kirsher
> <jeffrey.t.kirsher@intel.com> wrote:
>> From: Mark Rustad <mark.d.rustad@intel.com>
>>=20
>> Use diagnostic control macros to ignore nested-externs warnings
>> in this case.
>>=20
>> CC: Ingo Molnar <mingo@redhat.com>
>> CC: Peter Zijlstra <peterz@infradead.org>
>> CC: Brian Norris <computersforpeace@gmail.com>
>> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
>> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
>> ---
>> include/linux/sched.h | 2 ++
>> 1 file changed, 2 insertions(+)
>>=20
>> diff --git a/include/linux/sched.h b/include/linux/sched.h
>> index 5c2c885..ed52c76 100644
>> --- a/include/linux/sched.h
>> +++ b/include/linux/sched.h
>> @@ -832,7 +832,9 @@ static inline int sched_info_on(void)
>> #ifdef CONFIG_SCHEDSTATS
>>        return 1;
>> #elif defined(CONFIG_TASK_DELAY_ACCT)
>> +       DIAG_PUSH DIAG_IGNORE(nested-externs)
>>        extern int delayacct_on;
>> +       DIAG_POP
>=20
> This ridiculous, please try to move this extern into the appropriate =
header file
> instead of surrounding it with these macros.

Excellent. I'll try adding an include of delayacct.h instead. My patch =
was based on the assumption that the existing code was wanted in that =
form for some reason, so the patch served a purpose in recognizing that =
it isn't. So the macros have served a purpose before even being in =
place. :-)

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_95907DD6-03E2-4FAD-AA49-8185C35F39E0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUHJN0AAoJEDwO/+eO4+5uI/IP/R14/8QxYcwicvj8hl/kid45
HhCUUGl9NENqV130XPiv+HyKYM2Ke54uBD97Upvs/dFHrRzp1EfZmJ+7/Q6v9dvI
+sAlrTnq1jd0b5fZX4T3KNbDVD74zRFSN7Xt9tF1i1tYWLEgu23MNmgbCGkUPGIu
3Y2N3pb6I2mCHd9gRKAFlV4vHlWW/SW9M850ie1m8f5Uppl5W81ktyHId+wsq0jQ
Tollm3kdAX4FoQmk3lhhoCaPPABp4t45kM4tXt+QPQRQeYwx+cNtsKa8TWzEaIGz
4kIKL2qquSWK0bR4uI8x2ePPauBp3SQxLZQ73rLJpNPKszo2v51GPoXQZCnnOjAp
aW02p9jLKeEq09qP7S78qHS6N5NhJeP/7fHlRjAfQZWfKo8SuzMGBQ6aveAamGOB
EJhzHiySttHC74lc52EW1cXyWsfsI2903lSweOWzZK5KHxviuhuBApeF5PqewHnm
TNsZ7RawakUICKLiEoq7v+s5xfJfJ4rzXZn1X6GJR2wk0sZJ5zPuaq129xLv1g4q
63tLDInJfYryHLG5jHxR2BOHspswpoxVDuxlEDD21XDEB8aYmaMPmbzTMDIezOzY
w2LGavRO+ZBXWT357tJMaZhU/f/V8JgkGwhHQ8YLYuM8tPq4bBh/RZCMWt7OYVBU
qArMmNXK66Ed38CYF5zM
=APgt
-----END PGP SIGNATURE-----

--Apple-Mail=_95907DD6-03E2-4FAD-AA49-8185C35F39E0--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Richard Weinberger <richard () nod ! at>
To: linux-sparse
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 20:41:21 +0000
Message-ID: <541C94F1.9020206 () nod ! at>
--------------------
This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--6SEEuo15mx4CkX54CiqePiKU0HvUNI1Ip
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Am 19.09.2014 22:34, schrieb Rustad, Mark D:
> Excellent. I'll try adding an include of delayacct.h instead. My patch =
was based on the assumption that the existing code was wanted in that for=
m for some reason, so the patch served a purpose in recognizing that it i=
sn't. So the macros have served a purpose before even being in place. :-)=


I bet sched.h does not include delayacct.h for a good reason.
sched.h is included in a lot of files, maybe delayacct.h introduces nasty=
 dependency issues.
You'll find out. ;-)

Thanks,
//richard


--6SEEuo15mx4CkX54CiqePiKU0HvUNI1Ip
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIcBAEBAgAGBQJUHJTyAAoJEPmeIjfg4UaavQUP/0S9EgrxcUoGLFFkEWY7z2EJ
mBMER+MGeuXHsPR1EYineFg18XJ+Jl3N+A2539v15dh9VrqPxPBW1dcE2/MqcP8T
xtd403PRFMgNIrVei5JkkgZSUu5xzondH5lcxwtPw0iDm0ZE2fh4CRFRGy2SxCGw
CY9aRs8CQJNYAlUcKYm/pPHmgTTqDaHz8w6tEIzUZ+heEQbGKG+wo1cJ3Bi7Kn2O
lQgfLPWNBTUm9Nqsy7PFsZ8f02TzQZdKRXTpTTXn2l4au0XjBIq9LZ8XYYyWkfFT
lmmEUZIoXnByhIVqXZIf9x6GP4L5iZ5oMeTNpmKK4zUFc2OBu/Q5wp7XleEZB9ji
V9P4udpoI2hyvxpn0PIZr/Gl05qkXFwOsPvCSB/pOOch/a0xi7JhGqPYgOAURZnf
oOfGYAf2sBqHDzJy+718dk9bCZfaxc+tccFc7N1P1iUeJEA+SiAWa3Dw8oeTuC9v
xVt/lglWWeXiHTDtsy3MSc1yPQOIjcaPE+tPJfmDY6EGpAGPpC1MVr2sBDdHOq+f
FiHk7V21s3ddHR6xhT6CVVwcNZE9P4qBsWufLJbg/N6S0URVd0ipGr4InWuLdBXT
xhXepiyWGGIN+hBabH2MHA7qQcva/FISrrU8m8z3hNZ89a5EcFVpdNHTvIwAlsDd
yZfAznqe96lomS4f9UmP
=Y3nE
-----END PGP SIGNATURE-----

--6SEEuo15mx4CkX54CiqePiKU0HvUNI1Ip--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Richard Weinberger <richard () nod ! at>
To: linux-kernel
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 20:41:21 +0000
Message-ID: <541C94F1.9020206 () nod ! at>
--------------------
This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--6SEEuo15mx4CkX54CiqePiKU0HvUNI1Ip
Content-Type: text/plain; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

Am 19.09.2014 22:34, schrieb Rustad, Mark D:
> Excellent. I'll try adding an include of delayacct.h instead. My patch =
was based on the assumption that the existing code was wanted in that for=
m for some reason, so the patch served a purpose in recognizing that it i=
sn't. So the macros have served a purpose before even being in place. :-)=


I bet sched.h does not include delayacct.h for a good reason.
sched.h is included in a lot of files, maybe delayacct.h introduces nasty=
 dependency issues.
You'll find out. ;-)

Thanks,
//richard


--6SEEuo15mx4CkX54CiqePiKU0HvUNI1Ip
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIcBAEBAgAGBQJUHJTyAAoJEPmeIjfg4UaavQUP/0S9EgrxcUoGLFFkEWY7z2EJ
mBMER+MGeuXHsPR1EYineFg18XJ+Jl3N+A2539v15dh9VrqPxPBW1dcE2/MqcP8T
xtd403PRFMgNIrVei5JkkgZSUu5xzondH5lcxwtPw0iDm0ZE2fh4CRFRGy2SxCGw
CY9aRs8CQJNYAlUcKYm/pPHmgTTqDaHz8w6tEIzUZ+heEQbGKG+wo1cJ3Bi7Kn2O
lQgfLPWNBTUm9Nqsy7PFsZ8f02TzQZdKRXTpTTXn2l4au0XjBIq9LZ8XYYyWkfFT
lmmEUZIoXnByhIVqXZIf9x6GP4L5iZ5oMeTNpmKK4zUFc2OBu/Q5wp7XleEZB9ji
V9P4udpoI2hyvxpn0PIZr/Gl05qkXFwOsPvCSB/pOOch/a0xi7JhGqPYgOAURZnf
oOfGYAf2sBqHDzJy+718dk9bCZfaxc+tccFc7N1P1iUeJEA+SiAWa3Dw8oeTuC9v
xVt/lglWWeXiHTDtsy3MSc1yPQOIjcaPE+tPJfmDY6EGpAGPpC1MVr2sBDdHOq+f
FiHk7V21s3ddHR6xhT6CVVwcNZE9P4qBsWufLJbg/N6S0URVd0ipGr4InWuLdBXT
xhXepiyWGGIN+hBabH2MHA7qQcva/FISrrU8m8z3hNZ89a5EcFVpdNHTvIwAlsDd
yZfAznqe96lomS4f9UmP
=Y3nE
-----END PGP SIGNATURE-----

--6SEEuo15mx4CkX54CiqePiKU0HvUNI1Ip--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 20:49:53 +0000
Message-ID: <09D2323D-79B7-423A-9BA6-504112AFE104 () intel ! com>
--------------------
--Apple-Mail=_FC277461-5FEE-49C4-BFF3-B55576FF17A4
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=iso-8859-1

On Sep 19, 2014, at 1:41 PM, Richard Weinberger <richard@nod.at> wrote:

> Am 19.09.2014 22:34, schrieb Rustad, Mark D:
>> Excellent. I'll try adding an include of delayacct.h instead. My =
patch was based on the assumption that the existing code was wanted in =
that form for some reason, so the patch served a purpose in recognizing =
that it isn't. So the macros have served a purpose before even being in =
place. :-)
>=20
> I bet sched.h does not include delayacct.h for a good reason.
> sched.h is included in a lot of files, maybe delayacct.h introduces =
nasty dependency issues.
> You'll find out. ;-)

Right you are, but when I'm done, there will only be one extern =
declaration for that global, which is better than more than one. I'll =
think a little before settling on the best resolution.

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_FC277461-5FEE-49C4-BFF3-B55576FF17A4
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUHJbyAAoJEDwO/+eO4+5uPxQQAJVRXx4Od4WCkQCggtUxqkJN
EDEnEqCSORD98TWjakQ/DRrdimzlnjZsK1gJLVHIp3kvB9iOs4Zq+Qto43UgtngR
Uh4M4EFQ05OH4xou2s84i8vZ1H6T1m1z8sw8tpjYLpcPx9llQZX4/AdlmORDHyxt
0YPBG4ivSHzywBe3eYA3DnUTfcVc64Akq5Bnau5+iKfaPsibSkNTGHWtbFH+CBRH
GNZgrWWPQnSN5Sr3ApxQ/d1lRHChW6dmE49aRVHPEDkgJoHPD7cQAhkCGqk3y6qa
/gd0heR7z6obzCfbWcz7PjsVoRdS2SdfpE1/Lo9Y/FPCrSXFr6QdB8fPeu8m0HBr
RLVrcqy0+QVA7RUONQXp/hITMoBtrrFy47vD9Iy/A1NL2GY1UsZtizym+KAyKe8j
gBiGUErhAoND9hHuMpwHSrMQ/WguEol16aPWAUTqWwx1oWBoJlQOcHcdyeHkwjer
kub50MXstQO4lVeDo+OlgYmLHVBWbywrf03q7Rlr578y5FVW0d2FCxW0A/90zrX1
T6gOIiZAD1iaNFFdFdrtwdkqTrW4yCHzAD5qUy2eaYfzDyuLjS3u4aNQDb4AI0RQ
S7QA8m2Qatu4B4q8/33oc5HPrmaoLKxNuX4RYNonO9pnMI8hiv5ypKCbjBkixJu+
mPkydO9WnYw4lWH8frnX
=02gi
-----END PGP SIGNATURE-----

--Apple-Mail=_FC277461-5FEE-49C4-BFF3-B55576FF17A4--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-kernel
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 22:54:53 +0000
Message-ID: <20140919225453.GJ2832 () worktop ! localdomain>
--------------------
On Fri, Sep 19, 2014 at 08:29:40AM -0700, Jeff Kirsher wrote:
> From: Mark Rustad <mark.d.rustad@intel.com>
> 
> Use diagnostic control macros to ignore nested-externs warnings
> in this case.
> 
> CC: Ingo Molnar <mingo@redhat.com>
> CC: Peter Zijlstra <peterz@infradead.org>
> CC: Brian Norris <computersforpeace@gmail.com>
> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
> ---
>  include/linux/sched.h | 2 ++
>  1 file changed, 2 insertions(+)
> 
> diff --git a/include/linux/sched.h b/include/linux/sched.h
> index 5c2c885..ed52c76 100644
> --- a/include/linux/sched.h
> +++ b/include/linux/sched.h
> @@ -832,7 +832,9 @@ static inline int sched_info_on(void)
>  #ifdef CONFIG_SCHEDSTATS
>  	return 1;
>  #elif defined(CONFIG_TASK_DELAY_ACCT)
> +	DIAG_PUSH DIAG_IGNORE(nested-externs)
>  	extern int delayacct_on;
> +	DIAG_POP
>  	return delayacct_on;

Who has this nested extern warn on in anycase? I've never seen it
generate a warning. Also WTF is DIAG_PUSH/POP, its not a GCC thing
afaict.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 23:26:28 +0000
Message-ID: <4950B4DF-F8A7-4978-B901-CB35EA1B1F5B () intel ! com>
--------------------
--Apple-Mail=_D8662EEB-57AD-48EA-9B68-0FCF113D7C74
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 19, 2014, at 3:54 PM, Peter Zijlstra <peterz@infradead.org> =
wrote:

> On Fri, Sep 19, 2014 at 08:29:40AM -0700, Jeff Kirsher wrote:
>> From: Mark Rustad <mark.d.rustad@intel.com>
>>=20
>> Use diagnostic control macros to ignore nested-externs warnings
>> in this case.
>>=20
>> CC: Ingo Molnar <mingo@redhat.com>
>> CC: Peter Zijlstra <peterz@infradead.org>
>> CC: Brian Norris <computersforpeace@gmail.com>
>> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
>> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
>> ---
>> include/linux/sched.h | 2 ++
>> 1 file changed, 2 insertions(+)
>>=20
>> diff --git a/include/linux/sched.h b/include/linux/sched.h
>> index 5c2c885..ed52c76 100644
>> --- a/include/linux/sched.h
>> +++ b/include/linux/sched.h
>> @@ -832,7 +832,9 @@ static inline int sched_info_on(void)
>> #ifdef CONFIG_SCHEDSTATS
>> 	return 1;
>> #elif defined(CONFIG_TASK_DELAY_ACCT)
>> +	DIAG_PUSH DIAG_IGNORE(nested-externs)
>> 	extern int delayacct_on;
>> +	DIAG_POP
>> 	return delayacct_on;
>=20
> Who has this nested extern warn on in anycase?

They appear in W=3D2 builds, so you do have to ask for them.

> I've never seen it
> generate a warning. Also WTF is DIAG_PUSH/POP, its not a GCC thing
> afaict.

The first patch in the series adds macros to use the gcc/clang pragmas =
to control these things. Both compilers have the capability. The macros =
generate nothing for compilers that lack it.

In any case, this particular one will be resolved instead of silenced.

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_D8662EEB-57AD-48EA-9B68-0FCF113D7C74
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUHLujAAoJEDwO/+eO4+5umMUP/2SCVWRQgxC650JAl39EOOwG
xKkRgPQLvdjRqa0Oo8ZmmKkWB3l7UKXUALgQgsTlBxz3iA/Z5NlyQMgJr9lAC8t1
YCYtXhHTLTEXv/lHYcGFLqDylqCS75DzdERfRfq+NEv/tuFQ8OKfPdE9cfa0ASYi
jkURRvM+P0ibDa8J7z6fyPD7ydnx1CfX6rqIXzRU7k7TscyEORS5liLBikdNEPOd
4YZIfmYScfyAobdcQSaAVgiooJe95rIk3Qd3Sz+a8OonJnQ6Nv+8js3AV5hsUgrb
d5HI8rVew0hWNif8IopWIiYqsgl/rTp9oqbHjeUsoHJZVlGaroeJqMaNeVw4z2BA
Y23UkWz4CU1r8QsCsbbvH00jtmYX7v+FYYKXKEO6Qno+CxyufQkqI+VO+cJqyPZE
rNamL1p5yOlBP5z1/mg/ETn8NTUuFrIrcThzDePw1Vj967IXhBi9p3ayvFXvR5Y1
ZgI1gJxdHfCHmrd13oV1CKlb4TjQwH0cXhc36FN/rBuFSQaTm764oNCAHesvh0Bj
3JmhchkJ3AKk5P9r++ii0+gxRqXKJy1jFNYxanJtUnSWm7XVURKVKJygFY0aVZiY
Qynh55a8S7vcOCI/VIHJyqfibSATJRV7E26zyfZYe9lHDhYG9Z0KHkUmxDKuutXl
4P4P8KU5VrQnlLdGYYkS
=Wmh/
-----END PGP SIGNATURE-----

--Apple-Mail=_D8662EEB-57AD-48EA-9B68-0FCF113D7C74--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-sparse
Subject: Re: [PATCH 7/7] sched: Silence nested-externs warnings
Date: Fri, 19 Sep 2014 23:26:28 +0000
Message-ID: <4950B4DF-F8A7-4978-B901-CB35EA1B1F5B () intel ! com>
--------------------
--Apple-Mail=_D8662EEB-57AD-48EA-9B68-0FCF113D7C74
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 19, 2014, at 3:54 PM, Peter Zijlstra <peterz@infradead.org> =
wrote:

> On Fri, Sep 19, 2014 at 08:29:40AM -0700, Jeff Kirsher wrote:
>> From: Mark Rustad <mark.d.rustad@intel.com>
>>=20
>> Use diagnostic control macros to ignore nested-externs warnings
>> in this case.
>>=20
>> CC: Ingo Molnar <mingo@redhat.com>
>> CC: Peter Zijlstra <peterz@infradead.org>
>> CC: Brian Norris <computersforpeace@gmail.com>
>> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
>> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
>> ---
>> include/linux/sched.h | 2 ++
>> 1 file changed, 2 insertions(+)
>>=20
>> diff --git a/include/linux/sched.h b/include/linux/sched.h
>> index 5c2c885..ed52c76 100644
>> --- a/include/linux/sched.h
>> +++ b/include/linux/sched.h
>> @@ -832,7 +832,9 @@ static inline int sched_info_on(void)
>> #ifdef CONFIG_SCHEDSTATS
>> 	return 1;
>> #elif defined(CONFIG_TASK_DELAY_ACCT)
>> +	DIAG_PUSH DIAG_IGNORE(nested-externs)
>> 	extern int delayacct_on;
>> +	DIAG_POP
>> 	return delayacct_on;
>=20
> Who has this nested extern warn on in anycase?

They appear in W=3D2 builds, so you do have to ask for them.

> I've never seen it
> generate a warning. Also WTF is DIAG_PUSH/POP, its not a GCC thing
> afaict.

The first patch in the series adds macros to use the gcc/clang pragmas =
to control these things. Both compilers have the capability. The macros =
generate nothing for compilers that lack it.

In any case, this particular one will be resolved instead of silenced.

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_D8662EEB-57AD-48EA-9B68-0FCF113D7C74
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUHLujAAoJEDwO/+eO4+5umMUP/2SCVWRQgxC650JAl39EOOwG
xKkRgPQLvdjRqa0Oo8ZmmKkWB3l7UKXUALgQgsTlBxz3iA/Z5NlyQMgJr9lAC8t1
YCYtXhHTLTEXv/lHYcGFLqDylqCS75DzdERfRfq+NEv/tuFQ8OKfPdE9cfa0ASYi
jkURRvM+P0ibDa8J7z6fyPD7ydnx1CfX6rqIXzRU7k7TscyEORS5liLBikdNEPOd
4YZIfmYScfyAobdcQSaAVgiooJe95rIk3Qd3Sz+a8OonJnQ6Nv+8js3AV5hsUgrb
d5HI8rVew0hWNif8IopWIiYqsgl/rTp9oqbHjeUsoHJZVlGaroeJqMaNeVw4z2BA
Y23UkWz4CU1r8QsCsbbvH00jtmYX7v+FYYKXKEO6Qno+CxyufQkqI+VO+cJqyPZE
rNamL1p5yOlBP5z1/mg/ETn8NTUuFrIrcThzDePw1Vj967IXhBi9p3ayvFXvR5Y1
ZgI1gJxdHfCHmrd13oV1CKlb4TjQwH0cXhc36FN/rBuFSQaTm764oNCAHesvh0Bj
3JmhchkJ3AKk5P9r++ii0+gxRqXKJy1jFNYxanJtUnSWm7XVURKVKJygFY0aVZiY
Qynh55a8S7vcOCI/VIHJyqfibSATJRV7E26zyfZYe9lHDhYG9Z0KHkUmxDKuutXl
4P4P8KU5VrQnlLdGYYkS
=Wmh/
-----END PGP SIGNATURE-----

--Apple-Mail=_D8662EEB-57AD-48EA-9B68-0FCF113D7C74--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH RESEND] build: allow use of PKG_CONFIG to override pkg-config ===

From: Aaro Koskinen <aaro.koskinen () nsn ! com>
To: linux-sparse
Subject: [PATCH RESEND] build: allow use of PKG_CONFIG to override pkg-config
Date: Fri, 07 Nov 2014 12:44:47 +0000
Message-ID: <1415364287-5427-1-git-send-email-aaro.koskinen () nsn ! com>
--------------------
Allow overriding pkg-config e.g. when cross-compiling.

Signed-off-by: Aaro Koskinen <aaro.koskinen@nsn.com>
---
 Makefile | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/Makefile b/Makefile
index 3f3c71a..c7031af 100644
--- a/Makefile
+++ b/Makefile
@@ -17,6 +17,7 @@ CFLAGS += -Wall -Wwrite-strings
 LDFLAGS += -g
 LD = gcc
 AR = ar
+PKG_CONFIG = pkg-config
 
 ALL_CFLAGS = $(CFLAGS) $(BASIC_CFLAGS)
 #
@@ -25,11 +26,11 @@ ALL_CFLAGS = $(CFLAGS) $(BASIC_CFLAGS)
 #     CFLAGS += -O0 -DDEBUG -g3 -gdwarf-2
 #
 
-HAVE_LIBXML:=$(shell pkg-config --exists libxml-2.0 2>/dev/null && echo 'yes')
+HAVE_LIBXML:=$(shell $(PKG_CONFIG) --exists libxml-2.0 2>/dev/null && echo 'yes')
 HAVE_GCC_DEP:=$(shell touch .gcc-test.c && 				\
 		$(CC) -c -Wp,-MD,.gcc-test.d .gcc-test.c 2>/dev/null && \
 		echo 'yes'; rm -f .gcc-test.d .gcc-test.o .gcc-test.c)
-HAVE_GTK2:=$(shell pkg-config --exists gtk+-2.0 2>/dev/null && echo 'yes')
+HAVE_GTK2:=$(shell $(PKG_CONFIG) --exists gtk+-2.0 2>/dev/null && echo 'yes')
 LLVM_CONFIG:=llvm-config
 HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
 
@@ -60,14 +61,14 @@ INST_MAN1=sparse.1 cgcc.1
 ifeq ($(HAVE_LIBXML),yes)
 PROGRAMS+=c2xml
 INST_PROGRAMS+=c2xml
-c2xml_EXTRA_OBJS = `pkg-config --libs libxml-2.0`
+c2xml_EXTRA_OBJS = `$(PKG_CONFIG) --libs libxml-2.0`
 else
 $(warning Your system does not have libxml, disabling c2xml)
 endif
 
 ifeq ($(HAVE_GTK2),yes)
-GTK2_CFLAGS := $(shell pkg-config --cflags gtk+-2.0)
-GTK2_LIBS := $(shell pkg-config --libs gtk+-2.0)
+GTK2_CFLAGS := $(shell $(PKG_CONFIG) --cflags gtk+-2.0)
+GTK2_LIBS := $(shell $(PKG_CONFIG) --libs gtk+-2.0)
 PROGRAMS += test-inspect
 INST_PROGRAMS += test-inspect
 test-inspect_EXTRA_DEPS := ast-model.o ast-view.o ast-inspect.o
@@ -187,7 +188,7 @@ DEP_FILES := $(wildcard .*.o.d)
 $(if $(DEP_FILES),$(eval include $(DEP_FILES)))
 
 c2xml.o: c2xml.c $(LIB_H)
-	$(QUIET_CC)$(CC) `pkg-config --cflags libxml-2.0` -o $@ -c $(ALL_CFLAGS) $<
+	$(QUIET_CC)$(CC) `$(PKG_CONFIG) --cflags libxml-2.0` -o $@ -c $(ALL_CFLAGS) $<
 
 compat-linux.o: compat/strtold.c compat/mmap-blob.c $(LIB_H)
 compat-solaris.o: compat/mmap-blob.c $(LIB_H)
-- 
2.1.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH V2 linux-next] jffs2: fix sparse warning: unexpected unlock ===

From: Brian Norris <computersforpeace () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH V2 linux-next] jffs2: fix sparse warning: unexpected unlock
Date: Wed, 22 Oct 2014 08:40:45 +0000
Message-ID: <20141022084045.GI16128 () brian-ubuntu>
--------------------
On Sun, Sep 28, 2014 at 09:26:32PM +0200, Fabian Frederick wrote:
> fs/jffs2/summary.c:846:5: warning: context imbalance in 'jffs2_sum_write_sumnode' - unexpected unlock
> 
> Suggested-by: Brian Norris <computersforpeace@gmail.com>
> Suggested-by: Josh Triplett <josh@joshtriplett.org>
> Signed-off-by: Fabian Frederick <fabf@skynet.be>
> ---
> V2: use __must_hold instead of __releases / __acquires
> (suggested by Brian Norris and Josh Triplett)

Pushed to l2-mtd.git. Thanks!

Brian
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH V2] sparse: Allow override of sizeof(bool) warning ===

From: Theodore Ts'o <tytso () mit ! edu>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 15:24:35 +0000
Message-ID: <20140227152435.GA7982 () thunk ! org>
--------------------
On Thu, Feb 27, 2014 at 07:10:25AM -0800, H. Peter Anvin wrote:
> Keep in mind, too, that for the kernel we don't care about the full
> C standard but a subset.  We rely on extrastandard behavior all over
> the place.  For all ABIs supported by the kernel, sizeof(_Book) == 1
> and so everything is sane.

Do we have a fairly comprehensive list of what these extrastandard
requirements / assumptions are?  It might be a good idea to have one
that we can point to, so that (a) people who are trying to define a
new architecture knows what they need to handle, (b) and so we can
give a list of things that static code analyzers like smatch and
coverity and sparse should be able to suppress (perhaps in a Linux
kernel-only mode).

					- Ted
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Theodore Ts'o <tytso () mit ! edu>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 15:24:35 +0000
Message-ID: <20140227152435.GA7982 () thunk ! org>
--------------------
On Thu, Feb 27, 2014 at 07:10:25AM -0800, H. Peter Anvin wrote:
> Keep in mind, too, that for the kernel we don't care about the full
> C standard but a subset.  We rely on extrastandard behavior all over
> the place.  For all ABIs supported by the kernel, sizeof(_Book) == 1
> and so everything is sane.

Do we have a fairly comprehensive list of what these extrastandard
requirements / assumptions are?  It might be a good idea to have one
that we can point to, so that (a) people who are trying to define a
new architecture knows what they need to handle, (b) and so we can
give a list of things that static code analyzers like smatch and
coverity and sparse should be able to suppress (perhaps in a Linux
kernel-only mode).

					- Ted
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 15:48:35 +0000
Message-ID: <530F5E53.5070208 () zytor ! com>
--------------------
On 02/27/2014 07:24 AM, Theodore Ts'o wrote:
> On Thu, Feb 27, 2014 at 07:10:25AM -0800, H. Peter Anvin wrote:
>> Keep in mind, too, that for the kernel we don't care about the full
>> C standard but a subset.  We rely on extrastandard behavior all over
>> the place.  For all ABIs supported by the kernel, sizeof(_Book) == 1
>> and so everything is sane.
> 
> Do we have a fairly comprehensive list of what these extrastandard
> requirements / assumptions are?  It might be a good idea to have one
> that we can point to, so that (a) people who are trying to define a
> new architecture knows what they need to handle, (b) and so we can
> give a list of things that static code analyzers like smatch and
> coverity and sparse should be able to suppress (perhaps in a Linux
> kernel-only mode).
> 

No, but I think we can certainly make a list... a lot of it right now
sits in various people's heads.

Here are a couple:

- Bytes are 8 bits
- Signed integers will be 2's complement
- sizeof char, short, int, long, and long long will be 1, 2, 4, 4, 8 or
  1, 2, 4, 8, 8 on 32- and 64-bit processors, respectively.
- sizeof(long) == sizeof(void *)
- NULL is represented by all zero
- Structures will not add padding as long as all the members are
  naturally aligned.

Someone want to set up a collaborative document of some kind and collect
more?

	-hpa


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Borislav Petkov <bp () alien8 ! de>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 16:01:12 +0000
Message-ID: <20140227160112.GG18191 () pd ! tnic>
--------------------
On Thu, Feb 27, 2014 at 07:48:35AM -0800, H. Peter Anvin wrote:
> No, but I think we can certainly make a list... a lot of it right now
> sits in various people's heads.
> 
> Here are a couple:
> 
> - Bytes are 8 bits
> - Signed integers will be 2's complement
> - sizeof char, short, int, long, and long long will be 1, 2, 4, 4, 8 or
		^					   ^
	       bool, 					  ,1 ,


>   1, 2, 4, 8, 8 on 32- and 64-bit processors, respectively.
> - sizeof(long) == sizeof(void *)
> - NULL is represented by all zero
> - Structures will not add padding as long as all the members are
>   naturally aligned.
> 
> Someone want to set up a collaborative document of some kind and collect
> more?

https://wiki.kernel.org/ but I hear spammers love it.

-- 
Regards/Gruss,
    Boris.

Sent from a fat crate under my desk. Formatting is fine.
--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Borislav Petkov <bp () alien8 ! de>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 16:01:12 +0000
Message-ID: <20140227160112.GG18191 () pd ! tnic>
--------------------
On Thu, Feb 27, 2014 at 07:48:35AM -0800, H. Peter Anvin wrote:
> No, but I think we can certainly make a list... a lot of it right now
> sits in various people's heads.
> 
> Here are a couple:
> 
> - Bytes are 8 bits
> - Signed integers will be 2's complement
> - sizeof char, short, int, long, and long long will be 1, 2, 4, 4, 8 or
		^					   ^
	       bool, 					  ,1 ,


>   1, 2, 4, 8, 8 on 32- and 64-bit processors, respectively.
> - sizeof(long) == sizeof(void *)
> - NULL is represented by all zero
> - Structures will not add padding as long as all the members are
>   naturally aligned.
> 
> Someone want to set up a collaborative document of some kind and collect
> more?

https://wiki.kernel.org/ but I hear spammers love it.

-- 
Regards/Gruss,
    Boris.

Sent from a fat crate under my desk. Formatting is fine.
--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 16:10:04 +0000
Message-ID: <20140227161004.GT26722 () mwanda>
--------------------
On Thu, Feb 27, 2014 at 07:48:35AM -0800, H. Peter Anvin wrote:
> > Do we have a fairly comprehensive list of what these extrastandard
> > requirements / assumptions are?  It might be a good idea to have one
> > that we can point to, so that (a) people who are trying to define a
> > new architecture knows what they need to handle, (b) and so we can
> > give a list of things that static code analyzers like smatch and
> > coverity and sparse should be able to suppress (perhaps in a Linux
> > kernel-only mode).
> > 
> 
> No, but I think we can certainly make a list... a lot of it right now
> sits in various people's heads.
> 
> Here are a couple:
> 
> - Bytes are 8 bits
> - Signed integers will be 2's complement
> - sizeof char, short, int, long, and long long will be 1, 2, 4, 4, 8 or
>   1, 2, 4, 8, 8 on 32- and 64-bit processors, respectively.
> - sizeof(long) == sizeof(void *)
> - NULL is represented by all zero
> - Structures will not add padding as long as all the members are
>   naturally aligned.
> 

That last assumption has to change for the Meta architecture.

https://lwn.net/Articles/522188/

On meta, the structs and unions are padded to 4 bytes unless they are
explicitly marked as __packed.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 16:10:04 +0000
Message-ID: <20140227161004.GT26722 () mwanda>
--------------------
On Thu, Feb 27, 2014 at 07:48:35AM -0800, H. Peter Anvin wrote:
> > Do we have a fairly comprehensive list of what these extrastandard
> > requirements / assumptions are?  It might be a good idea to have one
> > that we can point to, so that (a) people who are trying to define a
> > new architecture knows what they need to handle, (b) and so we can
> > give a list of things that static code analyzers like smatch and
> > coverity and sparse should be able to suppress (perhaps in a Linux
> > kernel-only mode).
> > 
> 
> No, but I think we can certainly make a list... a lot of it right now
> sits in various people's heads.
> 
> Here are a couple:
> 
> - Bytes are 8 bits
> - Signed integers will be 2's complement
> - sizeof char, short, int, long, and long long will be 1, 2, 4, 4, 8 or
>   1, 2, 4, 8, 8 on 32- and 64-bit processors, respectively.
> - sizeof(long) == sizeof(void *)
> - NULL is represented by all zero
> - Structures will not add padding as long as all the members are
>   naturally aligned.
> 

That last assumption has to change for the Meta architecture.

https://lwn.net/Articles/522188/

On meta, the structs and unions are padded to 4 bytes unless they are
explicitly marked as __packed.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 16:52:19 +0000
Message-ID: <530F6D43.5020006 () zytor ! com>
--------------------
On 02/27/2014 08:10 AM, Dan Carpenter wrote:
> 
> That last assumption has to change for the Meta architecture.
> 
> https://lwn.net/Articles/522188/
> 
> On meta, the structs and unions are padded to 4 bytes unless they are
> explicitly marked as __packed.
> 

One have to wonder how likely they are to have that not continually break...

	-hpa


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 16:52:19 +0000
Message-ID: <530F6D43.5020006 () zytor ! com>
--------------------
On 02/27/2014 08:10 AM, Dan Carpenter wrote:
> 
> That last assumption has to change for the Meta architecture.
> 
> https://lwn.net/Articles/522188/
> 
> On meta, the structs and unions are padded to 4 bytes unless they are
> explicitly marked as __packed.
> 

One have to wonder how likely they are to have that not continually break...

	-hpa


--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: James Hogan <james.hogan () imgtec ! com>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 17:06:02 +0000
Message-ID: <530F707A.8060603 () imgtec ! com>
--------------------
On 27/02/14 16:52, H. Peter Anvin wrote:
> On 02/27/2014 08:10 AM, Dan Carpenter wrote:
>>
>> That last assumption has to change for the Meta architecture.
>>
>> https://lwn.net/Articles/522188/
>>
>> On meta, the structs and unions are padded to 4 bytes unless they are
>> explicitly marked as __packed.
>>
> 
> One have to wonder how likely they are to have that not continually break...

Well it's only when it deals with stored/portable data formats that it's
an issue, and in those cases some amount of care over packing has
usually already been taken. It most often causes problems when one small
struct/union containing only chars or shorts is nested inside another
struct which is marked as packed (on the unfortunately mistaken
assumption that the inner struct cannot have padding at the end so
doesn't need packing itself).

But yeh, it is a PITA.

Cheers
James
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:22:45 +0000
Message-ID: <CANeU7Q=RNXR00bQcPzJYTOcZmRSn3U31ZcadPTHu6Y_Uk0UnYw () mail ! gmail ! com>
--------------------
On Wed, Feb 26, 2014 at 8:32 PM, H. Peter Anvin <hpa@zytor.com> wrote:
>
> Quite frankly, this is silly in my opinion, *and* it is not guaranteed
> by C either (read about "trap representations").
>>
> Anything that moves data around in a generic fashion.  It can be as
> simple as:
>
>         memcpy(foo, bar, sizeof *foo);

OK. I get it nobody wants a sizeof(_Bool) warning.

I am going to apply this patch.

Should we change the default to off then?

Thanks.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:22:45 +0000
Message-ID: <CANeU7Q=RNXR00bQcPzJYTOcZmRSn3U31ZcadPTHu6Y_Uk0UnYw () mail ! gmail ! com>
--------------------
On Wed, Feb 26, 2014 at 8:32 PM, H. Peter Anvin <hpa@zytor.com> wrote:
>
> Quite frankly, this is silly in my opinion, *and* it is not guaranteed
> by C either (read about "trap representations").
>>
> Anything that moves data around in a generic fashion.  It can be as
> simple as:
>
>         memcpy(foo, bar, sizeof *foo);

OK. I get it nobody wants a sizeof(_Bool) warning.

I am going to apply this patch.

Should we change the default to off then?

Thanks.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:26:14 +0000
Message-ID: <faa9e231-d561-417b-8b8b-95192cb0e56a () email ! android ! com>
--------------------
I would.

On February 27, 2014 12:22:45 PM PST, Christopher Li <sparse@chrisli.org> wrote:
>On Wed, Feb 26, 2014 at 8:32 PM, H. Peter Anvin <hpa@zytor.com> wrote:
>>
>> Quite frankly, this is silly in my opinion, *and* it is not
>guaranteed
>> by C either (read about "trap representations").
>>>
>> Anything that moves data around in a generic fashion.  It can be as
>> simple as:
>>
>>         memcpy(foo, bar, sizeof *foo);
>
>OK. I get it nobody wants a sizeof(_Bool) warning.
>
>I am going to apply this patch.
>
>Should we change the default to off then?
>
>Thanks.
>
>Chris

-- 
Sent from my mobile phone.  Please pardon brevity and lack of formatting.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:39:23 +0000
Message-ID: <1393533563.24588.127.camel () joe-AO722>
--------------------
On Thu, 2014-02-27 at 12:26 -0800, H. Peter Anvin wrote:
> On February 27, 2014 12:22:45 PM PST, Christopher Li <sparse@chrisli.org> wrote:
> >OK. I get it nobody wants a sizeof(_Bool) warning.
> >I am going to apply this patch.

Please use V3 as I stuffed up the alphabetic order
of sizeof and shadow.

> >Should we change the default to off then?
> I would.

I'm not sure it matters much, but the linux-kernel
Makefile wouldn't need to be changed if Wsizeof_bool
is default 0.

Here's a couple of other nits:

Maybe the evaluate.c "size = bits_in_char;" assignment

        if (size == 1 && is_bool_type(type)) {
-               warning(expr->pos, "expression using sizeof bool");
+               if (Wsizeof_bool)
+                       warning(expr->pos, "expression using sizeof bool");
                size = bits_in_char;
        }

should be

	size = sizeof(_Bool) * 8;

And also, in sparse.1, Josh Triplett is shown as
the maintainer.  Maybe that should be changed to
Christopher Li


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:44:37 +0000
Message-ID: <CANeU7QnB1Yfd6SjLeUmB1Q-a+U6G221J8es7ckfjB-U45sAVMA () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 12:26 PM, H. Peter Anvin <hpa@zytor.com> wrote:
> I would.
>

Joe, I assume you are OK with this patch, the default is now off.

Chris

Allow an override to emit or not the sizeof(bool) warning.
Add a "-Wsizeof-bool" description to the manpage.

Signed-off-by: Joe Perches <joe@perches.com>
Reviewed-by: Josh Triplett <josh@joshtriplett.org>
Signed-off-by: Christopher Li <sparse@chrisli.org>
---
 evaluate.c | 3 ++-
 lib.c      | 2 ++
 lib.h      | 1 +
 sparse.1   | 8 ++++++++
 4 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..a45f59b 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -2057,7 +2057,8 @@ static struct symbol *evaluate_sizeof(struct
expression *expr)
     }

     if (size == 1 && is_bool_type(type)) {
-        warning(expr->pos, "expression using sizeof bool");
+        if (Wsizeof_bool)
+            warning(expr->pos, "expression using sizeof bool");
         size = bits_in_char;
     }

diff --git a/lib.c b/lib.c
index 51b97fd..844797d 100644
--- a/lib.c
+++ b/lib.c
@@ -226,6 +226,7 @@ int Wparen_string = 0;
 int Wptr_subtraction_blows = 0;
 int Wreturn_void = 0;
 int Wshadow = 0;
+int Wsizeof_bool = 0;
 int Wtransparent_union = 0;
 int Wtypesign = 0;
 int Wundef = 0;
@@ -438,6 +439,7 @@ static const struct warning {
     { "ptr-subtraction-blows", &Wptr_subtraction_blows },
     { "return-void", &Wreturn_void },
     { "shadow", &Wshadow },
+    { "sizeof-bool", &Wsizeof_bool },
     { "transparent-union", &Wtransparent_union },
     { "typesign", &Wtypesign },
     { "undef", &Wundef },
diff --git a/lib.h b/lib.h
index f09b338..f6cd9b4 100644
--- a/lib.h
+++ b/lib.h
@@ -120,6 +120,7 @@ extern int Wparen_string;
 extern int Wptr_subtraction_blows;
 extern int Wreturn_void;
 extern int Wshadow;
+extern int Wsizeof_bool;
 extern int Wtransparent_union;
 extern int Wtypesign;
 extern int Wundef;
diff --git a/sparse.1 b/sparse.1
index cd6be26..54da09b 100644
--- a/sparse.1
+++ b/sparse.1
@@ -297,6 +297,14 @@ Such declarations can lead to error-prone code.
 Sparse does not issue these warnings by default.
 .
 .TP
+.B \-Wsizeof-bool
+Warn when checking the sizeof a _Bool.
+
+C99 does not specify the sizeof a _Bool.  gcc uses 1.
+
+Sparse does not issue these warnings by default.
+.
+.TP
 .B \-Wtransparent\-union
 Warn about any declaration using the GCC extension
 \fB__attribute__((transparent_union))\fR.
-- 
1.8.5.3
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:44:37 +0000
Message-ID: <CANeU7QnB1Yfd6SjLeUmB1Q-a+U6G221J8es7ckfjB-U45sAVMA () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 12:26 PM, H. Peter Anvin <hpa@zytor.com> wrote:
> I would.
>

Joe, I assume you are OK with this patch, the default is now off.

Chris

Allow an override to emit or not the sizeof(bool) warning.
Add a "-Wsizeof-bool" description to the manpage.

Signed-off-by: Joe Perches <joe@perches.com>
Reviewed-by: Josh Triplett <josh@joshtriplett.org>
Signed-off-by: Christopher Li <sparse@chrisli.org>
---
 evaluate.c | 3 ++-
 lib.c      | 2 ++
 lib.h      | 1 +
 sparse.1   | 8 ++++++++
 4 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..a45f59b 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -2057,7 +2057,8 @@ static struct symbol *evaluate_sizeof(struct
expression *expr)
     }

     if (size == 1 && is_bool_type(type)) {
-        warning(expr->pos, "expression using sizeof bool");
+        if (Wsizeof_bool)
+            warning(expr->pos, "expression using sizeof bool");
         size = bits_in_char;
     }

diff --git a/lib.c b/lib.c
index 51b97fd..844797d 100644
--- a/lib.c
+++ b/lib.c
@@ -226,6 +226,7 @@ int Wparen_string = 0;
 int Wptr_subtraction_blows = 0;
 int Wreturn_void = 0;
 int Wshadow = 0;
+int Wsizeof_bool = 0;
 int Wtransparent_union = 0;
 int Wtypesign = 0;
 int Wundef = 0;
@@ -438,6 +439,7 @@ static const struct warning {
     { "ptr-subtraction-blows", &Wptr_subtraction_blows },
     { "return-void", &Wreturn_void },
     { "shadow", &Wshadow },
+    { "sizeof-bool", &Wsizeof_bool },
     { "transparent-union", &Wtransparent_union },
     { "typesign", &Wtypesign },
     { "undef", &Wundef },
diff --git a/lib.h b/lib.h
index f09b338..f6cd9b4 100644
--- a/lib.h
+++ b/lib.h
@@ -120,6 +120,7 @@ extern int Wparen_string;
 extern int Wptr_subtraction_blows;
 extern int Wreturn_void;
 extern int Wshadow;
+extern int Wsizeof_bool;
 extern int Wtransparent_union;
 extern int Wtypesign;
 extern int Wundef;
diff --git a/sparse.1 b/sparse.1
index cd6be26..54da09b 100644
--- a/sparse.1
+++ b/sparse.1
@@ -297,6 +297,14 @@ Such declarations can lead to error-prone code.
 Sparse does not issue these warnings by default.
 .
 .TP
+.B \-Wsizeof-bool
+Warn when checking the sizeof a _Bool.
+
+C99 does not specify the sizeof a _Bool.  gcc uses 1.
+
+Sparse does not issue these warnings by default.
+.
+.TP
 .B \-Wtransparent\-union
 Warn about any declaration using the GCC extension
 \fB__attribute__((transparent_union))\fR.
-- 
1.8.5.3
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:55:28 +0000
Message-ID: <CANeU7QnZika4XsdS_=UwPc5uZgv2-m5vMdmZLyCynKK2YNKLvQ () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 12:39 PM, Joe Perches <joe@perches.com> wrote:
> Please use V3 as I stuffed up the alphabetic order
> of sizeof and shadow.

Please send it your V3 then :-)

>
> I'm not sure it matters much, but the linux-kernel
> Makefile wouldn't need to be changed if Wsizeof_bool
> is default 0.

It seems default to off is the right thing to do.

>
> Here's a couple of other nits:
>
> Maybe the evaluate.c "size = bits_in_char;" assignment
>
>         if (size == 1 && is_bool_type(type)) {
> -               warning(expr->pos, "expression using sizeof bool");
> +               if (Wsizeof_bool)
> +                       warning(expr->pos, "expression using sizeof bool");
>                 size = bits_in_char;
>         }
>
> should be
>
>         size = sizeof(_Bool) * 8;

The reason to use bits_in_xxxx is to allow sparse application to over write
the size of int etc. If you don't like the bits_in_char here. You can introduce
bits_in_bool and set that to sizeof(Bool)*8 by default. That way you don't
hard code it.

> And also, in sparse.1, Josh Triplett is shown as
> the maintainer.  Maybe that should be changed to
> Christopher Li

Maybe a separate patch.

Waiting for your V3.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 20:55:28 +0000
Message-ID: <CANeU7QnZika4XsdS_=UwPc5uZgv2-m5vMdmZLyCynKK2YNKLvQ () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 12:39 PM, Joe Perches <joe@perches.com> wrote:
> Please use V3 as I stuffed up the alphabetic order
> of sizeof and shadow.

Please send it your V3 then :-)

>
> I'm not sure it matters much, but the linux-kernel
> Makefile wouldn't need to be changed if Wsizeof_bool
> is default 0.

It seems default to off is the right thing to do.

>
> Here's a couple of other nits:
>
> Maybe the evaluate.c "size = bits_in_char;" assignment
>
>         if (size == 1 && is_bool_type(type)) {
> -               warning(expr->pos, "expression using sizeof bool");
> +               if (Wsizeof_bool)
> +                       warning(expr->pos, "expression using sizeof bool");
>                 size = bits_in_char;
>         }
>
> should be
>
>         size = sizeof(_Bool) * 8;

The reason to use bits_in_xxxx is to allow sparse application to over write
the size of int etc. If you don't like the bits_in_char here. You can introduce
bits_in_bool and set that to sizeof(Bool)*8 by default. That way you don't
hard code it.

> And also, in sparse.1, Josh Triplett is shown as
> the maintainer.  Maybe that should be changed to
> Christopher Li

Maybe a separate patch.

Waiting for your V3.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 21:00:41 +0000
Message-ID: <1393534841.24588.131.camel () joe-AO722>
--------------------
On Thu, 2014-02-27 at 12:44 -0800, Christopher Li wrote:
> On Thu, Feb 27, 2014 at 12:26 PM, H. Peter Anvin <hpa@zytor.com> wrote:
> > I would.
> Joe, I assume you are OK with this patch, the default is now off.

Of course

> diff --git a/lib.c b/lib.c
[]
> @@ -226,6 +226,7 @@ int Wparen_string = 0;
> +int Wsizeof_bool = 0;


--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 21:03:23 +0000
Message-ID: <CANeU7QnjzVTFJVxvkw_EAay_rX-fvJQc+LY=7r7cG95ApjiOWg () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 1:00 PM, Joe Perches <joe@perches.com> wrote:
> On Thu, 2014-02-27 at 12:44 -0800, Christopher Li wrote:
>> On Thu, Feb 27, 2014 at 12:26 PM, H. Peter Anvin <hpa@zytor.com> wrote:
>> > I would.
>> Joe, I assume you are OK with this patch, the default is now off.
>
> Of course

Let me know if you are going to have a V3 or not.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 21:03:23 +0000
Message-ID: <CANeU7QnjzVTFJVxvkw_EAay_rX-fvJQc+LY=7r7cG95ApjiOWg () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 1:00 PM, Joe Perches <joe@perches.com> wrote:
> On Thu, 2014-02-27 at 12:44 -0800, Christopher Li wrote:
>> On Thu, Feb 27, 2014 at 12:26 PM, H. Peter Anvin <hpa@zytor.com> wrote:
>> > I would.
>> Joe, I assume you are OK with this patch, the default is now off.
>
> Of course

Let me know if you are going to have a V3 or not.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 21:41:23 +0000
Message-ID: <CANeU7Q=QoDN2itH9pVt4v+NE1YULpDL38Fj9ES511fCH7Wn0Sg () mail ! gmail ! com>
--------------------
On Thu, Feb 27, 2014 at 1:00 PM, Joe Perches <joe@perches.com> wrote:

> Of course
>

The change has applied and pushed.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-sparse
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 21:49:06 +0000
Message-ID: <1393537746.24588.143.camel () joe-AO722>
--------------------
On Thu, 2014-02-27 at 12:55 -0800, Christopher Li wrote:
> On Thu, Feb 27, 2014 at 12:39 PM, Joe Perches <joe@perches.com> wrote:

> > Maybe the evaluate.c "size = bits_in_char;" assignment
> >
> >         if (size == 1 && is_bool_type(type)) {
> > -               warning(expr->pos, "expression using sizeof bool");
> > +               if (Wsizeof_bool)
> > +                       warning(expr->pos, "expression using sizeof bool");
> >                 size = bits_in_char;
> >         }
> >
> > should be
> >
> >         size = sizeof(_Bool) * 8;
> 
> The reason to use bits_in_xxxx is to allow sparse application to over write
> the size of int etc. If you don't like the bits_in_char here. You can introduce
> bits_in_bool and set that to sizeof(Bool)*8 by default. That way you don't
> hard code it.

There already is a bits_in_bool and it's default 1.

$ git grep -E "\bbits_in_\w+\s*=[^=]"
lib.c:          bits_in_long = 64;
lib.c:          bits_in_pointer = 64;
target.c:int bits_in_bool = 1;
target.c:int bits_in_char = 8;
target.c:int bits_in_short = 16;
target.c:int bits_in_int = 32;
target.c:int bits_in_long = 32;
target.c:int bits_in_longlong = 64;
target.c:int bits_in_longlonglong = 128;
target.c:int bits_in_float = 32;
target.c:int bits_in_double = 64;
target.c:int bits_in_longdouble = 80;
target.c:int bits_in_pointer = 32;
target.c:int bits_in_enum = 32;

> > And also, in sparse.1, Josh Triplett is shown as
> > the maintainer.  Maybe that should be changed to
> > Christopher Li
> 
> Maybe a separate patch.

That's fine with me too.  If you're the maintainer,
I think you should do that patch.  I don't see a need
for me to send any more right now though.

cheers, Joe

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-kernel
Subject: Re: [PATCH V2] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 21:49:06 +0000
Message-ID: <1393537746.24588.143.camel () joe-AO722>
--------------------
On Thu, 2014-02-27 at 12:55 -0800, Christopher Li wrote:
> On Thu, Feb 27, 2014 at 12:39 PM, Joe Perches <joe@perches.com> wrote:

> > Maybe the evaluate.c "size = bits_in_char;" assignment
> >
> >         if (size == 1 && is_bool_type(type)) {
> > -               warning(expr->pos, "expression using sizeof bool");
> > +               if (Wsizeof_bool)
> > +                       warning(expr->pos, "expression using sizeof bool");
> >                 size = bits_in_char;
> >         }
> >
> > should be
> >
> >         size = sizeof(_Bool) * 8;
> 
> The reason to use bits_in_xxxx is to allow sparse application to over write
> the size of int etc. If you don't like the bits_in_char here. You can introduce
> bits_in_bool and set that to sizeof(Bool)*8 by default. That way you don't
> hard code it.

There already is a bits_in_bool and it's default 1.

$ git grep -E "\bbits_in_\w+\s*=[^=]"
lib.c:          bits_in_long = 64;
lib.c:          bits_in_pointer = 64;
target.c:int bits_in_bool = 1;
target.c:int bits_in_char = 8;
target.c:int bits_in_short = 16;
target.c:int bits_in_int = 32;
target.c:int bits_in_long = 32;
target.c:int bits_in_longlong = 64;
target.c:int bits_in_longlonglong = 128;
target.c:int bits_in_float = 32;
target.c:int bits_in_double = 64;
target.c:int bits_in_longdouble = 80;
target.c:int bits_in_pointer = 32;
target.c:int bits_in_enum = 32;

> > And also, in sparse.1, Josh Triplett is shown as
> > the maintainer.  Maybe that should be changed to
> > Christopher Li
> 
> Maybe a separate patch.

That's fine with me too.  If you're the maintainer,
I think you should do that patch.  I don't see a need
for me to send any more right now though.

cheers, Joe

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH V3] sparse: Allow override of sizeof(bool) warning ===

From: Joe Perches <joe () perches ! com>
To: linux-sparse
Subject: [PATCH V3] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 03:19:25 +0000
Message-ID: <1393471165.24588.79.camel () joe-AO722>
--------------------
Allow an override to emit or not the sizeof(bool) warning.
Add a "-Wsizeof-bool" description to the manpage.

Signed-off-by: Joe Perches <joe@perches.com>
Reviewed-by: Josh Triplett <josh@joshtriplett.org>
---
v2: Add manpage
v3: gah.  Joe knows his alphabet (sometimes). (shadow _then_ sizeof)

 evaluate.c | 3 ++-
 lib.c      | 2 ++
 lib.h      | 1 +
 sparse.1   | 9 +++++++++
 4 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..a45f59b 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -2057,7 +2057,8 @@ static struct symbol *evaluate_sizeof(struct expression *expr)
 	}
 
 	if (size == 1 && is_bool_type(type)) {
-		warning(expr->pos, "expression using sizeof bool");
+		if (Wsizeof_bool)
+			warning(expr->pos, "expression using sizeof bool");
 		size = bits_in_char;
 	}
 
diff --git a/lib.c b/lib.c
index bf3e91c..d6ac79d 100644
--- a/lib.c
+++ b/lib.c
@@ -226,6 +226,7 @@ int Wparen_string = 0;
 int Wptr_subtraction_blows = 0;
 int Wreturn_void = 0;
 int Wshadow = 0;
+int Wsizeof_bool = 1;
 int Wtransparent_union = 0;
 int Wtypesign = 0;
 int Wundef = 0;
@@ -438,6 +439,7 @@ static const struct warning {
 	{ "ptr-subtraction-blows", &Wptr_subtraction_blows },
 	{ "return-void", &Wreturn_void },
 	{ "shadow", &Wshadow },
+	{ "sizeof-bool", &Wsizeof_bool },
 	{ "transparent-union", &Wtransparent_union },
 	{ "typesign", &Wtypesign },
 	{ "undef", &Wundef },
diff --git a/lib.h b/lib.h
index f09b338..f6cd9b4 100644
--- a/lib.h
+++ b/lib.h
@@ -120,6 +120,7 @@ extern int Wparen_string;
 extern int Wptr_subtraction_blows;
 extern int Wreturn_void;
 extern int Wshadow;
+extern int Wsizeof_bool;
 extern int Wtransparent_union;
 extern int Wtypesign;
 extern int Wundef;
diff --git a/sparse.1 b/sparse.1
index cd6be26..b7a5b5c 100644
--- a/sparse.1
+++ b/sparse.1
@@ -297,6 +297,15 @@ Such declarations can lead to error-prone code.
 Sparse does not issue these warnings by default.
 .
 .TP
+.B \-Wsizeof-bool
+Warn when checking the sizeof a _Bool.
+
+C99 does not specify the sizeof a _Bool.  gcc uses 1.
+
+Sparse issues these warnings by default.  To turn them off, use
+\fB\-Wno\-sizeof\-bool\fR.
+.
+.TP
 .B \-Wtransparent\-union
 Warn about any declaration using the GCC extension
 \fB__attribute__((transparent_union))\fR.
-- 
1.8.1.2.459.gbcd45b4.dirty



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2 0/2] fix for --param GCC's command line option ===

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-sparse
Subject: [PATCH v2 0/2] fix for --param GCC's command line option
Date: Tue, 17 Jun 2014 09:11:44 +0000
Message-ID: <1402996306-6811-1-git-send-email-andriy.shevchenko () linux ! intel ! com>
--------------------
There is a dumb fix to avoid --param option and make sparse survive.

Since v1:
 - added patch 1/2
 - handle both --param=* and --param *

Andy Shevchenko (2):
  lib.c: introduce split_value_from_arg helper
  lib.c: skip --param parameters

 lib.c | 38 ++++++++++++++++++++++++++++----------
 1 file changed, 28 insertions(+), 10 deletions(-)

-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2 01/10] Add the __restrict__ keyword ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH v2 01/10] Add the __restrict__ keyword
Date: Thu, 07 Aug 2014 20:11:02 +0000
Message-ID: <53E3DD56.1030706 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

I added a separate test file (alternate-keywords.c) which includes
test cases for restrict, __restrict and __restrict__. I also included
some additional tests for other alternative keywords (hence the name
of the file), namely inline, typeof and their variants.

I have tested this only on 32-bit Linux so far. (I will do the other
platforms tomorrow, but I don't expect to find any problems) I wanted
to get this to you tonight.

ATB,
Ramsay Jones

 ident-list.h                    |  2 +-
 parse.c                         |  3 ++-
 validation/alternate-keywords.c | 46 +++++++++++++++++++++++++++++++++++++++++
 validation/reserved.c           |  1 +
 4 files changed, 50 insertions(+), 2 deletions(-)
 create mode 100644 validation/alternate-keywords.c

diff --git a/ident-list.h b/ident-list.h
index c0fc18f..d5a145f 100644
--- a/ident-list.h
+++ b/ident-list.h
@@ -86,7 +86,7 @@ IDENT(stdcall); IDENT(__stdcall__);
 IDENT(fastcall); IDENT(__fastcall__);
 IDENT(dllimport); IDENT(__dllimport__);
 IDENT(dllexport); IDENT(__dllexport__);
-IDENT(restrict); IDENT(__restrict);
+IDENT(restrict); IDENT(__restrict); IDENT(__restrict__);
 IDENT(artificial); IDENT(__artificial__);
 IDENT(leaf); IDENT(__leaf__);
 IDENT(vector_size); IDENT(__vector_size__);
diff --git a/parse.c b/parse.c
index eaa1883..ec835ef 100644
--- a/parse.c
+++ b/parse.c
@@ -435,6 +435,7 @@ static struct init_keyword {
 	/* Ignored for now.. */
 	{ "restrict",	NS_TYPEDEF, .op = &restrict_op},
 	{ "__restrict",	NS_TYPEDEF, .op = &restrict_op},
+	{ "__restrict__",	NS_TYPEDEF, .op = &restrict_op},
 
 	/* Storage class */
 	{ "auto",	NS_TYPEDEF, .op = &auto_op },
@@ -1553,7 +1554,7 @@ static struct token *abstract_array_declarator(struct token *token, struct symbo
 
 	token = abstract_array_static_declarator(token, &has_static);
 
-	if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
+	if (match_idents(token, &restrict_ident, &__restrict_ident, &__restrict___ident, NULL))
 		token = abstract_array_static_declarator(token->next, &has_static);
 	token = parse_expression(token, &expr);
 	sym->array_size = expr;
diff --git a/validation/alternate-keywords.c b/validation/alternate-keywords.c
new file mode 100644
index 0000000..2e91a35
--- /dev/null
+++ b/validation/alternate-keywords.c
@@ -0,0 +1,46 @@
+
+extern float strtof(const char *__restrict__ ptr, char **__restrict__ endptr);
+extern double strtod(const char *__restrict ptr, char **__restrict endptr);
+/* restrict: -std=c99 or -std=gnu99 or -std=c11 */
+extern long double strtold(const char *restrict ptr, char **restrict endptr);
+
+extern int (*funcs[])(void);
+
+/* typeof: no -std or -std=gnu90 or -std=gnu99 or -std=gnu11 */
+extern typeof (funcs[0]) f0;
+extern __typeof (funcs[1]) f1;
+extern __typeof__(funcs[2]) f2;
+
+typedef unsigned short uint16_t;
+typedef unsigned int uint32_t;
+typedef unsigned long long uint64_t;
+
+static __inline__ uint16_t swap16(uint16_t val)
+{
+	return ((((uint16_t)(val) & (uint16_t)0x00ffU) << 8) |
+		(((uint16_t)(val) & (uint16_t)0xff00U) >> 8));
+}
+
+static __inline uint32_t swap32(uint32_t val)
+{
+	return ((((uint32_t)(val) & (uint32_t)0x000000ffUL) << 24) |
+		(((uint32_t)(val) & (uint32_t)0x0000ff00UL) <<  8) |
+		(((uint32_t)(val) & (uint32_t)0x00ff0000UL) >>  8) |
+		(((uint32_t)(val) & (uint32_t)0xff000000UL) >> 24));
+}
+
+/* inline: no -std or -std=gnu90 or -std=c99 or -std=c11 */
+static inline uint64_t swap64(uint64_t val)
+{
+	return ((((uint64_t)(val) & (uint64_t)0x00000000000000ffULL) << 56) |
+		(((uint64_t)(val) & (uint64_t)0x000000000000ff00ULL) << 40) |
+		(((uint64_t)(val) & (uint64_t)0x0000000000ff0000ULL) << 24) |
+		(((uint64_t)(val) & (uint64_t)0x00000000ff000000ULL) <<  8) |
+		(((uint64_t)(val) & (uint64_t)0x000000ff00000000ULL) >>  8) |
+		(((uint64_t)(val) & (uint64_t)0x0000ff0000000000ULL) >> 24) |
+		(((uint64_t)(val) & (uint64_t)0x00ff000000000000ULL) >> 40) |
+		(((uint64_t)(val) & (uint64_t)0xff00000000000000ULL) >> 56));
+}
+/*
+ * check-name: alternate keywords
+ */
diff --git a/validation/reserved.c b/validation/reserved.c
index caacd21..e5d7af8 100644
--- a/validation/reserved.c
+++ b/validation/reserved.c
@@ -30,6 +30,7 @@ reserved.c:8:12: error: Trying to use reserved word '__const' as identifier
 reserved.c:9:12: error: Trying to use reserved word '__const__' as identifier
 reserved.c:10:12: error: Trying to use reserved word 'restrict' as identifier
 reserved.c:11:12: error: Trying to use reserved word '__restrict' as identifier
+reserved.c:12:12: error: Trying to use reserved word '__restrict__' as identifier
 reserved.c:13:12: error: Trying to use reserved word 'typedef' as identifier
 reserved.c:14:12: error: Trying to use reserved word '__typeof' as identifier
 reserved.c:15:12: error: Trying to use reserved word '__typeof__' as identifier
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH v2 01/10] Add the __restrict__ keyword
Date: Thu, 07 Aug 2014 20:11:02 +0000
Message-ID: <53E3DD56.1030706 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

I added a separate test file (alternate-keywords.c) which includes
test cases for restrict, __restrict and __restrict__. I also included
some additional tests for other alternative keywords (hence the name
of the file), namely inline, typeof and their variants.

I have tested this only on 32-bit Linux so far. (I will do the other
platforms tomorrow, but I don't expect to find any problems) I wanted
to get this to you tonight.

ATB,
Ramsay Jones

 ident-list.h                    |  2 +-
 parse.c                         |  3 ++-
 validation/alternate-keywords.c | 46 +++++++++++++++++++++++++++++++++++++++++
 validation/reserved.c           |  1 +
 4 files changed, 50 insertions(+), 2 deletions(-)
 create mode 100644 validation/alternate-keywords.c

diff --git a/ident-list.h b/ident-list.h
index c0fc18f..d5a145f 100644
--- a/ident-list.h
+++ b/ident-list.h
@@ -86,7 +86,7 @@ IDENT(stdcall); IDENT(__stdcall__);
 IDENT(fastcall); IDENT(__fastcall__);
 IDENT(dllimport); IDENT(__dllimport__);
 IDENT(dllexport); IDENT(__dllexport__);
-IDENT(restrict); IDENT(__restrict);
+IDENT(restrict); IDENT(__restrict); IDENT(__restrict__);
 IDENT(artificial); IDENT(__artificial__);
 IDENT(leaf); IDENT(__leaf__);
 IDENT(vector_size); IDENT(__vector_size__);
diff --git a/parse.c b/parse.c
index eaa1883..ec835ef 100644
--- a/parse.c
+++ b/parse.c
@@ -435,6 +435,7 @@ static struct init_keyword {
 	/* Ignored for now.. */
 	{ "restrict",	NS_TYPEDEF, .op = &restrict_op},
 	{ "__restrict",	NS_TYPEDEF, .op = &restrict_op},
+	{ "__restrict__",	NS_TYPEDEF, .op = &restrict_op},
 
 	/* Storage class */
 	{ "auto",	NS_TYPEDEF, .op = &auto_op },
@@ -1553,7 +1554,7 @@ static struct token *abstract_array_declarator(struct token *token, struct symbo
 
 	token = abstract_array_static_declarator(token, &has_static);
 
-	if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
+	if (match_idents(token, &restrict_ident, &__restrict_ident, &__restrict___ident, NULL))
 		token = abstract_array_static_declarator(token->next, &has_static);
 	token = parse_expression(token, &expr);
 	sym->array_size = expr;
diff --git a/validation/alternate-keywords.c b/validation/alternate-keywords.c
new file mode 100644
index 0000000..2e91a35
--- /dev/null
+++ b/validation/alternate-keywords.c
@@ -0,0 +1,46 @@
+
+extern float strtof(const char *__restrict__ ptr, char **__restrict__ endptr);
+extern double strtod(const char *__restrict ptr, char **__restrict endptr);
+/* restrict: -std=c99 or -std=gnu99 or -std=c11 */
+extern long double strtold(const char *restrict ptr, char **restrict endptr);
+
+extern int (*funcs[])(void);
+
+/* typeof: no -std or -std=gnu90 or -std=gnu99 or -std=gnu11 */
+extern typeof (funcs[0]) f0;
+extern __typeof (funcs[1]) f1;
+extern __typeof__(funcs[2]) f2;
+
+typedef unsigned short uint16_t;
+typedef unsigned int uint32_t;
+typedef unsigned long long uint64_t;
+
+static __inline__ uint16_t swap16(uint16_t val)
+{
+	return ((((uint16_t)(val) & (uint16_t)0x00ffU) << 8) |
+		(((uint16_t)(val) & (uint16_t)0xff00U) >> 8));
+}
+
+static __inline uint32_t swap32(uint32_t val)
+{
+	return ((((uint32_t)(val) & (uint32_t)0x000000ffUL) << 24) |
+		(((uint32_t)(val) & (uint32_t)0x0000ff00UL) <<  8) |
+		(((uint32_t)(val) & (uint32_t)0x00ff0000UL) >>  8) |
+		(((uint32_t)(val) & (uint32_t)0xff000000UL) >> 24));
+}
+
+/* inline: no -std or -std=gnu90 or -std=c99 or -std=c11 */
+static inline uint64_t swap64(uint64_t val)
+{
+	return ((((uint64_t)(val) & (uint64_t)0x00000000000000ffULL) << 56) |
+		(((uint64_t)(val) & (uint64_t)0x000000000000ff00ULL) << 40) |
+		(((uint64_t)(val) & (uint64_t)0x0000000000ff0000ULL) << 24) |
+		(((uint64_t)(val) & (uint64_t)0x00000000ff000000ULL) <<  8) |
+		(((uint64_t)(val) & (uint64_t)0x000000ff00000000ULL) >>  8) |
+		(((uint64_t)(val) & (uint64_t)0x0000ff0000000000ULL) >> 24) |
+		(((uint64_t)(val) & (uint64_t)0x00ff000000000000ULL) >> 40) |
+		(((uint64_t)(val) & (uint64_t)0xff00000000000000ULL) >> 56));
+}
+/*
+ * check-name: alternate keywords
+ */
diff --git a/validation/reserved.c b/validation/reserved.c
index caacd21..e5d7af8 100644
--- a/validation/reserved.c
+++ b/validation/reserved.c
@@ -30,6 +30,7 @@ reserved.c:8:12: error: Trying to use reserved word '__const' as identifier
 reserved.c:9:12: error: Trying to use reserved word '__const__' as identifier
 reserved.c:10:12: error: Trying to use reserved word 'restrict' as identifier
 reserved.c:11:12: error: Trying to use reserved word '__restrict' as identifier
+reserved.c:12:12: error: Trying to use reserved word '__restrict__' as identifier
 reserved.c:13:12: error: Trying to use reserved word 'typedef' as identifier
 reserved.c:14:12: error: Trying to use reserved word '__typeof' as identifier
 reserved.c:15:12: error: Trying to use reserved word '__typeof__' as identifier
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2 01/10] Add the __restrict__ keyword
Date: Sat, 27 Sep 2014 00:47:43 +0000
Message-ID: <CANeU7QkWoXrrjdZvDFCM4yzFH7h70=1WraB7m3ggVrCan11dwQ () mail ! gmail ! com>
--------------------
Catching up my backlog.

On Fri, Aug 8, 2014 at 4:11 AM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
>
> Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
> ---
>
> Hi Chris,
>
> I added a separate test file (alternate-keywords.c) which includes
> test cases for restrict, __restrict and __restrict__. I also included
> some additional tests for other alternative keywords (hence the name
> of the file), namely inline, typeof and their variants.

Looks good.

> Just for the
> record, I don't know of any use of __restrict__ in an abstract array
> declaration on _any_ platform.

If there is no code using the __restrict__ for abstract array, we shouldn't need
this line:

> @@ -1553,7 +1554,7 @@ static struct token *abstract_array_declarator(struct token *token, struct symbo
>
>         token = abstract_array_static_declarator(token, &has_static);
>
> -       if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
> +       if (match_idents(token, &restrict_ident, &__restrict_ident, &__restrict___ident, NULL))
>                 token = abstract_array_static_declarator(token->next, &has_static);
>         token = parse_expression(token, &expr);
>         sym->array_size = expr;

Or, if you have valid reason to add it. Please provide a test case for
this code path.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH v2 01/10] Add the __restrict__ keyword
Date: Sat, 27 Sep 2014 12:42:32 +0000
Message-ID: <5426B0B8.4000709 () ramsay1 ! demon ! co ! uk>
--------------------
On 27/09/14 01:47, Christopher Li wrote:
> Catching up my backlog.
> 
> On Fri, Aug 8, 2014 at 4:11 AM, Ramsay Jones <ramsay@ramsay1.demon.co.uk> wrote:
[...]

>> Just for the
>> record, I don't know of any use of __restrict__ in an abstract array
>> declaration on _any_ platform.
> 
> If there is no code using the __restrict__ for abstract array, we shouldn't need
> this line:

Of course, just because I'm not aware of any such use, doesn't mean
there isn't one. :-D

gcc supports this usage, so it would be useful if sparse did also.

>> @@ -1553,7 +1554,7 @@ static struct token *abstract_array_declarator(struct token *token, struct symbo
>>
>>         token = abstract_array_static_declarator(token, &has_static);
>>
>> -       if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
>> +       if (match_idents(token, &restrict_ident, &__restrict_ident, &__restrict___ident, NULL))
>>                 token = abstract_array_static_declarator(token->next, &has_static);
>>         token = parse_expression(token, &expr);
>>         sym->array_size = expr;
> 
> Or, if you have valid reason to add it. Please provide a test case for
> this code path.

Yep, will do.

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH v2 06/10] don't run sparse{c,i} tests when sparse-llvm is disabled
Date: Sat, 27 Sep 2014 20:37:25 +0000
Message-ID: <54272005.4050100 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

I decided to have a quick attempt at one of the different approaches
to this patch that I mentioned this afternoon. So, although I have
labelled this as 'v2', its really an alternative to the 'v1' patch.

Note that I renamed sparse{c,i} to sparse{c,i}-in. It may have been
better to name then sparse{c,i}.sh, since they are not really templates
to be 'processed' to create a build product. dunno.

The Makefile changes were done in a hurry ... (I was more interested in
the test-suite changes.)

I'm not sure if this approach is any better ... what do you think?
Any other ideas?

ATB,
Ramsay Jones



 .gitignore            |  2 ++
 Makefile              | 10 ++++++++++
 sparsec => sparsec-in |  0
 sparsei => sparsei-in |  0
 validation/test-suite | 17 +++++++++++++++--
 5 files changed, 27 insertions(+), 2 deletions(-)
 rename sparsec => sparsec-in (100%)
 rename sparsei => sparsei-in (100%)

diff --git a/.gitignore b/.gitignore
index d32d063..a237767 100644
--- a/.gitignore
+++ b/.gitignore
@@ -9,6 +9,8 @@
 pre-process.h
 sparse.pc
 version.h
+sparsec
+sparsei
 
 # programs
 test-inspect
diff --git a/Makefile b/Makefile
index 1b69a73..2f87507 100644
--- a/Makefile
+++ b/Makefile
@@ -87,11 +87,20 @@ PROGRAMS += $(LLVM_PROGS)
 INST_PROGRAMS += sparse-llvm sparsec
 sparse-llvm.o: BASIC_CFLAGS += $(LLVM_CFLAGS)
 sparse-llvm_EXTRA_OBJS := $(LLVM_LIBS) $(LLVM_LDFLAGS)
+ifneq ($(MAKECMDGOALS),clean)
+ifeq ($(wildcard sparse?),)
+$(info $(shell cp sparsec-in sparsec && echo '     GEN      sparsec'))
+$(info $(shell cp sparsei-in sparsei && echo '     GEN      sparsei'))
+endif
+endif
 else
 $(warning LLVM 3.0 or later required. Your system has version $(LLVM_VERSION) installed.)
 endif
 else
 $(warning Your system does not have llvm, disabling sparse-llvm)
+ifneq ($(wildcard sparse?),)
+junk := $(shell rm -f sparsec sparsei)
+endif
 endif
 
 LIB_H=    token.h parse.h lib.h symbol.h scope.h expression.h target.h \
@@ -196,6 +205,7 @@ compat-cygwin.o: $(LIB_H)
 
 clean: clean-check
 	rm -f *.[oa] .*.d *.so $(PROGRAMS) $(SLIB_FILE) pre-process.h sparse.pc
+	rm -f sparsec sparsei
 
 dist:
 	@if test "$(SPARSE_VERSION)" != "v$(VERSION)" ; then \
diff --git a/sparsec b/sparsec-in
similarity index 100%
rename from sparsec
rename to sparsec-in
diff --git a/sparsei b/sparsei-in
similarity index 100%
rename from sparsei
rename to sparsei-in
diff --git a/validation/test-suite b/validation/test-suite
index 3c011c6..05a2b2f 100755
--- a/validation/test-suite
+++ b/validation/test-suite
@@ -9,10 +9,12 @@ prog_name=`basename $0`
 
 # counts:
 #	- tests that have not been converted to test-suite format
+#	- tests that are disabled
 #	- tests that passed
 #	- tests that failed
 #	- tests that failed but are known to fail
 unhandled_tests=0
+disabled_tests=0
 ok_tests=0
 ko_tests=0
 known_ko_tests=0
@@ -80,6 +82,7 @@ echo "    help                       prints usage"
 #	- 0 if the test passed,
 #	- 1 if it failed,
 #	- 2 if it is not a "test-suite" test.
+#	- 3 if the test is disabled.
 do_test()
 {
 	test_failed=0
@@ -95,8 +98,6 @@ do_test()
 	fi
 	test_name=$last_result
 
-	echo "     TEST    $test_name ($file)"
-
 	# does the test provide a specific command ?
 	cmd=`eval echo $default_path/$default_cmd`
 	get_value "check-command" $file
@@ -104,6 +105,15 @@ do_test()
 		last_result=`echo $last_result | sed -e 's/^ *//'`
 		cmd=`eval echo $default_path/$last_result`
 	fi
+
+	# check for disabled commands
+	prog=`echo $cmd | sed -e 's/^\([^ ]*\) .*$/\1/'`
+	if [ ! -x "$prog" ]; then
+		disabled_tests=`expr $disabled_tests + 1`
+		return 3
+	fi
+	echo "     TEST    $test_name ($file)"
+
 	verbose "Using command       : $cmd"
 
 	# grab the expected exit value
@@ -168,6 +178,9 @@ do_test_suite()
 	if [ "$unhandled_tests" -ne "0" ]; then
 		echo "$unhandled_tests tests could not be handled by $prog_name"
 	fi
+	if [ "$disabled_tests" -ne "0" ]; then
+		echo "$disabled_tests tests were disabled"
+	fi
 }
 
 ##
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2 1/2] evaluate: split out implementation of compatible_assignment_types ===

From: John Keeping <john () keeping ! me ! uk>
To: linux-sparse
Subject: [PATCH v2 1/2] evaluate: split out implementation of compatible_assignment_types
Date: Sun, 09 Mar 2014 11:32:50 +0000
Message-ID: <afd69e2697f3d3da96b74c06501fd2fb1fc5cba2.1394364717.git.john () keeping ! me ! uk>
--------------------
This will allow us to reuse the logic when processing a transparent
union by checking each member in turn without printing a warning unless
none of the members match.

Signed-off-by: John Keeping <john@keeping.me.uk>
---
 evaluate.c | 57 ++++++++++++++++++++++++++++++++++-----------------------
 1 file changed, 34 insertions(+), 23 deletions(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..2e6511b 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -1307,10 +1307,9 @@ static int whitelist_pointers(struct symbol *t1, struct symbol *t2)
 	return !Wtypesign;
 }
 
-static int compatible_assignment_types(struct expression *expr, struct symbol *target,
-	struct expression **rp, const char *where)
+static int check_assignment_types(struct symbol *target, struct expression **rp,
+	const char **typediff)
 {
-	const char *typediff;
 	struct symbol *source = degenerate(*rp);
 	struct symbol *t, *s;
 	int tclass = classify_type(target, &t);
@@ -1327,8 +1326,8 @@ static int compatible_assignment_types(struct expression *expr, struct symbol *t
 				return 1;
 		} else if (!(sclass & TYPE_RESTRICT))
 			goto Cast;
-		typediff = "different base types";
-		goto Err;
+		*typediff = "different base types";
+		return 0;
 	}
 
 	if (tclass == TYPE_PTR) {
@@ -1342,8 +1341,8 @@ static int compatible_assignment_types(struct expression *expr, struct symbol *t
 			goto Cast;
 		}
 		if (!(sclass & TYPE_PTR)) {
-			typediff = "different base types";
-			goto Err;
+			*typediff = "different base types";
+			return 0;
 		}
 		b1 = examine_pointer_target(t);
 		b2 = examine_pointer_target(s);
@@ -1356,19 +1355,19 @@ static int compatible_assignment_types(struct expression *expr, struct symbol *t
 			 * or mix address spaces [sparse].
 			 */
 			if (t->ctype.as != s->ctype.as) {
-				typediff = "different address spaces";
-				goto Err;
+				*typediff = "different address spaces";
+				return 0;
 			}
 			if (mod2 & ~mod1) {
-				typediff = "different modifiers";
-				goto Err;
+				*typediff = "different modifiers";
+				return 0;
 			}
 			goto Cast;
 		}
 		/* It's OK if the target is more volatile or const than the source */
-		typediff = type_difference(&t->ctype, &s->ctype, 0, mod1);
-		if (typediff)
-			goto Err;
+		*typediff = type_difference(&t->ctype, &s->ctype, 0, mod1);
+		if (*typediff)
+			return 0;
 		return 1;
 	}
 
@@ -1379,22 +1378,34 @@ static int compatible_assignment_types(struct expression *expr, struct symbol *t
 		/* XXX: need to turn into comparison with NULL */
 		if (t == &bool_ctype && (sclass & TYPE_PTR))
 			goto Cast;
-		typediff = "different base types";
-		goto Err;
+		*typediff = "different base types";
+		return 0;
 	}
-	typediff = "invalid types";
-
-Err:
-	warning(expr->pos, "incorrect type in %s (%s)", where, typediff);
-	info(expr->pos, "   expected %s", show_typename(target));
-	info(expr->pos, "   got %s", show_typename(source));
-	*rp = cast_to(*rp, target);
+	*typediff = "invalid types";
 	return 0;
+
 Cast:
 	*rp = cast_to(*rp, target);
 	return 1;
 }
 
+static int compatible_assignment_types(struct expression *expr, struct symbol *target,
+	struct expression **rp, const char *where)
+{
+	const char *typediff;
+	struct symbol *source = degenerate(*rp);
+
+	if (!check_assignment_types(target, rp, &typediff)) {
+		warning(expr->pos, "incorrect type in %s (%s)", where, typediff);
+		info(expr->pos, "   expected %s", show_typename(target));
+		info(expr->pos, "   got %s", show_typename(source));
+		*rp = cast_to(*rp, target);
+		return 0;
+	}
+
+	return 1;
+}
+
 static void mark_assigned(struct expression *expr)
 {
 	struct symbol *sym;
-- 
1.9.0.6.g037df60.dirty

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH v2 1/2] evaluate: split out implementation of compatible_assignment_types
Date: Tue, 01 Apr 2014 14:31:11 +0000
Message-ID: <533ACDAF.6050408 () ramsay1 ! demon ! co ! uk>
--------------------
On 01/04/14 08:46, Christopher Li wrote:
> On Sun, Mar 9, 2014 at 4:32 AM, John Keeping <john@keeping.me.uk> wrote:
>> This will allow us to reuse the logic when processing a transparent
>> union by checking each member in turn without printing a warning unless
>> none of the members match.
> 
> Both patches applied.
> 
> Chris

I 'tested' these patches (on Linux), by running sparse over the git.git
sources, as soon as they were posted. They worked beautifully. (git.git
on Linux (32-bit) only has a single sparse warning now - yay! :)

I forgot to report that here, since I had intended to test the patches
on Cygwin and (my version of sparse) on MinGW first, but I didn't get
around to it ... sorry!  (Hmm, I may have time tonight ...)

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2 1/2] lib.c: introduce split_value_from_arg helper ===

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-sparse
Subject: [PATCH v2 1/2] lib.c: introduce split_value_from_arg helper
Date: Tue, 17 Jun 2014 09:11:45 +0000
Message-ID: <1402996306-6811-2-git-send-email-andriy.shevchenko () linux ! intel ! com>
--------------------
The function tries to split a key / value from the given argument where
delimiter can be either ' ' (space) or '=' (equal sign).

It will be useful later as well.

Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
---
 lib.c | 23 ++++++++++++++---------
 1 file changed, 14 insertions(+), 9 deletions(-)

diff --git a/lib.c b/lib.c
index bf3e91c..4e5a846 100644
--- a/lib.c
+++ b/lib.c
@@ -275,14 +275,8 @@ void add_pre_buffer(const char *fmt, ...)
 	pre_buffer_end = end;
 }
 
-static char **handle_switch_D(char *arg, char **next)
+static const char *split_value_from_arg(char *arg, const char *def)
 {
-	const char *name = arg + 1;
-	const char *value = "1";
-
-	if (!*name || isspace(*name))
-		die("argument to `-D' is missing");
-
 	for (;;) {
 		char c;
 		c = *++arg;
@@ -290,10 +284,21 @@ static char **handle_switch_D(char *arg, char **next)
 			break;
 		if (isspace((unsigned char)c) || c == '=') {
 			*arg = '\0';
-			value = arg + 1;
-			break;
+			return arg + 1;
 		}
 	}
+	return def;
+}
+
+static char **handle_switch_D(char *arg, char **next)
+{
+	const char *name = arg + 1;
+	const char *value = "1";
+
+	if (!*name || isspace(*name))
+		die("argument to `-D' is missing");
+
+	value = split_value_from_arg(arg, value);
 	add_pre_buffer("#define %s %s\n", name, value);
 	return next;
 }
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2 2/2] lib.c: skip --param parameters ===

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-sparse
Subject: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Tue, 17 Jun 2014 09:11:46 +0000
Message-ID: <1402996306-6811-3-git-send-email-andriy.shevchenko () linux ! intel ! com>
--------------------
Very dumb patch to just skip --param allow-store-data-races=0 introduced in
newer GCC versions.

Without this patch sparse recognizes parameter of the --param option as a file
name which obviously couldn't be found.

The patch for easy implementation's sake slightly changed behaviour of
--version. Instead of exact keyword it will recognize anything starting with
--version as a correct option.

Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
---
 lib.c | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/lib.c b/lib.c
index 4e5a846..d5b94c3 100644
--- a/lib.c
+++ b/lib.c
@@ -678,6 +678,18 @@ static char **handle_version(char *arg, char **next)
 	exit(0);
 }
 
+static char **handle_param(char *arg, char **next)
+{
+	const char *value = NULL;
+
+	/* For now just skip any '--param=*' or '--param *' */
+	value = split_value_from_arg(arg, value);
+	if (!value)
+		++next;
+
+	return ++next;
+}
+
 struct switches {
 	const char *name;
 	char **(*fn)(char *, char **);
@@ -686,13 +698,14 @@ struct switches {
 static char **handle_long_options(char *arg, char **next)
 {
 	static struct switches cmd[] = {
+		{ "param", handle_param },
 		{ "version", handle_version },
 		{ NULL, NULL }
 	};
 	struct switches *s = cmd;
 
 	while (s->name) {
-		if (!strcmp(s->name, arg))
+		if (!strncmp(arg, s->name, strlen(s->name)))
 			return s->fn(arg, next);
 		s++;
 	}
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Sat, 28 Jun 2014 16:23:24 +0000
Message-ID: <CANeU7Q=uro=aXmXOM9U0Tt+pot4GEn6Jdqi9csOcoYuqAr-MvQ () mail ! gmail ! com>
--------------------

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Sat, 28 Jun 2014 16:59:58 +0000
Message-ID: <CANeU7QnLad1f4KkLpTGSWB8eD8_La-tACim6rR7DLQ=hggwhOQ () mail ! gmail ! com>
--------------------
Oops, I just click send before I type up the reply. Here we go again.

On Tue, Jun 17, 2014 at 2:11 AM, Andy Shevchenko
<andriy.shevchenko@linux.intel.com> wrote:
> Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> newer GCC versions.
>
> +static char **handle_param(char *arg, char **next)
> +{
> +       const char *value = NULL;
> +
> +       /* For now just skip any '--param=*' or '--param *' */
> +       value = split_value_from_arg(arg, value);
> +       if (!value)
> +               ++next;
> +
> +       return ++next;
> +}

I think this is problematic.There are three possible input
from args:
1) "--parm", you need to ++next skip to next arg, which is the value for parm.
2) "--parm=x",  you don't need to skip to next arg.
3) "--parm-with-crap", invalid argument. You don't need to skip next arg.

I think the patch is wrong on case 2) and case 3).
In case 2), the patch skip two arguments and make next point
points to out of bound memory.

The split_value_from_arg function is not a good abstraction for this job.
Its return value can only indicate 2 possible out come.
Also, returning the default value force the test against the input
default value. That make the logic a bit complicate.

>  struct switches {
>         const char *name;
>         char **(*fn)(char *, char **);
> @@ -686,13 +698,14 @@ struct switches {
>  static char **handle_long_options(char *arg, char **next)
>  {
>         static struct switches cmd[] = {
> +               { "param", handle_param },
>                 { "version", handle_version },
>                 { NULL, NULL }
>         };
>         struct switches *s = cmd;
>
>         while (s->name) {
> -               if (!strcmp(s->name, arg))
> +               if (!strncmp(arg, s->name, strlen(s->name)))

This will allow "--version-with-crap" as valid arguments.

I think we can have one extra member in "struct switch"
to indicate this option is a prefix rather than a whole word.
For "parm", it need to set that prefix member to non zero.

Please let me know if there is a V3 coming.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Sat, 28 Jun 2014 16:59:58 +0000
Message-ID: <CANeU7QnLad1f4KkLpTGSWB8eD8_La-tACim6rR7DLQ=hggwhOQ () mail ! gmail ! com>
--------------------
Oops, I just click send before I type up the reply. Here we go again.

On Tue, Jun 17, 2014 at 2:11 AM, Andy Shevchenko
<andriy.shevchenko@linux.intel.com> wrote:
> Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> newer GCC versions.
>
> +static char **handle_param(char *arg, char **next)
> +{
> +       const char *value = NULL;
> +
> +       /* For now just skip any '--param=*' or '--param *' */
> +       value = split_value_from_arg(arg, value);
> +       if (!value)
> +               ++next;
> +
> +       return ++next;
> +}

I think this is problematic.There are three possible input
from args:
1) "--parm", you need to ++next skip to next arg, which is the value for parm.
2) "--parm=x",  you don't need to skip to next arg.
3) "--parm-with-crap", invalid argument. You don't need to skip next arg.

I think the patch is wrong on case 2) and case 3).
In case 2), the patch skip two arguments and make next point
points to out of bound memory.

The split_value_from_arg function is not a good abstraction for this job.
Its return value can only indicate 2 possible out come.
Also, returning the default value force the test against the input
default value. That make the logic a bit complicate.

>  struct switches {
>         const char *name;
>         char **(*fn)(char *, char **);
> @@ -686,13 +698,14 @@ struct switches {
>  static char **handle_long_options(char *arg, char **next)
>  {
>         static struct switches cmd[] = {
> +               { "param", handle_param },
>                 { "version", handle_version },
>                 { NULL, NULL }
>         };
>         struct switches *s = cmd;
>
>         while (s->name) {
> -               if (!strcmp(s->name, arg))
> +               if (!strncmp(arg, s->name, strlen(s->name)))

This will allow "--version-with-crap" as valid arguments.

I think we can have one extra member in "struct switch"
to indicate this option is a prefix rather than a whole word.
For "parm", it need to set that prefix member to non zero.

Please let me know if there is a V3 coming.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Sun, 29 Jun 2014 07:19:10 +0000
Message-ID: <CANeU7Q=FUTd4XTrQeeFGaSqp7eriZS3egAOqDK--OC-kaWyZuw () mail ! gmail ! com>
--------------------
--001a1132f770dd479904fcf45b40
Content-Type: text/plain; charset=ISO-8859-1

Hi Andy,

On Sat, Jun 28, 2014 at 9:59 AM, Christopher Li <sparse@chrisli.org> wrote:
> I think this is problematic.There are three possible input
> from args:
> 1) "--parm", you need to ++next skip to next arg, which is the value for parm.
> 2) "--parm=x",  you don't need to skip to next arg.
> 3) "--parm-with-crap", invalid argument. You don't need to skip next arg.


How about this patch, I modify from your patch.
It fix the problem I mention earlier.

If no objections, I will push the change.

Chris

--001a1132f770dd479904fcf45b40
Content-Type: text/x-patch; charset=US-ASCII; name="0001-lib.c-skip-param-parameters.patch"
Content-Disposition: attachment; 
	filename="0001-lib.c-skip-param-parameters.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hx00yvwn0

RnJvbSBkOTE3NjYyZDU0YmE2OGQwYzNiMDNlOTk0Y2IxZmE2NmQ3YjE5YzMwIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBBbmR5IFNoZXZjaGVua28gPGFuZHJpeS5zaGV2Y2hlbmtvQGxp
bnV4LmludGVsLmNvbT4KRGF0ZTogVHVlLCAxNyBKdW4gMjAxNCAxMjoxMTo0NSArMDMwMApTdWJq
ZWN0OiBbUEFUQ0hdIGxpYi5jOiBza2lwIC0tcGFyYW0gcGFyYW1ldGVycwoKVmVyeSBkdW1iIHBh
dGNoIHRvIGp1c3Qgc2tpcCAtLXBhcmFtIGFsbG93LXN0b3JlLWRhdGEtcmFjZXM9MCBpbnRyb2R1
Y2VkIGluCm5ld2VyIEdDQyB2ZXJzaW9ucy4KCldpdGhvdXQgdGhpcyBwYXRjaCBzcGFyc2UgcmVj
b2duaXplcyBwYXJhbWV0ZXIgb2YgdGhlIC0tcGFyYW0gb3B0aW9uIGFzIGEgZmlsZQpuYW1lIHdo
aWNoIG9idmlvdXNseSBjb3VsZG4ndCBiZSBmb3VuZC4KClNpZ25lZC1vZmYtYnk6IEFuZHkgU2hl
dmNoZW5rbyA8YW5kcml5LnNoZXZjaGVua29AbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5
OiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgotLS0KIGxpYi5jIHwgMjQgKysr
KysrKysrKysrKysrKysrKysrKy0tCiAxIGZpbGUgY2hhbmdlZCwgMjIgaW5zZXJ0aW9ucygrKSwg
MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9saWIuYyBiL2xpYi5jCmluZGV4IDg0NDc5N2Qu
LjBiYzRiMmIgMTAwNjQ0Ci0tLSBhL2xpYi5jCisrKyBiL2xpYi5jCkBAIC02NzUsMjIgKzY3NSw0
MiBAQCBzdGF0aWMgY2hhciAqKmhhbmRsZV92ZXJzaW9uKGNoYXIgKmFyZywgY2hhciAqKm5leHQp
CiAJZXhpdCgwKTsKIH0KIAorc3RhdGljIGNoYXIgKipoYW5kbGVfcGFyYW0oY2hhciAqYXJnLCBj
aGFyICoqbmV4dCkKK3sKKwljaGFyICp2YWx1ZSA9IE5VTEw7CisKKwkvKiBGb3Igbm93IGp1c3Qg
c2tpcCBhbnkgJy0tcGFyYW09Kicgb3IgJy0tcGFyYW0gKicgKi8KKwlpZiAoKmFyZyA9PSAnXDAn
KSB7CisJCXZhbHVlID0gKisrbmV4dDsKKwl9IGVsc2UgaWYgKGlzc3BhY2UoKmFyZykgfHwgKmFy
ZyA9PSAnPScpIHsKKwkJdmFsdWUgPSArK2FyZzsKKwl9CisKKwlpZiAoIXZhbHVlKQorCQlkaWUo
Im1pc3NpbmcgYXJndW1lbnQgZm9yIC0tcGFyYW0gb3B0aW9uIik7CisKKwlyZXR1cm4gbmV4dDsK
K30KKwogc3RydWN0IHN3aXRjaGVzIHsKIAljb25zdCBjaGFyICpuYW1lOwogCWNoYXIgKiooKmZu
KShjaGFyICosIGNoYXIgKiopOworCXVuc2lnbmVkIGludCBwcmVmaXg6MTsKIH07CiAKIHN0YXRp
YyBjaGFyICoqaGFuZGxlX2xvbmdfb3B0aW9ucyhjaGFyICphcmcsIGNoYXIgKipuZXh0KQogewog
CXN0YXRpYyBzdHJ1Y3Qgc3dpdGNoZXMgY21kW10gPSB7CisJCXsgInBhcmFtIiwgaGFuZGxlX3Bh
cmFtLCAxIH0sCiAJCXsgInZlcnNpb24iLCBoYW5kbGVfdmVyc2lvbiB9LAogCQl7IE5VTEwsIE5V
TEwgfQogCX07CiAJc3RydWN0IHN3aXRjaGVzICpzID0gY21kOwogCiAJd2hpbGUgKHMtPm5hbWUp
IHsKLQkJaWYgKCFzdHJjbXAocy0+bmFtZSwgYXJnKSkKLQkJCXJldHVybiBzLT5mbihhcmcsIG5l
eHQpOworCQlpbnQgb3B0bGVuID0gc3RybGVuKHMtPm5hbWUpOworCQlpZiAoIXN0cm5jbXAocy0+
bmFtZSwgYXJnLCBvcHRsZW4gKyAhcy0+cHJlZml4KSkKKwkJCXJldHVybiBzLT5mbihhcmcgKyBv
cHRsZW4sIG5leHQpOwogCQlzKys7CiAJfQogCXJldHVybiBuZXh0OwotLSAKMS45LjMKCg==
--001a1132f770dd479904fcf45b40--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Sun, 29 Jun 2014 19:01:36 +0000
Message-ID: <CANeU7QmOfn6z==ZgdEJeFm4Xg_BgYGqCQmH5fsVzK73VrSgYdA () mail ! gmail ! com>
--------------------
On Sun, Jun 29, 2014 at 12:19 AM, Christopher Li <sparse@chrisli.org> wrote:
>
> If no objections, I will push the change.
>

Change pushed.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Sun, 29 Jun 2014 19:01:36 +0000
Message-ID: <CANeU7QmOfn6z==ZgdEJeFm4Xg_BgYGqCQmH5fsVzK73VrSgYdA () mail ! gmail ! com>
--------------------
On Sun, Jun 29, 2014 at 12:19 AM, Christopher Li <sparse@chrisli.org> wrote:
>
> If no objections, I will push the change.
>

Change pushed.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-sparse
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Mon, 30 Jun 2014 08:32:45 +0000
Message-ID: <1404117165.5102.3.camel () smile ! fi ! intel ! com>
--------------------
On Sat, 2014-06-28 at 09:59 -0700, Christopher Li wrote:
> Oops, I just click send before I type up the reply. Here we go again.
> 
> On Tue, Jun 17, 2014 at 2:11 AM, Andy Shevchenko
> <andriy.shevchenko@linux.intel.com> wrote:
> > Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> > newer GCC versions.
> >
> > +static char **handle_param(char *arg, char **next)
> > +{
> > +       const char *value = NULL;
> > +
> > +       /* For now just skip any '--param=*' or '--param *' */
> > +       value = split_value_from_arg(arg, value);
> > +       if (!value)
> > +               ++next;
> > +
> > +       return ++next;
> > +}
> 
> I think this is problematic.There are three possible input
> from args:
> 1) "--parm", you need to ++next skip to next arg, which is the value for parm.
> 2) "--parm=x",  you don't need to skip to next arg.
> 3) "--parm-with-crap", invalid argument. You don't need to skip next arg.
> 
> I think the patch is wrong on case 2) and case 3).
> In case 2), the patch skip two arguments and make next point
> points to out of bound memory.

Hmm... I'd just added test printf to the handle_param() and see if I
print *next, it is either --param or --param=*. So, using return (next +
2) helps, otherwise we end up with the same situation as before patch.

What did I miss?

> 
> The split_value_from_arg function is not a good abstraction for this job.
> Its return value can only indicate 2 possible out come.
> Also, returning the default value force the test against the input
> default value. That make the logic a bit complicate.
> 
> >  struct switches {
> >         const char *name;
> >         char **(*fn)(char *, char **);
> > @@ -686,13 +698,14 @@ struct switches {
> >  static char **handle_long_options(char *arg, char **next)
> >  {
> >         static struct switches cmd[] = {
> > +               { "param", handle_param },
> >                 { "version", handle_version },
> >                 { NULL, NULL }
> >         };
> >         struct switches *s = cmd;
> >
> >         while (s->name) {
> > -               if (!strcmp(s->name, arg))
> > +               if (!strncmp(arg, s->name, strlen(s->name)))
> 
> This will allow "--version-with-crap" as valid arguments.

Which was explicitly mentioned in the commit message.

> 
> I think we can have one extra member in "struct switch"
> to indicate this option is a prefix rather than a whole word.
> For "parm", it need to set that prefix member to non zero.

No objections about this approach.

> Please let me know if there is a V3 coming.

Apparently you did this on weekend.


-- 
Andy Shevchenko <andriy.shevchenko@intel.com>
Intel Finland Oy

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-kernel
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Mon, 30 Jun 2014 08:32:45 +0000
Message-ID: <1404117165.5102.3.camel () smile ! fi ! intel ! com>
--------------------
On Sat, 2014-06-28 at 09:59 -0700, Christopher Li wrote:
> Oops, I just click send before I type up the reply. Here we go again.
> 
> On Tue, Jun 17, 2014 at 2:11 AM, Andy Shevchenko
> <andriy.shevchenko@linux.intel.com> wrote:
> > Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> > newer GCC versions.
> >
> > +static char **handle_param(char *arg, char **next)
> > +{
> > +       const char *value = NULL;
> > +
> > +       /* For now just skip any '--param=*' or '--param *' */
> > +       value = split_value_from_arg(arg, value);
> > +       if (!value)
> > +               ++next;
> > +
> > +       return ++next;
> > +}
> 
> I think this is problematic.There are three possible input
> from args:
> 1) "--parm", you need to ++next skip to next arg, which is the value for parm.
> 2) "--parm=x",  you don't need to skip to next arg.
> 3) "--parm-with-crap", invalid argument. You don't need to skip next arg.
> 
> I think the patch is wrong on case 2) and case 3).
> In case 2), the patch skip two arguments and make next point
> points to out of bound memory.

Hmm... I'd just added test printf to the handle_param() and see if I
print *next, it is either --param or --param=*. So, using return (next +
2) helps, otherwise we end up with the same situation as before patch.

What did I miss?

> 
> The split_value_from_arg function is not a good abstraction for this job.
> Its return value can only indicate 2 possible out come.
> Also, returning the default value force the test against the input
> default value. That make the logic a bit complicate.
> 
> >  struct switches {
> >         const char *name;
> >         char **(*fn)(char *, char **);
> > @@ -686,13 +698,14 @@ struct switches {
> >  static char **handle_long_options(char *arg, char **next)
> >  {
> >         static struct switches cmd[] = {
> > +               { "param", handle_param },
> >                 { "version", handle_version },
> >                 { NULL, NULL }
> >         };
> >         struct switches *s = cmd;
> >
> >         while (s->name) {
> > -               if (!strcmp(s->name, arg))
> > +               if (!strncmp(arg, s->name, strlen(s->name)))
> 
> This will allow "--version-with-crap" as valid arguments.

Which was explicitly mentioned in the commit message.

> 
> I think we can have one extra member in "struct switch"
> to indicate this option is a prefix rather than a whole word.
> For "parm", it need to set that prefix member to non zero.

No objections about this approach.

> Please let me know if there is a V3 coming.

Apparently you did this on weekend.


-- 
Andy Shevchenko <andriy.shevchenko@intel.com>
Intel Finland Oy

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Mon, 30 Jun 2014 08:51:57 +0000
Message-ID: <CANeU7Qk6e-CAK_aRTzq=ev_esQ9uGsbc6ihH7m-0=ngoPotVzg () mail ! gmail ! com>
--------------------
On Mon, Jun 30, 2014 at 1:32 AM, Andy Shevchenko
<andriy.shevchenko@linux.intel.com> wrote:
>
> Hmm... I'd just added test printf to the handle_param() and see if I
> print *next, it is either --param or --param=*. So, using return (next +
> 2) helps, otherwise we end up with the same situation as before patch.

The return value from handle_switch() is a bit tricky. It is actually points to
the current args which about to be expired.

Take a look at this code which invoke the handle_switch().
    for (;;) {
        char *arg = *++args;      <---------------- notice the ++
before the fetch
        if (!arg)
            break;

        if (arg[0] == '-' && arg[1]) {
            args = handle_switch(arg+1, args); <-------- args return here.
            continue;
        }
        add_ptr_list_notag(filelist, arg);
    }

>
> What did I miss?

So the caller loop will perform 1 pointer advance before fetch.
Your code can advance 2 pointer, so that is  total 3 pointer advance.

>
> Which was explicitly mentioned in the commit message.

Sorry about that, I jump to the code first. I later notice that  in
the commit message as well.

Any way, the change I push should fix all that.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2 2/2] lib.c: skip --param parameters
Date: Mon, 30 Jun 2014 08:51:57 +0000
Message-ID: <CANeU7Qk6e-CAK_aRTzq=ev_esQ9uGsbc6ihH7m-0=ngoPotVzg () mail ! gmail ! com>
--------------------
On Mon, Jun 30, 2014 at 1:32 AM, Andy Shevchenko
<andriy.shevchenko@linux.intel.com> wrote:
>
> Hmm... I'd just added test printf to the handle_param() and see if I
> print *next, it is either --param or --param=*. So, using return (next +
> 2) helps, otherwise we end up with the same situation as before patch.

The return value from handle_switch() is a bit tricky. It is actually points to
the current args which about to be expired.

Take a look at this code which invoke the handle_switch().
    for (;;) {
        char *arg = *++args;      <---------------- notice the ++
before the fetch
        if (!arg)
            break;

        if (arg[0] == '-' && arg[1]) {
            args = handle_switch(arg+1, args); <-------- args return here.
            continue;
        }
        add_ptr_list_notag(filelist, arg);
    }

>
> What did I miss?

So the caller loop will perform 1 pointer advance before fetch.
Your code can advance 2 pointer, so that is  total 3 pointer advance.

>
> Which was explicitly mentioned in the commit message.

Sorry about that, I jump to the code first. I later notice that  in
the commit message as well.

Any way, the change I push should fix all that.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2] Define __CHAR_BIT__ ===

From: "Emilio G. Cota" <cota () braap ! org>
To: linux-sparse
Subject: [PATCH v2] Define __CHAR_BIT__
Date: Wed, 08 Jan 2014 21:32:42 +0000
Message-ID: <1389216762-10884-1-git-send-email-cota () braap ! org>
--------------------
From: "Emilio G. Cota" <cota@braap.org>

gcc defines __CHAR_BIT__ as a pre-defined macro.

Define __CHAR_BIT__ in sparse so that code that needs it (e.g. code
using CHAR_BIT from limits.h) does not generate false warnings.

Signed-off-by: Emilio G. Cota <cota@braap.org>
---
 lib.c                         | 1 +
 validation/builtin_char_bit.c | 7 +++++++
 2 files changed, 8 insertions(+)
 create mode 100644 validation/builtin_char_bit.c

diff --git a/lib.c b/lib.c
index fe20f93..bbdb9b7 100644
--- a/lib.c
+++ b/lib.c
@@ -911,6 +911,7 @@ void create_builtin_stream(void)
 	add_pre_buffer("#weak_define __LONG_LONG_MAX__ " STRINGIFY(__LONG_LONG_MAX__) "\n");
 	add_pre_buffer("#weak_define __WCHAR_MAX__ " STRINGIFY(__WCHAR_MAX__) "\n");
 	add_pre_buffer("#weak_define __SIZEOF_POINTER__ " STRINGIFY(__SIZEOF_POINTER__) "\n");
+	add_pre_buffer("#weak_define __CHAR_BIT__ " STRINGIFY(__CHAR_BIT__) "\n");
 }
 
 static struct symbol_list *sparse_tokenstream(struct token *token)
diff --git a/validation/builtin_char_bit.c b/validation/builtin_char_bit.c
new file mode 100644
index 0000000..30e6bed
--- /dev/null
+++ b/validation/builtin_char_bit.c
@@ -0,0 +1,7 @@
+#include <limits.h>
+
+static unsigned int word_bits = sizeof(unsigned int) * CHAR_BIT;
+
+/*
+ * check-name: __CHAR_BIT__
+ */
-- 
1.8.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "Emilio G. Cota" <cota () braap ! org>
To: linux-sparse
Subject: Re: [PATCH v2] Define __CHAR_BIT__
Date: Tue, 28 Jan 2014 21:38:10 +0000
Message-ID: <20140128213810.GA27471 () flamenco ! cs ! columbia ! edu>
--------------------
On Wed, Jan 08, 2014 at 16:32:42 -0500, Emilio G. Cota wrote:
> From: "Emilio G. Cota" <cota@braap.org>
> 
> gcc defines __CHAR_BIT__ as a pre-defined macro.
> 
> Define __CHAR_BIT__ in sparse so that code that needs it (e.g. code
> using CHAR_BIT from limits.h) does not generate false warnings.
> 
> Signed-off-by: Emilio G. Cota <cota@braap.org>

Haven't seen any activity for this v2 since it was sent on
Jan 08--please take a look.

Thanks,

		Emilio
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2] sparse: Make -Werror turn warnigns into errors ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Sat, 27 Sep 2014 00:24:42 +0000
Message-ID: <CANeU7QnM-sns1pOgjpOrKp2LkMnf7O=89XSvF7hCuzvrwg5bPw () mail ! gmail ! com>
--------------------
On Thu, Sep 25, 2014 at 4:11 PM, Thomas Graf <tgraf@suug.ch> wrote:
>
> @@ -467,6 +475,9 @@ static char **handle_onoff_switch(char *arg, char **next, const struct warning w
>                 }
>         }
>
> +       if (!strcmp(p, "error"))
> +               Werror = 1;
> +
>         // Prefixes "no" and "no-" mean to turn warning off.
>         if (p[0] == 'n' && p[1] == 'o') {
>                 p += 2;
> diff --git a/lib.h b/lib.h
> index f6cd9b4..dc01684 100644

While I apply the patch, I notice this piece. Sparse has the on/off switch list.
"Werror" seems should belong to that list. Gcc accept "-Wno-error" to turn off
the switch. However, we might not want "-Wsparse-all" to turn on "Werror".

So I have the incremental patch to convert "Werror" using the on/off
switch list.

Feed back?

Chris

diff --git a/lib.c b/lib.c
index 5203d98..8395662 100644
--- a/lib.c
+++ b/lib.c
@@ -439,6 +439,7 @@ static const struct warning {
        { "designated-init", &Wdesignated_init },
        { "do-while", &Wdo_while },
        { "enum-mismatch", &Wenum_mismatch },
+       { "error", &Werror },
        { "init-cstring", &Winit_cstring },
        { "non-pointer-null", &Wnon_pointer_null },
        { "old-initializer", &Wold_initializer },
@@ -470,14 +471,11 @@ static char **handle_onoff_switch(char *arg,
char **next, const struct warning

        if (!strcmp(p, "sparse-all")) {
                for (i = 0; i < n; i++) {
-                       if (*warnings[i].flag != WARNING_FORCE_OFF)
+                       if (*warnings[i].flag != WARNING_FORCE_OFF &&
warnings[i].flag != &Werror)
                                *warnings[i].flag = WARNING_ON;
                }
        }

-       if (!strcmp(p, "error"))
-               Werror = 1;
-
        // Prefixes "no" and "no-" mean to turn warning off.
        if (p[0] == 'n' && p[1] == 'o') {
                p += 2;
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Sat, 27 Sep 2014 00:24:42 +0000
Message-ID: <CANeU7QnM-sns1pOgjpOrKp2LkMnf7O=89XSvF7hCuzvrwg5bPw () mail ! gmail ! com>
--------------------
On Thu, Sep 25, 2014 at 4:11 PM, Thomas Graf <tgraf@suug.ch> wrote:
>
> @@ -467,6 +475,9 @@ static char **handle_onoff_switch(char *arg, char **next, const struct warning w
>                 }
>         }
>
> +       if (!strcmp(p, "error"))
> +               Werror = 1;
> +
>         // Prefixes "no" and "no-" mean to turn warning off.
>         if (p[0] == 'n' && p[1] == 'o') {
>                 p += 2;
> diff --git a/lib.h b/lib.h
> index f6cd9b4..dc01684 100644

While I apply the patch, I notice this piece. Sparse has the on/off switch list.
"Werror" seems should belong to that list. Gcc accept "-Wno-error" to turn off
the switch. However, we might not want "-Wsparse-all" to turn on "Werror".

So I have the incremental patch to convert "Werror" using the on/off
switch list.

Feed back?

Chris

diff --git a/lib.c b/lib.c
index 5203d98..8395662 100644
--- a/lib.c
+++ b/lib.c
@@ -439,6 +439,7 @@ static const struct warning {
        { "designated-init", &Wdesignated_init },
        { "do-while", &Wdo_while },
        { "enum-mismatch", &Wenum_mismatch },
+       { "error", &Werror },
        { "init-cstring", &Winit_cstring },
        { "non-pointer-null", &Wnon_pointer_null },
        { "old-initializer", &Wold_initializer },
@@ -470,14 +471,11 @@ static char **handle_onoff_switch(char *arg,
char **next, const struct warning

        if (!strcmp(p, "sparse-all")) {
                for (i = 0; i < n; i++) {
-                       if (*warnings[i].flag != WARNING_FORCE_OFF)
+                       if (*warnings[i].flag != WARNING_FORCE_OFF &&
warnings[i].flag != &Werror)
                                *warnings[i].flag = WARNING_ON;
                }
        }

-       if (!strcmp(p, "error"))
-               Werror = 1;
-
        // Prefixes "no" and "no-" mean to turn warning off.
        if (p[0] == 'n' && p[1] == 'o') {
                p += 2;
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Thomas Graf <tgraf () suug ! ch>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Sat, 27 Sep 2014 07:11:36 +0000
Message-ID: <20140927071136.GA10174 () casper ! infradead ! org>
--------------------
On 09/27/14 at 08:24am, Christopher Li wrote:
> While I apply the patch, I notice this piece. Sparse has the on/off switch list.
> "Werror" seems should belong to that list. Gcc accept "-Wno-error" to turn off
> the switch. However, we might not want "-Wsparse-all" to turn on "Werror".
> 
> So I have the incremental patch to convert "Werror" using the on/off
> switch list.
> 
> Feed back?

Sure
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Sun, 28 Sep 2014 02:32:38 +0000
Message-ID: <CANeU7Q=hd-PYBk4YEWMt=XfsJAz5r17GZ22FZDvX1W2O_XaK9A () mail ! gmail ! com>
--------------------
On Sat, Sep 27, 2014 at 3:11 PM, Thomas Graf <tgraf@suug.ch> wrote:
>> Feed back?
>
> Sure

Change pushed.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Sun, 28 Sep 2014 02:32:38 +0000
Message-ID: <CANeU7Q=hd-PYBk4YEWMt=XfsJAz5r17GZ22FZDvX1W2O_XaK9A () mail ! gmail ! com>
--------------------
On Sat, Sep 27, 2014 at 3:11 PM, Thomas Graf <tgraf@suug.ch> wrote:
>> Feed back?
>
> Sure

Change pushed.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Tue, 07 Oct 2014 09:45:08 +0000
Message-ID: <20141007094508.GN23154 () mwanda>
--------------------
> diff --git a/cgcc b/cgcc
> index c075e5f..204bda3 100755
> --- a/cgcc
> +++ b/cgcc
> @@ -70,7 +70,7 @@ if ($do_check) {
>  
>      print "$check\n" if $verbose;
>      if ($do_compile) {
> -	system ($check);
> +	system ($check) == 0 or die;

This just enables -Werror for everyone so now I can't run Sparse on
itself now because there are old errors from 2007.

lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers

Btw, these errors also disable warnings for the rest of the file...  I
don't think just because there are different modifiers it means that
we should give up looking for other warnings.  In the kernel we miss
some endian bugs because of this.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Tue, 07 Oct 2014 09:45:08 +0000
Message-ID: <20141007094508.GN23154 () mwanda>
--------------------
> diff --git a/cgcc b/cgcc
> index c075e5f..204bda3 100755
> --- a/cgcc
> +++ b/cgcc
> @@ -70,7 +70,7 @@ if ($do_check) {
>  
>      print "$check\n" if $verbose;
>      if ($do_compile) {
> -	system ($check);
> +	system ($check) == 0 or die;

This just enables -Werror for everyone so now I can't run Sparse on
itself now because there are old errors from 2007.

lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers

Btw, these errors also disable warnings for the rest of the file...  I
don't think just because there are different modifiers it means that
we should give up looking for other warnings.  In the kernel we miss
some endian bugs because of this.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Thomas Graf <tgraf () suug ! ch>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Wed, 08 Oct 2014 09:39:10 +0000
Message-ID: <20141008093910.GB3181 () casper ! infradead ! org>
--------------------
On 10/07/14 at 12:45pm, Dan Carpenter wrote:
> > diff --git a/cgcc b/cgcc
> > index c075e5f..204bda3 100755
> > --- a/cgcc
> > +++ b/cgcc
> > @@ -70,7 +70,7 @@ if ($do_check) {
> >  
> >      print "$check\n" if $verbose;
> >      if ($do_compile) {
> > -	system ($check);
> > +	system ($check) == 0 or die;
> 
> This just enables -Werror for everyone so now I can't run Sparse on
> itself now because there are old errors from 2007.

The above change should merely have sparse fail upon an error and not
warnings unless you specifiy -Werror which I would consider expected
behaviour.

> lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
> lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers
> 
> Btw, these errors also disable warnings for the rest of the file...  I
> don't think just because there are different modifiers it means that
> we should give up looking for other warnings.  In the kernel we miss
> some endian bugs because of this.


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Thomas Graf <tgraf () suug ! ch>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Wed, 08 Oct 2014 09:39:10 +0000
Message-ID: <20141008093910.GB3181 () casper ! infradead ! org>
--------------------
On 10/07/14 at 12:45pm, Dan Carpenter wrote:
> > diff --git a/cgcc b/cgcc
> > index c075e5f..204bda3 100755
> > --- a/cgcc
> > +++ b/cgcc
> > @@ -70,7 +70,7 @@ if ($do_check) {
> >  
> >      print "$check\n" if $verbose;
> >      if ($do_compile) {
> > -	system ($check);
> > +	system ($check) == 0 or die;
> 
> This just enables -Werror for everyone so now I can't run Sparse on
> itself now because there are old errors from 2007.

The above change should merely have sparse fail upon an error and not
warnings unless you specifiy -Werror which I would consider expected
behaviour.

> lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
> lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers
> 
> Btw, these errors also disable warnings for the rest of the file...  I
> don't think just because there are different modifiers it means that
> we should give up looking for other warnings.  In the kernel we miss
> some endian bugs because of this.


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Wed, 08 Oct 2014 10:26:23 +0000
Message-ID: <CANeU7Q==hANeGNEK3f-_LnNa-msVQgPa=mnk4k0qkuz5s=_K+w () mail ! gmail ! com>
--------------------
On Tue, Oct 7, 2014 at 5:45 PM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
>> +     system ($check) == 0 or die;
>
> This just enables -Werror for everyone so now I can't run Sparse on
> itself now because there are old errors from 2007.
>
> lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
> lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers

It depend on how you invoke sparse.
Do you invoke sparse by some thing like "make CC=./cgcc"?

>
> Btw, these errors also disable warnings for the rest of the file...  I
> don't think just because there are different modifiers it means that
> we should give up looking for other warnings.  In the kernel we miss
> some endian bugs because of this.

Are you suggesting change that type different error into warnings so
sparse can still check the rest of the file?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Wed, 08 Oct 2014 17:51:58 +0000
Message-ID: <CANeU7Q=0VhRqKQqO0nKzUT3vN8AU6bcTMC6QKAm3H-Y2i-+4hA () mail ! gmail ! com>
--------------------
On Wed, Oct 8, 2014 at 5:39 PM, Thomas Graf <tgraf@suug.ch> wrote:
>> This just enables -Werror for everyone so now I can't run Sparse on
>> itself now because there are old errors from 2007.
>
> The above change should merely have sparse fail upon an error and not
> warnings unless you specifiy -Werror which I would consider expected
> behaviour.

Actually I realized that this "-Werror" patch is wrong. As it is, we can't
actually make the full kernel check without hitting sparse errors interrupting
the build. That is pretty unacceptable.

We should reserve the "-Werror" for gcc. It means gcc should treat warning
as error. We should have another option like "-Wsparse-error" for telling sparse
to treat warning as error. Just like "-Wall" does not mean sparse should
turn on all usual warnings. We have "-Wsparse-all" for that.

I have the following patch renaming the option. BTW, I think sparse
should only return error when "-Wsparse-error" was given.

Any feed back?

Chris

diff --git a/lib.c b/lib.c
index 8395662..b1b18aa 100644
--- a/lib.c
+++ b/lib.c
@@ -150,7 +150,7 @@ void warning(struct position pos, const char * fmt, ...)
 {
        va_list args;

-       if (Werror) {
+       if (Wsparse_error) {
                va_start(args, fmt);
                do_error(pos, fmt, args);
                va_end(args);
@@ -226,7 +226,7 @@ int Wdesignated_init = 1;
 int Wdo_while = 0;
 int Winit_cstring = 0;
 int Wenum_mismatch = 1;
-int Werror = 0;
+int Wsparse_error = 0;
 int Wnon_pointer_null = 1;
 int Wold_initializer = 1;
 int Wone_bit_signed_bitfield = 1;
@@ -439,7 +439,7 @@ static const struct warning {
        { "designated-init", &Wdesignated_init },
        { "do-while", &Wdo_while },
        { "enum-mismatch", &Wenum_mismatch },
-       { "error", &Werror },
+       { "sparse-error", &Wsparse_error },
        { "init-cstring", &Winit_cstring },
        { "non-pointer-null", &Wnon_pointer_null },
        { "old-initializer", &Wold_initializer },
@@ -471,7 +471,7 @@ static char **handle_onoff_switch(char *arg, char **next, co

        if (!strcmp(p, "sparse-all")) {
                for (i = 0; i < n; i++) {
-                       if (*warnings[i].flag != WARNING_FORCE_OFF && warnings[i
+                       if (*warnings[i].flag != WARNING_FORCE_OFF && warnings[i
                                *warnings[i].flag = WARNING_ON;
                }
             }
diff --git a/lib.h b/lib.h
index dc01684..15b69fa 100644
--- a/lib.h
+++ b/lib.h
@@ -112,7 +112,7 @@ extern int Wdefault_bitfield_sign;
 extern int Wdesignated_init;
 extern int Wdo_while;
 extern int Wenum_mismatch;
-extern int Werror;
+extern int Wsparse_error;
 extern int Winit_cstring;
 extern int Wnon_pointer_null;
 extern int Wold_initializer;
diff --git a/sparse.1 b/sparse.1
index acdce53..63fceb9 100644
--- a/sparse.1
+++ b/sparse.1
@@ -24,7 +24,7 @@ off those warnings, pass the negation of the associated warnin
 Turn on all sparse warnings, except for those explicitly disabled via
 \fB\-Wno\-something\fR.
 .TP
-.B \-Werror
+.B \-Wsparse\-error
 Turn all sparse warnings into errors.
 .TP
 .B \-Waddress\-space
diff --git a/sparse.c b/sparse.c
index 7d389b1..6b3324c 100644
--- a/sparse.c
+++ b/sparse.c
@@ -288,7 +288,7 @@ static void check_symbols(struct symbol_list *list)
                }
        } END_FOR_EACH_PTR(sym);

-       if (die_if_error)
+       if (Wsparse_error && die_if_error)
                exit(1);
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Wed, 08 Oct 2014 19:27:21 +0000
Message-ID: <20141008192721.GS23154 () mwanda>
--------------------
On Wed, Oct 08, 2014 at 06:26:23PM +0800, Christopher Li wrote:
> On Tue, Oct 7, 2014 at 5:45 PM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
> >> +     system ($check) == 0 or die;
> >
> > This just enables -Werror for everyone so now I can't run Sparse on
> > itself now because there are old errors from 2007.
> >
> > lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
> > lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers
> 
> It depend on how you invoke sparse.
> Do you invoke sparse by some thing like "make CC=./cgcc"?

Yes.  In my makefile I have:

ifeq ($(CC),"")
CC = gcc
endif

> 
> >
> > Btw, these errors also disable warnings for the rest of the file...  I
> > don't think just because there are different modifiers it means that
> > we should give up looking for other warnings.  In the kernel we miss
> > some endian bugs because of this.
> 
> Are you suggesting change that type different error into warnings so
> sparse can still check the rest of the file?

Let me look at this more closely again and write some patches.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Wed, 08 Oct 2014 19:27:21 +0000
Message-ID: <20141008192721.GS23154 () mwanda>
--------------------
On Wed, Oct 08, 2014 at 06:26:23PM +0800, Christopher Li wrote:
> On Tue, Oct 7, 2014 at 5:45 PM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
> >> +     system ($check) == 0 or die;
> >
> > This just enables -Werror for everyone so now I can't run Sparse on
> > itself now because there are old errors from 2007.
> >
> > lib.c:192:6: error: symbol 'error_die' redeclared with different type (originally declared at lib.h:97) - different modifiers
> > lib.c:201:6: error: symbol 'die' redeclared with different type (originally declared at lib.h:93) - different modifiers
> 
> It depend on how you invoke sparse.
> Do you invoke sparse by some thing like "make CC=./cgcc"?

Yes.  In my makefile I have:

ifeq ($(CC),"")
CC = gcc
endif

> 
> >
> > Btw, these errors also disable warnings for the rest of the file...  I
> > don't think just because there are different modifiers it means that
> > we should give up looking for other warnings.  In the kernel we miss
> > some endian bugs because of this.
> 
> Are you suggesting change that type different error into warnings so
> sparse can still check the rest of the file?

Let me look at this more closely again and write some patches.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Thu, 09 Oct 2014 00:56:04 +0000
Message-ID: <5435DD24.3070005 () ramsay1 ! demon ! co ! uk>
--------------------
On 08/10/14 18:51, Christopher Li wrote:
> On Wed, Oct 8, 2014 at 5:39 PM, Thomas Graf <tgraf@suug.ch> wrote:
>>> This just enables -Werror for everyone so now I can't run Sparse on
>>> itself now because there are old errors from 2007.
>>
>> The above change should merely have sparse fail upon an error and not
>> warnings unless you specifiy -Werror which I would consider expected
>> behaviour.
> 
> Actually I realized that this "-Werror" patch is wrong. As it is, we can't
> actually make the full kernel check without hitting sparse errors interrupting
> the build. That is pretty unacceptable.
> 
> We should reserve the "-Werror" for gcc. It means gcc should treat warning
> as error. We should have another option like "-Wsparse-error" for telling sparse
> to treat warning as error. Just like "-Wall" does not mean sparse should
> turn on all usual warnings. We have "-Wsparse-all" for that.
> 
> I have the following patch renaming the option. BTW, I think sparse
> should only return error when "-Wsparse-error" was given.
> 
> Any feed back?

I haven't been following this discussion, but I would have
expected to see a check for '-Wsparse-error' in the 
'check_only_option' function in cgcc as part of this patch.

HTH

ATB,
Ramsay Jones


> Chris
> 
> diff --git a/lib.c b/lib.c
> index 8395662..b1b18aa 100644
> --- a/lib.c
> +++ b/lib.c
> @@ -150,7 +150,7 @@ void warning(struct position pos, const char * fmt, ...)
>  {
>         va_list args;
> 
> -       if (Werror) {
> +       if (Wsparse_error) {
>                 va_start(args, fmt);
>                 do_error(pos, fmt, args);
>                 va_end(args);
> @@ -226,7 +226,7 @@ int Wdesignated_init = 1;
>  int Wdo_while = 0;
>  int Winit_cstring = 0;
>  int Wenum_mismatch = 1;
> -int Werror = 0;
> +int Wsparse_error = 0;
>  int Wnon_pointer_null = 1;
>  int Wold_initializer = 1;
>  int Wone_bit_signed_bitfield = 1;
> @@ -439,7 +439,7 @@ static const struct warning {
>         { "designated-init", &Wdesignated_init },
>         { "do-while", &Wdo_while },
>         { "enum-mismatch", &Wenum_mismatch },
> -       { "error", &Werror },
> +       { "sparse-error", &Wsparse_error },
>         { "init-cstring", &Winit_cstring },
>         { "non-pointer-null", &Wnon_pointer_null },
>         { "old-initializer", &Wold_initializer },
> @@ -471,7 +471,7 @@ static char **handle_onoff_switch(char *arg, char **next, co
> 
>         if (!strcmp(p, "sparse-all")) {
>                 for (i = 0; i < n; i++) {
> -                       if (*warnings[i].flag != WARNING_FORCE_OFF && warnings[i
> +                       if (*warnings[i].flag != WARNING_FORCE_OFF && warnings[i
>                                 *warnings[i].flag = WARNING_ON;
>                 }
>              }
> diff --git a/lib.h b/lib.h
> index dc01684..15b69fa 100644
> --- a/lib.h
> +++ b/lib.h
> @@ -112,7 +112,7 @@ extern int Wdefault_bitfield_sign;
>  extern int Wdesignated_init;
>  extern int Wdo_while;
>  extern int Wenum_mismatch;
> -extern int Werror;
> +extern int Wsparse_error;
>  extern int Winit_cstring;
>  extern int Wnon_pointer_null;
>  extern int Wold_initializer;
> diff --git a/sparse.1 b/sparse.1
> index acdce53..63fceb9 100644
> --- a/sparse.1
> +++ b/sparse.1
> @@ -24,7 +24,7 @@ off those warnings, pass the negation of the associated warnin
>  Turn on all sparse warnings, except for those explicitly disabled via
>  \fB\-Wno\-something\fR.
>  .TP
> -.B \-Werror
> +.B \-Wsparse\-error
>  Turn all sparse warnings into errors.
>  .TP
>  .B \-Waddress\-space
> diff --git a/sparse.c b/sparse.c
> index 7d389b1..6b3324c 100644
> --- a/sparse.c
> +++ b/sparse.c
> @@ -288,7 +288,7 @@ static void check_symbols(struct symbol_list *list)
>                 }
>         } END_FOR_EACH_PTR(sym);
> 
> -       if (die_if_error)
> +       if (Wsparse_error && die_if_error)
>                 exit(1);
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
> .
> 

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH v2] sparse: Make -Werror turn warnigns into errors
Date: Thu, 09 Oct 2014 00:56:04 +0000
Message-ID: <5435DD24.3070005 () ramsay1 ! demon ! co ! uk>
--------------------
On 08/10/14 18:51, Christopher Li wrote:
> On Wed, Oct 8, 2014 at 5:39 PM, Thomas Graf <tgraf@suug.ch> wrote:
>>> This just enables -Werror for everyone so now I can't run Sparse on
>>> itself now because there are old errors from 2007.
>>
>> The above change should merely have sparse fail upon an error and not
>> warnings unless you specifiy -Werror which I would consider expected
>> behaviour.
> 
> Actually I realized that this "-Werror" patch is wrong. As it is, we can't
> actually make the full kernel check without hitting sparse errors interrupting
> the build. That is pretty unacceptable.
> 
> We should reserve the "-Werror" for gcc. It means gcc should treat warning
> as error. We should have another option like "-Wsparse-error" for telling sparse
> to treat warning as error. Just like "-Wall" does not mean sparse should
> turn on all usual warnings. We have "-Wsparse-all" for that.
> 
> I have the following patch renaming the option. BTW, I think sparse
> should only return error when "-Wsparse-error" was given.
> 
> Any feed back?

I haven't been following this discussion, but I would have
expected to see a check for '-Wsparse-error' in the 
'check_only_option' function in cgcc as part of this patch.

HTH

ATB,
Ramsay Jones


> Chris
> 
> diff --git a/lib.c b/lib.c
> index 8395662..b1b18aa 100644
> --- a/lib.c
> +++ b/lib.c
> @@ -150,7 +150,7 @@ void warning(struct position pos, const char * fmt, ...)
>  {
>         va_list args;
> 
> -       if (Werror) {
> +       if (Wsparse_error) {
>                 va_start(args, fmt);
>                 do_error(pos, fmt, args);
>                 va_end(args);
> @@ -226,7 +226,7 @@ int Wdesignated_init = 1;
>  int Wdo_while = 0;
>  int Winit_cstring = 0;
>  int Wenum_mismatch = 1;
> -int Werror = 0;
> +int Wsparse_error = 0;
>  int Wnon_pointer_null = 1;
>  int Wold_initializer = 1;
>  int Wone_bit_signed_bitfield = 1;
> @@ -439,7 +439,7 @@ static const struct warning {
>         { "designated-init", &Wdesignated_init },
>         { "do-while", &Wdo_while },
>         { "enum-mismatch", &Wenum_mismatch },
> -       { "error", &Werror },
> +       { "sparse-error", &Wsparse_error },
>         { "init-cstring", &Winit_cstring },
>         { "non-pointer-null", &Wnon_pointer_null },
>         { "old-initializer", &Wold_initializer },
> @@ -471,7 +471,7 @@ static char **handle_onoff_switch(char *arg, char **next, co
> 
>         if (!strcmp(p, "sparse-all")) {
>                 for (i = 0; i < n; i++) {
> -                       if (*warnings[i].flag != WARNING_FORCE_OFF && warnings[i
> +                       if (*warnings[i].flag != WARNING_FORCE_OFF && warnings[i
>                                 *warnings[i].flag = WARNING_ON;
>                 }
>              }
> diff --git a/lib.h b/lib.h
> index dc01684..15b69fa 100644
> --- a/lib.h
> +++ b/lib.h
> @@ -112,7 +112,7 @@ extern int Wdefault_bitfield_sign;
>  extern int Wdesignated_init;
>  extern int Wdo_while;
>  extern int Wenum_mismatch;
> -extern int Werror;
> +extern int Wsparse_error;
>  extern int Winit_cstring;
>  extern int Wnon_pointer_null;
>  extern int Wold_initializer;
> diff --git a/sparse.1 b/sparse.1
> index acdce53..63fceb9 100644
> --- a/sparse.1
> +++ b/sparse.1
> @@ -24,7 +24,7 @@ off those warnings, pass the negation of the associated warnin
>  Turn on all sparse warnings, except for those explicitly disabled via
>  \fB\-Wno\-something\fR.
>  .TP
> -.B \-Werror
> +.B \-Wsparse\-error
>  Turn all sparse warnings into errors.
>  .TP
>  .B \-Waddress\-space
> diff --git a/sparse.c b/sparse.c
> index 7d389b1..6b3324c 100644
> --- a/sparse.c
> +++ b/sparse.c
> @@ -288,7 +288,7 @@ static void check_symbols(struct symbol_list *list)
>                 }
>         } END_FOR_EACH_PTR(sym);
> 
> -       if (die_if_error)
> +       if (Wsparse_error && die_if_error)
>                 exit(1);
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
> .
> 

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v2] sparse: make bits_to_bytes round up instead of down ===

From: Jeff Layton <jlayton () primarydata ! com>
To: linux-sparse
Subject: [PATCH v2] sparse: make bits_to_bytes round up instead of down
Date: Wed, 16 Jul 2014 16:27:42 +0000
Message-ID: <1405528062-588-1-git-send-email-jlayton () primarydata ! com>
--------------------
Currently, sparse handles arrays of bools incorrectly. If you declare an
array of bools like this:

    static _Bool boolarray[3] = {
        [0] = 1,
        [1] = 1,
    };

...you get warnings like this (which are bogus):

    ./test.c:2:10: warning: Initializer entry defined twice
    ./test.c:3:10:   also defined here

The problem is that bits_to_bytes rounds down instead of up, and sparse
defaults to _Bool being only 1 bit in size. This causes sparse to think
that they sit within the same byte, when they do not.

Fix bits_to_bytes to round up instead of down, and fix the call in
init_ctype to no longer correct for it. Also add a validation
test to ensure that we don't break this in the future.

Signed-off-by: Jeff Layton <jlayton@primarydata.com>
---
 symbol.c                                     |  2 +-
 target.h                                     |  2 +-
 validation/initializer-entry-defined-twice.c | 10 ++++++++++
 3 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/symbol.c b/symbol.c
index eb6e1215ee87..f02e07bd8c59 100644
--- a/symbol.c
+++ b/symbol.c
@@ -888,7 +888,7 @@ void init_ctype(void)
 		struct symbol *sym = ctype->ptr;
 		unsigned long bit_size = ctype->bit_size ? *ctype->bit_size : -1;
 		unsigned long maxalign = ctype->maxalign ? *ctype->maxalign : 0;
-		unsigned long alignment = bits_to_bytes(bit_size + bits_in_char - 1);
+		unsigned long alignment = bits_to_bytes(bit_size);
 
 		if (alignment > maxalign)
 			alignment = maxalign;
diff --git a/target.h b/target.h
index 1030c7c38993..140df3c1a64d 100644
--- a/target.h
+++ b/target.h
@@ -49,7 +49,7 @@ extern int enum_alignment;
 
 static inline int bits_to_bytes(int bits)
 {
-	return bits >= 0 ? bits / bits_in_char : -1;
+	return bits >= 0 ? (bits + bits_in_char - 1) / bits_in_char : -1;
 }
 
 static inline int bytes_to_bits(int bytes)
diff --git a/validation/initializer-entry-defined-twice.c b/validation/initializer-entry-defined-twice.c
index 968e3dd1af2a..8a5bd3a95631 100644
--- a/validation/initializer-entry-defined-twice.c
+++ b/validation/initializer-entry-defined-twice.c
@@ -41,6 +41,16 @@ static struct same_offset not_an_error = {
 	.field1 = { },
 	.field2 = 0
 };
+
+/*
+ * _Bools generally take a whole byte, so ensure that we can initialize
+ * them without spewing a warning.
+ */
+static _Bool boolarray[3] = {
+	[0] = 1,
+	[1] = 1,
+};
+
 /*
  * check-name: Initializer entry defined twice
  *
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v3 01/10] Add the __restrict__ keyword ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH v3 01/10] Add the __restrict__ keyword
Date: Sat, 27 Sep 2014 12:52:35 +0000
Message-ID: <5426B313.7050109 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

As promised, this adds tests for __restrict__ and restrict
keywords to validation/restrict-array.c.

[Note: I had intended to include a comment, just as for the
new test file, reminding gcc users to use -std=c99 etc., in
the case of the 'restrict' keyword (I always compile tests
with gcc), but I forgot. :( ]

ATB,
Ramsay Jones


 ident-list.h                    |  2 +-
 parse.c                         |  3 ++-
 validation/alternate-keywords.c | 46 +++++++++++++++++++++++++++++++++++++++++
 validation/reserved.c           |  1 +
 validation/restrict-array.c     | 25 ++++++++++++++++++++++
 5 files changed, 75 insertions(+), 2 deletions(-)
 create mode 100644 validation/alternate-keywords.c

diff --git a/ident-list.h b/ident-list.h
index c0fc18f..d5a145f 100644
--- a/ident-list.h
+++ b/ident-list.h
@@ -86,7 +86,7 @@ IDENT(stdcall); IDENT(__stdcall__);
 IDENT(fastcall); IDENT(__fastcall__);
 IDENT(dllimport); IDENT(__dllimport__);
 IDENT(dllexport); IDENT(__dllexport__);
-IDENT(restrict); IDENT(__restrict);
+IDENT(restrict); IDENT(__restrict); IDENT(__restrict__);
 IDENT(artificial); IDENT(__artificial__);
 IDENT(leaf); IDENT(__leaf__);
 IDENT(vector_size); IDENT(__vector_size__);
diff --git a/parse.c b/parse.c
index eaa1883..ec835ef 100644
--- a/parse.c
+++ b/parse.c
@@ -435,6 +435,7 @@ static struct init_keyword {
 	/* Ignored for now.. */
 	{ "restrict",	NS_TYPEDEF, .op = &restrict_op},
 	{ "__restrict",	NS_TYPEDEF, .op = &restrict_op},
+	{ "__restrict__",	NS_TYPEDEF, .op = &restrict_op},
 
 	/* Storage class */
 	{ "auto",	NS_TYPEDEF, .op = &auto_op },
@@ -1553,7 +1554,7 @@ static struct token *abstract_array_declarator(struct token *token, struct symbo
 
 	token = abstract_array_static_declarator(token, &has_static);
 
-	if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
+	if (match_idents(token, &restrict_ident, &__restrict_ident, &__restrict___ident, NULL))
 		token = abstract_array_static_declarator(token->next, &has_static);
 	token = parse_expression(token, &expr);
 	sym->array_size = expr;
diff --git a/validation/alternate-keywords.c b/validation/alternate-keywords.c
new file mode 100644
index 0000000..2e91a35
--- /dev/null
+++ b/validation/alternate-keywords.c
@@ -0,0 +1,46 @@
+
+extern float strtof(const char *__restrict__ ptr, char **__restrict__ endptr);
+extern double strtod(const char *__restrict ptr, char **__restrict endptr);
+/* restrict: -std=c99 or -std=gnu99 or -std=c11 */
+extern long double strtold(const char *restrict ptr, char **restrict endptr);
+
+extern int (*funcs[])(void);
+
+/* typeof: no -std or -std=gnu90 or -std=gnu99 or -std=gnu11 */
+extern typeof (funcs[0]) f0;
+extern __typeof (funcs[1]) f1;
+extern __typeof__(funcs[2]) f2;
+
+typedef unsigned short uint16_t;
+typedef unsigned int uint32_t;
+typedef unsigned long long uint64_t;
+
+static __inline__ uint16_t swap16(uint16_t val)
+{
+	return ((((uint16_t)(val) & (uint16_t)0x00ffU) << 8) |
+		(((uint16_t)(val) & (uint16_t)0xff00U) >> 8));
+}
+
+static __inline uint32_t swap32(uint32_t val)
+{
+	return ((((uint32_t)(val) & (uint32_t)0x000000ffUL) << 24) |
+		(((uint32_t)(val) & (uint32_t)0x0000ff00UL) <<  8) |
+		(((uint32_t)(val) & (uint32_t)0x00ff0000UL) >>  8) |
+		(((uint32_t)(val) & (uint32_t)0xff000000UL) >> 24));
+}
+
+/* inline: no -std or -std=gnu90 or -std=c99 or -std=c11 */
+static inline uint64_t swap64(uint64_t val)
+{
+	return ((((uint64_t)(val) & (uint64_t)0x00000000000000ffULL) << 56) |
+		(((uint64_t)(val) & (uint64_t)0x000000000000ff00ULL) << 40) |
+		(((uint64_t)(val) & (uint64_t)0x0000000000ff0000ULL) << 24) |
+		(((uint64_t)(val) & (uint64_t)0x00000000ff000000ULL) <<  8) |
+		(((uint64_t)(val) & (uint64_t)0x000000ff00000000ULL) >>  8) |
+		(((uint64_t)(val) & (uint64_t)0x0000ff0000000000ULL) >> 24) |
+		(((uint64_t)(val) & (uint64_t)0x00ff000000000000ULL) >> 40) |
+		(((uint64_t)(val) & (uint64_t)0xff00000000000000ULL) >> 56));
+}
+/*
+ * check-name: alternate keywords
+ */
diff --git a/validation/reserved.c b/validation/reserved.c
index caacd21..e5d7af8 100644
--- a/validation/reserved.c
+++ b/validation/reserved.c
@@ -30,6 +30,7 @@ reserved.c:8:12: error: Trying to use reserved word '__const' as identifier
 reserved.c:9:12: error: Trying to use reserved word '__const__' as identifier
 reserved.c:10:12: error: Trying to use reserved word 'restrict' as identifier
 reserved.c:11:12: error: Trying to use reserved word '__restrict' as identifier
+reserved.c:12:12: error: Trying to use reserved word '__restrict__' as identifier
 reserved.c:13:12: error: Trying to use reserved word 'typedef' as identifier
 reserved.c:14:12: error: Trying to use reserved word '__typeof' as identifier
 reserved.c:15:12: error: Trying to use reserved word '__typeof__' as identifier
diff --git a/validation/restrict-array.c b/validation/restrict-array.c
index 3facebf..04bfdad 100644
--- a/validation/restrict-array.c
+++ b/validation/restrict-array.c
@@ -7,6 +7,31 @@ extern int lio_listio64 (int __mode,
 			 struct aiocb64 *__const __list[__restrict_arr],
 			 int __nent, struct sigevent *__restrict __sig);
 
+#undef __restrict_arr
+#define __restrict_arr __restrict__
+
+struct gaicb;
+
+extern int getaddrinfo_a (int __mode, struct gaicb *__list[__restrict_arr],
+			  int __ent, struct sigevent *__restrict __sig);
+
+#undef __restrict_arr
+#define __restrict_arr restrict
+
+typedef struct re_pattern_buffer regex_t;
+typedef int regoff_t;
+typedef struct
+{
+  regoff_t rm_so;  /* Byte offset from string's start to substring's start.  */
+  regoff_t rm_eo;  /* Byte offset from string's start to substring's end.  */
+} regmatch_t;
+typedef unsigned long int size_t;
+
+extern int regexec (const regex_t *__restrict __preg,
+		    const char *__restrict __string, size_t __nmatch,
+		    regmatch_t __pmatch[__restrict_arr],
+		    int __eflags);
+
 /*
  * check-name: restrict array attribute
  */
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH v3] sparse: treat function pointers as pointers to const data ===

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Mon, 08 Sep 2014 06:30:03 +0000
Message-ID: <1410157803-3658-1-git-send-email-ard.biesheuvel () linaro ! org>
--------------------
This code snippet:

static void bar(void const *arg)
{
	int (*foo)(void) = arg;
}

produces the following warning:

test.c:4:28: warning: incorrect type in initializer (different modifiers)
test.c:4:28:    expected int ( *foo )( ... )
test.c:4:28:    got void const *arg

which is caused by the fact that the function pointer 'foo' is not annotated
as being a pointer to const data. However, dereferencing a function pointer
does not produce an lvalue, so a function pointer points to const data by
definition, and we should treat it accordingly.

To avoid producing a warning on the inverse case, i.e.,

static void bar(void)
{
	void *foo = bar;
}

we only address the case where the function pointer is the target of
an assignment.

Reviewed-by: Josh Triplett <josh@joshtriplett.org>
Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
---
v3: add rationale for restriction to assignments to commit message
    add R-b

v2: only treat function pointers as pointers to const data when they are the
    target of an assignment

 evaluate.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/evaluate.c b/evaluate.c
index 66556150ddac..a5a830978bda 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -1359,6 +1359,15 @@ static int compatible_assignment_types(struct expression *expr, struct symbol *t
 				typediff = "different address spaces";
 				goto Err;
 			}
+			/*
+			 * If this is a function pointer assignment, it is
+			 * actually fine to assign a pointer to const data to
+			 * it, as a function pointer points to const data
+			 * implicitly, i.e., dereferencing it does not produce
+			 * an lvalue.
+			 */
+			if (b1->type == SYM_FN)
+				mod1 |= MOD_CONST;
 			if (mod2 & ~mod1) {
 				typediff = "different modifiers";
 				goto Err;
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Mon, 08 Sep 2014 06:30:03 +0000
Message-ID: <1410157803-3658-1-git-send-email-ard.biesheuvel () linaro ! org>
--------------------
This code snippet:

static void bar(void const *arg)
{
	int (*foo)(void) = arg;
}

produces the following warning:

test.c:4:28: warning: incorrect type in initializer (different modifiers)
test.c:4:28:    expected int ( *foo )( ... )
test.c:4:28:    got void const *arg

which is caused by the fact that the function pointer 'foo' is not annotated
as being a pointer to const data. However, dereferencing a function pointer
does not produce an lvalue, so a function pointer points to const data by
definition, and we should treat it accordingly.

To avoid producing a warning on the inverse case, i.e.,

static void bar(void)
{
	void *foo = bar;
}

we only address the case where the function pointer is the target of
an assignment.

Reviewed-by: Josh Triplett <josh@joshtriplett.org>
Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
---
v3: add rationale for restriction to assignments to commit message
    add R-b

v2: only treat function pointers as pointers to const data when they are the
    target of an assignment

 evaluate.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/evaluate.c b/evaluate.c
index 66556150ddac..a5a830978bda 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -1359,6 +1359,15 @@ static int compatible_assignment_types(struct expression *expr, struct symbol *t
 				typediff = "different address spaces";
 				goto Err;
 			}
+			/*
+			 * If this is a function pointer assignment, it is
+			 * actually fine to assign a pointer to const data to
+			 * it, as a function pointer points to const data
+			 * implicitly, i.e., dereferencing it does not produce
+			 * an lvalue.
+			 */
+			if (b1->type == SYM_FN)
+				mod1 |= MOD_CONST;
 			if (mod2 & ~mod1) {
 				typediff = "different modifiers";
 				goto Err;
-- 
1.8.3.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Wed, 08 Oct 2014 18:00:02 +0000
Message-ID: <CANeU7QmR-HCp5--PhihSfM1Aan8bNGsPLgtewVVptjbfEZCj6A () mail ! gmail ! com>
--------------------
On Mon, Oct 6, 2014 at 10:44 PM, Ard Biesheuvel
<ard.biesheuvel@linaro.org> wrote:
>> we only address the case where the function pointer is the target of
>> an assignment.

I apply the patch in my private branch but haven't push out yet.

I just want to confirm, you didn't find this kind of assignment in the
kernel, right?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: Re: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Tue, 14 Oct 2014 12:55:35 +0000
Message-ID: <CAKv+Gu_7tgBVJ9uLRDazhMoj88xu5JS89VkW2UumFxKq65ze7g () mail ! gmail ! com>
--------------------
On 8 October 2014 20:06, Ard Biesheuvel <ard.biesheuvel@linaro.org> wrote:
> On 8 October 2014 20:00, Christopher Li <sparse@chrisli.org> wrote:
>> On Mon, Oct 6, 2014 at 10:44 PM, Ard Biesheuvel
>> <ard.biesheuvel@linaro.org> wrote:
>>>> we only address the case where the function pointer is the target of
>>>> an assignment.
>>
>> I apply the patch in my private branch but haven't push out yet.
>>
>> I just want to confirm, you didn't find this kind of assignment in the
>> kernel, right?
>>
>
> I noticed this patch
>
> https://git.kernel.org/cgit/linux/kernel/git/kvmarm/kvmarm.git/commit/?h=queue&id=de56fb1923ca11f428bf557870e0faa99f38762e
>
> and saw that it was bogus: changing the return type of the pointed-to
> function to 'const int' makes no sense at all, and yet it shuts up
> sparse.
>
> With my sparse patch, that patch could have been dropped (although I
> think it was merged after all)
>

Ping?
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Wed, 15 Oct 2014 01:34:45 +0000
Message-ID: <CANeU7Qm=AudXFYxNDyrachGRoAurKTzixQ5dcLdrJPcTr7GS+g () mail ! gmail ! com>
--------------------
On Tue, Oct 14, 2014 at 8:55 PM, Ard Biesheuvel
<ard.biesheuvel@linaro.org> wrote:
>
> Ping?

It is already applied and pushed as c1763a249aba0a40bd326c845c2a146132a02448

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: Re: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Wed, 15 Oct 2014 05:16:15 +0000
Message-ID: <CAKv+Gu_N=BO8K4nEpJo8=Z5fSfmD+6bEGQCDdR6QVVUGUE2VeQ () mail ! gmail ! com>
--------------------
On 15 October 2014 03:34, Christopher Li <sparse@chrisli.org> wrote:
> On Tue, Oct 14, 2014 at 8:55 PM, Ard Biesheuvel
> <ard.biesheuvel@linaro.org> wrote:
>>
>> Ping?
>
> It is already applied and pushed as c1763a249aba0a40bd326c845c2a146132a02448
>

OK, thanks!

Which upstream repo is that? I couldn't find it on
git://git.kernel.org/pub/scm/devel/sparse/sparse.git

regards,
Ard.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: Re: [PATCH v3] sparse: treat function pointers as pointers to const data
Date: Wed, 15 Oct 2014 07:10:04 +0000
Message-ID: <CAKv+Gu-zDfhhnDxQ0PeW_k85-xZkF8UJbuEHda5NPNWBsdRgrw () mail ! gmail ! com>
--------------------
On 15 October 2014 09:06, Christopher Li <sparse@chrisli.org> wrote:
> On Wed, Oct 15, 2014 at 1:16 PM, Ard Biesheuvel
> <ard.biesheuvel@linaro.org> wrote:
>>
>> Which upstream repo is that? I couldn't find it on
>> git://git.kernel.org/pub/scm/devel/sparse/sparse.git
>
> https://git.kernel.org/cgit/devel/sparse/chrisl/sparse.git/
>

OK, thanks!
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] Fix offsets in anonymous unions ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] Fix offsets in anonymous unions
Date: Sun, 01 Jun 2014 07:55:44 +0000
Message-ID: <CANeU7Qn067TkgFsfHJkd30Q3mEtCvgjwMUt=a3Yfo7Zfcq10fg () mail ! gmail ! com>
--------------------
On Thu, May 22, 2014 at 6:22 AM, John Keeping <john@keeping.me.uk> wrote:
> Commit 38d1124 (Fix error at anoymous unions, 2014-04-03) says:
> @@ -2328,6 +2326,7 @@ static struct expression *check_designators(struct expression *e,
>                                 break;
>                         }
>                         e->field = e->ctype = ctype;
> +                       e->init_offset = offset;
>                         last = e;
>                         if (!e->ident_expression) {

OK, this is actually wrong. The member "init_offset" is only
valid for EXPR_POS type. The current e->type is EXPR_IDENTIFIER,
the e->init_offset member actually share the same memory location as
e->expr_ident. In order words, writing to init_offset will corrupt the
e->expr_ident. We did not use e->expr_ident afterwards though.


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] Link binaries with system libraries needed by LLVM ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH] Link binaries with system libraries needed by LLVM
Date: Thu, 02 Oct 2014 20:11:31 +0000
Message-ID: <542DB173.6030901 () ramsay1 ! demon ! co ! uk>
--------------------
On 02/10/14 20:53, Josh Triplett wrote:
> On Thu, Oct 02, 2014 at 07:19:48AM -0700, Anatol Pomozov wrote:
>> It is needed on Linux Arch with latest LLVM installed
>>
>> Signed-off-by: Anatol Pomozov <anatol.pomozov@gmail.com>
> 
> One comment below.
> 
>>  Makefile | 3 ++-
>>  1 file changed, 2 insertions(+), 1 deletion(-)
>>
>> diff --git a/Makefile b/Makefile
>> index 28c4df6..25087d7 100644
>> --- a/Makefile
>> +++ b/Makefile
>> @@ -112,11 +112,12 @@ LLVM_PROGS := sparse-llvm
>>  $(LLVM_PROGS): LD := g++
>>  LLVM_LDFLAGS := $(shell llvm-config --ldflags)
>>  LLVM_CFLAGS := $(shell llvm-config --cflags | sed -e "s/-DNDEBUG//g")
>> +LLVM_SYSTEM_LIBS := $(shell llvm-config --system-libs)
>>  LLVM_LIBS := $(shell llvm-config --libs)
>>  PROGRAMS += $(LLVM_PROGS)
>>  INST_PROGRAMS += sparse-llvm sparsec
>>  sparse-llvm.o: BASIC_CFLAGS += $(LLVM_CFLAGS)
>> -sparse-llvm_EXTRA_OBJS := $(LLVM_LIBS) $(LLVM_LDFLAGS)
>> +sparse-llvm_EXTRA_OBJS := $(LLVM_SYSTEM_LIBS) $(LLVM_LIBS) $(LLVM_LDFLAGS)
> 

This issue is addressed in commit d92353b4eacbac54d693edd62fb565f071e3ba86
("sparse-llvm: Fix LLVM 3.5 linker errors", 24-09-2014) in the main sparse
repo and in a follow-up commit a5bdeee9e145cc4313526f9722f80674321ab491
("Use LLVM_CONFIG instead of llvm-config in Makefile", 24-09-2014) in 
Christopher's public repo on kernel.org.

Neither commit is in a released version of sparse.

> Does llvm-config support passing multiple options, such as "llvm-config
> --libs --system-libs"?  If so, I'd suggest just adding --system-libs to
> the call in LLVM_LIBS, rather than adding a second variable.

An old version of llvm-config (prior to adding --system-libs) would
respond like so:

    $ llvm-config --libs --system-libs
    -lLLVM-3.4.2
    usage: llvm-config <OPTION>... [<COMPONENT>...]
    
    Get various configuration information needed to compile programs which use
    LLVM.  Typically called from 'configure' scripts.  Examples:
      llvm-config --cxxflags
      llvm-config --ldflags
      llvm-config --libs engine bcreader scalaropts

    Options:
      --version         Print LLVM version.
      --prefix          Print the installation prefix.
      --src-root        Print the source root LLVM was built from.
      --obj-root        Print the object root used to build LLVM.
...
      --build-mode      Print build mode of LLVM tree (e.g. Debug or Release).
    Typical components:
      all               All LLVM libraries (default).
      engine            Either a native JIT or a bitcode interpreter.
    $ echo $?
    1
    $ 

HTH

ATB,
Ramsay Jones


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse ===

From: "Marcos A. Di Pietro" <marcosadp () gmail ! com>
To: linux-driver-devel
Subject: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Tue, 10 Jun 2014 01:24:35 +0000
Message-ID: <53965E53.5080504 () gmail ! com>
--------------------
Fixes warning static analysis warning raised by sparse in drivers/staging/comedi/drivers/ni_stc.h

warning: shift too big (4294967295) for type int
Signed-off-by: Marcos A. Di Pietro <marcosadp@gmail.com>
---
 drivers/staging/comedi/drivers/ni_stc.h | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/comedi/drivers/ni_stc.h b/drivers/staging/comedi/drivers/ni_stc.h
index f0630b78..8ef420c 100644
--- a/drivers/staging/comedi/drivers/ni_stc.h
+++ b/drivers/staging/comedi/drivers/ni_stc.h
@@ -716,8 +716,12 @@ enum AI_AO_Select_Bits {
 #define G0_G1_Select			0x0b
 static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
 {
-	if (channel < 4)
-		return 1 << channel;
+	if (channel == 1)
+		return 1 << 0x1;
+	if (channel == 2)
+		return 1 << 0x2;
+	if (channel == 3 || channel == 4)
+		return 1 << 0x3;
 	if (channel == 4)
 		return 0x3;
 	if (channel == 5)
-- 
1.8.3.2
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Tue, 10 Jun 2014 05:47:41 +0000
Message-ID: <20140610054741.GE5500 () mwanda>
--------------------
On Mon, Jun 09, 2014 at 09:24:35PM -0400, Marcos A. Di Pietro wrote:
> Fixes warning static analysis warning raised by sparse in drivers/staging/comedi/drivers/ni_stc.h
> 
> warning: shift too big (4294967295) for type int

This warning seems wrong.  I don't even understand how it thinks the
shift is too big. The patch doesn't make sense and it introduces a bug.

> Signed-off-by: Marcos A. Di Pietro <marcosadp@gmail.com>
> ---
>  drivers/staging/comedi/drivers/ni_stc.h | 8 ++++++--
>  1 file changed, 6 insertions(+), 2 deletions(-)
> 
> diff --git a/drivers/staging/comedi/drivers/ni_stc.h b/drivers/staging/comedi/drivers/ni_stc.h
> index f0630b78..8ef420c 100644
> --- a/drivers/staging/comedi/drivers/ni_stc.h
> +++ b/drivers/staging/comedi/drivers/ni_stc.h
> @@ -716,8 +716,12 @@ enum AI_AO_Select_Bits {
>  #define G0_G1_Select			0x0b
>  static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
>  {
> -	if (channel < 4)
> -		return 1 << channel;
> +	if (channel == 1)
> +		return 1 << 0x1;
> +	if (channel == 2)
> +		return 1 << 0x2;
> +	if (channel == 3 || channel == 4)
> +		return 1 << 0x3;
>  	if (channel == 4)
>  		return 0x3;

channel == 4 is supposed to be handled here.

regards,
dan carpenter

>  	if (channel == 5)
> -- 
> 1.8.3.2
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Hartley Sweeten <HartleyS () visionengravers ! com>
To: linux-driver-devel
Subject: RE: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Tue, 10 Jun 2014 22:36:13 +0000
Message-ID: <DC148C5AA1CEBA4E87973D432B1C2D8825E9AE6A () P3PWEX4MB008 ! ex4 ! secureserver ! net>
--------------------
On Monday, June 09, 2014 10:48 PM, Dan Carpenter wrote:
> On Mon, Jun 09, 2014 at 09:24:35PM -0400, Marcos A. Di Pietro wrote:
>> Fixes warning static analysis warning raised by sparse in drivers/staging/comedi/drivers/ni_stc.h
>> 
>> warning: shift too big (4294967295) for type int
>
> This warning seems wrong.  I don't even understand how it thinks the
> shift is too big. The patch doesn't make sense and it introduces a bug.

The warning is a bit annoying and I also haven't figured out why sparse
thinks the shift is too big.

Following is an alternate patch to "fix" the warning.

I'm not sure if this patch will apply to the current linux-next tree due to
a number of patches I am holding until after the merge and Greg opens
the staging tree again.

Please just consider this as a RFC. If it looks like a clean solution I will rebase
it and repost after Greg opens the staging tree.

---


================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Wed, 11 Jun 2014 06:56:12 +0000
Message-ID: <20140611065612.GQ5015 () mwanda>
--------------------
On Tue, Jun 10, 2014 at 10:36:13PM +0000, Hartley Sweeten wrote:
> On Monday, June 09, 2014 10:48 PM, Dan Carpenter wrote:
> > On Mon, Jun 09, 2014 at 09:24:35PM -0400, Marcos A. Di Pietro wrote:
> >> Fixes warning static analysis warning raised by sparse in drivers/staging/comedi/drivers/ni_stc.h
> >> 
> >> warning: shift too big (4294967295) for type int
> >
> > This warning seems wrong.  I don't even understand how it thinks the
> > shift is too big. The patch doesn't make sense and it introduces a bug.
> 
> The warning is a bit annoying and I also haven't figured out why sparse
> thinks the shift is too big.

I can't figure out how to reproduce this Sparse warning.  I compiled
drivers/staging/comedi/drivers/ni_mio_cs.c and it doesn't have it.
I double checked by doing a
`make drivers/staging/comedi/drivers/ni_mio_cs.i` that the
ni_stc_dma_channel_select_bitfield is not ifdeffed out.

Which version of Sparse are you using?  Really the correct thing is to
fix Sparse.

regards,
dan carpenter

_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Hartley Sweeten <HartleyS () visionengravers ! com>
To: linux-driver-devel
Subject: RE: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Wed, 11 Jun 2014 17:18:08 +0000
Message-ID: <DC148C5AA1CEBA4E87973D432B1C2D8825E9CBD6 () P3PWEX4MB008 ! ex4 ! secureserver ! net>
--------------------
On Tuesday, June 10, 2014 11:56 PM, Dan Carpenter wrote:
> On Tue, Jun 10, 2014 at 10:36:13PM +0000, Hartley Sweeten wrote:
>> On Monday, June 09, 2014 10:48 PM, Dan Carpenter wrote:
>>> On Mon, Jun 09, 2014 at 09:24:35PM -0400, Marcos A. Di Pietro wrote:
>>>> Fixes warning static analysis warning raised by sparse in drivers/staging/comedi/drivers/ni_stc.h
>>>> 
>>>> warning: shift too big (4294967295) for type int
>>>
>>> This warning seems wrong.  I don't even understand how it thinks the
>>> shift is too big. The patch doesn't make sense and it introduces a bug.
>> 
>> The warning is a bit annoying and I also haven't figured out why sparse
>> thinks the shift is too big.
>
> I can't figure out how to reproduce this Sparse warning.  I compiled
> drivers/staging/comedi/drivers/ni_mio_cs.c and it doesn't have it.
> I double checked by doing a
> `make drivers/staging/comedi/drivers/ni_mio_cs.i` that the
> ni_stc_dma_channel_select_bitfield is not ifdeffed out.
>
> Which version of Sparse are you using?  Really the correct thing is to
> fix Sparse.

I don't think sparse has a way to query the version so I'm not sure. But, I
just pulled the latest from git://git.kernel.org/pub/scm/devel/sparse/sparse.git
and built that so now I _should_ have the latest version regardless.

With today's next-20140611 branch:
$ make C=2 M=drivers/staging/comedi
...
  CHECK   drivers/staging/comedi/comedi_compat32.c
drivers/staging/comedi/comedi_compat32.c:201:16: warning: cast removes address space of expression
drivers/staging/comedi/comedi_compat32.c:201:16: warning: cast removes address space of expression
drivers/staging/comedi/comedi_compat32.c:201:16: warning: cast removes address space of expression
drivers/staging/comedi/comedi_compat32.c:201:16: warning: cast removes address space of expression
...
  CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int

BTW, drivers/staging/comedi/drivers/ni_mio_cs.c does not use the
code in ni_stc.h or ni_mio_common.c that would cause the warnings.
The functions that use ni_stc_dma_channel_select_bitfield() are only
enabled when PCIDMA is defined, which is only done in ni_pcimio.c.

Regards,
Hartley



_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Wed, 11 Jun 2014 21:24:25 +0000
Message-ID: <20140611212425.GW5015 () mwanda>
--------------------

--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Let's forward this to the Sparse mailing list.

We're seeing a Sparse false positive testing
drivers/staging/comedi/drivers/ni_pcimio.c.

  CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int

I have created some test code to demonstrate the problem (attached).

The check_shift_count() warning is only supposed to be printed for
number literals but because of the way inline functions are expanded it
still complains even though channel is a variable.

regards,
dan carpenter


--pWyiEgJYm5f9v55/
Content-Type: text/x-csrc; charset=us-ascii
Content-Disposition: attachment; filename="test_shift.c"

#include <stdio.h>
#include <limits.h>
#include <string.h>

static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
{
	if (channel < 4)
		return 1 << channel;
	return 0;
}

static inline void filter(int channel)
{
	if (channel < 0)
		return;
	ni_stc_dma_channel_select_bitfield(channel);
}

int main(void)
{
	filter(-1);

	return 0;
}

--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel

--pWyiEgJYm5f9v55/--
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Wed, 11 Jun 2014 21:24:25 +0000
Message-ID: <20140611212425.GW5015 () mwanda>
--------------------

--pWyiEgJYm5f9v55/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

Let's forward this to the Sparse mailing list.

We're seeing a Sparse false positive testing
drivers/staging/comedi/drivers/ni_pcimio.c.

  CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int

I have created some test code to demonstrate the problem (attached).

The check_shift_count() warning is only supposed to be printed for
number literals but because of the way inline functions are expanded it
still complains even though channel is a variable.

regards,
dan carpenter


--pWyiEgJYm5f9v55/
Content-Type: text/x-csrc; charset=us-ascii
Content-Disposition: attachment; filename="test_shift.c"

#include <stdio.h>
#include <limits.h>
#include <string.h>

static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
{
	if (channel < 4)
		return 1 << channel;
	return 0;
}

static inline void filter(int channel)
{
	if (channel < 0)
		return;
	ni_stc_dma_channel_select_bitfield(channel);
}

int main(void)
{
	filter(-1);

	return 0;
}

--pWyiEgJYm5f9v55/--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: josh () joshtriplett ! org
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Wed, 11 Jun 2014 21:45:29 +0000
Message-ID: <20140611214529.GB16940 () cloud>
--------------------
On Thu, Jun 12, 2014 at 12:24:25AM +0300, Dan Carpenter wrote:
> Let's forward this to the Sparse mailing list.
> 
> We're seeing a Sparse false positive testing
> drivers/staging/comedi/drivers/ni_pcimio.c.
> 
>   CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> 
> I have created some test code to demonstrate the problem (attached).
> 
> The check_shift_count() warning is only supposed to be printed for
> number literals but because of the way inline functions are expanded it
> still complains even though channel is a variable.

Thanks for the test case; this definitely makes no sense.  I don't think
Sparse will suddenly develop enough range analysis or reachability
analysis to handle this case; I think the right answer is to avoid
giving such warnings for shifts with a non-constant RHS.

> #include <stdio.h>
> #include <limits.h>
> #include <string.h>
> 
> static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
> {
> 	if (channel < 4)
> 		return 1 << channel;
> 	return 0;
> }
> 
> static inline void filter(int channel)
> {
> 	if (channel < 0)
> 		return;
> 	ni_stc_dma_channel_select_bitfield(channel);
> }
> 
> int main(void)
> {
> 	filter(-1);
> 
> 	return 0;
> }

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: josh () joshtriplett ! org
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Wed, 11 Jun 2014 21:45:29 +0000
Message-ID: <20140611214529.GB16940 () cloud>
--------------------
On Thu, Jun 12, 2014 at 12:24:25AM +0300, Dan Carpenter wrote:
> Let's forward this to the Sparse mailing list.
> 
> We're seeing a Sparse false positive testing
> drivers/staging/comedi/drivers/ni_pcimio.c.
> 
>   CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> 
> I have created some test code to demonstrate the problem (attached).
> 
> The check_shift_count() warning is only supposed to be printed for
> number literals but because of the way inline functions are expanded it
> still complains even though channel is a variable.

Thanks for the test case; this definitely makes no sense.  I don't think
Sparse will suddenly develop enough range analysis or reachability
analysis to handle this case; I think the right answer is to avoid
giving such warnings for shifts with a non-constant RHS.

> #include <stdio.h>
> #include <limits.h>
> #include <string.h>
> 
> static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
> {
> 	if (channel < 4)
> 		return 1 << channel;
> 	return 0;
> }
> 
> static inline void filter(int channel)
> {
> 	if (channel < 0)
> 		return;
> 	ni_stc_dma_channel_select_bitfield(channel);
> }
> 
> int main(void)
> {
> 	filter(-1);
> 
> 	return 0;
> }

_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Sun, 15 Jun 2014 19:32:27 +0000
Message-ID: <20140615193227.GA24515 () ravnborg ! org>
--------------------
Hi Josh.

On Wed, Jun 11, 2014 at 02:45:29PM -0700, josh@joshtriplett.org wrote:
> On Thu, Jun 12, 2014 at 12:24:25AM +0300, Dan Carpenter wrote:
> > Let's forward this to the Sparse mailing list.
> > 
> > We're seeing a Sparse false positive testing
> > drivers/staging/comedi/drivers/ni_pcimio.c.
> > 
> >   CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
> > drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> > drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> > drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> > drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> > 
> > I have created some test code to demonstrate the problem (attached).
> > 
> > The check_shift_count() warning is only supposed to be printed for
> > number literals but because of the way inline functions are expanded it
> > still complains even though channel is a variable.
> 
> Thanks for the test case; this definitely makes no sense.  I don't think
> Sparse will suddenly develop enough range analysis or reachability
> analysis to handle this case; I think the right answer is to avoid
> giving such warnings for shifts with a non-constant RHS.

Something like the appended?

It seems to work for me - and it cured a lot of warnings in math-emu.c on sparc.
If it looks OK I will do a proper patch submission.

	Sam


diff --git a/expand.c b/expand.c
index 0f6720c..4a96de4 100644
--- a/expand.c
+++ b/expand.c
@@ -187,7 +187,7 @@ static int simplify_int_binop(struct expression *expr, struct symbol *ctype)
 		return 0;
 	r = right->value;
 	if (expr->op == SPECIAL_LEFTSHIFT || expr->op == SPECIAL_RIGHTSHIFT) {
-		if (r >= ctype->bit_size) {
+		if (expr->flags & Int_const_expr && r >= ctype->bit_size) {
 			if (conservative)
 				return 0;
 			r = check_shift_count(expr, ctype, r);


_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Mon, 16 Jun 2014 07:40:19 +0000
Message-ID: <20140616074019.GL5015 () mwanda>
--------------------
On Sun, Jun 15, 2014 at 09:32:27PM +0200, Sam Ravnborg wrote:
> diff --git a/expand.c b/expand.c
> index 0f6720c..4a96de4 100644
> --- a/expand.c
> +++ b/expand.c
> @@ -187,7 +187,7 @@ static int simplify_int_binop(struct expression *expr, struct symbol *ctype)
>  		return 0;
>  	r = right->value;
>  	if (expr->op == SPECIAL_LEFTSHIFT || expr->op == SPECIAL_RIGHTSHIFT) {
> -		if (r >= ctype->bit_size) {
> +		if (expr->flags & Int_const_expr && r >= ctype->bit_size) {

Thanks!  I had no idea how to start writing a fix for this, but the test
should be:
		if (expr->right->flags & Int_const_expr

Otherwise both sides of the shift have to be const.

>  			if (conservative)
>  				return 0;
>  			r = check_shift_count(expr, ctype, r);
> 

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Mon, 16 Jun 2014 07:40:19 +0000
Message-ID: <20140616074019.GL5015 () mwanda>
--------------------
On Sun, Jun 15, 2014 at 09:32:27PM +0200, Sam Ravnborg wrote:
> diff --git a/expand.c b/expand.c
> index 0f6720c..4a96de4 100644
> --- a/expand.c
> +++ b/expand.c
> @@ -187,7 +187,7 @@ static int simplify_int_binop(struct expression *expr, struct symbol *ctype)
>  		return 0;
>  	r = right->value;
>  	if (expr->op == SPECIAL_LEFTSHIFT || expr->op == SPECIAL_RIGHTSHIFT) {
> -		if (r >= ctype->bit_size) {
> +		if (expr->flags & Int_const_expr && r >= ctype->bit_size) {

Thanks!  I had no idea how to start writing a fix for this, but the test
should be:
		if (expr->right->flags & Int_const_expr

Otherwise both sides of the shift have to be const.

>  			if (conservative)
>  				return 0;
>  			r = check_shift_count(expr, ctype, r);
> 

regards,
dan carpenter
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Mon, 16 Jun 2014 08:06:54 +0000
Message-ID: <20140616080654.GA2782 () ravnborg ! org>
--------------------
On Mon, Jun 16, 2014 at 10:40:19AM +0300, Dan Carpenter wrote:
> On Sun, Jun 15, 2014 at 09:32:27PM +0200, Sam Ravnborg wrote:
> > diff --git a/expand.c b/expand.c
> > index 0f6720c..4a96de4 100644
> > --- a/expand.c
> > +++ b/expand.c
> > @@ -187,7 +187,7 @@ static int simplify_int_binop(struct expression *expr, struct symbol *ctype)
> >  		return 0;
> >  	r = right->value;
> >  	if (expr->op == SPECIAL_LEFTSHIFT || expr->op == SPECIAL_RIGHTSHIFT) {
> > -		if (r >= ctype->bit_size) {
> > +		if (expr->flags & Int_const_expr && r >= ctype->bit_size) {
> 
> Thanks!  I had no idea how to start writing a fix for this, but the test
> should be:
> 		if (expr->right->flags & Int_const_expr
> 
> Otherwise both sides of the shift have to be const.
Thanks - will fix.

I will update the test case to check for this, and
then send a proper patch.

	Sam
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Sat, 28 Jun 2014 18:07:48 +0000
Message-ID: <CANeU7Qki9Fg=Vz8gryT1bL+BMnjuvWZTH7uNvyk-HjdSPsiiyg () mail ! gmail ! com>
--------------------
Sorry for the late reply.

On Wed, Jun 11, 2014 at 2:45 PM,  <josh@joshtriplett.org> wrote:
> On Thu, Jun 12, 2014 at 12:24:25AM +0300, Dan Carpenter wrote:
>> Let's forward this to the Sparse mailing list.
>>
>> We're seeing a Sparse false positive testing

No, this is a valid complain. See my point follows.

>> drivers/staging/comedi/drivers/ni_pcimio.c.
>>
>>   CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
>> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
>> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
>> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
>> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
>>
>> I have created some test code to demonstrate the problem (attached).
>>
>> The check_shift_count() warning is only supposed to be printed for
>> number literals but because of the way inline functions are expanded it
>> still complains even though channel is a variable.
>
> Thanks for the test case; this definitely makes no sense.  I don't think
> Sparse will suddenly develop enough range analysis or reachability
> analysis to handle this case; I think the right answer is to avoid
> giving such warnings for shifts with a non-constant RHS.

Sparse can handle inline function expand and some constant
propagate. In this case, sparse seems doing the right thing.
Sparse actually sees the channel value being  4294967295 (-1).


>> static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)

This is the bug. See this channel is *unsigned*. When -1 pass into
channel, it become a really large number 4294967295.
The code does request C compiler to perform left shift 4294967295 bits.
Which did not make sense.

>> {
>>       if (channel < 4)
>>               return 1 << channel;
>>       return 0;
>> }
>>
>> static inline void filter(int channel)
>> {
>>       if (channel < 0)
>>               return;
>>       ni_stc_dma_channel_select_bitfield(channel);

See this channel is *signed*, with -1 convert to 4294967295.
This is a bug in the kernel source not sparse.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Sat, 28 Jun 2014 19:20:25 +0000
Message-ID: <20140628192020.GA2501 () thin>
--------------------
On Sat, Jun 28, 2014 at 11:07:48AM -0700, Christopher Li wrote:
> On Wed, Jun 11, 2014 at 2:45 PM,  <josh@joshtriplett.org> wrote:
> > On Thu, Jun 12, 2014 at 12:24:25AM +0300, Dan Carpenter wrote:
> >> Let's forward this to the Sparse mailing list.
> >>
> >> We're seeing a Sparse false positive testing
> 
> No, this is a valid complain. See my point follows.
> 
> >> drivers/staging/comedi/drivers/ni_pcimio.c.
> >>
> >>   CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >>
> >> I have created some test code to demonstrate the problem (attached).
> >>
> >> The check_shift_count() warning is only supposed to be printed for
> >> number literals but because of the way inline functions are expanded it
> >> still complains even though channel is a variable.
> >
> > Thanks for the test case; this definitely makes no sense.  I don't think
> > Sparse will suddenly develop enough range analysis or reachability
> > analysis to handle this case; I think the right answer is to avoid
> > giving such warnings for shifts with a non-constant RHS.
> 
> Sparse can handle inline function expand and some constant
> propagate. In this case, sparse seems doing the right thing.
> Sparse actually sees the channel value being  4294967295 (-1).
> 
> >> static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
> 
> This is the bug. See this channel is *unsigned*. When -1 pass into
> channel, it become a really large number 4294967295.
> The code does request C compiler to perform left shift 4294967295 bits.
> Which did not make sense.
> 
> >> {
> >>       if (channel < 4)
> >>               return 1 << channel;
> >>       return 0;
> >> }
> >>
> >> static inline void filter(int channel)
> >> {
> >>       if (channel < 0)
> >>               return;
> >>       ni_stc_dma_channel_select_bitfield(channel);
> 
> See this channel is *signed*, with -1 convert to 4294967295.
> This is a bug in the kernel source not sparse.

Except that "filter" has an "int channel" (signed), so it can
successfully test "channel < 0" and return early; it'll never call
ni_stc_dma_channel_select_bitfield(channel) with a negative number.

I do agree that this code should sort out the signedness of its types,
but in this case I don't think the bad shift can actually happen, making
this a false positive.

- Josh Triplett
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Sat, 28 Jun 2014 19:20:25 +0000
Message-ID: <20140628192020.GA2501 () thin>
--------------------
On Sat, Jun 28, 2014 at 11:07:48AM -0700, Christopher Li wrote:
> On Wed, Jun 11, 2014 at 2:45 PM,  <josh@joshtriplett.org> wrote:
> > On Thu, Jun 12, 2014 at 12:24:25AM +0300, Dan Carpenter wrote:
> >> Let's forward this to the Sparse mailing list.
> >>
> >> We're seeing a Sparse false positive testing
> 
> No, this is a valid complain. See my point follows.
> 
> >> drivers/staging/comedi/drivers/ni_pcimio.c.
> >>
> >>   CHECK   drivers/staging/comedi/drivers/ni_pcimio.c
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >> drivers/staging/comedi/drivers/ni_stc.h:720:26: warning: shift too big (4294967295) for type int
> >>
> >> I have created some test code to demonstrate the problem (attached).
> >>
> >> The check_shift_count() warning is only supposed to be printed for
> >> number literals but because of the way inline functions are expanded it
> >> still complains even though channel is a variable.
> >
> > Thanks for the test case; this definitely makes no sense.  I don't think
> > Sparse will suddenly develop enough range analysis or reachability
> > analysis to handle this case; I think the right answer is to avoid
> > giving such warnings for shifts with a non-constant RHS.
> 
> Sparse can handle inline function expand and some constant
> propagate. In this case, sparse seems doing the right thing.
> Sparse actually sees the channel value being  4294967295 (-1).
> 
> >> static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
> 
> This is the bug. See this channel is *unsigned*. When -1 pass into
> channel, it become a really large number 4294967295.
> The code does request C compiler to perform left shift 4294967295 bits.
> Which did not make sense.
> 
> >> {
> >>       if (channel < 4)
> >>               return 1 << channel;
> >>       return 0;
> >> }
> >>
> >> static inline void filter(int channel)
> >> {
> >>       if (channel < 0)
> >>               return;
> >>       ni_stc_dma_channel_select_bitfield(channel);
> 
> See this channel is *signed*, with -1 convert to 4294967295.
> This is a bug in the kernel source not sparse.

Except that "filter" has an "int channel" (signed), so it can
successfully test "channel < 0" and return early; it'll never call
ni_stc_dma_channel_select_bitfield(channel) with a negative number.

I do agree that this code should sort out the signedness of its types,
but in this case I don't think the bad shift can actually happen, making
this a false positive.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Sun, 29 Jun 2014 03:09:25 +0000
Message-ID: <CANeU7QkKnh-Xq4CVAkNFs54KieNrDqD93uuWijCOYwj0iorHvg () mail ! gmail ! com>
--------------------
On Sat, Jun 28, 2014 at 12:20 PM, Josh Triplett <josh@joshtriplett.org> wrote:
> Except that "filter" has an "int channel" (signed), so it can
> successfully test "channel < 0" and return early; it'll never call
> ni_stc_dma_channel_select_bitfield(channel) with a negative number.
>
> I do agree that this code should sort out the signedness of its types,
> but in this case I don't think the bad shift can actually happen, making
> this a false positive.

Ah, I see. I agree that the warning happen on the dead code.

However, the root cause for the warning is not because sparse can not
figure out the value of "channel". Sparse actually correctly does the
inline and figure out "channel" is 4294967295. The root cause
of your complain against sparse is that it happen on the dead code.

I don' think the patch is the right fix for this problem though.
This patch try to silence a warning purely because it can happen
on dead code, otherwise perfectly valid warning.

My point is that, it can happen on dead code is not a valid reason
to weaken the warning. Sparse can give any possible warning on
dead code. e.g. On the dead code path, you can construct an address
space warning. Do we weakling the address space warning purely
because it can happen on the dead code as well? Of course not.
The same apply to any other sparse warnings.

So if there is a bug, It is sparse did not know exactly which part
of the code is dead on AST level. If you enable the "#if 0" inside
expand_if_statement(), sparse can actually correctly expand
"if (channel < 0)" into "return". Of course, it still can't handle jump
into dead code situation, which is the reason that piece of code
is not enabled in the first place. It needs more work. I think that is
a better approach than just random weakening some warnings
on dead code path.

Chris
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Mon, 30 Jun 2014 17:49:18 +0000
Message-ID: <CANeU7QmOq7iqy8--A3srr0yMQ4f92BRi9wrLT1pYAHYstwsToA () mail ! gmail ! com>
--------------------
On Sat, Jun 28, 2014 at 8:09 PM, Christopher Li <sparse@chrisli.org> wrote:
> So if there is a bug, It is sparse did not know exactly which part
> of the code is dead on AST level. If you enable the "#if 0" inside

I am thinking about how to fix the dead code issue. Try to do more
than trivial dead code analyses is really not the right place for AST.

Actually, there is a simple way out. We can just move the warning
to the linearize instruction level.

 $ ./test-linearize /tmp/test_shift.c
/tmp/test_shift.c:8:26: warning: shift too big (4294967295) for type int
main:
.L0x7f8f490e5010:
    <entry-point>
    # call      %r1 <- filter, $0xffffffff
    ret.32      $0

You see, once drop into the instruction level, sparse already
know that code is dead.

Since the sparse is already linearizing instruction to perform
the context check. We just need to move the warning from AST
to instruction level.

The warning should be trivial in instruction level. We are looking
for an instruction has larger than type size constant shift
value.

Comments and feed backs, even patches?

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-driver-devel
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Mon, 30 Jun 2014 17:49:18 +0000
Message-ID: <CANeU7QmOq7iqy8--A3srr0yMQ4f92BRi9wrLT1pYAHYstwsToA () mail ! gmail ! com>
--------------------
On Sat, Jun 28, 2014 at 8:09 PM, Christopher Li <sparse@chrisli.org> wrote:
> So if there is a bug, It is sparse did not know exactly which part
> of the code is dead on AST level. If you enable the "#if 0" inside

I am thinking about how to fix the dead code issue. Try to do more
than trivial dead code analyses is really not the right place for AST.

Actually, there is a simple way out. We can just move the warning
to the linearize instruction level.

 $ ./test-linearize /tmp/test_shift.c
/tmp/test_shift.c:8:26: warning: shift too big (4294967295) for type int
main:
.L0x7f8f490e5010:
    <entry-point>
    # call      %r1 <- filter, $0xffffffff
    ret.32      $0

You see, once drop into the instruction level, sparse already
know that code is dead.

Since the sparse is already linearizing instruction to perform
the context check. We just need to move the warning from AST
to instruction level.

The warning should be trivial in instruction level. We are looking
for an instruction has larger than type size constant shift
value.

Comments and feed backs, even patches?

Chris
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] Staging/comedi: Fixes static analysis warning raised by sparse
Date: Mon, 30 Jun 2014 18:32:21 +0000
Message-ID: <CANeU7QmdB0Ec0ytBiLqW+QRMr_2_Eq-6hnraCb0nQtuY8-0N2w () mail ! gmail ! com>
--------------------
On Mon, Jun 30, 2014 at 10:49 AM, Christopher Li <sparse@chrisli.org> wrote:
> The warning should be trivial in instruction level. We are looking
> for an instruction has larger than type size constant shift
> value.

Actually, just try it. Not as trivial as I thought.

The problem is that, in the instruction level, sparse will optimize away
the shift instruction when it see a larger than type size shift.
The finial instruction level don't see the big constant shift any way.
Need to catch it before the instruction get optimized away.

That is unfortunate. If we check it too early, we can't tell it is in the
dead code. If we check it too late, the instruction itself get optimized
away.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] build: allow use of LLVM_CONFIG to override llvm-config config script ===

From: Cody P Schafer <cody () linux ! vnet ! ibm ! com>
To: linux-sparse
Subject: [PATCH] build: allow use of LLVM_CONFIG to override llvm-config config script
Date: Tue, 15 Apr 2014 17:22:49 +0000
Message-ID: <1397582569-7043-1-git-send-email-cody () linux ! vnet ! ibm ! com>
--------------------
On systems like ubuntu 12.04, llvm-config is llvm 2.9, but
llvm-config-3.0 and llvm-config-3.3 (for example) are versions 3.0 and
3.3 respectively. Allow overriding the name/path of the llvm-config
script so people can use these versioned config scripts

Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>
---
 Makefile | 13 +++++++------
 1 file changed, 7 insertions(+), 6 deletions(-)

diff --git a/Makefile b/Makefile
index c3f3104..bbdc088 100644
--- a/Makefile
+++ b/Makefile
@@ -30,9 +30,10 @@ HAVE_GCC_DEP:=$(shell touch .gcc-test.c && 				\
 		$(CC) -c -Wp,-MD,.gcc-test.d .gcc-test.c 2>/dev/null && \
 		echo 'yes'; rm -f .gcc-test.d .gcc-test.o .gcc-test.c)
 HAVE_GTK2:=$(shell pkg-config --exists gtk+-2.0 2>/dev/null && echo 'yes')
-HAVE_LLVM:=$(shell llvm-config --version >/dev/null 2>&1 && echo 'yes')
-HAVE_LLVM_VERSION:=$(shell llvm-config --version | grep "^[3-9].*" >/dev/null 2>&1 && echo yes)
-LLVM_VERSION=$(shell llvm-config --version)
+LLVM_CONFIG=llvm-config
+HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
+HAVE_LLVM_VERSION:=$(shell $(LLVM_CONFIG) --version | grep "^[3-9].*" >/dev/null 2>&1 && echo yes)
+LLVM_VERSION=$(shell $(LLVM_CONFIG) --version)
 
 GCC_BASE = $(shell $(CC) --print-file-name=)
 BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
@@ -84,9 +85,9 @@ HAVE_LLVM=no
 else
 LLVM_PROGS := sparse-llvm
 $(LLVM_PROGS): LD := g++
-LLVM_LDFLAGS := $(shell llvm-config --ldflags)
-LLVM_CFLAGS := $(shell llvm-config --cflags | sed -e "s/-DNDEBUG//g")
-LLVM_LIBS := $(shell llvm-config --libs)
+LLVM_LDFLAGS := $(shell $(LLVM_CONFIG) --ldflags)
+LLVM_CFLAGS := $(shell $(LLVM_CONFIG) --cflags | sed -e "s/-DNDEBUG//g")
+LLVM_LIBS := $(shell $(LLVM_CONFIG) --libs)
 PROGRAMS += $(LLVM_PROGS)
 INST_PROGRAMS += sparse-llvm sparsec
 sparse-llvm.o: BASIC_CFLAGS += $(LLVM_CFLAGS)
-- 
1.9.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] build: allow use of LLVM_CONFIG to override llvm-config config script
Date: Tue, 15 Apr 2014 18:00:45 +0000
Message-ID: <20140415180045.GA2707 () leaf>
--------------------
On Tue, Apr 15, 2014 at 10:22:49AM -0700, Cody P Schafer wrote:
> On systems like ubuntu 12.04, llvm-config is llvm 2.9, but
> llvm-config-3.0 and llvm-config-3.3 (for example) are versions 3.0 and
> 3.3 respectively. Allow overriding the name/path of the llvm-config
> script so people can use these versioned config scripts
> 
> Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>

Reviewed-by: Josh Triplett <josh@joshtriplett.org>

>  Makefile | 13 +++++++------
>  1 file changed, 7 insertions(+), 6 deletions(-)
> 
> diff --git a/Makefile b/Makefile
> index c3f3104..bbdc088 100644
> --- a/Makefile
> +++ b/Makefile
> @@ -30,9 +30,10 @@ HAVE_GCC_DEP:=$(shell touch .gcc-test.c && 				\
>  		$(CC) -c -Wp,-MD,.gcc-test.d .gcc-test.c 2>/dev/null && \
>  		echo 'yes'; rm -f .gcc-test.d .gcc-test.o .gcc-test.c)
>  HAVE_GTK2:=$(shell pkg-config --exists gtk+-2.0 2>/dev/null && echo 'yes')
> -HAVE_LLVM:=$(shell llvm-config --version >/dev/null 2>&1 && echo 'yes')
> -HAVE_LLVM_VERSION:=$(shell llvm-config --version | grep "^[3-9].*" >/dev/null 2>&1 && echo yes)
> -LLVM_VERSION=$(shell llvm-config --version)
> +LLVM_CONFIG=llvm-config
> +HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
> +HAVE_LLVM_VERSION:=$(shell $(LLVM_CONFIG) --version | grep "^[3-9].*" >/dev/null 2>&1 && echo yes)
> +LLVM_VERSION=$(shell $(LLVM_CONFIG) --version)
>  
>  GCC_BASE = $(shell $(CC) --print-file-name=)
>  BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
> @@ -84,9 +85,9 @@ HAVE_LLVM=no
>  else
>  LLVM_PROGS := sparse-llvm
>  $(LLVM_PROGS): LD := g++
> -LLVM_LDFLAGS := $(shell llvm-config --ldflags)
> -LLVM_CFLAGS := $(shell llvm-config --cflags | sed -e "s/-DNDEBUG//g")
> -LLVM_LIBS := $(shell llvm-config --libs)
> +LLVM_LDFLAGS := $(shell $(LLVM_CONFIG) --ldflags)
> +LLVM_CFLAGS := $(shell $(LLVM_CONFIG) --cflags | sed -e "s/-DNDEBUG//g")
> +LLVM_LIBS := $(shell $(LLVM_CONFIG) --libs)
>  PROGRAMS += $(LLVM_PROGS)
>  INST_PROGRAMS += sparse-llvm sparsec
>  sparse-llvm.o: BASIC_CFLAGS += $(LLVM_CFLAGS)
> -- 
> 1.9.2
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] build: allow use of LLVM_CONFIG to override llvm-config config script
Date: Tue, 15 Apr 2014 22:05:21 +0000
Message-ID: <CANeU7QmOQwveOeTRP9rrcXaCJYv3DMBGAW_yp1uGG0Juvm0agw () mail ! gmail ! com>
--------------------
On Tue, Apr 15, 2014 at 11:00 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> On Tue, Apr 15, 2014 at 10:22:49AM -0700, Cody P Schafer wrote:
>> On systems like ubuntu 12.04, llvm-config is llvm 2.9, but
>> llvm-config-3.0 and llvm-config-3.3 (for example) are versions 3.0 and
>> 3.3 respectively. Allow overriding the name/path of the llvm-config
>> script so people can use these versioned config scripts
>>
>> Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>
>
> Reviewed-by: Josh Triplett <josh@joshtriplett.org>

Applied with trivial modification to use simple
expanded variable.

Chris

diff --git a/Makefile b/Makefile
index bbdc088..f453ded 100644
--- a/Makefile
+++ b/Makefile
@@ -30,10 +30,10 @@ HAVE_GCC_DEP:=$(shell touch .gcc-test.c &&
                $(CC) -c -Wp,-MD,.gcc-test.d .gcc-test.c 2>/dev/null && \
                echo 'yes'; rm -f .gcc-test.d .gcc-test.o .gcc-test.c)
 HAVE_GTK2:=$(shell pkg-config --exists gtk+-2.0 2>/dev/null && echo 'yes')
-LLVM_CONFIG=llvm-config
+LLVM_CONFIG:=llvm-config
 HAVE_LLVM:=$(shell $(LLVM_CONFIG) --version >/dev/null 2>&1 && echo 'yes')
 HAVE_LLVM_VERSION:=$(shell $(LLVM_CONFIG) --version | grep "^[3-9].*" >/dev/nul
-LLVM_VERSION=$(shell $(LLVM_CONFIG) --version)
+LLVM_VERSION:=$(shell $(LLVM_CONFIG) --version)

 GCC_BASE = $(shell $(CC) --print-file-name=)
 BASIC_CFLAGS = -DGCC_BASE=\"$(GCC_BASE)\"
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] cgcc: Fix preprocessing of assembler files ===

From: Stefan Weil <sw () weilnetz ! de>
To: linux-sparse
Subject: [PATCH] cgcc: Fix preprocessing of assembler files
Date: Sat, 04 Jan 2014 10:20:48 +0000
Message-ID: <1388830848-2020-1-git-send-email-sw () weilnetz ! de>
--------------------
The old code does not preprocess assembler files when cgcc is called like
this:

cgcc -E -o multiboot.asm multiboot.S

As the preprocessor is not called, no multiboot.asm is generated, and any
further build steps which need it will fail.

Fix this by using a new intermediate variable $do_preprocess.

Signed-off-by: Stefan Weil <sw@weilnetz.de>
---

This patch allows using cgcc for QEMU builds. I did not run any other tests,
so please review carefully.

Thanks,
Stefan Weil

 cgcc |    9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/cgcc b/cgcc
index c075e5f..a43e074 100755
--- a/cgcc
+++ b/cgcc
@@ -10,6 +10,7 @@ my $has_specs = 0;
 my $gendeps = 0;
 my $do_check = 0;
 my $do_compile = 1;
+my $do_preprocess = 0;
 my $gcc_base_dir;
 my $verbose = 0;
 
@@ -44,8 +45,7 @@ while (@ARGV) {
         next;
     }
 
-    # If someone adds "-E", don't pre-process twice.
-    $do_compile = 0 if $_ eq '-E';
+    $do_preprocess = 1 if $_ eq '-E';
 
     $verbose = 1 if $_ eq '-v';
 
@@ -59,6 +59,11 @@ if ($gendeps) {
     $do_check = 0;
 }
 
+if ($do_check && $do_preprocess) {
+    # If someone adds "-E", don't pre-process twice.
+    $do_compile = 0;
+}
+
 if ($do_check) {
     if (!$has_specs) {
 	$check .= &add_specs ('host_arch_specs');
-- 
1.7.10.4

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] compile-i386.c: don't ignore return value of write(2) ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH] compile-i386.c: don't ignore return value of write(2)
Date: Mon, 13 Oct 2014 23:03:31 +0000
Message-ID: <543C5A43.9 () ramsay1 ! demon ! co ! uk>
--------------------

Some versions of gcc (e.g. v4.8.2) complain about ignoring the return
value of a call to the write(2) system call, since the system header
files have marked its declaration with the warn_unused_result attribute.

In order to suppress the compiler warning, check the return value from
'write' and, if it indicates an error (a negative return value), exit
the process using 'die' to display an error message. Replace a second
call to 'write', which does not provoke a compiler warning, with similar
code for consistency.

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

This is an (almost) minimal patch to suppress the compiler warning.
You could drop the second hunk (and edit the commit message) if you
prefer an absolutely minimal patch. :-D

ATB,
Ramsay Jones

 compile-i386.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/compile-i386.c b/compile-i386.c
index 88169ec..44b72ec 100644
--- a/compile-i386.c
+++ b/compile-i386.c
@@ -732,7 +732,8 @@ static void emit_insn_atom(struct function *f, struct atom *atom)
 			atom->insn,
 			comment[0] ? "\t\t" : "", comment);
 
-	write(STDOUT_FILENO, s, strlen(s));
+	if (write(STDOUT_FILENO, s, strlen(s)) < 0)
+		die("can't write to stdout");
 }
 
 static void emit_atom_list(struct function *f)
@@ -742,9 +743,8 @@ static void emit_atom_list(struct function *f)
 	FOR_EACH_PTR(f->atom_list, atom) {
 		switch (atom->type) {
 		case ATOM_TEXT: {
-			ssize_t rc = write(STDOUT_FILENO, atom->text,
-					   atom->text_len);
-			(void) rc;	/* FIXME */
+			if (write(STDOUT_FILENO, atom->text, atom->text_len) < 0)
+				die("can't write to stdout");
 			break;
 		}
 		case ATOM_INSN:
-- 
2.1.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] compile-i386.c: don't ignore return value of write(2)
Date: Tue, 14 Oct 2014 03:14:29 +0000
Message-ID: <20141014031428.GA1009 () thin>
--------------------
On Tue, Oct 14, 2014 at 12:03:31AM +0100, Ramsay Jones wrote:
> 
> Some versions of gcc (e.g. v4.8.2) complain about ignoring the return
> value of a call to the write(2) system call, since the system header
> files have marked its declaration with the warn_unused_result attribute.
> 
> In order to suppress the compiler warning, check the return value from
> 'write' and, if it indicates an error (a negative return value), exit
> the process using 'die' to display an error message. Replace a second
> call to 'write', which does not provoke a compiler warning, with similar
> code for consistency.
> 
> Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>

That isn't the only way write() can fail; it can also do a partial
write, in which case you need to loop and write the rest.  You might
consider adding an xwrite() function which includes that logic.
(Alternatively, you could use standard C IO, which doesn't have that
problem.)

> 
> Hi Chris,
> 
> This is an (almost) minimal patch to suppress the compiler warning.
> You could drop the second hunk (and edit the commit message) if you
> prefer an absolutely minimal patch. :-D
> 
> ATB,
> Ramsay Jones
> 
>  compile-i386.c | 8 ++++----
>  1 file changed, 4 insertions(+), 4 deletions(-)
> 
> diff --git a/compile-i386.c b/compile-i386.c
> index 88169ec..44b72ec 100644
> --- a/compile-i386.c
> +++ b/compile-i386.c
> @@ -732,7 +732,8 @@ static void emit_insn_atom(struct function *f, struct atom *atom)
>  			atom->insn,
>  			comment[0] ? "\t\t" : "", comment);
>  
> -	write(STDOUT_FILENO, s, strlen(s));
> +	if (write(STDOUT_FILENO, s, strlen(s)) < 0)
> +		die("can't write to stdout");
>  }
>  
>  static void emit_atom_list(struct function *f)
> @@ -742,9 +743,8 @@ static void emit_atom_list(struct function *f)
>  	FOR_EACH_PTR(f->atom_list, atom) {
>  		switch (atom->type) {
>  		case ATOM_TEXT: {
> -			ssize_t rc = write(STDOUT_FILENO, atom->text,
> -					   atom->text_len);
> -			(void) rc;	/* FIXME */
> +			if (write(STDOUT_FILENO, atom->text, atom->text_len) < 0)
> +				die("can't write to stdout");
>  			break;
>  		}
>  		case ATOM_INSN:
> -- 
> 2.1.0
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: Re: [PATCH] compile-i386.c: don't ignore return value of write(2)
Date: Tue, 14 Oct 2014 10:13:47 +0000
Message-ID: <543CF75B.1020507 () ramsay1 ! demon ! co ! uk>
--------------------
On 14/10/14 04:14, Josh Triplett wrote:
> On Tue, Oct 14, 2014 at 12:03:31AM +0100, Ramsay Jones wrote:
>>
>> Some versions of gcc (e.g. v4.8.2) complain about ignoring the return
>> value of a call to the write(2) system call, since the system header
>> files have marked its declaration with the warn_unused_result attribute.
>>
>> In order to suppress the compiler warning, check the return value from
>> 'write' and, if it indicates an error (a negative return value), exit
>> the process using 'die' to display an error message. Replace a second
>> call to 'write', which does not provoke a compiler warning, with similar
>> code for consistency.
>>
>> Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
> 
> That isn't the only way write() can fail; it can also do a partial
> write, in which case you need to loop and write the rest.  You might
> consider adding an xwrite() function which includes that logic.

I did consider doing exactly that, but I wanted a _minimal_ fix for a
program that is basically unmaintained. However, if Chris would like
such a patch, I will happily provide one! ;-)

> (Alternatively, you could use standard C IO, which doesn't have that
> problem.)

See the very first version of this patch. :-D (I still slightly prefer
the first patch, very closely followed by the second version; this is
the third attempt).

ATB,
Ramsay Jones



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] compiler.h: Move __memory_barrier() use to compiler-intel.h ===

From: Pranith Kumar <bobby.prani () gmail ! com>
To: linux-sparse
Subject: [PATCH] compiler.h: Move __memory_barrier() use to compiler-intel.h
Date: Mon, 11 Aug 2014 22:51:42 +0000
Message-ID: <1407797503-24727-4-git-send-email-bobby.prani () gmail ! com>
--------------------
Commit 73679e5082012 ("compiler-intel.h: Remove duplicate definition") removed a
duplicate definition of barrier() from compiler-intel.h. This is the wrong
duplicate definition removed since __memory_barrier() is an intel compiler
specific intrinsic and should live in compiler-intel.h.

This commit reverts the previous commit and removes the definition from
compiler.h

Signed-off-by: Pranith Kumar <bobby.prani@gmail.com>
---
 include/linux/compiler-intel.h | 3 +++
 include/linux/compiler.h       | 5 -----
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/include/linux/compiler-intel.h b/include/linux/compiler-intel.h
index ba147a1..5529c52 100644
--- a/include/linux/compiler-intel.h
+++ b/include/linux/compiler-intel.h
@@ -13,9 +13,12 @@
 /* Intel ECC compiler doesn't support gcc specific asm stmts.
  * It uses intrinsics to do the equivalent things.
  */
+#undef barrier
 #undef RELOC_HIDE
 #undef OPTIMIZER_HIDE_VAR
 
+#define barrier() __memory_barrier()
+
 #define RELOC_HIDE(ptr, off)					\
   ({ unsigned long __ptr;					\
      __ptr = (unsigned long) (ptr);				\
diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index d5ad7b1..bc24cad 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -160,11 +160,6 @@ void ftrace_likely_update(struct ftrace_branch_data *f, int val, int expect);
 # define unlikely(x)	__builtin_expect(!!(x), 0)
 #endif
 
-/* Optimization barrier */
-#ifndef barrier
-# define barrier() __memory_barrier()
-#endif
-
 /* Unreachable code */
 #ifndef unreachable
 # define unreachable() do { } while (1)
-- 
1.9.1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] compiler: Correct macro parameter expansion problem ===

From: Jeff Kirsher <jeffrey.t.kirsher () intel ! com>
To: linux-kernel
Subject: [PATCH] compiler: Correct macro parameter expansion problem
Date: Mon, 03 Nov 2014 14:34:13 +0000
Message-ID: <1415025253-15976-1-git-send-email-jeffrey.t.kirsher () intel ! com>
--------------------
From: Mark Rustad <mark.d.rustad@intel.com>

The macro __compiletime_error_fallback has an error in that it
lacks parens around the expansion of an expression. It also
lacks a conversion to a boolean value. The first problem can
result in a mis-evaluation. The second problem can also result
in an error if the value comes out negative. That would thwart
the intended error generation. That is, the error being asserted
would not in fact generate an error. Fix both problems by adding
!!() to the expansion.

Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Tested-by: Aaron Brown <aaron.f.brown@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
---
 include/linux/compiler.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/include/linux/compiler.h b/include/linux/compiler.h
index d5ad7b1..59dc611 100644
--- a/include/linux/compiler.h
+++ b/include/linux/compiler.h
@@ -331,7 +331,7 @@ void ftrace_likely_update(struct ftrace_branch_data *f, int val, int expect);
  */
 # ifndef __CHECKER__
 #  define __compiletime_error_fallback(condition) \
-	do { ((void)sizeof(char[1 - 2 * condition])); } while (0)
+	do { ((void)sizeof(char[1 - 2 * !!(condition)])); } while (0)
 # endif
 #endif
 #ifndef __compiletime_error_fallback
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH] compiler: Correct macro parameter expansion problem
Date: Mon, 03 Nov 2014 14:48:01 +0000
Message-ID: <20141103144800.GA23094 () thin>
--------------------
On Mon, Nov 03, 2014 at 06:34:13AM -0800, Jeff Kirsher wrote:
> From: Mark Rustad <mark.d.rustad@intel.com>
> 
> The macro __compiletime_error_fallback has an error in that it
> lacks parens around the expansion of an expression. It also
> lacks a conversion to a boolean value. The first problem can
> result in a mis-evaluation. The second problem can also result
> in an error if the value comes out negative. That would thwart
> the intended error generation. That is, the error being asserted
> would not in fact generate an error. Fix both problems by adding
> !!() to the expansion.
> 
> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
> Tested-by: Aaron Brown <aaron.f.brown@intel.com>
> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>

Good catch.

Reviewed-by: Josh Triplett <josh@joshtriplett.org>

>  include/linux/compiler.h | 2 +-
>  1 file changed, 1 insertion(+), 1 deletion(-)
> 
> diff --git a/include/linux/compiler.h b/include/linux/compiler.h
> index d5ad7b1..59dc611 100644
> --- a/include/linux/compiler.h
> +++ b/include/linux/compiler.h
> @@ -331,7 +331,7 @@ void ftrace_likely_update(struct ftrace_branch_data *f, int val, int expect);
>   */
>  # ifndef __CHECKER__
>  #  define __compiletime_error_fallback(condition) \
> -	do { ((void)sizeof(char[1 - 2 * condition])); } while (0)
> +	do { ((void)sizeof(char[1 - 2 * !!(condition)])); } while (0)
>  # endif
>  #endif
>  #ifndef __compiletime_error_fallback
> -- 
> 1.9.3
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] compiler: Correct macro parameter expansion problem
Date: Mon, 03 Nov 2014 14:48:01 +0000
Message-ID: <20141103144800.GA23094 () thin>
--------------------
On Mon, Nov 03, 2014 at 06:34:13AM -0800, Jeff Kirsher wrote:
> From: Mark Rustad <mark.d.rustad@intel.com>
> 
> The macro __compiletime_error_fallback has an error in that it
> lacks parens around the expansion of an expression. It also
> lacks a conversion to a boolean value. The first problem can
> result in a mis-evaluation. The second problem can also result
> in an error if the value comes out negative. That would thwart
> the intended error generation. That is, the error being asserted
> would not in fact generate an error. Fix both problems by adding
> !!() to the expansion.
> 
> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
> Tested-by: Aaron Brown <aaron.f.brown@intel.com>
> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>

Good catch.

Reviewed-by: Josh Triplett <josh@joshtriplett.org>

>  include/linux/compiler.h | 2 +-
>  1 file changed, 1 insertion(+), 1 deletion(-)
> 
> diff --git a/include/linux/compiler.h b/include/linux/compiler.h
> index d5ad7b1..59dc611 100644
> --- a/include/linux/compiler.h
> +++ b/include/linux/compiler.h
> @@ -331,7 +331,7 @@ void ftrace_likely_update(struct ftrace_branch_data *f, int val, int expect);
>   */
>  # ifndef __CHECKER__
>  #  define __compiletime_error_fallback(condition) \
> -	do { ((void)sizeof(char[1 - 2 * condition])); } while (0)
> +	do { ((void)sizeof(char[1 - 2 * !!(condition)])); } while (0)
>  # endif
>  #endif
>  #ifndef __compiletime_error_fallback
> -- 
> 1.9.3
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] lib.c: skip --param parameters ===

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-kernel
Subject: [PATCH] lib.c: skip --param parameters
Date: Mon, 16 Jun 2014 10:43:06 +0000
Message-ID: <1402915386-28210-1-git-send-email-andriy.shevchenko () linux ! intel ! com>
--------------------
Very dumb patch to just skip --param allow-store-data-races=0 introduced in
newest Linux kernel buildsystem.

Actually the option is present in few GCC versions and probably should be
handled properly.

Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
---
 lib.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/lib.c b/lib.c
index bf3e91c..e56037b 100644
--- a/lib.c
+++ b/lib.c
@@ -673,6 +673,12 @@ static char **handle_version(char *arg, char **next)
 	exit(0);
 }
 
+static char **handle_param(char *arg, char **next)
+{
+	++next;
+	return ++next;
+}
+
 struct switches {
 	const char *name;
 	char **(*fn)(char *, char **);
@@ -681,6 +687,7 @@ struct switches {
 static char **handle_long_options(char *arg, char **next)
 {
 	static struct switches cmd[] = {
+		{ "param", handle_param },
 		{ "version", handle_version },
 		{ NULL, NULL }
 	};
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-sparse
Subject: [PATCH] lib.c: skip --param parameters
Date: Mon, 16 Jun 2014 10:43:06 +0000
Message-ID: <1402915386-28210-1-git-send-email-andriy.shevchenko () linux ! intel ! com>
--------------------
Very dumb patch to just skip --param allow-store-data-races=0 introduced in
newest Linux kernel buildsystem.

Actually the option is present in few GCC versions and probably should be
handled properly.

Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
---
 lib.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/lib.c b/lib.c
index bf3e91c..e56037b 100644
--- a/lib.c
+++ b/lib.c
@@ -673,6 +673,12 @@ static char **handle_version(char *arg, char **next)
 	exit(0);
 }
 
+static char **handle_param(char *arg, char **next)
+{
+	++next;
+	return ++next;
+}
+
 struct switches {
 	const char *name;
 	char **(*fn)(char *, char **);
@@ -681,6 +687,7 @@ struct switches {
 static char **handle_long_options(char *arg, char **next)
 {
 	static struct switches cmd[] = {
+		{ "param", handle_param },
 		{ "version", handle_version },
 		{ NULL, NULL }
 	};
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH] lib.c: skip --param parameters
Date: Mon, 16 Jun 2014 16:02:38 +0000
Message-ID: <20140616160238.GA2746 () jtriplet-mobl1>
--------------------
On Mon, Jun 16, 2014 at 01:43:06PM +0300, Andy Shevchenko wrote:
> Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> newest Linux kernel buildsystem.
> 
> Actually the option is present in few GCC versions and probably should be
> handled properly.
> 
> Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>

As far as I can tell, this seems to only handle "--param arg"; however,
according to the thread on LKML, GCC handles --param=arg as well.  Could
you please handle that variant too?

>  lib.c | 7 +++++++
>  1 file changed, 7 insertions(+)
> 
> diff --git a/lib.c b/lib.c
> index bf3e91c..e56037b 100644
> --- a/lib.c
> +++ b/lib.c
> @@ -673,6 +673,12 @@ static char **handle_version(char *arg, char **next)
>  	exit(0);
>  }
>  
> +static char **handle_param(char *arg, char **next)
> +{
> +	++next;
> +	return ++next;
> +}
> +
>  struct switches {
>  	const char *name;
>  	char **(*fn)(char *, char **);
> @@ -681,6 +687,7 @@ struct switches {
>  static char **handle_long_options(char *arg, char **next)
>  {
>  	static struct switches cmd[] = {
> +		{ "param", handle_param },
>  		{ "version", handle_version },
>  		{ NULL, NULL }
>  	};
> -- 
> 2.0.0
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] lib.c: skip --param parameters
Date: Mon, 16 Jun 2014 16:02:38 +0000
Message-ID: <20140616160238.GA2746 () jtriplet-mobl1>
--------------------
On Mon, Jun 16, 2014 at 01:43:06PM +0300, Andy Shevchenko wrote:
> Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> newest Linux kernel buildsystem.
> 
> Actually the option is present in few GCC versions and probably should be
> handled properly.
> 
> Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>

As far as I can tell, this seems to only handle "--param arg"; however,
according to the thread on LKML, GCC handles --param=arg as well.  Could
you please handle that variant too?

>  lib.c | 7 +++++++
>  1 file changed, 7 insertions(+)
> 
> diff --git a/lib.c b/lib.c
> index bf3e91c..e56037b 100644
> --- a/lib.c
> +++ b/lib.c
> @@ -673,6 +673,12 @@ static char **handle_version(char *arg, char **next)
>  	exit(0);
>  }
>  
> +static char **handle_param(char *arg, char **next)
> +{
> +	++next;
> +	return ++next;
> +}
> +
>  struct switches {
>  	const char *name;
>  	char **(*fn)(char *, char **);
> @@ -681,6 +687,7 @@ struct switches {
>  static char **handle_long_options(char *arg, char **next)
>  {
>  	static struct switches cmd[] = {
> +		{ "param", handle_param },
>  		{ "version", handle_version },
>  		{ NULL, NULL }
>  	};
> -- 
> 2.0.0
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: David Rientjes <rientjes () google ! com>
To: linux-kernel
Subject: Re: [PATCH] lib.c: skip --param parameters
Date: Mon, 16 Jun 2014 23:48:51 +0000
Message-ID: <alpine.DEB.2.02.1406161647510.21018 () chino ! kir ! corp ! google ! com>
--------------------
On Mon, 16 Jun 2014, Josh Triplett wrote:

> On Mon, Jun 16, 2014 at 01:43:06PM +0300, Andy Shevchenko wrote:
> > Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> > newest Linux kernel buildsystem.
> > 
> > Actually the option is present in few GCC versions and probably should be
> > handled properly.
> > 
> > Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
> 
> As far as I can tell, this seems to only handle "--param arg"; however,
> according to the thread on LKML, GCC handles --param=arg as well.  Could
> you please handle that variant too?
> 

This is only from linux-next and not Linus's tree, correct?

Is this still necessary since the "./Makefile: tell gcc optimizer to never 
introduce new data races" patch has been removed from -mm due to failures?

See http://marc.info/?l=linux-mm-commits&m=140295825623471

> >  lib.c | 7 +++++++
> >  1 file changed, 7 insertions(+)
> > 
> > diff --git a/lib.c b/lib.c
> > index bf3e91c..e56037b 100644
> > --- a/lib.c
> > +++ b/lib.c
> > @@ -673,6 +673,12 @@ static char **handle_version(char *arg, char **next)
> >  	exit(0);
> >  }
> >  
> > +static char **handle_param(char *arg, char **next)
> > +{
> > +	++next;
> > +	return ++next;
> > +}
> > +
> >  struct switches {
> >  	const char *name;
> >  	char **(*fn)(char *, char **);
> > @@ -681,6 +687,7 @@ struct switches {
> >  static char **handle_long_options(char *arg, char **next)
> >  {
> >  	static struct switches cmd[] = {
> > +		{ "param", handle_param },
> >  		{ "version", handle_version },
> >  		{ NULL, NULL }
> >  	};
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] lib.c: skip --param parameters
Date: Tue, 17 Jun 2014 02:36:48 +0000
Message-ID: <20140617023648.GA5961 () thin>
--------------------
On Mon, Jun 16, 2014 at 04:48:51PM -0700, David Rientjes wrote:
> On Mon, 16 Jun 2014, Josh Triplett wrote:
> 
> > On Mon, Jun 16, 2014 at 01:43:06PM +0300, Andy Shevchenko wrote:
> > > Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> > > newest Linux kernel buildsystem.
> > > 
> > > Actually the option is present in few GCC versions and probably should be
> > > handled properly.
> > > 
> > > Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
> > 
> > As far as I can tell, this seems to only handle "--param arg"; however,
> > according to the thread on LKML, GCC handles --param=arg as well.  Could
> > you please handle that variant too?
> > 
> 
> This is only from linux-next and not Linus's tree, correct?
> 
> Is this still necessary since the "./Makefile: tell gcc optimizer to never 
> introduce new data races" patch has been removed from -mm due to failures?
> 
> See http://marc.info/?l=linux-mm-commits&m=140295825623471

I'd still like to see Sparse not choke on the option, in either form,
whether the kernel ends up using it or not.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Andy Shevchenko <andriy.shevchenko () linux ! intel ! com>
To: linux-kernel
Subject: Re: [PATCH] lib.c: skip --param parameters
Date: Tue, 17 Jun 2014 08:15:58 +0000
Message-ID: <1402992958.3796.69.camel () smile ! fi ! intel ! com>
--------------------
On Mon, 2014-06-16 at 09:02 -0700, Josh Triplett wrote:
> On Mon, Jun 16, 2014 at 01:43:06PM +0300, Andy Shevchenko wrote:
> > Very dumb patch to just skip --param allow-store-data-races=0 introduced in
> > newest Linux kernel buildsystem.
> > 
> > Actually the option is present in few GCC versions and probably should be
> > handled properly.
> > 
> > Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
> 
> As far as I can tell, this seems to only handle "--param arg"; however,
> according to the thread on LKML, GCC handles --param=arg as well.  Could
> you please handle that variant too?

Yes, I will in v2.

> 
> >  lib.c | 7 +++++++
> >  1 file changed, 7 insertions(+)
> > 
> > diff --git a/lib.c b/lib.c
> > index bf3e91c..e56037b 100644
> > --- a/lib.c
> > +++ b/lib.c
> > @@ -673,6 +673,12 @@ static char **handle_version(char *arg, char **next)
> >  	exit(0);
> >  }
> >  
> > +static char **handle_param(char *arg, char **next)
> > +{
> > +	++next;
> > +	return ++next;
> > +}
> > +
> >  struct switches {
> >  	const char *name;
> >  	char **(*fn)(char *, char **);
> > @@ -681,6 +687,7 @@ struct switches {
> >  static char **handle_long_options(char *arg, char **next)
> >  {
> >  	static struct switches cmd[] = {
> > +		{ "param", handle_param },
> >  		{ "version", handle_version },
> >  		{ NULL, NULL }
> >  	};
> > -- 
> > 2.0.0
> > 
> > --
> > To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> > the body of a message to majordomo@vger.kernel.org
> > More majordomo info at  http://vger.kernel.org/majordomo-info.html


-- 
Andy Shevchenko <andriy.shevchenko@intel.com>
Intel Finland Oy

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH] parse.c: remove duplicate 'may_alias' ignored_attributes ===

From: Ramsay Jones <ramsay () ramsay1 ! demon ! co ! uk>
To: linux-sparse
Subject: [PATCH] parse.c: remove duplicate 'may_alias' ignored_attributes
Date: Mon, 04 Aug 2014 20:01:41 +0000
Message-ID: <53DFE6A5.2070903 () ramsay1 ! demon ! co ! uk>
--------------------

Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>
---

Hi Chris,

I noticed this recently when rebasing an old branch, but forgot
to write a patch.

ATB,
Ramsay Jones

 parse.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/parse.c b/parse.c
index 69bcf82..471fb31 100644
--- a/parse.c
+++ b/parse.c
@@ -548,8 +548,6 @@ const char *ignored_attributes[] = {
 	"__l1_data__",
 	"l2",
 	"__l2__",
-	"may_alias",
-	"__may_alias__",
 	"malloc",
 	"__malloc__",
 	"may_alias",
-- 
2.0.0
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] parse.c: remove duplicate 'may_alias' ignored_attributes
Date: Tue, 05 Aug 2014 16:43:49 +0000
Message-ID: <20140805164348.GC3146 () thin>
--------------------
On Mon, Aug 04, 2014 at 09:01:41PM +0100, Ramsay Jones wrote:
> Signed-off-by: Ramsay Jones <ramsay@ramsay1.demon.co.uk>

Reviewed-by: Josh Triplett <josh@joshtriplett.org>

Ironic attribute to duplicate.  Apparently may_alias may alias.

> Hi Chris,
> 
> I noticed this recently when rebasing an old branch, but forgot
> to write a patch.
> 
> ATB,
> Ramsay Jones
> 
>  parse.c | 2 --
>  1 file changed, 2 deletions(-)
> 
> diff --git a/parse.c b/parse.c
> index 69bcf82..471fb31 100644
> --- a/parse.c
> +++ b/parse.c
> @@ -548,8 +548,6 @@ const char *ignored_attributes[] = {
>  	"__l1_data__",
>  	"l2",
>  	"__l2__",
> -	"may_alias",
> -	"__may_alias__",
>  	"malloc",
>  	"__malloc__",
>  	"may_alias",
> -- 
> 2.0.0
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] parse: support c99 [static ...] in abstract array declarators ===

From: Cody P Schafer <cody () linux ! vnet ! ibm ! com>
To: linux-sparse
Subject: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Tue, 15 Apr 2014 23:08:57 +0000
Message-ID: <1397603337-28016-1-git-send-email-cody () linux ! vnet ! ibm ! com>
--------------------
Makes sparse a little more accepting than the standard: we accept any
number of ["static", "restrict"] repeated in any order, while the n1570
specifies (in 6.7.6.2.3) that either type-qualifiers (ie: "restrict")
come first and are followed by "static" or the opposite ("static" then
type-qualifiers).

Also add a test.

Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>
---
 ident-list.h                                  | 1 +
 parse.c                                       | 2 +-
 validation/abstract-array-declarator-static.c | 6 ++++++
 3 files changed, 8 insertions(+), 1 deletion(-)
 create mode 100644 validation/abstract-array-declarator-static.c

diff --git a/ident-list.h b/ident-list.h
index e93aae7..c0fc18f 100644
--- a/ident-list.h
+++ b/ident-list.h
@@ -91,6 +91,7 @@ IDENT(artificial); IDENT(__artificial__);
 IDENT(leaf); IDENT(__leaf__);
 IDENT(vector_size); IDENT(__vector_size__);
 IDENT(error); IDENT(__error__);
+IDENT(static);
 
 
 /* Preprocessor idents.  Direct use of __IDENT avoids mentioning the keyword
diff --git a/parse.c b/parse.c
index 9cc5f65..cbe3af4 100644
--- a/parse.c
+++ b/parse.c
@@ -1532,7 +1532,7 @@ static struct token *abstract_array_declarator(struct token *token, struct symbo
 {
 	struct expression *expr = NULL;
 
-	if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
+	while (match_idents(token, &restrict_ident, &__restrict_ident, &static_ident, NULL))
 		token = token->next;
 	token = parse_expression(token, &expr);
 	sym->array_size = expr;
diff --git a/validation/abstract-array-declarator-static.c b/validation/abstract-array-declarator-static.c
new file mode 100644
index 0000000..23cbae0
--- /dev/null
+++ b/validation/abstract-array-declarator-static.c
@@ -0,0 +1,6 @@
+
+extern void f(int g[static 1]);
+
+/*
+ * check-name: abstract array declarator static
+ */
-- 
1.9.2

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Thu, 17 Apr 2014 00:12:34 +0000
Message-ID: <20140417001234.GA18426 () leaf>
--------------------
On Tue, Apr 15, 2014 at 04:08:57PM -0700, Cody P Schafer wrote:
> Makes sparse a little more accepting than the standard: we accept any
> number of ["static", "restrict"] repeated in any order, while the n1570
> specifies (in 6.7.6.2.3) that either type-qualifiers (ie: "restrict")
> come first and are followed by "static" or the opposite ("static" then
> type-qualifiers).
> 
> Also add a test.
> 
> Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>

What's the rationale for this?  Why should sparse accept more than the
standard allows?  What real-world code do you have that requires this?

And would it be worth adding a warning for this non-standards-compliant
code, even if that warning isn't on by default?

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Cody P Schafer <cody () linux ! vnet ! ibm ! com>
To: linux-sparse
Subject: Re: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Thu, 17 Apr 2014 03:50:23 +0000
Message-ID: <534F4F7F.5020506 () linux ! vnet ! ibm ! com>
--------------------
On 04/16/2014 05:12 PM, Josh Triplett wrote:
> On Tue, Apr 15, 2014 at 04:08:57PM -0700, Cody P Schafer wrote:
>> Makes sparse a little more accepting than the standard: we accept any
>> number of ["static", "restrict"] repeated in any order, while the n1570
>> specifies (in 6.7.6.2.3) that either type-qualifiers (ie: "restrict")
>> come first and are followed by "static" or the opposite ("static" then
>> type-qualifiers).
>>
>> Also add a test.
>>
>> Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>
>
> What's the rationale for this?  Why should sparse accept more than the
> standard allows?  What real-world code do you have that requires this?
>
> And would it be worth adding a warning for this non-standards-compliant
> code, even if that warning isn't on by default?

I could have sparse be just as strict as the standard, it just was just 
(much) simpler to make it liberal in what it accepts. If you're fine 
with some more verbose code, I'll put together something that is stricter.

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Thu, 17 Apr 2014 05:09:14 +0000
Message-ID: <20140417050914.GA21150 () leaf>
--------------------
On Wed, Apr 16, 2014 at 08:50:23PM -0700, Cody P Schafer wrote:
> On 04/16/2014 05:12 PM, Josh Triplett wrote:
> >On Tue, Apr 15, 2014 at 04:08:57PM -0700, Cody P Schafer wrote:
> >>Makes sparse a little more accepting than the standard: we accept any
> >>number of ["static", "restrict"] repeated in any order, while the n1570
> >>specifies (in 6.7.6.2.3) that either type-qualifiers (ie: "restrict")
> >>come first and are followed by "static" or the opposite ("static" then
> >>type-qualifiers).
> >>
> >>Also add a test.
> >>
> >>Signed-off-by: Cody P Schafer <cody@linux.vnet.ibm.com>
> >
> >What's the rationale for this?  Why should sparse accept more than the
> >standard allows?  What real-world code do you have that requires this?
> >
> >And would it be worth adding a warning for this non-standards-compliant
> >code, even if that warning isn't on by default?
> 
> I could have sparse be just as strict as the standard, it just was just
> (much) simpler to make it liberal in what it accepts. If you're fine with
> some more verbose code, I'll put together something that is stricter.

I'd suggest trying to match the standard in this case, or failing that
match what GCC does.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Thu, 17 Apr 2014 06:50:15 +0000
Message-ID: <CANeU7Q=qfD=fpP1k1gHpUxek4ZUuau3drCDncYr5eE18Xiq4Zw () mail ! gmail ! com>
--------------------
On Wed, Apr 16, 2014 at 10:09 PM, Josh Triplett <josh@joshtriplett.org> wrote:
>> I could have sparse be just as strict as the standard, it just was just
>> (much) simpler to make it liberal in what it accepts. If you're fine with
>> some more verbose code, I'll put together something that is stricter.
>
> I'd suggest trying to match the standard in this case, or failing that
> match what GCC does.

I second that. It does not seem too complicate to make sparse accept
"static" in two possible position.

Here is a purpose patch with limited test. I expand the test to cover
more static test case.

Cody, does this patch work for you?

Chris

diff --git a/parse.c b/parse.c
index 70553f2..76aba40 100644
--- a/parse.c
+++ b/parse.c
@@ -1533,12 +1533,28 @@ static struct token
*declaration_specifiers(struct token *tok
        return token;
 }

+static struct token *abstract_array_static_declarator(struct token
*token, int *has_
+{
+       while (token->ident == &static_ident) {
+               if (*has_static)
+                       warning(token->pos, "duplicate array static
declarator");
+
+               *has_static = 1;
+               token = token->next;
+       }
+       return token;
+
+}
+
 static struct token *abstract_array_declarator(struct token *token,
struct symbol *s
 {
        struct expression *expr = NULL;
+       int has_static = 0;

-       while (match_idents(token, &restrict_ident, &__restrict_ident,
&static_ident,
-               token = token->next;
+       token = abstract_array_static_declarator(token, &has_static);
+
+       if (match_idents(token, &restrict_ident, &__restrict_ident, NULL))
+               token = abstract_array_static_declarator(token->next,
&has_static);
        token = parse_expression(token, &expr);
        sym->array_size = expr;
        return token;
diff --git a/validation/abstract-array-declarator-static.c
b/validation/abstract-arra
index 23cbae0..b0af17b 100644
--- a/validation/abstract-array-declarator-static.c
+++ b/validation/abstract-array-declarator-static.c
@@ -1,6 +1,14 @@

-extern void f(int g[static 1]);
+extern void f1(int g[static 1]);
+extern void f2(int g[static restrict 1]);
+extern void f3(int g[restrict static 1]);
+extern void f4(int g[static restrict static 1]);       /* duplicate
static error */
+extern void f5(int g[restrict static static 1]);       /* duplicate
static error */

 /*
  * check-name: abstract array declarator static
+ * check-error-start
+abstract-array-declarator-static.c:5:38: warning: duplicate array
static declarator
+abstract-array-declarator-static.c:6:38: warning: duplicate array
static declarator
+ * check-error-end
  */
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Fri, 18 Apr 2014 05:52:59 +0000
Message-ID: <CANeU7Qn-CV1Raae1-E03tJCDidzV8tshwjE8M+JCh3r70zXokw () mail ! gmail ! com>
--------------------
On Wed, Apr 16, 2014 at 11:50 PM, Christopher Li <sparse@chrisli.org> wrote:

> Here is a purpose patch with limited test. I expand the test to cover
> more static test case.
>
> Cody, does this patch work for you?

I apply the patch and push it out.

Please let me know if it breaks any thing.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Cody P Schafer <cody () linux ! vnet ! ibm ! com>
To: linux-sparse
Subject: Re: [PATCH] parse: support c99 [static ...] in abstract array declarators
Date: Mon, 21 Apr 2014 16:43:12 +0000
Message-ID: <53554AA0.2070903 () linux ! vnet ! ibm ! com>
--------------------
On 04/17/2014 10:52 PM, Christopher Li wrote:
> On Wed, Apr 16, 2014 at 11:50 PM, Christopher Li <sparse@chrisli.org> wrote:
>
>> Here is a purpose patch with limited test. I expand the test to cover
>> more static test case.
>>
>> Cody, does this patch work for you?
>
> I apply the patch and push it out.
>
> Please let me know if it breaks any thing.
>

Looks fine to me Chris, thanks for putting this together.

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sched: Remove nested extern ===

From: Mark D Rustad <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 17:55:11 +0000
Message-ID: <20140922175511.62229.98784.stgit () mdrustad-wks ! jf ! intel ! com>
--------------------
Avoid W=2 nested-externs warning by moving the nested extern to
a normal extern. This eliminates that warning which is generated
for every inclusion of sched.h in a kernel build when W=2 is used.
This also removes a point of maintenance if the definition of
delayacct_on were ever to change.

Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
---
 include/linux/delayacct.h |    1 -
 include/linux/sched.h     |    3 ++-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/include/linux/delayacct.h b/include/linux/delayacct.h
index 6cee17c22313..51229790af00 100644
--- a/include/linux/delayacct.h
+++ b/include/linux/delayacct.h
@@ -30,7 +30,6 @@
 
 #ifdef CONFIG_TASK_DELAY_ACCT
 
-extern int delayacct_on;	/* Delay accounting turned on/off */
 extern struct kmem_cache *delayacct_cache;
 extern void delayacct_init(void);
 extern void __delayacct_tsk_init(struct task_struct *);
diff --git a/include/linux/sched.h b/include/linux/sched.h
index 5c2c885ee52b..1f1dcfdcd92c 100644
--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -825,6 +825,8 @@ struct task_delay_info {
 	u64 freepages_delay;	/* wait for memory reclaim */
 	u32 freepages_count;	/* total count of memory reclaim */
 };
+
+extern int delayacct_on;	/* Delay accounting turned on/off */
 #endif	/* CONFIG_TASK_DELAY_ACCT */
 
 static inline int sched_info_on(void)
@@ -832,7 +834,6 @@ static inline int sched_info_on(void)
 #ifdef CONFIG_SCHEDSTATS
 	return 1;
 #elif defined(CONFIG_TASK_DELAY_ACCT)
-	extern int delayacct_on;
 	return delayacct_on;
 #else
 	return 0;

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Mark D Rustad <mark.d.rustad () intel ! com>
To: linux-sparse
Subject: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 17:55:11 +0000
Message-ID: <20140922175511.62229.98784.stgit () mdrustad-wks ! jf ! intel ! com>
--------------------
Avoid W=2 nested-externs warning by moving the nested extern to
a normal extern. This eliminates that warning which is generated
for every inclusion of sched.h in a kernel build when W=2 is used.
This also removes a point of maintenance if the definition of
delayacct_on were ever to change.

Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
---
 include/linux/delayacct.h |    1 -
 include/linux/sched.h     |    3 ++-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/include/linux/delayacct.h b/include/linux/delayacct.h
index 6cee17c22313..51229790af00 100644
--- a/include/linux/delayacct.h
+++ b/include/linux/delayacct.h
@@ -30,7 +30,6 @@
 
 #ifdef CONFIG_TASK_DELAY_ACCT
 
-extern int delayacct_on;	/* Delay accounting turned on/off */
 extern struct kmem_cache *delayacct_cache;
 extern void delayacct_init(void);
 extern void __delayacct_tsk_init(struct task_struct *);
diff --git a/include/linux/sched.h b/include/linux/sched.h
index 5c2c885ee52b..1f1dcfdcd92c 100644
--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -825,6 +825,8 @@ struct task_delay_info {
 	u64 freepages_delay;	/* wait for memory reclaim */
 	u32 freepages_count;	/* total count of memory reclaim */
 };
+
+extern int delayacct_on;	/* Delay accounting turned on/off */
 #endif	/* CONFIG_TASK_DELAY_ACCT */
 
 static inline int sched_info_on(void)
@@ -832,7 +834,6 @@ static inline int sched_info_on(void)
 #ifdef CONFIG_SCHEDSTATS
 	return 1;
 #elif defined(CONFIG_TASK_DELAY_ACCT)
-	extern int delayacct_on;
 	return delayacct_on;
 #else
 	return 0;

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 18:25:44 +0000
Message-ID: <20140922182544.GA27107 () thin>
--------------------
On Mon, Sep 22, 2014 at 10:55:11AM -0700, Mark D Rustad wrote:
> Avoid W=2 nested-externs warning by moving the nested extern to
> a normal extern. This eliminates that warning which is generated
> for every inclusion of sched.h in a kernel build when W=2 is used.
> This also removes a point of maintenance if the definition of
> delayacct_on were ever to change.
> 
> Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>

This seems sensible, and makes much more sense than wrapping the extern
in a directive to disable warnings.

Reviewed-by: Josh Triplett <josh@joshtriplett.org>

>  include/linux/delayacct.h |    1 -
>  include/linux/sched.h     |    3 ++-
>  2 files changed, 2 insertions(+), 2 deletions(-)
> 
> diff --git a/include/linux/delayacct.h b/include/linux/delayacct.h
> index 6cee17c22313..51229790af00 100644
> --- a/include/linux/delayacct.h
> +++ b/include/linux/delayacct.h
> @@ -30,7 +30,6 @@
>  
>  #ifdef CONFIG_TASK_DELAY_ACCT
>  
> -extern int delayacct_on;	/* Delay accounting turned on/off */
>  extern struct kmem_cache *delayacct_cache;
>  extern void delayacct_init(void);
>  extern void __delayacct_tsk_init(struct task_struct *);
> diff --git a/include/linux/sched.h b/include/linux/sched.h
> index 5c2c885ee52b..1f1dcfdcd92c 100644
> --- a/include/linux/sched.h
> +++ b/include/linux/sched.h
> @@ -825,6 +825,8 @@ struct task_delay_info {
>  	u64 freepages_delay;	/* wait for memory reclaim */
>  	u32 freepages_count;	/* total count of memory reclaim */
>  };
> +
> +extern int delayacct_on;	/* Delay accounting turned on/off */
>  #endif	/* CONFIG_TASK_DELAY_ACCT */
>  
>  static inline int sched_info_on(void)
> @@ -832,7 +834,6 @@ static inline int sched_info_on(void)
>  #ifdef CONFIG_SCHEDSTATS
>  	return 1;
>  #elif defined(CONFIG_TASK_DELAY_ACCT)
> -	extern int delayacct_on;
>  	return delayacct_on;
>  #else
>  	return 0;
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 19:01:28 +0000
Message-ID: <20140922190128.GA2805 () worktop ! programming ! kicks-ass ! net>
--------------------
On Mon, Sep 22, 2014 at 10:55:11AM -0700, Mark D Rustad wrote:
> Avoid W=2 nested-externs warning by moving the nested extern to
> a normal extern. This eliminates that warning which is generated
> for every inclusion of sched.h in a kernel build when W=2 is used.
> This also removes a point of maintenance if the definition of
> delayacct_on were ever to change.
> 

Yeah, so why is that warning worth using? Just disable the warn if
you're bothered by it.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 19:32:04 +0000
Message-ID: <D428C53D-F663-4846-ACAB-74922033B048 () intel ! com>
--------------------
--Apple-Mail=_8CCC8EA9-24BF-4637-A31E-5A11B69304C9
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=us-ascii

On Sep 22, 2014, at 12:01 PM, Peter Zijlstra <peterz@infradead.org> wrote:

> On Mon, Sep 22, 2014 at 10:55:11AM -0700, Mark D Rustad wrote:
>> Avoid W=2 nested-externs warning by moving the nested extern to
>> a normal extern. This eliminates that warning which is generated
>> for every inclusion of sched.h in a kernel build when W=2 is used.
>> This also removes a point of maintenance if the definition of
>> delayacct_on were ever to change.
> 
> Yeah, so why is that warning worth using? Just disable the warn if
> you're bothered by it.

I assume that nested-externs is included in W=2 because many uses of
them, especially with function prototypes, creates a risk of inconsistent
declarations. The kernel has a fair number of them that seem to have
been added to disentangle include files. If they are judged to be
worthwhile, then it would be good to silence the warnings so that
attention can be given to other instances of the warnings. If those
nested externs are not worth the risk, well that is a different conversation.

-- 
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_8CCC8EA9-24BF-4637-A31E-5A11B69304C9
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUIHkzAAoJEDwO/+eO4+5u45wP/11SArEWtpADJbQnAfcGPBR3
qlryiWpF9e5hqj55QFSFIcg+Ff9KxGKo0tq2ZwxAY4oA+46J09TuvsAtEzHrIo+v
My+e5l9ToMbEk7/PjUGVw/Xl/0pgFMQ50trPkHQyG0VJezjKfJAzM2TKmJCqYpt8
croy6C9spXlajEcLnN67XWgUsAz02y+m/kKwZEpYQKzqg+aaC7Qm811AgxXdFZ0y
Oft1t+DmA+RQXi1Dgn6jI3LPlH02Y10fiubSbAe2uEAvcj9A4lqXli9PIe37Rr3o
urSTWwWgidMz43ZHAznRZIknTXOKQq9l8O7JqvejfOEP9J/HsD9Yg5/Xmo5Wvgm+
5QGKjtTqcEH2zG4vhAmHxkwOjPQwaDZTrEiWraacrlFp1znfW2U43qzMqcPQ0vme
2khFZdfaZI2jqi80BMb6sYuYdO36kV5UKilCfGjo3NNjZvXt/rzey2nSHXhvLFS4
kPINyajdqp8k1UBOW/902WST5ljWipdaV2QAfsLC7QH372Gc+f8A/08xv8xio+Uc
Frmmy4Kk2VjdSgJcAdUoJwD2YLUnFBXEcIrUO546xsu/ELLfAGTXcCcSbcp2pksX
WrKdJNGbebB707ezrVc6Tq3lrft2qX7JJ2/rXaSMOFNPdr1BmDhO39aliiPSynGZ
0PSiRgJwmg1v/hQBOA7Z
=B3pP
-----END PGP SIGNATURE-----

--Apple-Mail=_8CCC8EA9-24BF-4637-A31E-5A11B69304C9--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 20:05:27 +0000
Message-ID: <20140922200527.GA3128 () worktop ! programming ! kicks-ass ! net>
--------------------
On Mon, Sep 22, 2014 at 07:32:04PM +0000, Rustad, Mark D wrote:
> On Sep 22, 2014, at 12:01 PM, Peter Zijlstra <peterz@infradead.org> wrote:
> 
> > On Mon, Sep 22, 2014 at 10:55:11AM -0700, Mark D Rustad wrote:
> >> Avoid W=2 nested-externs warning by moving the nested extern to
> >> a normal extern. This eliminates that warning which is generated
> >> for every inclusion of sched.h in a kernel build when W=2 is used.
> >> This also removes a point of maintenance if the definition of
> >> delayacct_on were ever to change.
> > 
> > Yeah, so why is that warning worth using? Just disable the warn if
> > you're bothered by it.
> 
> I assume that nested-externs is included in W=2 because many uses of
> them, especially with function prototypes, creates a risk of inconsistent
> declarations. The kernel has a fair number of them that seem to have
> been added to disentangle include files. If they are judged to be
> worthwhile, then it would be good to silence the warnings so that
> attention can be given to other instances of the warnings. If those
> nested externs are not worth the risk, well that is a different conversation.

So would using something like LTO not be way better at actually finding
the problems, seeing how it can actually see the inconsistency in
declarations.

It seems to me that banning the use of nested extern is misguided as
they are a useful tool; they provide some means of keeping symbols from
being globally visible even though they actually are. Its a really poor
man's 'private', but its the best C provides.

Also, why do you care about W=2 nonsense anyhow? They're default
disabled for a reason.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-kernel
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 20:05:27 +0000
Message-ID: <20140922200527.GA3128 () worktop ! programming ! kicks-ass ! net>
--------------------
On Mon, Sep 22, 2014 at 07:32:04PM +0000, Rustad, Mark D wrote:
> On Sep 22, 2014, at 12:01 PM, Peter Zijlstra <peterz@infradead.org> wrote:
> 
> > On Mon, Sep 22, 2014 at 10:55:11AM -0700, Mark D Rustad wrote:
> >> Avoid W=2 nested-externs warning by moving the nested extern to
> >> a normal extern. This eliminates that warning which is generated
> >> for every inclusion of sched.h in a kernel build when W=2 is used.
> >> This also removes a point of maintenance if the definition of
> >> delayacct_on were ever to change.
> > 
> > Yeah, so why is that warning worth using? Just disable the warn if
> > you're bothered by it.
> 
> I assume that nested-externs is included in W=2 because many uses of
> them, especially with function prototypes, creates a risk of inconsistent
> declarations. The kernel has a fair number of them that seem to have
> been added to disentangle include files. If they are judged to be
> worthwhile, then it would be good to silence the warnings so that
> attention can be given to other instances of the warnings. If those
> nested externs are not worth the risk, well that is a different conversation.

So would using something like LTO not be way better at actually finding
the problems, seeing how it can actually see the inconsistency in
declarations.

It seems to me that banning the use of nested extern is misguided as
they are a useful tool; they provide some means of keeping symbols from
being globally visible even though they actually are. Its a really poor
man's 'private', but its the best C provides.

Also, why do you care about W=2 nonsense anyhow? They're default
disabled for a reason.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 20:59:32 +0000
Message-ID: <D3423D3A-814F-4E22-A84B-61D76D137A98 () intel ! com>
--------------------
--Apple-Mail=_55C4654D-914A-40A7-AA3A-D0D0CB6FF672
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 22, 2014, at 1:05 PM, Peter Zijlstra <peterz@infradead.org> =
wrote:

> On Mon, Sep 22, 2014 at 07:32:04PM +0000, Rustad, Mark D wrote:
>> I assume that nested-externs is included in W=3D2 because many uses =
of
>> them, especially with function prototypes, creates a risk of =
inconsistent
>> declarations. The kernel has a fair number of them that seem to have
>> been added to disentangle include files. If they are judged to be
>> worthwhile, then it would be good to silence the warnings so that
>> attention can be given to other instances of the warnings. If those
>> nested externs are not worth the risk, well that is a different =
conversation.
>=20
> So would using something like LTO not be way better at actually =
finding
> the problems, seeing how it can actually see the inconsistency in
> declarations.
>=20
> It seems to me that banning the use of nested extern is misguided as
> they are a useful tool; they provide some means of keeping symbols =
from
> being globally visible even though they actually are. Its a really =
poor
> man's 'private', but its the best C provides.

By using the macros the use of nested externs can be discouraged without
being banned. Presence of a DIAG_IGNORE macro should mean that the =
exception
has been noted and accepted. And the macro remains as an indicator of =
that.
Or to be taken as a warning label: readers choice perhaps.

> Also, why do you care about W=3D2 nonsense anyhow? They're default
> disabled for a reason.

Because I have found that enabling many warnings helps identify problems
in code and it has been my standard practice since about 1999 to do so.
The compiler warnings are really just another form of static analysis,
and I use it routinely on every compile. Here is how routinely: I have
W=3D1 in my environment, W=3D12 is just too painful. I would change that
default to W=3D12 if it wasn't insane to do so.

In my own code, I use way more warnings than even W=3D12 enables and in
that code I just resolve them. I had never resorted to using the =
attributes
in my own code, but they are an available tool.

I just finally thought it might be time to consider opening up a new
method to manage them for the kernel.

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_55C4654D-914A-40A7-AA3A-D0D0CB6FF672
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUII20AAoJEDwO/+eO4+5usBoQAIS8VsZExOmae1m1mEHxcu03
ww7KWYbJ4vBTQBEjd+LDlEE7rjflSZaEWs9ibkVhDgrm2pyplnW8eqhKX8lR01Rl
BPaO5643N1f28U8VzughgwXWoJ1a4ydyIswdTKf/v8pe4lW2mU4C9qEY/5W+Lxs2
qIXWRNzAIZgrgXKs/rE4JsfPIYTMBwey8KviTu7EmzIDiujgShEwu5M0ti/uju2Y
c/42NLUyqzKAkC2/WvKkTed9/h2um/SYm/Iuw24M3syByM6qy3dgygKcqz9Lp7Gf
G4jHKyGC32txUnCYOYmMdvTWYOJlXSNcb0cmuoqxOipIXg6ZIrG3Ol/tu0pcLLTh
8BPwDBXjqWiLPXkxsv4W1kz0vROnX73Rz5xxKDff9z2HsbQ//Hii3htEsndtwrz0
Y2sPoEAK4LqB+91Ruy8vI6VqVYb8Cd0C5igljPzGui1lGE2CDQ+nB2Qg0RWaSm9O
5f2+AKOE/5i+u5S3P8jlRPEzGmA4r9UTP6OyjHWaVbBRdPNCjLwcMnAPgJUt4QDZ
67cZuterm8+/dIhrE6iiN7nUNdar9CCheRWnSYJUvd0oF7P8xhKFLgA0ZHEBPQ7h
peWKMByFtAsK3Aeb+D/ACDK7hDPYrUVnTCbTv/KSU/PVFNy4f7LF3kpiVXq7nW7v
plpY4VpMCxPkaIfwbYtx
=bjvd
-----END PGP SIGNATURE-----

--Apple-Mail=_55C4654D-914A-40A7-AA3A-D0D0CB6FF672--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-kernel
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 21:21:05 +0000
Message-ID: <20140922212105.GD3128 () worktop ! programming ! kicks-ass ! net>
--------------------
On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
> Because I have found that enabling many warnings helps identify problems
> in code and it has been my standard practice since about 1999 to do so.
> The compiler warnings are really just another form of static analysis,
> and I use it routinely on every compile. Here is how routinely: I have
> W=1 in my environment, W=12 is just too painful. I would change that
> default to W=12 if it wasn't insane to do so.

Many warnings are just plain insane and stupid. They're not helping
anybody. There's a very good reason many are disabled. I'm sure you can
find some entertaining discussions on the topic if you search the LKML
archives.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 21:21:05 +0000
Message-ID: <20140922212105.GD3128 () worktop ! programming ! kicks-ass ! net>
--------------------
On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
> Because I have found that enabling many warnings helps identify problems
> in code and it has been my standard practice since about 1999 to do so.
> The compiler warnings are really just another form of static analysis,
> and I use it routinely on every compile. Here is how routinely: I have
> W=1 in my environment, W=12 is just too painful. I would change that
> default to W=12 if it wasn't insane to do so.

Many warnings are just plain insane and stupid. They're not helping
anybody. There's a very good reason many are disabled. I'm sure you can
find some entertaining discussions on the topic if you search the LKML
archives.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "Rustad, Mark D" <mark.d.rustad () intel ! com>
To: linux-kernel
Subject: Re: [PATCH] sched: Remove nested extern
Date: Mon, 22 Sep 2014 21:50:44 +0000
Message-ID: <9C9DCC69-1F75-4241-A022-FFB9B6A11AC5 () intel ! com>
--------------------
--Apple-Mail=_18D117C2-F9E5-459C-A416-EC76765E82F7
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=us-ascii

On Sep 22, 2014, at 2:21 PM, Peter Zijlstra <peterz@infradead.org> =
wrote:

> On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
>> Because I have found that enabling many warnings helps identify =
problems
>> in code and it has been my standard practice since about 1999 to do =
so.
>> The compiler warnings are really just another form of static =
analysis,
>> and I use it routinely on every compile. Here is how routinely: I =
have
>> W=3D1 in my environment, W=3D12 is just too painful. I would change =
that
>> default to W=3D12 if it wasn't insane to do so.
>=20
> Many warnings are just plain insane and stupid. They're not helping
> anybody. There's a very good reason many are disabled. I'm sure you =
can
> find some entertaining discussions on the topic if you search the LKML
> archives.

That is what I used to think. -Wshadow for example. What's the problem? =
It
is perfectly valid C. Well, I recently sent a patch that changed some
function parameters that used the name jiffies, which of course shadowed
the well-known global. If a macro were ever called in those functions
whose expansion ever tried to access jiffies, well it wouldn't do what
was expected. Not a bug now, but a trap for the future. I only found =
that
because I either resolved or silenced enough warnings to see something =
interesting.

Over the years I think I have resolved real bugs revealed by probably =
nearly
every one of the additional warning messages. They do have value, but =
that
value is typically lost if the norm is a flood of messages. Apple would =
not
have had their SSL problem if they had had -Wunreachable-code enabled =
and
noticed the message.

--=20
Mark Rustad, Networking Division, Intel Corporation


--Apple-Mail=_18D117C2-F9E5-459C-A416-EC76765E82F7
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="signature.asc"
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Message signed with OpenPGP using GPGMail

-----BEGIN PGP SIGNATURE-----
Comment: GPGTools - http://gpgtools.org

iQIcBAEBAgAGBQJUIJm0AAoJEDwO/+eO4+5u1P8QAKfPs62HndTh+iCaza7BwvwH
6grUaidMoTs2DHPAM1/krZGB0s+TVKqvmlp3YL2QN+JX9qFxLmDyuSILQedJ1kO0
1mw/XTrLiS3g9ZFdM70R3yIPOc2FyiidbE4h5tjqw8GSa8MXpXu52Zv7YKpXDeAe
R3FV5AzWV6Gcq1NGwtKqG1tx79ebkXclDd5KIPQ4N291S+iv7+VDMH1dN5RpShmJ
+d+OieprfIdF+d2vLMQHfrYALyzsmvGzLGDpK6NV7N4V6CHTCNJwagogyM7ZT9kW
YQ9KBkZOiWtGseY2pShoFXMmfJjfbwhECkKNWbajMk9gCM9RYeqlkJm8z3QHReZA
jtU0WrBtmBqZEA/TDv8/fKK3SyE2FRSx97kw/5CAgiKp5B15/UE9tU0wAxt5Aqnn
VpQ9B3EBQY93T9eOA67svqvDpK7BEFXDKeYtl1u3/Gc5PNGT10/Smx3y9utykGZl
rbctZVZga3Jr8nVE4Qt4cdmFvWRdwoFAaEjQOuzIpMKcaP2/G2s8YUbE2E6jpQXA
vbsXMkHllcmkYq3hQ+4TQG9DsulcVQHUeYv2NK8F9Q6u6NN6992l/ypAJnxfNJ34
O+XA7vMFr/13elkdIdID5dwJeyBcHnsaRJr2fem74PEUv6fFZQYPZhF+dgWPwKVx
b8AP1mz0xoTqF0NmjPep
=scE2
-----END PGP SIGNATURE-----

--Apple-Mail=_18D117C2-F9E5-459C-A416-EC76765E82F7--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Ingo Molnar <mingo () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Wed, 24 Sep 2014 07:41:44 +0000
Message-ID: <20140924074144.GA3467 () gmail ! com>
--------------------

* Rustad, Mark D <mark.d.rustad@intel.com> wrote:

> On Sep 22, 2014, at 2:21 PM, Peter Zijlstra <peterz@infradead.org> wrote:
> 
> > On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
> >> Because I have found that enabling many warnings helps identify problems
> >> in code and it has been my standard practice since about 1999 to do so.
> >> The compiler warnings are really just another form of static analysis,
> >> and I use it routinely on every compile. Here is how routinely: I have
> >> W=1 in my environment, W=12 is just too painful. I would change that
> >> default to W=12 if it wasn't insane to do so.
> > 
> > Many warnings are just plain insane and stupid. They're not 
> > helping anybody. There's a very good reason many are 
> > disabled. I'm sure you can find some entertaining discussions 
> > on the topic if you search the LKML archives.
> 
> That is what I used to think. -Wshadow for example. What's the 
> problem? [...]

Then please add it to the default build. There are some warnings 
that used to be crap but have been improved over the year - 
enable them one by one, with good case by case justification and 
analysis. Just going after all W=2 warnings is insane.

Thanks,

	Ingo
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-kernel
Subject: Re: [PATCH] sched: Remove nested extern
Date: Wed, 24 Sep 2014 07:52:48 +0000
Message-ID: <20140924075248.GU16043 () twins ! programming ! kicks-ass ! net>
--------------------
On Wed, Sep 24, 2014 at 09:41:44AM +0200, Ingo Molnar wrote:
> 
> * Rustad, Mark D <mark.d.rustad@intel.com> wrote:
> 
> > On Sep 22, 2014, at 2:21 PM, Peter Zijlstra <peterz@infradead.org> wrote:
> > 
> > > On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
> > >> Because I have found that enabling many warnings helps identify problems
> > >> in code and it has been my standard practice since about 1999 to do so.
> > >> The compiler warnings are really just another form of static analysis,
> > >> and I use it routinely on every compile. Here is how routinely: I have
> > >> W=1 in my environment, W=12 is just too painful. I would change that
> > >> default to W=12 if it wasn't insane to do so.
> > > 
> > > Many warnings are just plain insane and stupid. They're not 
> > > helping anybody. There's a very good reason many are 
> > > disabled. I'm sure you can find some entertaining discussions 
> > > on the topic if you search the LKML archives.
> > 
> > That is what I used to think. -Wshadow for example. What's the 
> > problem? [...]
> 
> Then please add it to the default build. There are some warnings 
> that used to be crap but have been improved over the year - 
> enable them one by one, with good case by case justification and 
> analysis. Just going after all W=2 warnings is insane.

So I don't like the nested extern one because it either means not using
that language feature at all or pooping all over your code with that
DECL crap. That just a loose-loose proposition.
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Wed, 24 Sep 2014 07:52:48 +0000
Message-ID: <20140924075248.GU16043 () twins ! programming ! kicks-ass ! net>
--------------------
On Wed, Sep 24, 2014 at 09:41:44AM +0200, Ingo Molnar wrote:
> 
> * Rustad, Mark D <mark.d.rustad@intel.com> wrote:
> 
> > On Sep 22, 2014, at 2:21 PM, Peter Zijlstra <peterz@infradead.org> wrote:
> > 
> > > On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
> > >> Because I have found that enabling many warnings helps identify problems
> > >> in code and it has been my standard practice since about 1999 to do so.
> > >> The compiler warnings are really just another form of static analysis,
> > >> and I use it routinely on every compile. Here is how routinely: I have
> > >> W=1 in my environment, W=12 is just too painful. I would change that
> > >> default to W=12 if it wasn't insane to do so.
> > > 
> > > Many warnings are just plain insane and stupid. They're not 
> > > helping anybody. There's a very good reason many are 
> > > disabled. I'm sure you can find some entertaining discussions 
> > > on the topic if you search the LKML archives.
> > 
> > That is what I used to think. -Wshadow for example. What's the 
> > problem? [...]
> 
> Then please add it to the default build. There are some warnings 
> that used to be crap but have been improved over the year - 
> enable them one by one, with good case by case justification and 
> analysis. Just going after all W=2 warnings is insane.

So I don't like the nested extern one because it either means not using
that language feature at all or pooping all over your code with that
DECL crap. That just a loose-loose proposition.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ingo Molnar <mingo () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH] sched: Remove nested extern
Date: Wed, 24 Sep 2014 07:58:37 +0000
Message-ID: <20140924075837.GB3919 () gmail ! com>
--------------------

* Peter Zijlstra <peterz@infradead.org> wrote:

> On Wed, Sep 24, 2014 at 09:41:44AM +0200, Ingo Molnar wrote:
> > 
> > * Rustad, Mark D <mark.d.rustad@intel.com> wrote:
> > 
> > > On Sep 22, 2014, at 2:21 PM, Peter Zijlstra <peterz@infradead.org> wrote:
> > > 
> > > > On Mon, Sep 22, 2014 at 08:59:32PM +0000, Rustad, Mark D wrote:
> > > >> Because I have found that enabling many warnings helps identify problems
> > > >> in code and it has been my standard practice since about 1999 to do so.
> > > >> The compiler warnings are really just another form of static analysis,
> > > >> and I use it routinely on every compile. Here is how routinely: I have
> > > >> W=1 in my environment, W=12 is just too painful. I would change that
> > > >> default to W=12 if it wasn't insane to do so.
> > > > 
> > > > Many warnings are just plain insane and stupid. They're not 
> > > > helping anybody. There's a very good reason many are 
> > > > disabled. I'm sure you can find some entertaining discussions 
> > > > on the topic if you search the LKML archives.
> > > 
> > > That is what I used to think. -Wshadow for example. What's the 
> > > problem? [...]
> > 
> > Then please add it to the default build. There are some warnings 
> > that used to be crap but have been improved over the year - 
> > enable them one by one, with good case by case justification and 
> > analysis. Just going after all W=2 warnings is insane.

So by 'try to add it' I mean -Wshadow, which is a useful warning 
that I use in user-space projects as well: it does catch 
bogosities and isn't annoyingly inaccurate.

> So I don't like the nested extern one because it either means 
> not using that language feature at all or pooping all over your 
> code with that DECL crap. That just a loose-loose proposition.

Agreed.

Thanks,

	Ingo
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse-llvm: Fix LLVM 3.5 linker errors ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse-llvm: Fix LLVM 3.5 linker errors
Date: Thu, 25 Sep 2014 00:21:35 +0000
Message-ID: <CANeU7QnXEgjpDMTdL_JYY1T=GG5A_aP4+90ctTPbCsh8DokUyw () mail ! gmail ! com>
--------------------
On Thu, Sep 25, 2014 at 5:01 AM, Omar Sandoval <osandov@osandov.com> wrote:
> llvm-config 3.5 no longer lists the non-LLVM libraries needed for linkage when
> passed --libs. The --system-libs flag was added for this purpose. This adds
> these libraries while silently doing nothing for older versions of LLVM.

Thanks for the patch. It looks fine. Applied.

BTW, the patch did not apply cleanly for me. It has some conflict.
I can't see why it failed. Since it is just one line, I just paste it.

Please double check the tip of chrisl repository. I just push it.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Add CLOG option for saving warning ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: [PATCH] sparse: Add CLOG option for saving warning
Date: Mon, 30 Jun 2014 08:57:13 +0000
Message-ID: <CANeU7Q=a82YmUE49uZ1sOxZn0KGLuktSXuj7YsmUb=wXQEpPXA () mail ! gmail ! com>
--------------------
--001a113a76ca62b5ba04fd09d8a3
Content-Type: text/plain; charset=ISO-8859-1

Currently sparse warning only output to stderr.
In the parallel build process, different source
file output is fixed together. It is hard to keep
track of the warning.

Add the CLOG=<logname> option in command line to
save the sparse warning into individual log file.

Typical usage:

make -j8 C=2 CLOG=<logname>

The log file is saved in the target directory as
.xxx.o.<logname>.sparse

By diffing between different log file, it is much
easier to analyze how the sparse change impact
the whole kernel build.

Signed-off-by: Christopher Li <sparse@chrisli.org>


Chris

--001a113a76ca62b5ba04fd09d8a3
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-sparse-Add-CLOG-option-for-saving-warning.patch"
Content-Disposition: attachment; 
	filename="0001-sparse-Add-CLOG-option-for-saving-warning.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hx1jvqmh0

RnJvbSAzYjJmZjIwNGNiZGE2ODRhZGY5ZGJhMmFkZjU2ODA2MjUzM2FlMzRkIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgpE
YXRlOiBNb24sIDMwIEp1biAyMDE0IDAxOjMzOjIyIC0wNzAwClN1YmplY3Q6IFtQQVRDSF0gc3Bh
cnNlOiBBZGQgQ0xPRyBvcHRpb24gZm9yIHNhdmluZyB3YXJuaW5nCgpDdXJyZW50bHkgc3BhcnNl
IHdhcm5pbmcgb25seSBvdXRwdXQgdG8gc3RkZXJyLgpJbiB0aGUgcGFyYWxsZWwgYnVpbGQgcHJv
Y2VzcywgZGlmZmVyZW50IHNvdXJjZQpmaWxlIG91dHB1dCBpcyBmaXhlZCB0b2dldGhlci4gSXQg
aXMgaGFyZCB0byBrZWVwCnRyYWNrIG9mIHRoZSB3YXJuaW5nLgoKQWRkIHRoZSBDTE9HPTxsb2du
YW1lPiBvcHRpb24gaW4gY29tbWFuZCBsaW5lIHRvCnNhdmUgdGhlIHNwYXJzZSB3YXJuaW5nIGlu
dG8gaW5kaXZpZHVhbCBsb2cgZmlsZS4KClR5cGljYWwgdXNhZ2U6CgptYWtlIC1qOCBDPTIgQ0xP
Rz08bG9nbmFtZT4KClRoZSBsb2cgZmlsZSBpcyBzYXZlZCBpbiB0aGUgdGFyZ2V0IGRpcmVjdG9y
eSBhcwoueHh4Lm8uPGxvZ25hbWU+LnNwYXJzZQoKQnkgZGlmZmluZyBiZXR3ZWVuIGRpZmZlcmVu
dCBsb2cgZmlsZSwgaXQgaXMgbXVjaAplYXNpZXIgdG8gYW5hbHl6ZSBob3cgdGhlIHNwYXJzZSBj
aGFuZ2UgaW1wYWN0CnRoZSB3aG9sZSBrZXJuZWwgYnVpbGQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
c3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgotLS0KIE1ha2VmaWxlICAgICAgICAgICAg
ICAgfCAxMyArKysrKysrKysrKystCiBzY3JpcHRzL01ha2VmaWxlLmJ1aWxkIHwgMTEgKysrKysr
KysrLS0KIDIgZmlsZXMgY2hhbmdlZCwgMjEgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9NYWtlZmlsZSBiL01ha2VmaWxlCmluZGV4IGIxMWUyZDUuLjU2YzM1MDIg
MTAwNjQ0Ci0tLSBhL01ha2VmaWxlCisrKyBiL01ha2VmaWxlCkBAIC02OCw2ICs2OCwxNiBAQCBp
Zm5kZWYgS0JVSUxEX0NIRUNLU1JDCiAgIEtCVUlMRF9DSEVDS1NSQyA9IDAKIGVuZGlmCiAKK2lm
ZXEgKCIkKG9yaWdpbiBDTE9HKSIsICJjb21tYW5kIGxpbmUiKQorICBLQlVJTERfQ0hFQ0tMT0cg
PSAkKENMT0cpCitlbmRpZgoraWZuZGVmIEtCVUlMRF9DSEVDS0xPRworICBLQlVJTERfQ0hFQ0tM
T0cgPQorZW5kaWYKKworCisKKwogIyBVc2UgbWFrZSBNPWRpciB0byBzcGVjaWZ5IGRpcmVjdG9y
eSBvZiBleHRlcm5hbCBtb2R1bGUgdG8gYnVpbGQKICMgT2xkIHN5bnRheCBtYWtlIC4uLiBTVUJE
SVJTPSRQV0QgaXMgc3RpbGwgc3VwcG9ydGVkCiAjIFNldHRpbmcgdGhlIGVudmlyb25tZW50IHZh
cmlhYmxlIEtCVUlMRF9FWFRNT0QgdGFrZSBwcmVjZWRlbmNlCkBAIC0yODcsNyArMjk3LDcgQEAg
aWZlcSAoJChNQUtFQ01ER09BTFMpLCkKIGVuZGlmCiAKIGV4cG9ydCBLQlVJTERfTU9EVUxFUyBL
QlVJTERfQlVJTFRJTgotZXhwb3J0IEtCVUlMRF9DSEVDS1NSQyBLQlVJTERfU1JDIEtCVUlMRF9F
WFRNT0QKK2V4cG9ydCBLQlVJTERfQ0hFQ0tTUkMgS0JVSUxEX0NIRUNLTE9HIEtCVUlMRF9TUkMg
S0JVSUxEX0VYVE1PRAogCiAjIEJlYXV0aWZ5IG91dHB1dAogIyAtLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
QEAgLTEzNzAsNiArMTM4MCw3IEBAIGNsZWFuOiAkKGNsZWFuLWRpcnMpCiAJJChjYWxsIGNtZCxy
bWZpbGVzKQogCUBmaW5kICQoaWYgJChLQlVJTERfRVhUTU9EKSwgJChLQlVJTERfRVhUTU9EKSwg
LikgJChSQ1NfRklORF9JR05PUkUpIFwKIAkJXCggLW5hbWUgJyouW29hc10nIC1vIC1uYW1lICcq
LmtvJyAtbyAtbmFtZSAnLiouY21kJyBcCisJCS1vIC1uYW1lICcuKi5zcGFyc2UnIFwKIAkJLW8g
LW5hbWUgJyoua28uKicgXAogCQktbyAtbmFtZSAnLiouZCcgLW8gLW5hbWUgJy4qLnRtcCcgLW8g
LW5hbWUgJyoubW9kLmMnIFwKIAkJLW8gLW5hbWUgJyouc3ltdHlwZXMnIC1vIC1uYW1lICdtb2R1
bGVzLm9yZGVyJyBcCmRpZmYgLS1naXQgYS9zY3JpcHRzL01ha2VmaWxlLmJ1aWxkIGIvc2NyaXB0
cy9NYWtlZmlsZS5idWlsZAppbmRleCBiZjNlNjc3Li40NWM2MDA0IDEwMDY0NAotLS0gYS9zY3Jp
cHRzL01ha2VmaWxlLmJ1aWxkCisrKyBiL3NjcmlwdHMvTWFrZWZpbGUuYnVpbGQKQEAgLTk2LDE0
ICs5NiwyMSBAQCBfX2J1aWxkOiAkKGlmICQoS0JVSUxEX0JVSUxUSU4pLCQoYnVpbHRpbi10YXJn
ZXQpICQobGliLXRhcmdldCkgJChleHRyYS15KSkgXAogCSAkKHN1YmRpci15bSkgJChhbHdheXMp
CiAJQDoKIAorY2hlY2tfbG9nX2ZpbGUgPSAkKGRvdC10YXJnZXQpLiQoS0JVSUxEX0NIRUNLTE9H
KS5zcGFyc2UKKworaWZuZXEgKCQoS0JVSUxEX0NIRUNLTE9HKSwpCisgIGNoZWNrX2xvZ2dpbmcg
PSAyPiAkKGNoZWNrX2xvZ19maWxlKQorZW5kaWYKKworY21kX2NoZWNrID0gJChDSEVDSykgJChD
SEVDS0ZMQUdTKSAkKGNfZmxhZ3MpICQ8ICQoY2hlY2tfbG9nZ2luZykgOwogIyBMaW51cycga2Vy
bmVsIHNhbml0eSBjaGVja2luZyB0b29sCiBpZm5lcSAoJChLQlVJTERfQ0hFQ0tTUkMpLDApCiAg
IGlmZXEgKCQoS0JVSUxEX0NIRUNLU1JDKSwyKQogICAgIHF1aWV0X2NtZF9mb3JjZV9jaGVja3Ny
YyA9IENIRUNLICAgJDwKLSAgICAgICAgICBjbWRfZm9yY2VfY2hlY2tzcmMgPSAkKENIRUNLKSAk
KENIRUNLRkxBR1MpICQoY19mbGFncykgJDwgOworICAgICAgICAgIGNtZF9mb3JjZV9jaGVja3Ny
YyA9ICQoY21kX2NoZWNrKQogICBlbHNlCiAgICAgICBxdWlldF9jbWRfY2hlY2tzcmMgICAgID0g
Q0hFQ0sgICAkPAotICAgICAgICAgICAgY21kX2NoZWNrc3JjICAgICA9ICQoQ0hFQ0spICQoQ0hF
Q0tGTEFHUykgJChjX2ZsYWdzKSAkPCA7CisgICAgICAgICAgICBjbWRfY2hlY2tzcmMgICAgID0g
JChjbWRfY2hlY2spCiAgIGVuZGlmCiBlbmRpZgogCi0tIAoxLjkuMwoK
--001a113a76ca62b5ba04fd09d8a3--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: [PATCH] sparse: Add CLOG option for saving warning
Date: Mon, 30 Jun 2014 08:57:13 +0000
Message-ID: <CANeU7Q=a82YmUE49uZ1sOxZn0KGLuktSXuj7YsmUb=wXQEpPXA () mail ! gmail ! com>
--------------------
--001a113a76ca62b5ba04fd09d8a3
Content-Type: text/plain; charset=ISO-8859-1

Currently sparse warning only output to stderr.
In the parallel build process, different source
file output is fixed together. It is hard to keep
track of the warning.

Add the CLOG=<logname> option in command line to
save the sparse warning into individual log file.

Typical usage:

make -j8 C=2 CLOG=<logname>

The log file is saved in the target directory as
.xxx.o.<logname>.sparse

By diffing between different log file, it is much
easier to analyze how the sparse change impact
the whole kernel build.

Signed-off-by: Christopher Li <sparse@chrisli.org>


Chris

--001a113a76ca62b5ba04fd09d8a3
Content-Type: text/x-patch; charset=US-ASCII; 
	name="0001-sparse-Add-CLOG-option-for-saving-warning.patch"
Content-Disposition: attachment; 
	filename="0001-sparse-Add-CLOG-option-for-saving-warning.patch"
Content-Transfer-Encoding: base64
X-Attachment-Id: f_hx1jvqmh0

RnJvbSAzYjJmZjIwNGNiZGE2ODRhZGY5ZGJhMmFkZjU2ODA2MjUzM2FlMzRkIE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBDaHJpc3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgpE
YXRlOiBNb24sIDMwIEp1biAyMDE0IDAxOjMzOjIyIC0wNzAwClN1YmplY3Q6IFtQQVRDSF0gc3Bh
cnNlOiBBZGQgQ0xPRyBvcHRpb24gZm9yIHNhdmluZyB3YXJuaW5nCgpDdXJyZW50bHkgc3BhcnNl
IHdhcm5pbmcgb25seSBvdXRwdXQgdG8gc3RkZXJyLgpJbiB0aGUgcGFyYWxsZWwgYnVpbGQgcHJv
Y2VzcywgZGlmZmVyZW50IHNvdXJjZQpmaWxlIG91dHB1dCBpcyBmaXhlZCB0b2dldGhlci4gSXQg
aXMgaGFyZCB0byBrZWVwCnRyYWNrIG9mIHRoZSB3YXJuaW5nLgoKQWRkIHRoZSBDTE9HPTxsb2du
YW1lPiBvcHRpb24gaW4gY29tbWFuZCBsaW5lIHRvCnNhdmUgdGhlIHNwYXJzZSB3YXJuaW5nIGlu
dG8gaW5kaXZpZHVhbCBsb2cgZmlsZS4KClR5cGljYWwgdXNhZ2U6CgptYWtlIC1qOCBDPTIgQ0xP
Rz08bG9nbmFtZT4KClRoZSBsb2cgZmlsZSBpcyBzYXZlZCBpbiB0aGUgdGFyZ2V0IGRpcmVjdG9y
eSBhcwoueHh4Lm8uPGxvZ25hbWU+LnNwYXJzZQoKQnkgZGlmZmluZyBiZXR3ZWVuIGRpZmZlcmVu
dCBsb2cgZmlsZSwgaXQgaXMgbXVjaAplYXNpZXIgdG8gYW5hbHl6ZSBob3cgdGhlIHNwYXJzZSBj
aGFuZ2UgaW1wYWN0CnRoZSB3aG9sZSBrZXJuZWwgYnVpbGQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
c3RvcGhlciBMaSA8c3BhcnNlQGNocmlzbGkub3JnPgotLS0KIE1ha2VmaWxlICAgICAgICAgICAg
ICAgfCAxMyArKysrKysrKysrKystCiBzY3JpcHRzL01ha2VmaWxlLmJ1aWxkIHwgMTEgKysrKysr
KysrLS0KIDIgZmlsZXMgY2hhbmdlZCwgMjEgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9NYWtlZmlsZSBiL01ha2VmaWxlCmluZGV4IGIxMWUyZDUuLjU2YzM1MDIg
MTAwNjQ0Ci0tLSBhL01ha2VmaWxlCisrKyBiL01ha2VmaWxlCkBAIC02OCw2ICs2OCwxNiBAQCBp
Zm5kZWYgS0JVSUxEX0NIRUNLU1JDCiAgIEtCVUlMRF9DSEVDS1NSQyA9IDAKIGVuZGlmCiAKK2lm
ZXEgKCIkKG9yaWdpbiBDTE9HKSIsICJjb21tYW5kIGxpbmUiKQorICBLQlVJTERfQ0hFQ0tMT0cg
PSAkKENMT0cpCitlbmRpZgoraWZuZGVmIEtCVUlMRF9DSEVDS0xPRworICBLQlVJTERfQ0hFQ0tM
T0cgPQorZW5kaWYKKworCisKKwogIyBVc2UgbWFrZSBNPWRpciB0byBzcGVjaWZ5IGRpcmVjdG9y
eSBvZiBleHRlcm5hbCBtb2R1bGUgdG8gYnVpbGQKICMgT2xkIHN5bnRheCBtYWtlIC4uLiBTVUJE
SVJTPSRQV0QgaXMgc3RpbGwgc3VwcG9ydGVkCiAjIFNldHRpbmcgdGhlIGVudmlyb25tZW50IHZh
cmlhYmxlIEtCVUlMRF9FWFRNT0QgdGFrZSBwcmVjZWRlbmNlCkBAIC0yODcsNyArMjk3LDcgQEAg
aWZlcSAoJChNQUtFQ01ER09BTFMpLCkKIGVuZGlmCiAKIGV4cG9ydCBLQlVJTERfTU9EVUxFUyBL
QlVJTERfQlVJTFRJTgotZXhwb3J0IEtCVUlMRF9DSEVDS1NSQyBLQlVJTERfU1JDIEtCVUlMRF9F
WFRNT0QKK2V4cG9ydCBLQlVJTERfQ0hFQ0tTUkMgS0JVSUxEX0NIRUNLTE9HIEtCVUlMRF9TUkMg
S0JVSUxEX0VYVE1PRAogCiAjIEJlYXV0aWZ5IG91dHB1dAogIyAtLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
QEAgLTEzNzAsNiArMTM4MCw3IEBAIGNsZWFuOiAkKGNsZWFuLWRpcnMpCiAJJChjYWxsIGNtZCxy
bWZpbGVzKQogCUBmaW5kICQoaWYgJChLQlVJTERfRVhUTU9EKSwgJChLQlVJTERfRVhUTU9EKSwg
LikgJChSQ1NfRklORF9JR05PUkUpIFwKIAkJXCggLW5hbWUgJyouW29hc10nIC1vIC1uYW1lICcq
LmtvJyAtbyAtbmFtZSAnLiouY21kJyBcCisJCS1vIC1uYW1lICcuKi5zcGFyc2UnIFwKIAkJLW8g
LW5hbWUgJyoua28uKicgXAogCQktbyAtbmFtZSAnLiouZCcgLW8gLW5hbWUgJy4qLnRtcCcgLW8g
LW5hbWUgJyoubW9kLmMnIFwKIAkJLW8gLW5hbWUgJyouc3ltdHlwZXMnIC1vIC1uYW1lICdtb2R1
bGVzLm9yZGVyJyBcCmRpZmYgLS1naXQgYS9zY3JpcHRzL01ha2VmaWxlLmJ1aWxkIGIvc2NyaXB0
cy9NYWtlZmlsZS5idWlsZAppbmRleCBiZjNlNjc3Li40NWM2MDA0IDEwMDY0NAotLS0gYS9zY3Jp
cHRzL01ha2VmaWxlLmJ1aWxkCisrKyBiL3NjcmlwdHMvTWFrZWZpbGUuYnVpbGQKQEAgLTk2LDE0
ICs5NiwyMSBAQCBfX2J1aWxkOiAkKGlmICQoS0JVSUxEX0JVSUxUSU4pLCQoYnVpbHRpbi10YXJn
ZXQpICQobGliLXRhcmdldCkgJChleHRyYS15KSkgXAogCSAkKHN1YmRpci15bSkgJChhbHdheXMp
CiAJQDoKIAorY2hlY2tfbG9nX2ZpbGUgPSAkKGRvdC10YXJnZXQpLiQoS0JVSUxEX0NIRUNLTE9H
KS5zcGFyc2UKKworaWZuZXEgKCQoS0JVSUxEX0NIRUNLTE9HKSwpCisgIGNoZWNrX2xvZ2dpbmcg
PSAyPiAkKGNoZWNrX2xvZ19maWxlKQorZW5kaWYKKworY21kX2NoZWNrID0gJChDSEVDSykgJChD
SEVDS0ZMQUdTKSAkKGNfZmxhZ3MpICQ8ICQoY2hlY2tfbG9nZ2luZykgOwogIyBMaW51cycga2Vy
bmVsIHNhbml0eSBjaGVja2luZyB0b29sCiBpZm5lcSAoJChLQlVJTERfQ0hFQ0tTUkMpLDApCiAg
IGlmZXEgKCQoS0JVSUxEX0NIRUNLU1JDKSwyKQogICAgIHF1aWV0X2NtZF9mb3JjZV9jaGVja3Ny
YyA9IENIRUNLICAgJDwKLSAgICAgICAgICBjbWRfZm9yY2VfY2hlY2tzcmMgPSAkKENIRUNLKSAk
KENIRUNLRkxBR1MpICQoY19mbGFncykgJDwgOworICAgICAgICAgIGNtZF9mb3JjZV9jaGVja3Ny
YyA9ICQoY21kX2NoZWNrKQogICBlbHNlCiAgICAgICBxdWlldF9jbWRfY2hlY2tzcmMgICAgID0g
Q0hFQ0sgICAkPAotICAgICAgICAgICAgY21kX2NoZWNrc3JjICAgICA9ICQoQ0hFQ0spICQoQ0hF
Q0tGTEFHUykgJChjX2ZsYWdzKSAkPCA7CisgICAgICAgICAgICBjbWRfY2hlY2tzcmMgICAgID0g
JChjbWRfY2hlY2spCiAgIGVuZGlmCiBlbmRpZgogCi0tIAoxLjkuMwoK
--001a113a76ca62b5ba04fd09d8a3--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Fri, 04 Jul 2014 07:48:00 +0000
Message-ID: <CANeU7QmT=vzOGd6bBdkr-kNkt7yfzCWQF5QujiwV7Q8Q9hZw=w () mail ! gmail ! com>
--------------------
On Mon, Jun 30, 2014 at 1:57 AM, Christopher Li <sparse@chrisli.org> wrote:
>
> Add the CLOG=<logname> option in command line to
> save the sparse warning into individual log file.
>
> Typical usage:
>
> make -j8 C=2 CLOG=<logname>

Any feed back for this change? I want to clarify that this patch
is for the Linux kernel kbuild system, not sparse.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Fri, 04 Jul 2014 07:48:00 +0000
Message-ID: <CANeU7QmT=vzOGd6bBdkr-kNkt7yfzCWQF5QujiwV7Q8Q9hZw=w () mail ! gmail ! com>
--------------------
On Mon, Jun 30, 2014 at 1:57 AM, Christopher Li <sparse@chrisli.org> wrote:
>
> Add the CLOG=<logname> option in command line to
> save the sparse warning into individual log file.
>
> Typical usage:
>
> make -j8 C=2 CLOG=<logname>

Any feed back for this change? I want to clarify that this patch
is for the Linux kernel kbuild system, not sparse.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Fri, 04 Jul 2014 21:20:25 +0000
Message-ID: <20140704212025.GA3052 () thin>
--------------------
On Fri, Jul 04, 2014 at 12:48:00AM -0700, Christopher Li wrote:
> On Mon, Jun 30, 2014 at 1:57 AM, Christopher Li <sparse@chrisli.org> wrote:
> >
> > Add the CLOG=<logname> option in command line to
> > save the sparse warning into individual log file.
> >
> > Typical usage:
> >
> > make -j8 C=2 CLOG=<logname>
> 
> Any feed back for this change? I want to clarify that this patch
> is for the Linux kernel kbuild system, not sparse.

Seems reasonable to me.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Fri, 04 Jul 2014 21:20:25 +0000
Message-ID: <20140704212025.GA3052 () thin>
--------------------
On Fri, Jul 04, 2014 at 12:48:00AM -0700, Christopher Li wrote:
> On Mon, Jun 30, 2014 at 1:57 AM, Christopher Li <sparse@chrisli.org> wrote:
> >
> > Add the CLOG=<logname> option in command line to
> > save the sparse warning into individual log file.
> >
> > Typical usage:
> >
> > make -j8 C=2 CLOG=<logname>
> 
> Any feed back for this change? I want to clarify that this patch
> is for the Linux kernel kbuild system, not sparse.

Seems reasonable to me.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Sam Ravnborg <sam () ravnborg ! org>
To: linux-kernel
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Mon, 07 Jul 2014 11:22:57 +0000
Message-ID: <20140707112257.GA12549 () ravnborg ! org>
--------------------
On Fri, Jul 04, 2014 at 12:48:00AM -0700, Christopher Li wrote:
> On Mon, Jun 30, 2014 at 1:57 AM, Christopher Li <sparse@chrisli.org> wrote:
> >
> > Add the CLOG=<logname> option in command line to
> > save the sparse warning into individual log file.
> >
> > Typical usage:
> >
> > make -j8 C=2 CLOG=<logname>
> 
> Any feed back for this change? I want to clarify that this patch
> is for the Linux kernel kbuild system, not sparse.
We do not need this kind of special handling of outputs from gcc.
For sparse you just do a run with C=2 then you have it.

In other words - this looks like overkill for somethign thas is achievable
with simpler means.

	Sam

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Tue, 08 Jul 2014 05:49:34 +0000
Message-ID: <CANeU7QmKtQ=KVEUM=5pMi7Rko3O3MEPB8w7Biw-r=jFtpH4_dg () mail ! gmail ! com>
--------------------
On Mon, Jul 7, 2014 at 4:22 AM, Sam Ravnborg <sam@ravnborg.org> wrote:

>> > Typical usage:
>> >
>> > make -j8 C=2 CLOG=<logname>
>>
> We do not need this kind of special handling of outputs from gcc.
> For sparse you just do a run with C=2 then you have it.
>
> In other words - this looks like overkill for somethign thas is achievable
> with simpler means.

I am aware of the C=2 flag. However, it does not provide consistent result
with "make -jn" flag.

Please consider that the gcc case is different. The kernel source is usually
clean of gcc warnings. If there is an error with gcc, the build process
stops. It is different with sparse. The primary goal of running sparse in
kernel build is to see those warning. Also sparse is a lot noisier than gcc
in the kernel build, so there is a need with logging which is not present
with gcc.

With this patch, here is a normal test procedure for me to see the impact of a
sparse change on kernel build:

$ make -j8 C=2 CLOG=std

# apply sparse change and make sparse

$ make -j8 C=2 CLOG=std-exp

$ find -name ".*.std.sparse" | while read -r file; do diff -du $file
${file/std.sparse/std-exp.
sparse} ; done > /tmp/sparse-diff


Without the CLOG= option, the only way to get similar diff
result is disable "-jn" option. Which make the test process painfully
slow.

I agree if I don't use "make -jn" flags, using C=2 is good enough.
However, what is your suggestion if I do want to use "make -jn" for
sparse checking in the previous mentioned usage case?

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Tue, 08 Jul 2014 07:37:12 +0000
Message-ID: <20140708073712.GC25880 () mwanda>
--------------------
My kernel tree is full of drivers/foo.c.smatch and
drivers/foo.c.smatch-info files...

It would be nice to add it to .gitignore as well.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Sat, 19 Jul 2014 09:02:49 +0000
Message-ID: <CANeU7Q=YfKEi8WBhNoUQOXpG_6jV1KMUsq=N-rVo1maaNERyAA () mail ! gmail ! com>
--------------------
On Tue, Jul 8, 2014 at 12:37 AM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
> My kernel tree is full of drivers/foo.c.smatch and
> drivers/foo.c.smatch-info files...
>
> It would be nice to add it to .gitignore as well.

Actually, ".*" is already in the .gitignore, there for the sparse log files
are covered.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-kernel
Subject: Re: [PATCH] sparse: Add CLOG option for saving warning
Date: Sat, 19 Jul 2014 09:02:49 +0000
Message-ID: <CANeU7Q=YfKEi8WBhNoUQOXpG_6jV1KMUsq=N-rVo1maaNERyAA () mail ! gmail ! com>
--------------------
On Tue, Jul 8, 2014 at 12:37 AM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
> My kernel tree is full of drivers/foo.c.smatch and
> drivers/foo.c.smatch-info files...
>
> It would be nice to add it to .gitignore as well.

Actually, ".*" is already in the .gitignore, there for the sparse log files
are covered.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Allow override of sizeof(bool) warning ===

From: Joe Perches <joe () perches ! com>
To: linux-kernel
Subject: [PATCH] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 02:03:39 +0000
Message-ID: <1393466619.24588.65.camel () joe-AO722>
--------------------
Allow an override to emit or not the sizeof(bool) warning

Signed-off-by: Joe Perches <joe@perches.com>
---
 evaluate.c | 3 ++-
 lib.c      | 2 ++
 lib.h      | 1 +
 3 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..a45f59b 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -2057,7 +2057,8 @@ static struct symbol *evaluate_sizeof(struct expression *expr)
 	}
 
 	if (size == 1 && is_bool_type(type)) {
-		warning(expr->pos, "expression using sizeof bool");
+		if (Wsizeof_bool)
+			warning(expr->pos, "expression using sizeof bool");
 		size = bits_in_char;
 	}
 
diff --git a/lib.c b/lib.c
index bf3e91c..676b72e 100644
--- a/lib.c
+++ b/lib.c
@@ -225,6 +225,7 @@ int Wone_bit_signed_bitfield = 1;
 int Wparen_string = 0;
 int Wptr_subtraction_blows = 0;
 int Wreturn_void = 0;
+int Wsizeof_bool = 1;
 int Wshadow = 0;
 int Wtransparent_union = 0;
 int Wtypesign = 0;
@@ -437,6 +438,7 @@ static const struct warning {
 	{ "paren-string", &Wparen_string },
 	{ "ptr-subtraction-blows", &Wptr_subtraction_blows },
 	{ "return-void", &Wreturn_void },
+	{ "sizeof-bool", &Wsizeof_bool },
 	{ "shadow", &Wshadow },
 	{ "transparent-union", &Wtransparent_union },
 	{ "typesign", &Wtypesign },
diff --git a/lib.h b/lib.h
index f09b338..7e3432f 100644
--- a/lib.h
+++ b/lib.h
@@ -119,6 +119,7 @@ extern int Wone_bit_signed_bitfield;
 extern int Wparen_string;
 extern int Wptr_subtraction_blows;
 extern int Wreturn_void;
+extern int Wsizeof_bool;
 extern int Wshadow;
 extern int Wtransparent_union;
 extern int Wtypesign;
-- 
1.8.1.2.459.gbcd45b4.dirty



--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-sparse
Subject: [PATCH] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 02:03:39 +0000
Message-ID: <1393466619.24588.65.camel () joe-AO722>
--------------------
Allow an override to emit or not the sizeof(bool) warning

Signed-off-by: Joe Perches <joe@perches.com>
---
 evaluate.c | 3 ++-
 lib.c      | 2 ++
 lib.h      | 1 +
 3 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/evaluate.c b/evaluate.c
index 6655615..a45f59b 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -2057,7 +2057,8 @@ static struct symbol *evaluate_sizeof(struct expression *expr)
 	}
 
 	if (size == 1 && is_bool_type(type)) {
-		warning(expr->pos, "expression using sizeof bool");
+		if (Wsizeof_bool)
+			warning(expr->pos, "expression using sizeof bool");
 		size = bits_in_char;
 	}
 
diff --git a/lib.c b/lib.c
index bf3e91c..676b72e 100644
--- a/lib.c
+++ b/lib.c
@@ -225,6 +225,7 @@ int Wone_bit_signed_bitfield = 1;
 int Wparen_string = 0;
 int Wptr_subtraction_blows = 0;
 int Wreturn_void = 0;
+int Wsizeof_bool = 1;
 int Wshadow = 0;
 int Wtransparent_union = 0;
 int Wtypesign = 0;
@@ -437,6 +438,7 @@ static const struct warning {
 	{ "paren-string", &Wparen_string },
 	{ "ptr-subtraction-blows", &Wptr_subtraction_blows },
 	{ "return-void", &Wreturn_void },
+	{ "sizeof-bool", &Wsizeof_bool },
 	{ "shadow", &Wshadow },
 	{ "transparent-union", &Wtransparent_union },
 	{ "typesign", &Wtypesign },
diff --git a/lib.h b/lib.h
index f09b338..7e3432f 100644
--- a/lib.h
+++ b/lib.h
@@ -119,6 +119,7 @@ extern int Wone_bit_signed_bitfield;
 extern int Wparen_string;
 extern int Wptr_subtraction_blows;
 extern int Wreturn_void;
+extern int Wsizeof_bool;
 extern int Wshadow;
 extern int Wtransparent_union;
 extern int Wtypesign;
-- 
1.8.1.2.459.gbcd45b4.dirty



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: [PATCH] sparse: Allow override of sizeof(bool) warning
Date: Thu, 27 Feb 2014 02:28:57 +0000
Message-ID: <20140227022857.GC23659 () thin>
--------------------
On Wed, Feb 26, 2014 at 06:03:39PM -0800, Joe Perches wrote:
> Allow an override to emit or not the sizeof(bool) warning
> 
> Signed-off-by: Joe Perches <joe@perches.com>

Seems reasonable.  However, please document the new flag in the manpage.

>  evaluate.c | 3 ++-
>  lib.c      | 2 ++
>  lib.h      | 1 +
>  3 files changed, 5 insertions(+), 1 deletion(-)
> 
> diff --git a/evaluate.c b/evaluate.c
> index 6655615..a45f59b 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -2057,7 +2057,8 @@ static struct symbol *evaluate_sizeof(struct expression *expr)
>  	}
>  
>  	if (size == 1 && is_bool_type(type)) {
> -		warning(expr->pos, "expression using sizeof bool");
> +		if (Wsizeof_bool)
> +			warning(expr->pos, "expression using sizeof bool");
>  		size = bits_in_char;
>  	}
>  
> diff --git a/lib.c b/lib.c
> index bf3e91c..676b72e 100644
> --- a/lib.c
> +++ b/lib.c
> @@ -225,6 +225,7 @@ int Wone_bit_signed_bitfield = 1;
>  int Wparen_string = 0;
>  int Wptr_subtraction_blows = 0;
>  int Wreturn_void = 0;
> +int Wsizeof_bool = 1;
>  int Wshadow = 0;
>  int Wtransparent_union = 0;
>  int Wtypesign = 0;
> @@ -437,6 +438,7 @@ static const struct warning {
>  	{ "paren-string", &Wparen_string },
>  	{ "ptr-subtraction-blows", &Wptr_subtraction_blows },
>  	{ "return-void", &Wreturn_void },
> +	{ "sizeof-bool", &Wsizeof_bool },
>  	{ "shadow", &Wshadow },
>  	{ "transparent-union", &Wtransparent_union },
>  	{ "typesign", &Wtypesign },
> diff --git a/lib.h b/lib.h
> index f09b338..7e3432f 100644
> --- a/lib.h
> +++ b/lib.h
> @@ -119,6 +119,7 @@ extern int Wone_bit_signed_bitfield;
>  extern int Wparen_string;
>  extern int Wptr_subtraction_blows;
>  extern int Wreturn_void;
> +extern int Wsizeof_bool;
>  extern int Wshadow;
>  extern int Wtransparent_union;
>  extern int Wtypesign;
> -- 
> 1.8.1.2.459.gbcd45b4.dirty
> 
> 
> 
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Fix ioc type check ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Fix ioc type check
Date: Thu, 25 Sep 2014 12:10:16 +0000
Message-ID: <CANeU7Qkg9zBUoggGLBtFq6_-Svh9C2XHsFKdqvQ3TGaGNMZ79w () mail ! gmail ! com>
--------------------
On Thu, Sep 25, 2014 at 4:20 PM, Thomas Graf <tgraf@suug.ch> wrote:
> Add missing exepcted error output for the test to pass.
>
> Fixes: 42ebe41 "Add test case for the ioc type check"
> Signed-off-by: Thomas Graf <tgraf@suug.ch>

No, this test case is some thing gcc can handle and sparse
can't. Instead of patching the test result, we need to fix sparse
to handle it correctly.

It is an open bug of sparse.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Make -Werror turn warnigns into errors ===

From: Thomas Graf <tgraf () suug ! ch>
To: linux-sparse
Subject: Re: [PATCH] sparse: Make -Werror turn warnigns into errors
Date: Thu, 25 Sep 2014 08:12:05 +0000
Message-ID: <20140925081205.GF4966 () casper ! infradead ! org>
--------------------
On 09/25/14 at 10:46am, Christopher Li wrote:
> So the bash version will be look like this, I briefly test it
> seems pass all test cases.
> 
> Any feed back?

WFM, I've sent out v2 of the patch.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Make struct token::special signed ===

From: Rasmus Villemoes <rv () rasmusvillemoes ! dk>
To: linux-sparse
Subject: [PATCH] sparse: Make struct token::special signed
Date: Tue, 23 Dec 2014 13:16:46 +0000
Message-ID: <1419340606-15606-1-git-send-email-rv () rasmusvillemoes ! dk>
--------------------
There doesn't seem to be any reason for the special member of struct
token to be unsigned; AFAICT it is only ever being directly compared
to explicit characters and the SPECIAL_* enum constants using ==, !=
and in a switch statement. Making it plain int avoids an annoying
warning from match_op in token.h when compiling with -Wsign-compare.

Signed-off-by: Rasmus Villemoes <rv@rasmusvillemoes.dk>
---
 token.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/token.h b/token.h
index 8dbd80f..69d95d7 100644
--- a/token.h
+++ b/token.h
@@ -187,7 +187,7 @@ struct token {
 	union {
 		const char *number;
 		struct ident *ident;
-		unsigned int special;
+		int special;
 		struct string *string;
 		int argnum;
 		struct argcount count;
-- 
2.1.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Make struct token::special signed
Date: Tue, 23 Dec 2014 19:01:09 +0000
Message-ID: <CA+55aFwW30VbRy7uiBZn-gmnYi7B7jr8g=rvR-_uhYxV3U6_Vw () mail ! gmail ! com>
--------------------
On Tue, Dec 23, 2014 at 5:16 AM, Rasmus Villemoes <rv@rasmusvillemoes.dk> wrote:
> There doesn't seem to be any reason for the special member of struct
> token to be unsigned; AFAICT it is only ever being directly compared
> to explicit characters and the SPECIAL_* enum constants using ==, !=
> and in a switch statement. Making it plain int avoids an annoying
> warning from match_op in token.h when compiling with -Wsign-compare.

Please don't use -Wsign-cpmpare to make decisions about code.

"unsigned" is generally the much preferred type if there are no
reasons for it to be signed. And -Wsign-compare on its own is not a
reason, since it gives insane warnings for good code.

-Wsign-compare is basically a "you can walk through the warnings and
see if any of them are actually valid" thing. It's not worth it in any
other form. Trying to be sign-compare clean will result in actively
*worse* code in some circumstances (ie pointless casts etc etc).

                     Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse: Use memmove in sort.c ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: Use memmove in sort.c
Date: Thu, 25 Dec 2014 16:19:30 +0000
Message-ID: <CANeU7QmRbDacRp00JHr8Eofs03snJtqye_qKwOCDTos-Zm=8XA () mail ! gmail ! com>
--------------------
On Tue, Dec 23, 2014 at 9:38 PM, Rasmus Villemoes <rv@rasmusvillemoes.dk> wrote:
> Using valgrind on the example ctags program I get
>
> ==16863== Source and destination overlap in memcpy(0x7ff000100, 0x7ff000108, 192)
> ==16863==    at 0x4C2A690: memcpy (mc_replace_strmem.c:838)
> ==16863==    by 0x412D86: merge_block_seqs (sort.c:207)
> ==16863==    by 0x41303C: sort_list (sort.c:275)
> ==16863==    by 0x401225: main (ctags.c:224)
>
> Fix it by using memmove instead of memcpy.

This bug has been fixed in the chrisl repository as commit:
6c2d743d2f130a8bf9014410f928bae3647e3108

The first memcpy is fine, one of the buffer is in the stack, the ptr
pointer is allocated using mmap. So they will never overlap.

The second memcpy is a real bug. It has been reported by Hans Verkuil.
It took me a while to fix the real cause. Because the corrupted
ptr list still contain valid ptr pointers. The symptoms has very odd
duplicate entries. It took me a while to find out the real cause.

If you send this patch earlier, it would have save me a lot of time.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse: fix bogus shift too big warning when rhs is a variable ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] sparse: fix bogus shift too big warning when rhs is a variable
Date: Sat, 28 Jun 2014 18:13:51 +0000
Message-ID: <CANeU7QnZA2RSZbq9b-azyFK3Pkw3uyR=YP98590sPqq4z+pjTQ () mail ! gmail ! com>
--------------------
On Sat, Jun 28, 2014 at 10:37 AM, Christopher Li <sparse@chrisli.org> wrote:
>
> Never mind, I just saw the other email thread discussing this bug.
> I will try the test case provide there.
>


Ok, I just reply to the other email.
The bug is in the kernel source, a valid complain.
Sparse is doing the right thing here. Not a sparse bug, it is feature.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] sparse{i,c}: use LLVM_CONFIG to find llc and lli ===

From: Cody P Schafer <cody () linux ! vnet ! ibm ! com>
To: linux-sparse
Subject: Re: [PATCH] sparse{i,c}: use LLVM_CONFIG to find llc and lli
Date: Tue, 15 Apr 2014 22:53:30 +0000
Message-ID: <534DB86A.5090506 () linux ! vnet ! ibm ! com>
--------------------
On 04/15/2014 03:28 PM, Christopher Li wrote:
> On Tue, Apr 15, 2014 at 12:51 PM, Cody P Schafer
> <cody@linux.vnet.ibm.com> wrote:
>> Some systems have multiple llvm versions installed, and have prefixed
>> executables ("<exec>-<version>"). While we could require the user to
>> specify a variable for each executable (LLC, LLI), using llvm-config
>> --bindir to locate them and allowing them to override using LLVM_CONFIG
>> makes much less work.
>
> How about this minor incremental patch? It will use the default variable
> to make the change smaller.
>

Yep, should have remembered that I could just use a default value for 
the variable. Looks good.

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] staging: comedi: ni_stc.h: cleanup dma channel select ===

From: H Hartley Sweeten <hsweeten@visionengravers.com>
To: Unknown
Subject: [PATCH] staging: comedi: ni_stc.h: cleanup dma channel select
Date: Mon, 5 May 2014 10:23:32 -0700
Message-ID: 
--------------------
There are a number of inline functions in ni_stc.h that are used to
work out the bits needed to select a dma channel for the ai, ao, gpct,
and cdo subdevices.

Unfortunately, the ni_stc_dma_channel_select_bitfield() helper causes
a sparse warning:

drivers/staging/comedi/drivers/ni_stc.h:724:26: warning: shift too big (4294967295) for type int

As Dan Carpenter pointed out, this warning seems wrong, but it is
annoying.

The helper functions also have some BUG and BUG_ON statements that will
never happen.

For aesthetics, convert the helper functions to macros and remove the
BUG and BUG_ON code.

Simplify the users of the new macros in ni_mio_common.c.

Signed-off-by: H Hartley Sweeten <hsweeten@visionengravers.com>
Cc: Dan Carpenter <dan.carpenter@oracle.com>
Cc: Marcos A. Di Pietro <marcosadp@gmail.com>
---
 drivers/staging/comedi/drivers/ni_mio_common.c | 72 ++++++++------------------
 drivers/staging/comedi/drivers/ni_stc.h        | 61 +++++++++-------------
 2 files changed, 47 insertions(+), 86 deletions(-)

diff --git a/drivers/staging/comedi/drivers/ni_mio_common.c b/drivers/staging/comedi/drivers/ni_mio_common.c
index e934fd4..7daac1d 100644
--- a/drivers/staging/comedi/drivers/ni_mio_common.c
+++ b/drivers/staging/comedi/drivers/ni_mio_common.c
@@ -239,15 +239,17 @@ static inline void ni_set_bitfield(struct comedi_device *dev, int reg,
 		devpriv->stc_writew(dev, devpriv->io_bidirection_pin_reg,
 				    IO_Bidirection_Pin_Register);
 		break;
-	case AI_AO_Select:
+	case NI_STC_AI_AO_SELECT_REG:
 		devpriv->ai_ao_select_reg &= ~bit_mask;
 		devpriv->ai_ao_select_reg |= bit_values & bit_mask;
-		devpriv->writeb(dev, devpriv->ai_ao_select_reg, AI_AO_Select);
+		devpriv->writeb(dev, devpriv->ai_ao_select_reg,
+				NI_STC_AI_AO_SELECT_REG);
 		break;
-	case G0_G1_Select:
+	case NI_STC_G0_G1_SELECT_REG:
 		devpriv->g0_g1_select_reg &= ~bit_mask;
 		devpriv->g0_g1_select_reg |= bit_values & bit_mask;
-		devpriv->writeb(dev, devpriv->g0_g1_select_reg, G0_G1_Select);
+		devpriv->writeb(dev, devpriv->g0_g1_select_reg,
+				NI_STC_G0_G1_SELECT_REG);
 		break;
 	default:
 		printk("Warning %s() called with invalid register\n", __func__);
@@ -262,67 +264,37 @@ static inline void ni_set_bitfield(struct comedi_device *dev, int reg,
 /* DMA channel setup */
 
 /* negative channel means no channel */
-static inline void ni_set_ai_dma_channel(struct comedi_device *dev, int channel)
+static inline void ni_set_ai_dma_channel(struct comedi_device *dev, int chan)
 {
-	unsigned bitfield;
-
-	if (channel >= 0) {
-		bitfield =
-		    (ni_stc_dma_channel_select_bitfield(channel) <<
-		     AI_DMA_Select_Shift) & AI_DMA_Select_Mask;
-	} else {
-		bitfield = 0;
-	}
-	ni_set_bitfield(dev, AI_AO_Select, AI_DMA_Select_Mask, bitfield);
+	ni_set_bitfield(dev, NI_STC_AI_AO_SELECT_REG, NI_STC_AI_DMA_MASK,
+			(chan >= 0) ? NI_STC_AI_DMA_CHAN(chan) : 0);
 }
 
 /* negative channel means no channel */
-static inline void ni_set_ao_dma_channel(struct comedi_device *dev, int channel)
+static inline void ni_set_ao_dma_channel(struct comedi_device *dev, int chan)
 {
-	unsigned bitfield;
-
-	if (channel >= 0) {
-		bitfield =
-		    (ni_stc_dma_channel_select_bitfield(channel) <<
-		     AO_DMA_Select_Shift) & AO_DMA_Select_Mask;
-	} else {
-		bitfield = 0;
-	}
-	ni_set_bitfield(dev, AI_AO_Select, AO_DMA_Select_Mask, bitfield);
+	ni_set_bitfield(dev, NI_STC_AI_AO_SELECT_REG, NI_STC_AO_DMA_MASK,
+			(chan >= 0) ? NI_STC_AO_DMA_CHAN(chan) : 0);
 }
 
 /* negative mite_channel means no channel */
 static inline void ni_set_gpct_dma_channel(struct comedi_device *dev,
-					   unsigned gpct_index,
-					   int mite_channel)
+					   unsigned gpct, int chan)
 {
-	unsigned bitfield;
-
-	if (mite_channel >= 0)
-		bitfield = GPCT_DMA_Select_Bits(gpct_index, mite_channel);
-	else
-		bitfield = 0;
-	ni_set_bitfield(dev, G0_G1_Select, GPCT_DMA_Select_Mask(gpct_index),
-			bitfield);
+	ni_set_bitfield(dev, NI_STC_G0_G1_SELECT_REG, NI_STC_GPCT_DMA_MASK(gpct),
+			(chan >= 0) ? NI_STC_GPCT_DMA_CHAN(gpct, chan) : 0);
 }
 
 /* negative mite_channel means no channel */
-static inline void ni_set_cdo_dma_channel(struct comedi_device *dev,
-					  int mite_channel)
+static inline void ni_set_cdo_dma_channel(struct comedi_device *dev, int chan)
 {
 	struct ni_private *devpriv = dev->private;
 	unsigned long flags;
 
 	spin_lock_irqsave(&devpriv->soft_reg_copy_lock, flags);
-	devpriv->cdio_dma_select_reg &= ~CDO_DMA_Select_Mask;
-	if (mite_channel >= 0) {
-		/*XXX just guessing ni_stc_dma_channel_select_bitfield() returns the right bits,
-		   under the assumption the cdio dma selection works just like ai/ao/gpct.
-		   Definitely works for dma channels 0 and 1. */
-		devpriv->cdio_dma_select_reg |=
-		    (ni_stc_dma_channel_select_bitfield(mite_channel) <<
-		     CDO_DMA_Select_Shift) & CDO_DMA_Select_Mask;
-	}
+	devpriv->cdio_dma_select_reg &= ~NI_CDO_DMA_MASK;
+	if (chan >= 0)
+		devpriv->cdio_dma_select_reg |= NI_CDO_DMA_CHAN(chan);
 	devpriv->writeb(dev, devpriv->cdio_dma_select_reg, M_Offset_CDIO_DMA_Select);
 	mmiowb();
 	spin_unlock_irqrestore(&devpriv->soft_reg_copy_lock, flags);
@@ -5552,8 +5524,10 @@ static int ni_E_init(struct comedi_device *dev,
 	}
 
 	/* DMA setup */
-	devpriv->writeb(dev, devpriv->ai_ao_select_reg, AI_AO_Select);
-	devpriv->writeb(dev, devpriv->g0_g1_select_reg, G0_G1_Select);
+	devpriv->writeb(dev, devpriv->ai_ao_select_reg,
+			NI_STC_AI_AO_SELECT_REG);
+	devpriv->writeb(dev, devpriv->g0_g1_select_reg,
+			NI_STC_G0_G1_SELECT_REG);
 
 	if (board->reg_type & ni_reg_6xxx_mask) {
 		devpriv->writeb(dev, 0, Magic_611x);
diff --git a/drivers/staging/comedi/drivers/ni_stc.h b/drivers/staging/comedi/drivers/ni_stc.h
index 2710c24..0183eb6 100644
--- a/drivers/staging/comedi/drivers/ni_stc.h
+++ b/drivers/staging/comedi/drivers/ni_stc.h
@@ -706,39 +706,23 @@ enum XXX_Status_Bits {
 #define Channel_A_Mode			0x03
 #define Channel_B_Mode			0x05
 #define Channel_C_Mode			0x07
-#define AI_AO_Select			0x09
-enum AI_AO_Select_Bits {
-	AI_DMA_Select_Shift = 0,
-	AI_DMA_Select_Mask = 0xf,
-	AO_DMA_Select_Shift = 4,
-	AO_DMA_Select_Mask = 0xf << AO_DMA_Select_Shift
-};
-#define G0_G1_Select			0x0b
-static inline unsigned ni_stc_dma_channel_select_bitfield(unsigned channel)
-{
-	if (channel < 4)
-		return 1 << channel;
-	if (channel == 4)
-		return 0x3;
-	if (channel == 5)
-		return 0x5;
-	BUG();
-	return 0;
-}
 
-static inline unsigned GPCT_DMA_Select_Bits(unsigned gpct_index,
-					    unsigned mite_channel)
-{
-	BUG_ON(gpct_index > 1);
-	return ni_stc_dma_channel_select_bitfield(mite_channel) << (4 *
-								    gpct_index);
-}
+#define NI_STC_DMA_CHAN_SEL(_c)		(((_c) == 0) ? 0x01 :	\
+					 ((_c) == 1) ? 0x02 :	\
+					 ((_c) == 2) ? 0x04 :	\
+					 ((_c) == 3) ? 0x08 :	\
+					 ((_c) == 4) ? 0x03 :	\
+					 ((_c) == 5) ? 0x05 : 0x00)
 
-static inline unsigned GPCT_DMA_Select_Mask(unsigned gpct_index)
-{
-	BUG_ON(gpct_index > 1);
-	return 0xf << (4 * gpct_index);
-}
+#define NI_STC_AI_AO_SELECT_REG		0x09
+#define NI_STC_AI_DMA_CHAN(_c)		(NI_STC_DMA_CHAN_SEL(_c) << 0)
+#define NI_STC_AI_DMA_MASK		(0xf << 0)
+#define NI_STC_AO_DMA_CHAN(_c)		(NI_STC_DMA_CHAN_SEL(_c) << 4)
+#define NI_STC_AO_DMA_MASK		(0xf << 4)
+
+#define NI_STC_G0_G1_SELECT_REG		0x0b
+#define NI_STC_GPCT_DMA_CHAN(_g,_c)	(NI_STC_DMA_CHAN_SEL(_c) << (4 * (_g)))
+#define NI_STC_GPCT_DMA_MASK(_g)	(0xf << (4 * (_g)))
 
 /* 16 bit registers */
 
@@ -1305,12 +1289,15 @@ static inline unsigned MSeries_PFI_Filter_Select_Bits(unsigned channel,
 			   2)) & MSeries_PFI_Filter_Select_Mask(channel);
 }
 
-enum CDIO_DMA_Select_Bits {
-	CDI_DMA_Select_Shift = 0,
-	CDI_DMA_Select_Mask = 0xf,
-	CDO_DMA_Select_Shift = 4,
-	CDO_DMA_Select_Mask = 0xf << CDO_DMA_Select_Shift
-};
+/*
+ * XXX just guessing NI_STC_DMA_CHAN_SEL() returns the right bits,
+ * under the assumption the cdio dma selection works just like ai/ao/gpct.
+ * Definitely works for dma channels 0 and 1.
+ */
+#define NI_CDI_DMA_CHAN(_c)		(NI_STC_DMA_CHAN_SEL(_c) << 0)
+#define NI_CDI_DMA_MASK			(0xf << 0)
+#define NI_CDO_DMA_CHAN(_c)		(NI_STC_DMA_CHAN_SEL(_c) << 4)
+#define NI_CDO_DMA_MASK			(0xf << 4)
 
 enum CDIO_Status_Bits {
 	CDO_FIFO_Empty_Bit = 0x1,
-- 
1.9.3

_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================


################################################################################

=== Thread: [PATCH] staging: rtl8192u: initialize array in C compliant way ===

From: Martin Kepplinger <martink () posteo ! de>
To: linux-driver-devel
Subject: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Tue, 06 May 2014 08:22:08 +0000
Message-ID: <1399364528-3727-1-git-send-email-martink () posteo ! de>
--------------------
Don't list elements to initialize. Remaining elements of a partly
initialized array are set to zero. Sparse complained here.

Signed-off-by: Martin Kepplinger <martink@posteo.de>
---
 drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
index 426f223..c96dbab 100644
--- a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
+++ b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
@@ -241,7 +241,7 @@ static PTS_COMMON_INFO SearchAdmitTRStream(struct ieee80211_device *ieee,
 {
 	//DIRECTION_VALUE	dir;
 	u8	dir;
-	bool				search_dir[4] = {0, 0, 0, 0};
+	bool				search_dir[4] = {0};
 	struct list_head		*psearch_list; //FIXME
 	PTS_COMMON_INFO	pRet = NULL;
 	if(ieee->iw_mode == IW_MODE_MASTER) //ap mode
-- 
1.7.10.4

_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Martin Kepplinger <martink () posteo ! de>
To: linux-kernel
Subject: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Tue, 06 May 2014 08:22:08 +0000
Message-ID: <1399364528-3727-1-git-send-email-martink () posteo ! de>
--------------------
Don't list elements to initialize. Remaining elements of a partly
initialized array are set to zero. Sparse complained here.

Signed-off-by: Martin Kepplinger <martink@posteo.de>
---
 drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
index 426f223..c96dbab 100644
--- a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
+++ b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
@@ -241,7 +241,7 @@ static PTS_COMMON_INFO SearchAdmitTRStream(struct ieee80211_device *ieee,
 {
 	//DIRECTION_VALUE	dir;
 	u8	dir;
-	bool				search_dir[4] = {0, 0, 0, 0};
+	bool				search_dir[4] = {0};
 	struct list_head		*psearch_list; //FIXME
 	PTS_COMMON_INFO	pRet = NULL;
 	if(ieee->iw_mode == IW_MODE_MASTER) //ap mode
-- 
1.7.10.4

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Tue, 06 May 2014 08:47:49 +0000
Message-ID: <20140506084749.GT26890 () mwanda>
--------------------
On Tue, May 06, 2014 at 10:22:08AM +0200, Martin Kepplinger wrote:
> Don't list elements to initialize. Remaining elements of a partly
> initialized array are set to zero. Sparse complained here.
> 
> Signed-off-by: Martin Kepplinger <martink@posteo.de>
> ---
>  drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c |    2 +-
>  1 file changed, 1 insertion(+), 1 deletion(-)
> 
> diff --git a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
> index 426f223..c96dbab 100644
> --- a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
> +++ b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
> @@ -241,7 +241,7 @@ static PTS_COMMON_INFO SearchAdmitTRStream(struct ieee80211_device *ieee,
>  {
>  	//DIRECTION_VALUE	dir;
>  	u8	dir;
> -	bool				search_dir[4] = {0, 0, 0, 0};
> +	bool				search_dir[4] = {0};

That's weird.  The original code is valid but it generates a sparse
warning.

drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:58: warning: Initializer entry defined twice
drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:61:   also defined here

It has something to do with "_Bool" types.  Changing it to "int" will
also make the warning disappear.  I've CC'd the sparse list to see if
anyone knows what's happening.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-kernel
Subject: Re: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Tue, 06 May 2014 08:47:49 +0000
Message-ID: <20140506084749.GT26890 () mwanda>
--------------------
On Tue, May 06, 2014 at 10:22:08AM +0200, Martin Kepplinger wrote:
> Don't list elements to initialize. Remaining elements of a partly
> initialized array are set to zero. Sparse complained here.
> 
> Signed-off-by: Martin Kepplinger <martink@posteo.de>
> ---
>  drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c |    2 +-
>  1 file changed, 1 insertion(+), 1 deletion(-)
> 
> diff --git a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
> index 426f223..c96dbab 100644
> --- a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
> +++ b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
> @@ -241,7 +241,7 @@ static PTS_COMMON_INFO SearchAdmitTRStream(struct ieee80211_device *ieee,
>  {
>  	//DIRECTION_VALUE	dir;
>  	u8	dir;
> -	bool				search_dir[4] = {0, 0, 0, 0};
> +	bool				search_dir[4] = {0};

That's weird.  The original code is valid but it generates a sparse
warning.

drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:58: warning: Initializer entry defined twice
drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:61:   also defined here

It has something to do with "_Bool" types.  Changing it to "int" will
also make the warning disappear.  I've CC'd the sparse list to see if
anyone knows what's happening.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-driver-devel
Subject: Re: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Tue, 06 May 2014 19:59:34 +0000
Message-ID: <CANeU7QmZXJ0KqVvkLfqxF6CGx81KQ93S++ViR9smWRTj8_6Dtg () mail ! gmail ! com>
--------------------
On Tue, May 6, 2014 at 1:47 AM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
>> -     bool                            search_dir[4] = {0, 0, 0, 0};
>> +     bool                            search_dir[4] = {0};
>
> That's weird.  The original code is valid but it generates a sparse
> warning.
>
> drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:58: warning: Initializer entry defined twice
> drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:61:   also defined here
>
> It has something to do with "_Bool" types.  Changing it to "int" will
> also make the warning disappear.  I've CC'd the sparse list to see if
> anyone knows what's happening.

This is easy reproducible with a small test case. It is a sparse bug for sure.

Let me take a look.

Chris
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Tue, 06 May 2014 19:59:34 +0000
Message-ID: <CANeU7QmZXJ0KqVvkLfqxF6CGx81KQ93S++ViR9smWRTj8_6Dtg () mail ! gmail ! com>
--------------------
On Tue, May 6, 2014 at 1:47 AM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
>> -     bool                            search_dir[4] = {0, 0, 0, 0};
>> +     bool                            search_dir[4] = {0};
>
> That's weird.  The original code is valid but it generates a sparse
> warning.
>
> drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:58: warning: Initializer entry defined twice
> drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c:244:61:   also defined here
>
> It has something to do with "_Bool" types.  Changing it to "int" will
> also make the warning disappear.  I've CC'd the sparse list to see if
> anyone knows what's happening.

This is easy reproducible with a small test case. It is a sparse bug for sure.

Let me take a look.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-driver-devel
Subject: Re: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Sat, 10 May 2014 09:09:52 +0000
Message-ID: <CANeU7Qkpg3_mYEYqZpT2zy__6z0q8KDNB=gDH9oMY8UtQNu0+Q () mail ! gmail ! com>
--------------------
On Tue, May 6, 2014 at 1:47 AM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
>> diff --git a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
>> index 426f223..c96dbab 100644
>> --- a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
>> +++ b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
>> @@ -241,7 +241,7 @@ static PTS_COMMON_INFO SearchAdmitTRStream(struct ieee80211_device *ieee,
>>  {
>>       //DIRECTION_VALUE       dir;
>>       u8      dir;
>> -     bool                            search_dir[4] = {0, 0, 0, 0};
>> +     bool                            search_dir[4] = {0};
>
> That's weird.  The original code is valid but it generates a sparse
> warning.

Sorry for the late reply. I see what is going on already. The bits_to_bytes()
function is buggy for bool type. Bool is the only type has bits less than 8.
It truncates the bool byte size to 0. As a result, the array layout function
convert_index() always set the expr->init_offset to 0 for bool type:

"e->init_offset = from * bits_to_bytes(e->ctype->bit_size);"

Chris
_______________________________________________
devel mailing list
devel@linuxdriverproject.org
http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCH] staging: rtl8192u: initialize array in C compliant way
Date: Sat, 10 May 2014 09:09:52 +0000
Message-ID: <CANeU7Qkpg3_mYEYqZpT2zy__6z0q8KDNB=gDH9oMY8UtQNu0+Q () mail ! gmail ! com>
--------------------
On Tue, May 6, 2014 at 1:47 AM, Dan Carpenter <dan.carpenter@oracle.com> wrote:
>> diff --git a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
>> index 426f223..c96dbab 100644
>> --- a/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
>> +++ b/drivers/staging/rtl8192u/ieee80211/rtl819x_TSProc.c
>> @@ -241,7 +241,7 @@ static PTS_COMMON_INFO SearchAdmitTRStream(struct ieee80211_device *ieee,
>>  {
>>       //DIRECTION_VALUE       dir;
>>       u8      dir;
>> -     bool                            search_dir[4] = {0, 0, 0, 0};
>> +     bool                            search_dir[4] = {0};
>
> That's weird.  The original code is valid but it generates a sparse
> warning.

Sorry for the late reply. I see what is going on already. The bits_to_bytes()
function is buggy for bool type. Bool is the only type has bits less than 8.
It truncates the bool byte size to 0. As a result, the array layout function
convert_index() always set the expr->init_offset to 0 for bool type:

"e->init_offset = from * bits_to_bytes(e->ctype->bit_size);"

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH] tell gcc optimizer to never introduce new data races ===

From: Marek Polacek <polacek () redhat ! com>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 15:04:55 +0000
Message-ID: <20140610150455.GC7335 () redhat ! com>
--------------------
On Tue, Jun 10, 2014 at 04:53:27PM +0200, Peter Zijlstra wrote:
> On Tue, Jun 10, 2014 at 03:23:36PM +0200, Jiri Kosina wrote:
> > +# Tell gcc to never replace conditional load with a non-conditional one
> > +KBUILD_CFLAGS	+= $(call cc-option,--param allow-store-data-races=0)
> > +
> 
> Why do we not want: -fmemory-model=safe? And should we not at the very
> least also disable packed-store-data-races?

Note that the option does not exist, even though it is mentioned in the
documentation.

	Marek
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Peter Zijlstra <peterz () infradead ! org>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 15:13:29 +0000
Message-ID: <20140610151329.GL6758 () twins ! programming ! kicks-ass ! net>
--------------------

--WI+ghjzd0JGVd6h/
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Tue, Jun 10, 2014 at 05:04:55PM +0200, Marek Polacek wrote:
> On Tue, Jun 10, 2014 at 04:53:27PM +0200, Peter Zijlstra wrote:
> > On Tue, Jun 10, 2014 at 03:23:36PM +0200, Jiri Kosina wrote:
> > > +# Tell gcc to never replace conditional load with a non-conditional =
one
> > > +KBUILD_CFLAGS	+=3D $(call cc-option,--param allow-store-data-races=
=3D0)
> > > +
> >=20
> > Why do we not want: -fmemory-model=3Dsafe? And should we not at the very
> > least also disable packed-store-data-races?
>=20
> Note that the option does not exist, even though it is mentioned in the
> documentation.

Urgh.. ok. Any word on the packed-store-data thing?

--WI+ghjzd0JGVd6h/
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iQIcBAEBAgAGBQJTlyCZAAoJEHZH4aRLwOS6COAQAIYdpteaqAxFZhbYzskF5GSQ
tkWrWOm7HUhwWOsH5U41sSwX2kddgadftFfoiE9UZcOT/wmh+0sMJrQUS546vVXx
9QFrKQ+OiIShJ+TNV5Dd4d4LVfIukD/LoBmK74/C4uXCuBAVGOI4mHB9wVMVTeSs
BJ6txPoejlDXMGUguOKSgqH7wMC0QxAAjaddN6hir/5rfsDxKGiWKsWZaVacYs2+
qOpBN+e7qJUiwBe6zcBNminVk8wFjNoMWutGIsZgHGWWkwJXuBB3gcV7+Om+wU/9
w1j509FTc1RKlBe22LmH0OYGMKeLgbvhO2A7PNAdV/SvHvtGG4s/swjtB1qGLS9D
12Mv/Sjedl2TwnbpjNqDgF6F7zUYHvPTNoStGeITxIBXfyZy+HHdPlyq/Gr4DC0R
nOhO3vCthoU5WEJgprc+NhkW48zDNROwyCk2CP3hK4w8hs8VorBvn+4W7I/6WRx4
59QAd4MYL7VaiVdBUUICQthT0s82M4cCAyVRJT+yWD/udnMop8tnZgXotutFZI5I
HGkDIP4TRVMwfvEPyGaqjGg2d/zG3OZQCiOliccuogLtgjQwCxel2JvLV6/1HV3s
VW03FdGrtdb9U3hpTBmpBY/yVa00Byv/SKgUhGQ78+sDTuTyOaVqj4qHUeBpcP3J
d8VCxqIoQduOl+syt2XW
=K8Fg
-----END PGP SIGNATURE-----

--WI+ghjzd0JGVd6h/--
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jakub Jelinek <jakub () redhat ! com>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 15:17:35 +0000
Message-ID: <20140610151735.GH19001 () tucnak ! redhat ! com>
--------------------
On Tue, Jun 10, 2014 at 05:13:29PM +0200, Peter Zijlstra wrote:
> On Tue, Jun 10, 2014 at 05:04:55PM +0200, Marek Polacek wrote:
> > On Tue, Jun 10, 2014 at 04:53:27PM +0200, Peter Zijlstra wrote:
> > > On Tue, Jun 10, 2014 at 03:23:36PM +0200, Jiri Kosina wrote:
> > > > +# Tell gcc to never replace conditional load with a non-conditional one
> > > > +KBUILD_CFLAGS	+= $(call cc-option,--param allow-store-data-races=0)
> > > > +
> > > 
> > > Why do we not want: -fmemory-model=safe? And should we not at the very
> > > least also disable packed-store-data-races?
> > 
> > Note that the option does not exist, even though it is mentioned in the
> > documentation.
> 
> Urgh.. ok. Any word on the packed-store-data thing?

That is recognized, undocumented and never used in the compiler (not in 4.7
or any later release till now).  Most of the spots in the compiler that
could introduce data races were actually just changed, there is (already
since 4.7) just a single conditional on the --param allow-store-data-races=X
value.

	Jakub
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jakub Jelinek <jakub () redhat ! com>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 15:17:35 +0000
Message-ID: <20140610151735.GH19001 () tucnak ! redhat ! com>
--------------------
On Tue, Jun 10, 2014 at 05:13:29PM +0200, Peter Zijlstra wrote:
> On Tue, Jun 10, 2014 at 05:04:55PM +0200, Marek Polacek wrote:
> > On Tue, Jun 10, 2014 at 04:53:27PM +0200, Peter Zijlstra wrote:
> > > On Tue, Jun 10, 2014 at 03:23:36PM +0200, Jiri Kosina wrote:
> > > > +# Tell gcc to never replace conditional load with a non-conditional one
> > > > +KBUILD_CFLAGS	+= $(call cc-option,--param allow-store-data-races=0)
> > > > +
> > > 
> > > Why do we not want: -fmemory-model=safe? And should we not at the very
> > > least also disable packed-store-data-races?
> > 
> > Note that the option does not exist, even though it is mentioned in the
> > documentation.
> 
> Urgh.. ok. Any word on the packed-store-data thing?

That is recognized, undocumented and never used in the compiler (not in 4.7
or any later release till now).  Most of the spots in the compiler that
could introduce data races were actually just changed, there is (already
since 4.7) just a single conditional on the --param allow-store-data-races=X
value.

	Jakub
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 17:46:22 +0000
Message-ID: <CA+55aFyY7_=3xt-0KE=-fmb+kLurxkBmh8TZWgDZMi_RVpKBpg () mail ! gmail ! com>
--------------------
On Tue, Jun 10, 2014 at 6:23 AM, Jiri Kosina <jkosina@suse.cz> wrote:
> We have been chasing a memory corruption bug, which turned out to be
> caused by very old gcc (4.3.4), which happily turned conditional load into
> a non-conditional one, and that broke correctness (the condition was met
> only if lock was held) and corrupted memory.

Just out of interest, can you point to the particular kernel code that
caused this? I think that's more interesting than the example program
you show - which I'm sure is really nice for gcc developers as an
example, but from a kernel standpoint I think it's more important to
show the particular problems this caused for the kernel?

            Linus
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Linus Torvalds <torvalds () linux-foundation ! org>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 17:46:22 +0000
Message-ID: <CA+55aFyY7_=3xt-0KE=-fmb+kLurxkBmh8TZWgDZMi_RVpKBpg () mail ! gmail ! com>
--------------------
On Tue, Jun 10, 2014 at 6:23 AM, Jiri Kosina <jkosina@suse.cz> wrote:
> We have been chasing a memory corruption bug, which turned out to be
> caused by very old gcc (4.3.4), which happily turned conditional load into
> a non-conditional one, and that broke correctness (the condition was met
> only if lock was held) and corrupted memory.

Just out of interest, can you point to the particular kernel code that
caused this? I think that's more interesting than the example program
you show - which I'm sure is really nice for gcc developers as an
example, but from a kernel standpoint I think it's more important to
show the particular problems this caused for the kernel?

            Linus
================================================================================

From: Steven Noonan <steven () uplinklabs ! net>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 18:04:13 +0000
Message-ID: <CAKbGBLi1hRxe03EB70HOYRTuVhHkAyTnhfv8HFXEwatP6Qn8tA () mail ! gmail ! com>
--------------------
On Tue, Jun 10, 2014 at 10:46 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> On Tue, Jun 10, 2014 at 6:23 AM, Jiri Kosina <jkosina@suse.cz> wrote:
>> We have been chasing a memory corruption bug, which turned out to be
>> caused by very old gcc (4.3.4), which happily turned conditional load into
>> a non-conditional one, and that broke correctness (the condition was met
>> only if lock was held) and corrupted memory.
>
> Just out of interest, can you point to the particular kernel code that
> caused this? I think that's more interesting than the example program
> you show - which I'm sure is really nice for gcc developers as an
> example, but from a kernel standpoint I think it's more important to
> show the particular problems this caused for the kernel?
>

Jiri, is there a workaround for compilers that don't support '--param
allow-store-data-races=0'? For example:

$ gcc-4.5 -O2 -o cond_store cond_store.c && ./cond_store
Segmentation fault (core dumped)

$ gcc-4.5 -O2 --param allow-store-data-races=0 -o cond_store
cond_store.c && ./cond_store
cc1: error: invalid parameter allow-store-data-races

$ gcc-4.5 -v
Using built-in specs.
COLLECT_GCC=gcc-4.5
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-unknown-linux-gnu/4.5.4/lto-wrapper
Target: x86_64-unknown-linux-gnu
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man
--infodir=/usr/share/info --libdir=/usr/lib --libexecdir=/usr/lib
--program-suffix=-4.5 --enable-shared
--enable-languages=c,c++,fortran,objc,obj-c++ --enable-__cxa_atexit
--disable-libstdcxx-pch --disable-multilib --disable-libgomp
--disable-libmudflap --disable-libssp --enable-clocale=gnu
--with-tune=generic --with-cloog --with-ppl --with-system-zlib
Thread model: posix
gcc version 4.5.4 (GCC)
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 18:10:54 +0000
Message-ID: <alpine.LNX.2.00.1406101959580.1321 () pobox ! suse ! cz>
--------------------
On Tue, 10 Jun 2014, Linus Torvalds wrote:

> > We have been chasing a memory corruption bug, which turned out to be
> > caused by very old gcc (4.3.4), which happily turned conditional load into
> > a non-conditional one, and that broke correctness (the condition was met
> > only if lock was held) and corrupted memory.
> 
> Just out of interest, can you point to the particular kernel code that
> caused this? I think that's more interesting than the example program
> you show - which I'm sure is really nice for gcc developers as an
> example, but from a kernel standpoint I think it's more important to
> show the particular problems this caused for the kernel?

Well, as I said, that was with gcc 4.3.4, and GCC people expressed 
themselves that that was a slightly different optimization. It made me 
nervous enough though to ask whether it's absolutely positively not going 
to happen with newer gccs, and the code snippet quoted in the original 
mail came back as a response.

The code in question was out-of-tree printk-in-NMI (yeah, surprise 
suprise, once again) patch written by Petr Mladek, let me quote his 
comment from our internal bugzilla:

===
I have spent few days investigating inconsistent state of kernel ring buffer.
It went out that it was caused by speculative store generated by 
gcc-4.3.4.

The problem is in assembly generated for make_free_space(). The functions is
called the following way:

+ vprintk_emit();
    + log = MAIN_LOG; // with logbuf_lock
       or
       log = NMI_LOG; // with nmi_logbuf_lock
       cont_add(log, ...);
        + cont_flush(log, ...);
            + log_store(log, ...);
                  + log_make_free_space(log, ...);

If called with log = NMI_LOG then only nmi_log_* global variables are safe to
modify but the generated code does store also into (main_)log_* global 
variables:


<log_make_free_space>:
       55                      push   %rbp
       89 f6                   mov    %esi,%esi

       48 8b 05 03 99 51 01    mov    0x1519903(%rip),%rax       # ffffffff82620868 <nmi_log_next_id>
       44 8b 1d ec 98 51 01    mov    0x15198ec(%rip),%r11d      # ffffffff82620858 <log_next_idx>
       8b 35 36 60 14 01       mov    0x1146036(%rip),%esi       # ffffffff8224cfa8 <log_buf_len>
       44 8b 35 33 60 14 01    mov    0x1146033(%rip),%r14d      # ffffffff8224cfac <nmi_log_buf_len>
       4c 8b 2d d0 98 51 01    mov    0x15198d0(%rip),%r13       # ffffffff82620850 <log_next_seq>
       4c 8b 25 11 61 14 01    mov    0x1146111(%rip),%r12       # ffffffff8224d098 <log_buf>
       49 89 c2                mov    %rax,%r10
       48 21 c2                and    %rax,%rdx
       48 8b 1d 0c 99 55 01    mov    0x155990c(%rip),%rbx       # ffffffff826608a0 <nmi_log_buf>
       49 c1 ea 20             shr    $0x20,%r10
       48 89 55 d0             mov    %rdx,-0x30(%rbp)
       44 29 de                sub    %r11d,%esi
       45 29 d6                sub    %r10d,%r14d
       4c 8b 0d 97 98 51 01    mov    0x1519897(%rip),%r9	# ffffffff82620840 <log_first_seq>
       eb 7e                   jmp    ffffffff81107029	<log_make_free_space+0xe9>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 e8                mov    %r13,%rax
       4c 89 ca                mov    %r9,%rdx
       74 0a                   je     ffffffff8110703d	<log_make_free_space+0xfd>
       8b 15 27 98 51 01       mov    0x1519827(%rip),%edx       # ffffffff82620860 <nmi_log_first_id>
       48 8b 45 d0             mov    -0x30(%rbp),%rax
       48 39 c2                cmp    %rax,%rdx                  # end of loop 
       0f 84 da 00 00 00       je     ffffffff81107120 <log_make_free_space+0x1e0>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 0d 17 97 51 01    mov    %r9,0x1519717(%rip)        # ffffffff82620840 <log_first_seq>
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
                               KABOOOM
       74 35                   je     ffffffff81107160		 <log_make_free_space+0x220>


It stores log_first_seq when edi == NMI_LOG. This instructions are used also
when edi == MAIN_LOG but the store is done speculatively before the condition
is decided.  It is unsafe because we do not have "logbuf_lock" in NMI context
and some other process migh modify "log_first_seq" in parallel.
===

I believe that the best course of action is both

- building kernel (and anything multi-threaded, I guess) with that 
  optimization turned off
- persuade gcc folks to change the default for future releases

Thanks,

-- 
Jiri Kosina
SUSE Labs
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 18:10:54 +0000
Message-ID: <alpine.LNX.2.00.1406101959580.1321 () pobox ! suse ! cz>
--------------------
On Tue, 10 Jun 2014, Linus Torvalds wrote:

> > We have been chasing a memory corruption bug, which turned out to be
> > caused by very old gcc (4.3.4), which happily turned conditional load into
> > a non-conditional one, and that broke correctness (the condition was met
> > only if lock was held) and corrupted memory.
> 
> Just out of interest, can you point to the particular kernel code that
> caused this? I think that's more interesting than the example program
> you show - which I'm sure is really nice for gcc developers as an
> example, but from a kernel standpoint I think it's more important to
> show the particular problems this caused for the kernel?

Well, as I said, that was with gcc 4.3.4, and GCC people expressed 
themselves that that was a slightly different optimization. It made me 
nervous enough though to ask whether it's absolutely positively not going 
to happen with newer gccs, and the code snippet quoted in the original 
mail came back as a response.

The code in question was out-of-tree printk-in-NMI (yeah, surprise 
suprise, once again) patch written by Petr Mladek, let me quote his 
comment from our internal bugzilla:

===
I have spent few days investigating inconsistent state of kernel ring buffer.
It went out that it was caused by speculative store generated by 
gcc-4.3.4.

The problem is in assembly generated for make_free_space(). The functions is
called the following way:

+ vprintk_emit();
    + log = MAIN_LOG; // with logbuf_lock
       or
       log = NMI_LOG; // with nmi_logbuf_lock
       cont_add(log, ...);
        + cont_flush(log, ...);
            + log_store(log, ...);
                  + log_make_free_space(log, ...);

If called with log = NMI_LOG then only nmi_log_* global variables are safe to
modify but the generated code does store also into (main_)log_* global 
variables:


<log_make_free_space>:
       55                      push   %rbp
       89 f6                   mov    %esi,%esi

       48 8b 05 03 99 51 01    mov    0x1519903(%rip),%rax       # ffffffff82620868 <nmi_log_next_id>
       44 8b 1d ec 98 51 01    mov    0x15198ec(%rip),%r11d      # ffffffff82620858 <log_next_idx>
       8b 35 36 60 14 01       mov    0x1146036(%rip),%esi       # ffffffff8224cfa8 <log_buf_len>
       44 8b 35 33 60 14 01    mov    0x1146033(%rip),%r14d      # ffffffff8224cfac <nmi_log_buf_len>
       4c 8b 2d d0 98 51 01    mov    0x15198d0(%rip),%r13       # ffffffff82620850 <log_next_seq>
       4c 8b 25 11 61 14 01    mov    0x1146111(%rip),%r12       # ffffffff8224d098 <log_buf>
       49 89 c2                mov    %rax,%r10
       48 21 c2                and    %rax,%rdx
       48 8b 1d 0c 99 55 01    mov    0x155990c(%rip),%rbx       # ffffffff826608a0 <nmi_log_buf>
       49 c1 ea 20             shr    $0x20,%r10
       48 89 55 d0             mov    %rdx,-0x30(%rbp)
       44 29 de                sub    %r11d,%esi
       45 29 d6                sub    %r10d,%r14d
       4c 8b 0d 97 98 51 01    mov    0x1519897(%rip),%r9	# ffffffff82620840 <log_first_seq>
       eb 7e                   jmp    ffffffff81107029	<log_make_free_space+0xe9>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 e8                mov    %r13,%rax
       4c 89 ca                mov    %r9,%rdx
       74 0a                   je     ffffffff8110703d	<log_make_free_space+0xfd>
       8b 15 27 98 51 01       mov    0x1519827(%rip),%edx       # ffffffff82620860 <nmi_log_first_id>
       48 8b 45 d0             mov    -0x30(%rbp),%rax
       48 39 c2                cmp    %rax,%rdx                  # end of loop 
       0f 84 da 00 00 00       je     ffffffff81107120 <log_make_free_space+0x1e0>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 0d 17 97 51 01    mov    %r9,0x1519717(%rip)        # ffffffff82620840 <log_first_seq>
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
                               KABOOOM
       74 35                   je     ffffffff81107160		 <log_make_free_space+0x220>


It stores log_first_seq when edi == NMI_LOG. This instructions are used also
when edi == MAIN_LOG but the store is done speculatively before the condition
is decided.  It is unsafe because we do not have "logbuf_lock" in NMI context
and some other process migh modify "log_first_seq" in parallel.
===

I believe that the best course of action is both

- building kernel (and anything multi-threaded, I guess) with that 
  optimization turned off
- persuade gcc folks to change the default for future releases

Thanks,

-- 
Jiri Kosina
SUSE Labs
================================================================================

From: Richard Biener <richard.guenther () gmail ! com>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 10 Jun 2014 18:54:09 +0000
Message-ID: <fb599019-daba-4d09-8524-fa692bd1f3a4 () email ! android ! com>
--------------------
On June 10, 2014 8:04:13 PM CEST, Steven Noonan <steven@uplinklabs.net> wrote:
>On Tue, Jun 10, 2014 at 10:46 AM, Linus Torvalds
><torvalds@linux-foundation.org> wrote:
>> On Tue, Jun 10, 2014 at 6:23 AM, Jiri Kosina <jkosina@suse.cz> wrote:
>>> We have been chasing a memory corruption bug, which turned out to be
>>> caused by very old gcc (4.3.4), which happily turned conditional
>load into
>>> a non-conditional one, and that broke correctness (the condition was
>met
>>> only if lock was held) and corrupted memory.
>>
>> Just out of interest, can you point to the particular kernel code
>that
>> caused this? I think that's more interesting than the example program
>> you show - which I'm sure is really nice for gcc developers as an
>> example, but from a kernel standpoint I think it's more important to
>> show the particular problems this caused for the kernel?
>>
>
>Jiri, is there a workaround for compilers that don't support '--param
>allow-store-data-races=0'? For example:

The optimization that purposely performs the undesired transform is loop store motion which is part of the tree loop invariant motion optimization. You can disable that with -fno-tree-loop-im.

That the bug didn't appear with newer compilers was due to lucky decisions to not inline a particular function.

Richard.

>$ gcc-4.5 -O2 -o cond_store cond_store.c && ./cond_store
>Segmentation fault (core dumped)
>
>$ gcc-4.5 -O2 --param allow-store-data-races=0 -o cond_store
>cond_store.c && ./cond_store
>cc1: error: invalid parameter allow-store-data-races
>
>$ gcc-4.5 -v
>Using built-in specs.
>COLLECT_GCC=gcc-4.5
>COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-unknown-linux-gnu/4.5.4/lto-wrapper
>Target: x86_64-unknown-linux-gnu
>Configured with: ../configure --prefix=/usr --mandir=/usr/share/man
>--infodir=/usr/share/info --libdir=/usr/lib --libexecdir=/usr/lib
>--program-suffix=-4.5 --enable-shared
>--enable-languages=c,c++,fortran,objc,obj-c++ --enable-__cxa_atexit
>--disable-libstdcxx-pch --disable-multilib --disable-libgomp
>--disable-libmudflap --disable-libssp --enable-clocale=gnu
>--with-tune=generic --with-cloog --with-ppl --with-system-zlib
>Thread model: posix
>gcc version 4.5.4 (GCC)


--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 10:29:27 +0000
Message-ID: <20140616102927.GA2994 () mwanda>
--------------------
Adding "--param allow-store-data-races=0" to the GCC options for the
kernel breaks C=1 because Sparse isn't expecting a GCC option with that
format.

It thinks allow-store-data-races=0 is the name of the file we are trying
to test.  Try use Sparse on linux-next to see the problem.

$ make C=2 mm/slab_common.o
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CALL    scripts/checksyscalls.sh
  CHECK   scripts/mod/empty.c
No such file: allow-store-data-races=0
make[2]: *** [scripts/mod/empty.o] Error 1
make[1]: *** [scripts/mod] Error 2
make: *** [scripts] Error 2
$

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 10:29:27 +0000
Message-ID: <20140616102927.GA2994 () mwanda>
--------------------
Adding "--param allow-store-data-races=0" to the GCC options for the
kernel breaks C=1 because Sparse isn't expecting a GCC option with that
format.

It thinks allow-store-data-races=0 is the name of the file we are trying
to test.  Try use Sparse on linux-next to see the problem.

$ make C=2 mm/slab_common.o
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CALL    scripts/checksyscalls.sh
  CHECK   scripts/mod/empty.c
No such file: allow-store-data-races=0
make[2]: *** [scripts/mod/empty.o] Error 1
make[1]: *** [scripts/mod] Error 2
make: *** [scripts] Error 2
$

regards,
dan carpenter

================================================================================

From: Andreas Schwab <schwab () suse ! de>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 10:52:10 +0000
Message-ID: <mvmsin51605.fsf () hawking ! suse ! de>
--------------------
Dan Carpenter <dan.carpenter@oracle.com> writes:

> Adding "--param allow-store-data-races=0" to the GCC options for the
> kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> format.

Please try --param=allow-store-data-races=0 instead.

Andreas.

-- 
Andreas Schwab, SUSE Labs, schwab@suse.de
GPG Key fingerprint = 0196 BAD8 1CE9 1970 F4BE  1748 E4D4 88E3 0EEA B9D7
"And now for something completely different."
================================================================================

From: Andreas Schwab <schwab () suse ! de>
To: linux-sparse
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 10:52:10 +0000
Message-ID: <mvmsin51605.fsf () hawking ! suse ! de>
--------------------
Dan Carpenter <dan.carpenter@oracle.com> writes:

> Adding "--param allow-store-data-races=0" to the GCC options for the
> kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> format.

Please try --param=allow-store-data-races=0 instead.

Andreas.

-- 
Andreas Schwab, SUSE Labs, schwab@suse.de
GPG Key fingerprint = 0196 BAD8 1CE9 1970 F4BE  1748 E4D4 88E3 0EEA B9D7
"And now for something completely different."
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 11:20:49 +0000
Message-ID: <alpine.LNX.2.00.1406161320180.1321 () pobox ! suse ! cz>
--------------------
On Mon, 16 Jun 2014, Andreas Schwab wrote:

> > Adding "--param allow-store-data-races=0" to the GCC options for the
> > kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> > format.
> 
> Please try --param=allow-store-data-races=0 instead.

How reliable is this format across GCC versions? GCC manpage doesn't seem 
to list it as a valid alternative.

-- 
Jiri Kosina
SUSE Labs
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 11:20:49 +0000
Message-ID: <alpine.LNX.2.00.1406161320180.1321 () pobox ! suse ! cz>
--------------------
On Mon, 16 Jun 2014, Andreas Schwab wrote:

> > Adding "--param allow-store-data-races=0" to the GCC options for the
> > kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> > format.
> 
> Please try --param=allow-store-data-races=0 instead.

How reliable is this format across GCC versions? GCC manpage doesn't seem 
to list it as a valid alternative.

-- 
Jiri Kosina
SUSE Labs
================================================================================

From: Mark Brown <broonie () kernel ! org>
To: linux-sparse
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 14:37:03 +0000
Message-ID: <20140616143703.GF5099 () sirena ! org ! uk>
--------------------

--j5J5lYLHcSGsXTNV
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

On Mon, Jun 16, 2014 at 12:52:10PM +0200, Andreas Schwab wrote:
> Dan Carpenter <dan.carpenter@oracle.com> writes:

> > Adding "--param allow-store-data-races=0" to the GCC options for the
> > kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> > format.

> Please try --param=allow-store-data-races=0 instead.

That appears to work for me.

--j5J5lYLHcSGsXTNV
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAEBAgAGBQJTnwEMAAoJELSic+t+oim9V18P/jBvkywh+YQMj8yAbpOmvBiv
nzkFZxdSSKgqrjSz8kxt2D19jx8HzNVXIPY3Kb8jqwcOT/YWRYkey+AkMFyhDOpt
fT7i1zv5TOV2wDgspXRJwLLYCfMc/y0BpEGm8J7Td8NbxSpn8UNdqK2nCdE7j+fI
Hx4t3Pdfthb0od6Os9gVZLyIbJfcU+3BugTxkQ3lxXoJQDKbc5jT1dLw02GORJ0y
Y7mQNZZyHYvQmucBm4k54mqc3X/rJSyf73EV5jgpQx0DZu0OI4XMC5eIODbmhFl9
Xo0N5E3s+xbjv4mUAvWYcjZGDap7/Gugz5TMSeDQjRLLBUvMwmerj8wNx4zLwnay
jqF63GXYhLi7mFrk5sI5KdKlxAKj3l9MhPZBnbo8EjcZrTkmI7aBcFbd9VUZBJo3
Gucx6LSBKAnfm/IZdsVyOZ90ngUSowoBq4mqodDC01oLdd45Ek1uaYqNeh77JUPJ
oiOUGgG3bpIz86v18/CpcliZ9fS94aFv0YdIkA3MpqqN41pwBdBKCV/AnKYuDSIq
qzqDmiCc/DtlWZzORcr9OLfSvqMpijDcPRecH1f1mwl+upMgILvjTLsbfOkKAKPH
tJCcU2fzTRLZAkq01HmdU9pa1nYC4kera5NvUOloGIi03TC7uVqZmieRF91+kyns
MTjYAnN+WCq+AIk3ctpU
=FSo7
-----END PGP SIGNATURE-----

--j5J5lYLHcSGsXTNV--
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Mark Brown <broonie () kernel ! org>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Mon, 16 Jun 2014 14:37:03 +0000
Message-ID: <20140616143703.GF5099 () sirena ! org ! uk>
--------------------

--j5J5lYLHcSGsXTNV
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline

On Mon, Jun 16, 2014 at 12:52:10PM +0200, Andreas Schwab wrote:
> Dan Carpenter <dan.carpenter@oracle.com> writes:

> > Adding "--param allow-store-data-races=0" to the GCC options for the
> > kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> > format.

> Please try --param=allow-store-data-races=0 instead.

That appears to work for me.

--j5J5lYLHcSGsXTNV
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: Digital signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAEBAgAGBQJTnwEMAAoJELSic+t+oim9V18P/jBvkywh+YQMj8yAbpOmvBiv
nzkFZxdSSKgqrjSz8kxt2D19jx8HzNVXIPY3Kb8jqwcOT/YWRYkey+AkMFyhDOpt
fT7i1zv5TOV2wDgspXRJwLLYCfMc/y0BpEGm8J7Td8NbxSpn8UNdqK2nCdE7j+fI
Hx4t3Pdfthb0od6Os9gVZLyIbJfcU+3BugTxkQ3lxXoJQDKbc5jT1dLw02GORJ0y
Y7mQNZZyHYvQmucBm4k54mqc3X/rJSyf73EV5jgpQx0DZu0OI4XMC5eIODbmhFl9
Xo0N5E3s+xbjv4mUAvWYcjZGDap7/Gugz5TMSeDQjRLLBUvMwmerj8wNx4zLwnay
jqF63GXYhLi7mFrk5sI5KdKlxAKj3l9MhPZBnbo8EjcZrTkmI7aBcFbd9VUZBJo3
Gucx6LSBKAnfm/IZdsVyOZ90ngUSowoBq4mqodDC01oLdd45Ek1uaYqNeh77JUPJ
oiOUGgG3bpIz86v18/CpcliZ9fS94aFv0YdIkA3MpqqN41pwBdBKCV/AnKYuDSIq
qzqDmiCc/DtlWZzORcr9OLfSvqMpijDcPRecH1f1mwl+upMgILvjTLsbfOkKAKPH
tJCcU2fzTRLZAkq01HmdU9pa1nYC4kera5NvUOloGIi03TC7uVqZmieRF91+kyns
MTjYAnN+WCq+AIk3ctpU
=FSo7
-----END PGP SIGNATURE-----

--j5J5lYLHcSGsXTNV--
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 17 Jun 2014 07:58:07 +0000
Message-ID: <alpine.LNX.2.00.1406170954390.1321 () pobox ! suse ! cz>
--------------------
On Mon, 16 Jun 2014, Dan Carpenter wrote:

> Adding "--param allow-store-data-races=0" to the GCC options for the
> kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> format.
> 
> It thinks allow-store-data-races=0 is the name of the file we are trying
> to test.  Try use Sparse on linux-next to see the problem.

Alright, no word from gcc folks, so let's hope the undocumented format of 
the parameter works better ... sigh.

Andrew, please use the updated one below.



From: Jiri Kosina <jkosina@suse.cz>
Subject: [PATCH] ./Makefile: tell gcc optimizer to never introduce new data races

We have been chasing a memory corruption bug, which turned out to be
caused by very old gcc (4.3.4), which happily turned conditional load into
a non-conditional one, and that broke correctness (the condition was met
only if lock was held) and corrupted memory.

This particular problem with that particular code did not happen when
never gccs were used. I've brought this up with our gcc folks, as I wanted
to make sure that this can't really happen again, and it turns out it
actually can.

Quoting Martin Jambor <mjambor@suse.cz>:

====
More current GCCs are more careful when it comes to replacing a
conditional load with a non-conditional one, most notably they check
that a store happens in each iteration of _a_ loop but they assume
loops are executed.  They also perform a simple check whether the
store cannot trap which currently passes only for non-const
variables.  A simple testcase demonstrating it on an x86_64 is for
example the following:

$ cat cond_store.c

int g_1 = 1;

int g_2[1024] __attribute__((section ("safe_section"), aligned (4096)));

int c = 4;

int __attribute__ ((noinline))
foo (void)
{
  int l;
  for (l = 0; (l != 4); l++) {
    if (g_1)
      return l;
    for (g_2[0] = 0; (g_2[0] >= 26); ++g_2[0])
      ;
  }
  return 2;
}

int main (int argc, char* argv[])
{
  if (mprotect (g_2, sizeof(g_2), PROT_READ) == -1)
    {
      int e = errno;
      error (e, e, "mprotect error %i", e);
    }
  foo ();
  __builtin_printf("OK\n");
  return 0;
}
/* EOF */
$ ~/gcc/trunk/inst/bin/gcc cond_store.c -O2 --param allow-store-data-races=0
$ ./a.out
OK
$ ~/gcc/trunk/inst/bin/gcc cond_store.c -O2 --param allow-store-data-races=1
$ ./a.out
Segmentation fault

The testcase fails the same at least with 4.9, 4.8 and 4.7.  Therefore
I would suggest building kernels with this parameter set to zero. I
also agree with Jikos that the default should be changed for -O2.  I
have run most of the SPEC 2k6 CPU benchmarks (gamess and dealII
failed, at -O2, not sure why) compiled with and without this option
and did not see any real difference between respective run-times.
====

Hopefully the default will be changed in newer gccs, but let's force
it for kernel builds so that we are on a safe side even when older
gcc are used.

The code in question was out-of-tree printk-in-NMI (yeah, surprise
suprise, once again) patch written by Petr Mladek, let me quote his
comment from our internal bugzilla:

===
I have spent few days investigating inconsistent state of kernel ring buffer.
It went out that it was caused by speculative store generated by
gcc-4.3.4.

The problem is in assembly generated for make_free_space(). The functions is
called the following way:

+ vprintk_emit();
    + log = MAIN_LOG; // with logbuf_lock
       or
       log = NMI_LOG; // with nmi_logbuf_lock
       cont_add(log, ...);
        + cont_flush(log, ...);
            + log_store(log, ...);
                  + log_make_free_space(log, ...);

If called with log = NMI_LOG then only nmi_log_* global variables are safe to
modify but the generated code does store also into (main_)log_* global
variables:

<log_make_free_space>:
       55                      push   %rbp
       89 f6                   mov    %esi,%esi

       48 8b 05 03 99 51 01    mov    0x1519903(%rip),%rax       # ffffffff82620868 <nmi_log_next_id>
       44 8b 1d ec 98 51 01    mov    0x15198ec(%rip),%r11d      # ffffffff82620858 <log_next_idx>
       8b 35 36 60 14 01       mov    0x1146036(%rip),%esi       # ffffffff8224cfa8 <log_buf_len>
       44 8b 35 33 60 14 01    mov    0x1146033(%rip),%r14d      # ffffffff8224cfac <nmi_log_buf_len>
       4c 8b 2d d0 98 51 01    mov    0x15198d0(%rip),%r13       # ffffffff82620850 <log_next_seq>
       4c 8b 25 11 61 14 01    mov    0x1146111(%rip),%r12       # ffffffff8224d098 <log_buf>
       49 89 c2                mov    %rax,%r10
       48 21 c2                and    %rax,%rdx
       48 8b 1d 0c 99 55 01    mov    0x155990c(%rip),%rbx       # ffffffff826608a0 <nmi_log_buf>
       49 c1 ea 20             shr    $0x20,%r10
       48 89 55 d0             mov    %rdx,-0x30(%rbp)
       44 29 de                sub    %r11d,%esi
       45 29 d6                sub    %r10d,%r14d
       4c 8b 0d 97 98 51 01    mov    0x1519897(%rip),%r9	# ffffffff82620840 <log_first_seq>
       eb 7e                   jmp    ffffffff81107029	<log_make_free_space+0xe9>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 e8                mov    %r13,%rax
       4c 89 ca                mov    %r9,%rdx
       74 0a                   je     ffffffff8110703d	<log_make_free_space+0xfd>
       8b 15 27 98 51 01       mov    0x1519827(%rip),%edx       # ffffffff82620860 <nmi_log_first_id>
       48 8b 45 d0             mov    -0x30(%rbp),%rax
       48 39 c2                cmp    %rax,%rdx                  # end of loop
       0f 84 da 00 00 00       je     ffffffff81107120 <log_make_free_space+0x1e0>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 0d 17 97 51 01    mov    %r9,0x1519717(%rip)        # ffffffff82620840 <log_first_seq>
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
                               KABOOOM
       74 35                   je     ffffffff81107160		 <log_make_free_space+0x220>

It stores log_first_seq when edi == NMI_LOG. This instructions are used also
when edi == MAIN_LOG but the store is done speculatively before the condition
is decided.  It is unsafe because we do not have "logbuf_lock" in NMI context
and some other process migh modify "log_first_seq" in parallel.
===

I believe that the best course of action is both

- building kernel (and anything multi-threaded, I guess) with that
  optimization turned off
- persuade gcc folks to change the default for future releases

Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Cc: Martin Jambor <mjambor@suse.cz>
Cc: Petr Mladek <pmladek@suse.cz>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Marek Polacek <polacek@redhat.com>
Cc: Jakub Jelinek <jakub@redhat.com>
Cc: Steven Noonan <steven@uplinklabs.net>
Cc: Richard Biener <richard.guenther@gmail.com>
---
 Makefile | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/Makefile b/Makefile
index 00a933b..255e56d 100644
--- a/Makefile
+++ b/Makefile
@@ -587,6 +587,9 @@ endif
 
 include $(srctree)/arch/$(SRCARCH)/Makefile
 
+# Tell gcc to never replace conditional load with a non-conditional one
+KBUILD_CFLAGS	+= $(call cc-option,--param=allow-store-data-races=0)
+
 ifdef CONFIG_READABLE_ASM
 # Disable optimizations that make assembler listings hard to read.
 # reorder blocks reorders the control in the function

-- 
Jiri Kosina
SUSE Labs
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: gcc
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 17 Jun 2014 07:58:07 +0000
Message-ID: <alpine.LNX.2.00.1406170954390.1321 () pobox ! suse ! cz>
--------------------
On Mon, 16 Jun 2014, Dan Carpenter wrote:

> Adding "--param allow-store-data-races=0" to the GCC options for the
> kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> format.
> 
> It thinks allow-store-data-races=0 is the name of the file we are trying
> to test.  Try use Sparse on linux-next to see the problem.

Alright, no word from gcc folks, so let's hope the undocumented format of 
the parameter works better ... sigh.

Andrew, please use the updated one below.



From: Jiri Kosina <jkosina@suse.cz>
Subject: [PATCH] ./Makefile: tell gcc optimizer to never introduce new data races

We have been chasing a memory corruption bug, which turned out to be
caused by very old gcc (4.3.4), which happily turned conditional load into
a non-conditional one, and that broke correctness (the condition was met
only if lock was held) and corrupted memory.

This particular problem with that particular code did not happen when
never gccs were used. I've brought this up with our gcc folks, as I wanted
to make sure that this can't really happen again, and it turns out it
actually can.

Quoting Martin Jambor <mjambor@suse.cz>:

====
More current GCCs are more careful when it comes to replacing a
conditional load with a non-conditional one, most notably they check
that a store happens in each iteration of _a_ loop but they assume
loops are executed.  They also perform a simple check whether the
store cannot trap which currently passes only for non-const
variables.  A simple testcase demonstrating it on an x86_64 is for
example the following:

$ cat cond_store.c

int g_1 = 1;

int g_2[1024] __attribute__((section ("safe_section"), aligned (4096)));

int c = 4;

int __attribute__ ((noinline))
foo (void)
{
  int l;
  for (l = 0; (l != 4); l++) {
    if (g_1)
      return l;
    for (g_2[0] = 0; (g_2[0] >= 26); ++g_2[0])
      ;
  }
  return 2;
}

int main (int argc, char* argv[])
{
  if (mprotect (g_2, sizeof(g_2), PROT_READ) == -1)
    {
      int e = errno;
      error (e, e, "mprotect error %i", e);
    }
  foo ();
  __builtin_printf("OK\n");
  return 0;
}
/* EOF */
$ ~/gcc/trunk/inst/bin/gcc cond_store.c -O2 --param allow-store-data-races=0
$ ./a.out
OK
$ ~/gcc/trunk/inst/bin/gcc cond_store.c -O2 --param allow-store-data-races=1
$ ./a.out
Segmentation fault

The testcase fails the same at least with 4.9, 4.8 and 4.7.  Therefore
I would suggest building kernels with this parameter set to zero. I
also agree with Jikos that the default should be changed for -O2.  I
have run most of the SPEC 2k6 CPU benchmarks (gamess and dealII
failed, at -O2, not sure why) compiled with and without this option
and did not see any real difference between respective run-times.
====

Hopefully the default will be changed in newer gccs, but let's force
it for kernel builds so that we are on a safe side even when older
gcc are used.

The code in question was out-of-tree printk-in-NMI (yeah, surprise
suprise, once again) patch written by Petr Mladek, let me quote his
comment from our internal bugzilla:

===
I have spent few days investigating inconsistent state of kernel ring buffer.
It went out that it was caused by speculative store generated by
gcc-4.3.4.

The problem is in assembly generated for make_free_space(). The functions is
called the following way:

+ vprintk_emit();
    + log = MAIN_LOG; // with logbuf_lock
       or
       log = NMI_LOG; // with nmi_logbuf_lock
       cont_add(log, ...);
        + cont_flush(log, ...);
            + log_store(log, ...);
                  + log_make_free_space(log, ...);

If called with log = NMI_LOG then only nmi_log_* global variables are safe to
modify but the generated code does store also into (main_)log_* global
variables:

<log_make_free_space>:
       55                      push   %rbp
       89 f6                   mov    %esi,%esi

       48 8b 05 03 99 51 01    mov    0x1519903(%rip),%rax       # ffffffff82620868 <nmi_log_next_id>
       44 8b 1d ec 98 51 01    mov    0x15198ec(%rip),%r11d      # ffffffff82620858 <log_next_idx>
       8b 35 36 60 14 01       mov    0x1146036(%rip),%esi       # ffffffff8224cfa8 <log_buf_len>
       44 8b 35 33 60 14 01    mov    0x1146033(%rip),%r14d      # ffffffff8224cfac <nmi_log_buf_len>
       4c 8b 2d d0 98 51 01    mov    0x15198d0(%rip),%r13       # ffffffff82620850 <log_next_seq>
       4c 8b 25 11 61 14 01    mov    0x1146111(%rip),%r12       # ffffffff8224d098 <log_buf>
       49 89 c2                mov    %rax,%r10
       48 21 c2                and    %rax,%rdx
       48 8b 1d 0c 99 55 01    mov    0x155990c(%rip),%rbx       # ffffffff826608a0 <nmi_log_buf>
       49 c1 ea 20             shr    $0x20,%r10
       48 89 55 d0             mov    %rdx,-0x30(%rbp)
       44 29 de                sub    %r11d,%esi
       45 29 d6                sub    %r10d,%r14d
       4c 8b 0d 97 98 51 01    mov    0x1519897(%rip),%r9	# ffffffff82620840 <log_first_seq>
       eb 7e                   jmp    ffffffff81107029	<log_make_free_space+0xe9>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 e8                mov    %r13,%rax
       4c 89 ca                mov    %r9,%rdx
       74 0a                   je     ffffffff8110703d	<log_make_free_space+0xfd>
       8b 15 27 98 51 01       mov    0x1519827(%rip),%edx       # ffffffff82620860 <nmi_log_first_id>
       48 8b 45 d0             mov    -0x30(%rbp),%rax
       48 39 c2                cmp    %rax,%rdx                  # end of loop
       0f 84 da 00 00 00       je     ffffffff81107120 <log_make_free_space+0x1e0>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 0d 17 97 51 01    mov    %r9,0x1519717(%rip)        # ffffffff82620840 <log_first_seq>
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
                               KABOOOM
       74 35                   je     ffffffff81107160		 <log_make_free_space+0x220>

It stores log_first_seq when edi == NMI_LOG. This instructions are used also
when edi == MAIN_LOG but the store is done speculatively before the condition
is decided.  It is unsafe because we do not have "logbuf_lock" in NMI context
and some other process migh modify "log_first_seq" in parallel.
===

I believe that the best course of action is both

- building kernel (and anything multi-threaded, I guess) with that
  optimization turned off
- persuade gcc folks to change the default for future releases

Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Cc: Martin Jambor <mjambor@suse.cz>
Cc: Petr Mladek <pmladek@suse.cz>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Marek Polacek <polacek@redhat.com>
Cc: Jakub Jelinek <jakub@redhat.com>
Cc: Steven Noonan <steven@uplinklabs.net>
Cc: Richard Biener <richard.guenther@gmail.com>
---
 Makefile | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/Makefile b/Makefile
index 00a933b..255e56d 100644
--- a/Makefile
+++ b/Makefile
@@ -587,6 +587,9 @@ endif
 
 include $(srctree)/arch/$(SRCARCH)/Makefile
 
+# Tell gcc to never replace conditional load with a non-conditional one
+KBUILD_CFLAGS	+= $(call cc-option,--param=allow-store-data-races=0)
+
 ifdef CONFIG_READABLE_ASM
 # Disable optimizations that make assembler listings hard to read.
 # reorder blocks reorders the control in the function

-- 
Jiri Kosina
SUSE Labs
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: linux-sparse
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Tue, 17 Jun 2014 07:58:07 +0000
Message-ID: <alpine.LNX.2.00.1406170954390.1321 () pobox ! suse ! cz>
--------------------
On Mon, 16 Jun 2014, Dan Carpenter wrote:

> Adding "--param allow-store-data-races=0" to the GCC options for the
> kernel breaks C=1 because Sparse isn't expecting a GCC option with that
> format.
> 
> It thinks allow-store-data-races=0 is the name of the file we are trying
> to test.  Try use Sparse on linux-next to see the problem.

Alright, no word from gcc folks, so let's hope the undocumented format of 
the parameter works better ... sigh.

Andrew, please use the updated one below.



From: Jiri Kosina <jkosina@suse.cz>
Subject: [PATCH] ./Makefile: tell gcc optimizer to never introduce new data races

We have been chasing a memory corruption bug, which turned out to be
caused by very old gcc (4.3.4), which happily turned conditional load into
a non-conditional one, and that broke correctness (the condition was met
only if lock was held) and corrupted memory.

This particular problem with that particular code did not happen when
never gccs were used. I've brought this up with our gcc folks, as I wanted
to make sure that this can't really happen again, and it turns out it
actually can.

Quoting Martin Jambor <mjambor@suse.cz>:

====
More current GCCs are more careful when it comes to replacing a
conditional load with a non-conditional one, most notably they check
that a store happens in each iteration of _a_ loop but they assume
loops are executed.  They also perform a simple check whether the
store cannot trap which currently passes only for non-const
variables.  A simple testcase demonstrating it on an x86_64 is for
example the following:

$ cat cond_store.c

int g_1 = 1;

int g_2[1024] __attribute__((section ("safe_section"), aligned (4096)));

int c = 4;

int __attribute__ ((noinline))
foo (void)
{
  int l;
  for (l = 0; (l != 4); l++) {
    if (g_1)
      return l;
    for (g_2[0] = 0; (g_2[0] >= 26); ++g_2[0])
      ;
  }
  return 2;
}

int main (int argc, char* argv[])
{
  if (mprotect (g_2, sizeof(g_2), PROT_READ) == -1)
    {
      int e = errno;
      error (e, e, "mprotect error %i", e);
    }
  foo ();
  __builtin_printf("OK\n");
  return 0;
}
/* EOF */
$ ~/gcc/trunk/inst/bin/gcc cond_store.c -O2 --param allow-store-data-races=0
$ ./a.out
OK
$ ~/gcc/trunk/inst/bin/gcc cond_store.c -O2 --param allow-store-data-races=1
$ ./a.out
Segmentation fault

The testcase fails the same at least with 4.9, 4.8 and 4.7.  Therefore
I would suggest building kernels with this parameter set to zero. I
also agree with Jikos that the default should be changed for -O2.  I
have run most of the SPEC 2k6 CPU benchmarks (gamess and dealII
failed, at -O2, not sure why) compiled with and without this option
and did not see any real difference between respective run-times.
====

Hopefully the default will be changed in newer gccs, but let's force
it for kernel builds so that we are on a safe side even when older
gcc are used.

The code in question was out-of-tree printk-in-NMI (yeah, surprise
suprise, once again) patch written by Petr Mladek, let me quote his
comment from our internal bugzilla:

===
I have spent few days investigating inconsistent state of kernel ring buffer.
It went out that it was caused by speculative store generated by
gcc-4.3.4.

The problem is in assembly generated for make_free_space(). The functions is
called the following way:

+ vprintk_emit();
    + log = MAIN_LOG; // with logbuf_lock
       or
       log = NMI_LOG; // with nmi_logbuf_lock
       cont_add(log, ...);
        + cont_flush(log, ...);
            + log_store(log, ...);
                  + log_make_free_space(log, ...);

If called with log = NMI_LOG then only nmi_log_* global variables are safe to
modify but the generated code does store also into (main_)log_* global
variables:

<log_make_free_space>:
       55                      push   %rbp
       89 f6                   mov    %esi,%esi

       48 8b 05 03 99 51 01    mov    0x1519903(%rip),%rax       # ffffffff82620868 <nmi_log_next_id>
       44 8b 1d ec 98 51 01    mov    0x15198ec(%rip),%r11d      # ffffffff82620858 <log_next_idx>
       8b 35 36 60 14 01       mov    0x1146036(%rip),%esi       # ffffffff8224cfa8 <log_buf_len>
       44 8b 35 33 60 14 01    mov    0x1146033(%rip),%r14d      # ffffffff8224cfac <nmi_log_buf_len>
       4c 8b 2d d0 98 51 01    mov    0x15198d0(%rip),%r13       # ffffffff82620850 <log_next_seq>
       4c 8b 25 11 61 14 01    mov    0x1146111(%rip),%r12       # ffffffff8224d098 <log_buf>
       49 89 c2                mov    %rax,%r10
       48 21 c2                and    %rax,%rdx
       48 8b 1d 0c 99 55 01    mov    0x155990c(%rip),%rbx       # ffffffff826608a0 <nmi_log_buf>
       49 c1 ea 20             shr    $0x20,%r10
       48 89 55 d0             mov    %rdx,-0x30(%rbp)
       44 29 de                sub    %r11d,%esi
       45 29 d6                sub    %r10d,%r14d
       4c 8b 0d 97 98 51 01    mov    0x1519897(%rip),%r9	# ffffffff82620840 <log_first_seq>
       eb 7e                   jmp    ffffffff81107029	<log_make_free_space+0xe9>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 e8                mov    %r13,%rax
       4c 89 ca                mov    %r9,%rdx
       74 0a                   je     ffffffff8110703d	<log_make_free_space+0xfd>
       8b 15 27 98 51 01       mov    0x1519827(%rip),%edx       # ffffffff82620860 <nmi_log_first_id>
       48 8b 45 d0             mov    -0x30(%rbp),%rax
       48 39 c2                cmp    %rax,%rdx                  # end of loop
       0f 84 da 00 00 00       je     ffffffff81107120 <log_make_free_space+0x1e0>
[...]
       85 ff                   test   %edi,%edi                  # edi = 1 for NMI_LOG
       4c 89 0d 17 97 51 01    mov    %r9,0x1519717(%rip)        # ffffffff82620840 <log_first_seq>
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
                               KABOOOM
       74 35                   je     ffffffff81107160		 <log_make_free_space+0x220>

It stores log_first_seq when edi == NMI_LOG. This instructions are used also
when edi == MAIN_LOG but the store is done speculatively before the condition
is decided.  It is unsafe because we do not have "logbuf_lock" in NMI context
and some other process migh modify "log_first_seq" in parallel.
===

I believe that the best course of action is both

- building kernel (and anything multi-threaded, I guess) with that
  optimization turned off
- persuade gcc folks to change the default for future releases

Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Cc: Martin Jambor <mjambor@suse.cz>
Cc: Petr Mladek <pmladek@suse.cz>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Marek Polacek <polacek@redhat.com>
Cc: Jakub Jelinek <jakub@redhat.com>
Cc: Steven Noonan <steven@uplinklabs.net>
Cc: Richard Biener <richard.guenther@gmail.com>
---
 Makefile | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/Makefile b/Makefile
index 00a933b..255e56d 100644
--- a/Makefile
+++ b/Makefile
@@ -587,6 +587,9 @@ endif
 
 include $(srctree)/arch/$(SRCARCH)/Makefile
 
+# Tell gcc to never replace conditional load with a non-conditional one
+KBUILD_CFLAGS	+= $(call cc-option,--param=allow-store-data-races=0)
+
 ifdef CONFIG_READABLE_ASM
 # Disable optimizations that make assembler listings hard to read.
 # reorder blocks reorders the control in the function

-- 
Jiri Kosina
SUSE Labs
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jiri Kosina <jkosina () suse ! cz>
To: linux-kernel
Subject: Re: [PATCH] tell gcc optimizer to never introduce new data races
Date: Wed, 20 Aug 2014 23:27:56 +0000
Message-ID: <alpine.LRH.2.00.1408210127150.12153 () twin ! jikos ! cz>
--------------------
On Tue, 10 Jun 2014, Jiri Kosina wrote:

> We have been chasing a memory corruption bug, which turned out to be 
> caused by very old gcc (4.3.4), which happily turned conditional load into 
> a non-conditional one, and that broke correctness (the condition was met 
> only if lock was held) and corrupted memory.
> 
> This particular problem with that particular code did not happen when 
> never gccs were used. I've brought this up with our gcc folks, as I wanted 
> to make sure that this can't really happen again, and it turns out it 
> actually can.

For the record (and for mailinglist archives to catch this information) -- 
the default has been changed for gcc 4.10 to a sane value (0).
 
I'd however suggest we keep changes made by commit 69102311a ("./Makefile:
tell gcc optimizer to never introduce new data races") for rather a long  
time.

-- 
Jiri Kosina
SUSE Labs

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: [PATCH] validation: In context test, make conditional acquire return a status ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: [PATCH] validation: In context test, make conditional acquire return a status
Date: Sat, 01 Feb 2014 18:33:40 +0000
Message-ID: <20140201183335.GA9697 () leaf>
--------------------
The context test defines and tests a __cond_lock mechanism similar to
the kernel, but then applies it to a function that returns void.  Change
that to int.

Signed-off-by: Josh Triplett <josh@joshtriplett.org>
---
 validation/context.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/validation/context.c b/validation/context.c
index 33b70b8..b9500dc 100644
--- a/validation/context.c
+++ b/validation/context.c
@@ -10,7 +10,7 @@ static void r(void) __attribute__((context(1,0)))
 	__context__(-1);
 }
 
-extern void _ca(int fail);
+extern int _ca(int fail);
 #define ca(fail) __cond_lock(_ca(fail))
 
 static void good_paired1(void)
-- 
1.9.rc1

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression ===

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-kernel
Subject: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Tue, 10 Jun 2014 21:38:49 +0000
Message-ID: <1402436329-24750-1-git-send-email-jlayton () poochiereds ! net>
--------------------
From: Jeff Layton <jlayton@primarydata.com>

Lately, when I do a make with C=1, I get *tons* of these warnings:

    include/linux/err.h:35:16: warning: dereference of noderef expression
    include/linux/err.h:30:23: warning: dereference of noderef expression

...so many that it's really driven down the signal to noise ratio. I've
taken a look at what's driving these warnings and I really just don't
get it. The pointers being passed in aren't being dereferenced as far
as I can tell, so what is sparse complaining about?

Even odder, just in playing around I've noticed that removing the
__force directives seems to silence these warnings. This is really
strange since all of the docs I see indicate that __force is supposed to
help silence sparse warnings, not cause them.

This patch just removes the __force directives on the err.h inlines and
that silences the warnings for me. Dan originally added those in commit
e7152b97f38f1 (err.h: IS_ERR() can accept __user pointers).

I don't really consider this a serious proposal for inclusion, but
rather just a starting point for discussion. What's the right way to fix
this problem? Is this a bug in sparse?

Signed-off-by: Jeff Layton <jlayton@primarydata.com>
---
 include/linux/err.h | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/include/linux/err.h b/include/linux/err.h
index a729120644d5..284897f403b3 100644
--- a/include/linux/err.h
+++ b/include/linux/err.h
@@ -25,17 +25,17 @@ static inline void * __must_check ERR_PTR(long error)
 	return (void *) error;
 }
 
-static inline long __must_check PTR_ERR(__force const void *ptr)
+static inline long __must_check PTR_ERR(const void *ptr)
 {
 	return (long) ptr;
 }
 
-static inline bool __must_check IS_ERR(__force const void *ptr)
+static inline bool __must_check IS_ERR(const void *ptr)
 {
 	return IS_ERR_VALUE((unsigned long)ptr);
 }
 
-static inline bool __must_check IS_ERR_OR_NULL(__force const void *ptr)
+static inline bool __must_check IS_ERR_OR_NULL(const void *ptr)
 {
 	return !ptr || IS_ERR_VALUE((unsigned long)ptr);
 }
@@ -47,13 +47,13 @@ static inline bool __must_check IS_ERR_OR_NULL(__force const void *ptr)
  * Explicitly cast an error-valued pointer to another pointer type in such a
  * way as to make it clear that's what's going on.
  */
-static inline void * __must_check ERR_CAST(__force const void *ptr)
+static inline void * __must_check ERR_CAST(const void *ptr)
 {
 	/* cast away the const */
 	return (void *) ptr;
 }
 
-static inline int __must_check PTR_ERR_OR_ZERO(__force const void *ptr)
+static inline int __must_check PTR_ERR_OR_ZERO(const void *ptr)
 {
 	if (IS_ERR(ptr))
 		return PTR_ERR(ptr);
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-sparse
Subject: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Tue, 10 Jun 2014 21:38:49 +0000
Message-ID: <1402436329-24750-1-git-send-email-jlayton () poochiereds ! net>
--------------------
From: Jeff Layton <jlayton@primarydata.com>

Lately, when I do a make with C=1, I get *tons* of these warnings:

    include/linux/err.h:35:16: warning: dereference of noderef expression
    include/linux/err.h:30:23: warning: dereference of noderef expression

...so many that it's really driven down the signal to noise ratio. I've
taken a look at what's driving these warnings and I really just don't
get it. The pointers being passed in aren't being dereferenced as far
as I can tell, so what is sparse complaining about?

Even odder, just in playing around I've noticed that removing the
__force directives seems to silence these warnings. This is really
strange since all of the docs I see indicate that __force is supposed to
help silence sparse warnings, not cause them.

This patch just removes the __force directives on the err.h inlines and
that silences the warnings for me. Dan originally added those in commit
e7152b97f38f1 (err.h: IS_ERR() can accept __user pointers).

I don't really consider this a serious proposal for inclusion, but
rather just a starting point for discussion. What's the right way to fix
this problem? Is this a bug in sparse?

Signed-off-by: Jeff Layton <jlayton@primarydata.com>
---
 include/linux/err.h | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/include/linux/err.h b/include/linux/err.h
index a729120644d5..284897f403b3 100644
--- a/include/linux/err.h
+++ b/include/linux/err.h
@@ -25,17 +25,17 @@ static inline void * __must_check ERR_PTR(long error)
 	return (void *) error;
 }
 
-static inline long __must_check PTR_ERR(__force const void *ptr)
+static inline long __must_check PTR_ERR(const void *ptr)
 {
 	return (long) ptr;
 }
 
-static inline bool __must_check IS_ERR(__force const void *ptr)
+static inline bool __must_check IS_ERR(const void *ptr)
 {
 	return IS_ERR_VALUE((unsigned long)ptr);
 }
 
-static inline bool __must_check IS_ERR_OR_NULL(__force const void *ptr)
+static inline bool __must_check IS_ERR_OR_NULL(const void *ptr)
 {
 	return !ptr || IS_ERR_VALUE((unsigned long)ptr);
 }
@@ -47,13 +47,13 @@ static inline bool __must_check IS_ERR_OR_NULL(__force const void *ptr)
  * Explicitly cast an error-valued pointer to another pointer type in such a
  * way as to make it clear that's what's going on.
  */
-static inline void * __must_check ERR_CAST(__force const void *ptr)
+static inline void * __must_check ERR_CAST(const void *ptr)
 {
 	/* cast away the const */
 	return (void *) ptr;
 }
 
-static inline int __must_check PTR_ERR_OR_ZERO(__force const void *ptr)
+static inline int __must_check PTR_ERR_OR_ZERO(const void *ptr)
 {
 	if (IS_ERR(ptr))
 		return PTR_ERR(ptr);
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-kernel
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Wed, 11 Jun 2014 05:45:18 +0000
Message-ID: <20140611052040.GM5500 () mwanda>
--------------------
On Tue, Jun 10, 2014 at 05:38:49PM -0400, Jeff Layton wrote:
> From: Jeff Layton <jlayton@primarydata.com>
> 
> Lately, when I do a make with C=1, I get *tons* of these warnings:
> 
>     include/linux/err.h:35:16: warning: dereference of noderef expression
>     include/linux/err.h:30:23: warning: dereference of noderef expression

Which version of Sparse, which version of the kernel and which .c file
can I compile to reproduce this?

I built fs/cifs/ and I didn't see the sparse warning.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Wed, 11 Jun 2014 11:06:32 +0000
Message-ID: <20140611070632.639e07ce () f20 ! localdomain>
--------------------
On Wed, 11 Jun 2014 08:45:18 +0300
Dan Carpenter <dan.carpenter@oracle.com> wrote:

> On Tue, Jun 10, 2014 at 05:38:49PM -0400, Jeff Layton wrote:
> > From: Jeff Layton <jlayton@primarydata.com>
> > 
> > Lately, when I do a make with C=1, I get *tons* of these warnings:
> > 
> >     include/linux/err.h:35:16: warning: dereference of noderef expression
> >     include/linux/err.h:30:23: warning: dereference of noderef expression
> 
> Which version of Sparse, which version of the kernel and which .c file
> can I compile to reproduce this?
> 
> I built fs/cifs/ and I didn't see the sparse warning.
> 
> regards,
> dan carpenter
> 

$ rpm -q sparse
sparse-0.5.0-1.fc20.x86_64

I see it all over the tree, but an easy example is fs/locks.c:

$ make fs/locks.o C=1
make[1]: Nothing to be done for `all'.
make[1]: Nothing to be done for `relocs'.
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CALL    scripts/checksyscalls.sh
  CHECK   fs/locks.c
include/linux/err.h:35:16: warning: dereference of noderef expression
include/linux/err.h:30:23: warning: dereference of noderef expression
include/linux/err.h:35:16: warning: dereference of noderef expression
include/linux/err.h:30:23: warning: dereference of noderef expression
  CC      fs/locks.o

It has two IS_ERR calls and two PTR_ERR calls, and each generates the
warning.

-- 
Jeff Layton <jlayton@poochiereds.net>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-kernel
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Wed, 11 Jun 2014 13:11:46 +0000
Message-ID: <20140611131146.GS5500 () mwanda>
--------------------
On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> $ rpm -q sparse
> sparse-0.5.0-1.fc20.x86_64
>
> I see it all over the tree, but an easy example is fs/locks.c:
> 
> $ make fs/locks.o C=1
> make[1]: Nothing to be done for `all'.
> make[1]: Nothing to be done for `relocs'.
>   CHK     include/config/kernel.release
>   CHK     include/generated/uapi/linux/version.h
>   CHK     include/generated/utsrelease.h
>   CALL    scripts/checksyscalls.sh
>   CHECK   fs/locks.c
> include/linux/err.h:35:16: warning: dereference of noderef expression
> include/linux/err.h:30:23: warning: dereference of noderef expression
> include/linux/err.h:35:16: warning: dereference of noderef expression
> include/linux/err.h:30:23: warning: dereference of noderef expression
>   CC      fs/locks.o
> 
> It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> warning.
>

I downloaded the Fedora SRPM and built the binary but I still wasn't
able to reproduce the bug.

dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
0.5.0
dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CALL    scripts/checksyscalls.sh
<stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
<stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
<stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
<stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
  CHECK   scripts/mod/empty.c
  CHECK   fs/locks.c
dcarpenter@speke:~/progs/kernel/devel$

I'm on today's linux-next.  I can't think of a kernel configuration
issue which would cause this...

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Wed, 11 Jun 2014 13:11:46 +0000
Message-ID: <20140611131146.GS5500 () mwanda>
--------------------
On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> $ rpm -q sparse
> sparse-0.5.0-1.fc20.x86_64
>
> I see it all over the tree, but an easy example is fs/locks.c:
> 
> $ make fs/locks.o C=1
> make[1]: Nothing to be done for `all'.
> make[1]: Nothing to be done for `relocs'.
>   CHK     include/config/kernel.release
>   CHK     include/generated/uapi/linux/version.h
>   CHK     include/generated/utsrelease.h
>   CALL    scripts/checksyscalls.sh
>   CHECK   fs/locks.c
> include/linux/err.h:35:16: warning: dereference of noderef expression
> include/linux/err.h:30:23: warning: dereference of noderef expression
> include/linux/err.h:35:16: warning: dereference of noderef expression
> include/linux/err.h:30:23: warning: dereference of noderef expression
>   CC      fs/locks.o
> 
> It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> warning.
>

I downloaded the Fedora SRPM and built the binary but I still wasn't
able to reproduce the bug.

dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
0.5.0
dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CALL    scripts/checksyscalls.sh
<stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
<stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
<stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
<stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
  CHECK   scripts/mod/empty.c
  CHECK   fs/locks.c
dcarpenter@speke:~/progs/kernel/devel$

I'm on today's linux-next.  I can't think of a kernel configuration
issue which would cause this...

regards,
dan carpenter
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Wed, 11 Jun 2014 13:51:02 +0000
Message-ID: <20140611095102.5bba1200 () f20 ! localdomain>
--------------------
On Wed, 11 Jun 2014 16:11:46 +0300
Dan Carpenter <dan.carpenter@oracle.com> wrote:

> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> > $ rpm -q sparse
> > sparse-0.5.0-1.fc20.x86_64
> >
> > I see it all over the tree, but an easy example is fs/locks.c:
> > 
> > $ make fs/locks.o C=1
> > make[1]: Nothing to be done for `all'.
> > make[1]: Nothing to be done for `relocs'.
> >   CHK     include/config/kernel.release
> >   CHK     include/generated/uapi/linux/version.h
> >   CHK     include/generated/utsrelease.h
> >   CALL    scripts/checksyscalls.sh
> >   CHECK   fs/locks.c
> > include/linux/err.h:35:16: warning: dereference of noderef expression
> > include/linux/err.h:30:23: warning: dereference of noderef expression
> > include/linux/err.h:35:16: warning: dereference of noderef expression
> > include/linux/err.h:30:23: warning: dereference of noderef expression
> >   CC      fs/locks.o
> > 
> > It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> > warning.
> >
> 
> I downloaded the Fedora SRPM and built the binary but I still wasn't
> able to reproduce the bug.
> 
> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
> 0.5.0
> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
>   CHK     include/config/kernel.release
>   CHK     include/generated/uapi/linux/version.h
>   CHK     include/generated/utsrelease.h
>   CALL    scripts/checksyscalls.sh
> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
>   CHECK   scripts/mod/empty.c
>   CHECK   fs/locks.c
> dcarpenter@speke:~/progs/kernel/devel$
> 
> I'm on today's linux-next.  I can't think of a kernel configuration
> issue which would cause this...
> 
> regards,
> dan carpenter

Could it be arch-specific then? What arch are you using? I'm on x86_64.
I know that quite a few other people have mentioned seeing these
warnings as well, so I'm pretty sure it's not just me.

-- 
Jeff Layton <jlayton@poochiereds.net>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Vitaly Osipov <vitaly.osipov () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Thu, 12 Jun 2014 08:06:25 +0000
Message-ID: <CAH42NiXUE70oVnZJNhkvgKT5FSfnMVOBEWau84E9YAbufBDHMw () mail ! gmail ! com>
--------------------
Nothing shows up for me on x86_64, allmodconfig, linux-next from 10 of
June. My sparse has been compiled from sources.

$ make fs/locks.o C=2 CHECK="/home/vosipov/bin/sparse"
  CHK     include/config/kernel.release
  CHK     include/generated/uapi/linux/version.h
  CHK     include/generated/utsrelease.h
  CALL    scripts/checksyscalls.sh
  CHECK   scripts/mod/empty.c
  CHECK   fs/locks.c

$ sparse version
v0.5.0

$ which sparse
/home/vosipov/bin/sparse

Regards,
Vitaly


On Wed, Jun 11, 2014 at 11:51 PM, Jeff Layton <jlayton@poochiereds.net> wrote:
> On Wed, 11 Jun 2014 16:11:46 +0300
> Dan Carpenter <dan.carpenter@oracle.com> wrote:
>
>> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
>> > $ rpm -q sparse
>> > sparse-0.5.0-1.fc20.x86_64
>> >
>> > I see it all over the tree, but an easy example is fs/locks.c:
>> >
>> > $ make fs/locks.o C=1
>> > make[1]: Nothing to be done for `all'.
>> > make[1]: Nothing to be done for `relocs'.
>> >   CHK     include/config/kernel.release
>> >   CHK     include/generated/uapi/linux/version.h
>> >   CHK     include/generated/utsrelease.h
>> >   CALL    scripts/checksyscalls.sh
>> >   CHECK   fs/locks.c
>> > include/linux/err.h:35:16: warning: dereference of noderef expression
>> > include/linux/err.h:30:23: warning: dereference of noderef expression
>> > include/linux/err.h:35:16: warning: dereference of noderef expression
>> > include/linux/err.h:30:23: warning: dereference of noderef expression
>> >   CC      fs/locks.o
>> >
>> > It has two IS_ERR calls and two PTR_ERR calls, and each generates the
>> > warning.
>> >
>>
>> I downloaded the Fedora SRPM and built the binary but I still wasn't
>> able to reproduce the bug.
>>
>> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
>> 0.5.0
>> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
>>   CHK     include/config/kernel.release
>>   CHK     include/generated/uapi/linux/version.h
>>   CHK     include/generated/utsrelease.h
>>   CALL    scripts/checksyscalls.sh
>> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
>> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
>> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
>> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
>>   CHECK   scripts/mod/empty.c
>>   CHECK   fs/locks.c
>> dcarpenter@speke:~/progs/kernel/devel$
>>
>> I'm on today's linux-next.  I can't think of a kernel configuration
>> issue which would cause this...
>>
>> regards,
>> dan carpenter
>
> Could it be arch-specific then? What arch are you using? I'm on x86_64.
> I know that quite a few other people have mentioned seeing these
> warnings as well, so I'm pretty sure it's not just me.
>
> --
> Jeff Layton <jlayton@poochiereds.net>
> --
> To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
> the body of a message to majordomo@vger.kernel.org
> More majordomo info at  http://vger.kernel.org/majordomo-info.html
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Fri, 13 Jun 2014 12:05:37 +0000
Message-ID: <20140613080537.75635d81 () f20 ! localdomain>
--------------------
On Thu, 12 Jun 2014 18:06:25 +1000
Vitaly Osipov <vitaly.osipov@gmail.com> wrote:

> Nothing shows up for me on x86_64, allmodconfig, linux-next from 10 of
> June. My sparse has been compiled from sources.
> 
> $ make fs/locks.o C=2 CHECK="/home/vosipov/bin/sparse"
>   CHK     include/config/kernel.release
>   CHK     include/generated/uapi/linux/version.h
>   CHK     include/generated/utsrelease.h
>   CALL    scripts/checksyscalls.sh
>   CHECK   scripts/mod/empty.c
>   CHECK   fs/locks.c
> 
> $ sparse version
> v0.5.0
> 
> $ which sparse
> /home/vosipov/bin/sparse
> 
> Regards,
> Vitaly
> 
> 
> On Wed, Jun 11, 2014 at 11:51 PM, Jeff Layton <jlayton@poochiereds.net> wrote:
> > On Wed, 11 Jun 2014 16:11:46 +0300
> > Dan Carpenter <dan.carpenter@oracle.com> wrote:
> >
> >> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> >> > $ rpm -q sparse
> >> > sparse-0.5.0-1.fc20.x86_64
> >> >
> >> > I see it all over the tree, but an easy example is fs/locks.c:
> >> >
> >> > $ make fs/locks.o C=1
> >> > make[1]: Nothing to be done for `all'.
> >> > make[1]: Nothing to be done for `relocs'.
> >> >   CHK     include/config/kernel.release
> >> >   CHK     include/generated/uapi/linux/version.h
> >> >   CHK     include/generated/utsrelease.h
> >> >   CALL    scripts/checksyscalls.sh
> >> >   CHECK   fs/locks.c
> >> > include/linux/err.h:35:16: warning: dereference of noderef expression
> >> > include/linux/err.h:30:23: warning: dereference of noderef expression
> >> > include/linux/err.h:35:16: warning: dereference of noderef expression
> >> > include/linux/err.h:30:23: warning: dereference of noderef expression
> >> >   CC      fs/locks.o
> >> >
> >> > It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> >> > warning.
> >> >
> >>
> >> I downloaded the Fedora SRPM and built the binary but I still wasn't
> >> able to reproduce the bug.
> >>
> >> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
> >> 0.5.0
> >> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
> >>   CHK     include/config/kernel.release
> >>   CHK     include/generated/uapi/linux/version.h
> >>   CHK     include/generated/utsrelease.h
> >>   CALL    scripts/checksyscalls.sh
> >> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
> >> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
> >> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
> >> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
> >>   CHECK   scripts/mod/empty.c
> >>   CHECK   fs/locks.c
> >> dcarpenter@speke:~/progs/kernel/devel$
> >>
> >> I'm on today's linux-next.  I can't think of a kernel configuration
> >> issue which would cause this...
> >>
> >> regards,
> >> dan carpenter
> >
> > Could it be arch-specific then? What arch are you using? I'm on x86_64.
> > I know that quite a few other people have mentioned seeing these
> > warnings as well, so I'm pretty sure it's not just me.
> >

Ha! It turns out that my hand-built sparse also works fine, so the
problem seems to be in the Fedora package.

With a little trial-and-error, I figured out what's causing the
problem, but I'm a little baffled as to why it's occurring. 

The Fedora SRPM builds the program with -fpic. When I remove that flag,
this problem goes away. I'd appreciate any insight into why that would
break things. I doubt PIC really makes much difference security-wise in
sparse, so removing it shouldn't matter much, but I wonder if this
indicates an underlying bug in sparse itself?

I'll do a bit more investigation, but I should be able to get a fixed
package pushed into Fedora soon. Thanks for the help, and obviously the
RFC patch I originally "proposed" can be dropped.

-- 
Jeff Layton <jlayton@poochiereds.net>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Fri, 13 Jun 2014 15:56:50 +0000
Message-ID: <20140613155650.GA13426 () thin>
--------------------
On Fri, Jun 13, 2014 at 08:05:37AM -0400, Jeff Layton wrote:
> On Thu, 12 Jun 2014 18:06:25 +1000
> Vitaly Osipov <vitaly.osipov@gmail.com> wrote:
> 
> > Nothing shows up for me on x86_64, allmodconfig, linux-next from 10 of
> > June. My sparse has been compiled from sources.
> > 
> > $ make fs/locks.o C=2 CHECK="/home/vosipov/bin/sparse"
> >   CHK     include/config/kernel.release
> >   CHK     include/generated/uapi/linux/version.h
> >   CHK     include/generated/utsrelease.h
> >   CALL    scripts/checksyscalls.sh
> >   CHECK   scripts/mod/empty.c
> >   CHECK   fs/locks.c
> > 
> > $ sparse version
> > v0.5.0
> > 
> > $ which sparse
> > /home/vosipov/bin/sparse
> > 
> > Regards,
> > Vitaly
> > 
> > 
> > On Wed, Jun 11, 2014 at 11:51 PM, Jeff Layton <jlayton@poochiereds.net> wrote:
> > > On Wed, 11 Jun 2014 16:11:46 +0300
> > > Dan Carpenter <dan.carpenter@oracle.com> wrote:
> > >
> > >> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> > >> > $ rpm -q sparse
> > >> > sparse-0.5.0-1.fc20.x86_64
> > >> >
> > >> > I see it all over the tree, but an easy example is fs/locks.c:
> > >> >
> > >> > $ make fs/locks.o C=1
> > >> > make[1]: Nothing to be done for `all'.
> > >> > make[1]: Nothing to be done for `relocs'.
> > >> >   CHK     include/config/kernel.release
> > >> >   CHK     include/generated/uapi/linux/version.h
> > >> >   CHK     include/generated/utsrelease.h
> > >> >   CALL    scripts/checksyscalls.sh
> > >> >   CHECK   fs/locks.c
> > >> > include/linux/err.h:35:16: warning: dereference of noderef expression
> > >> > include/linux/err.h:30:23: warning: dereference of noderef expression
> > >> > include/linux/err.h:35:16: warning: dereference of noderef expression
> > >> > include/linux/err.h:30:23: warning: dereference of noderef expression
> > >> >   CC      fs/locks.o
> > >> >
> > >> > It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> > >> > warning.
> > >> >
> > >>
> > >> I downloaded the Fedora SRPM and built the binary but I still wasn't
> > >> able to reproduce the bug.
> > >>
> > >> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
> > >> 0.5.0
> > >> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
> > >>   CHK     include/config/kernel.release
> > >>   CHK     include/generated/uapi/linux/version.h
> > >>   CHK     include/generated/utsrelease.h
> > >>   CALL    scripts/checksyscalls.sh
> > >> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
> > >> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
> > >> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
> > >> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
> > >>   CHECK   scripts/mod/empty.c
> > >>   CHECK   fs/locks.c
> > >> dcarpenter@speke:~/progs/kernel/devel$
> > >>
> > >> I'm on today's linux-next.  I can't think of a kernel configuration
> > >> issue which would cause this...
> > >>
> > >> regards,
> > >> dan carpenter
> > >
> > > Could it be arch-specific then? What arch are you using? I'm on x86_64.
> > > I know that quite a few other people have mentioned seeing these
> > > warnings as well, so I'm pretty sure it's not just me.
> > >
> 
> Ha! It turns out that my hand-built sparse also works fine, so the
> problem seems to be in the Fedora package.
> 
> With a little trial-and-error, I figured out what's causing the
> problem, but I'm a little baffled as to why it's occurring. 
> 
> The Fedora SRPM builds the program with -fpic. When I remove that flag,
> this problem goes away. I'd appreciate any insight into why that would
> break things. I doubt PIC really makes much difference security-wise in
> sparse, so removing it shouldn't matter much, but I wonder if this
> indicates an underlying bug in sparse itself?

Wow, that's horrifying.  I wonder if it might indicate a miscompilation
by GCC.  Does the problem persist if you build with -fpic -g?  If so,
you could set a few breakpoints and try to determine at what point the
behavior of the two sparse binaries diverges.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Sat, 14 Jun 2014 13:44:43 +0000
Message-ID: <20140614094443.4554cf96 () tlielax ! poochiereds ! net>
--------------------
On Fri, 13 Jun 2014 08:56:50 -0700
Josh Triplett <josh@joshtriplett.org> wrote:

> On Fri, Jun 13, 2014 at 08:05:37AM -0400, Jeff Layton wrote:
> > On Thu, 12 Jun 2014 18:06:25 +1000
> > Vitaly Osipov <vitaly.osipov@gmail.com> wrote:
> > 
> > > Nothing shows up for me on x86_64, allmodconfig, linux-next from 10 of
> > > June. My sparse has been compiled from sources.
> > > 
> > > $ make fs/locks.o C=2 CHECK="/home/vosipov/bin/sparse"
> > >   CHK     include/config/kernel.release
> > >   CHK     include/generated/uapi/linux/version.h
> > >   CHK     include/generated/utsrelease.h
> > >   CALL    scripts/checksyscalls.sh
> > >   CHECK   scripts/mod/empty.c
> > >   CHECK   fs/locks.c
> > > 
> > > $ sparse version
> > > v0.5.0
> > > 
> > > $ which sparse
> > > /home/vosipov/bin/sparse
> > > 
> > > Regards,
> > > Vitaly
> > > 
> > > 
> > > On Wed, Jun 11, 2014 at 11:51 PM, Jeff Layton <jlayton@poochiereds.net> wrote:
> > > > On Wed, 11 Jun 2014 16:11:46 +0300
> > > > Dan Carpenter <dan.carpenter@oracle.com> wrote:
> > > >
> > > >> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> > > >> > $ rpm -q sparse
> > > >> > sparse-0.5.0-1.fc20.x86_64
> > > >> >
> > > >> > I see it all over the tree, but an easy example is fs/locks.c:
> > > >> >
> > > >> > $ make fs/locks.o C=1
> > > >> > make[1]: Nothing to be done for `all'.
> > > >> > make[1]: Nothing to be done for `relocs'.
> > > >> >   CHK     include/config/kernel.release
> > > >> >   CHK     include/generated/uapi/linux/version.h
> > > >> >   CHK     include/generated/utsrelease.h
> > > >> >   CALL    scripts/checksyscalls.sh
> > > >> >   CHECK   fs/locks.c
> > > >> > include/linux/err.h:35:16: warning: dereference of noderef expression
> > > >> > include/linux/err.h:30:23: warning: dereference of noderef expression
> > > >> > include/linux/err.h:35:16: warning: dereference of noderef expression
> > > >> > include/linux/err.h:30:23: warning: dereference of noderef expression
> > > >> >   CC      fs/locks.o
> > > >> >
> > > >> > It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> > > >> > warning.
> > > >> >
> > > >>
> > > >> I downloaded the Fedora SRPM and built the binary but I still wasn't
> > > >> able to reproduce the bug.
> > > >>
> > > >> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
> > > >> 0.5.0
> > > >> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
> > > >>   CHK     include/config/kernel.release
> > > >>   CHK     include/generated/uapi/linux/version.h
> > > >>   CHK     include/generated/utsrelease.h
> > > >>   CALL    scripts/checksyscalls.sh
> > > >> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
> > > >> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
> > > >> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
> > > >> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
> > > >>   CHECK   scripts/mod/empty.c
> > > >>   CHECK   fs/locks.c
> > > >> dcarpenter@speke:~/progs/kernel/devel$
> > > >>
> > > >> I'm on today's linux-next.  I can't think of a kernel configuration
> > > >> issue which would cause this...
> > > >>
> > > >> regards,
> > > >> dan carpenter
> > > >
> > > > Could it be arch-specific then? What arch are you using? I'm on x86_64.
> > > > I know that quite a few other people have mentioned seeing these
> > > > warnings as well, so I'm pretty sure it's not just me.
> > > >
> > 
> > Ha! It turns out that my hand-built sparse also works fine, so the
> > problem seems to be in the Fedora package.
> > 
> > With a little trial-and-error, I figured out what's causing the
> > problem, but I'm a little baffled as to why it's occurring. 
> > 
> > The Fedora SRPM builds the program with -fpic. When I remove that flag,
> > this problem goes away. I'd appreciate any insight into why that would
> > break things. I doubt PIC really makes much difference security-wise in
> > sparse, so removing it shouldn't matter much, but I wonder if this
> > indicates an underlying bug in sparse itself?
> 
> Wow, that's horrifying.  I wonder if it might indicate a miscompilation
> by GCC.  Does the problem persist if you build with -fpic -g?  If so,
> you could set a few breakpoints and try to determine at what point the
> behavior of the two sparse binaries diverges.
> 

Yeah, this is a bit disturbing. Fedora already builds with -g, so yes,
the problem does persist. I made a very small, simple C file that just
calls IS_ERR to test with.

Broken sparse (built with -fpic):

Breakpoint 1, expand_dereference (expr=0x7ffff6f12210) at expand.c:629
629		if (expr->ctype->ctype.modifiers & MOD_NODEREF)
(gdb) p expr->ctype->ctype.modifiers
$3 = 0x65686374616d6e75

Built w/o -fpic at the same breakpoint:

Breakpoint 1, expand_dereference (expr=0x7ffff5e61bd0) at expand.c:629
629		if (expr->ctype->ctype.modifiers & MOD_NODEREF)
(gdb) p expr->ctype->ctype.modifiers
$2 = 0x0

The stack at that point is:

(gdb) bt
#0  expand_dereference (expr=0x7ffff5e61bd0) at expand.c:629
#1  expand_preop (expr=0x7ffff5e61bd0) at expand.c:736
#2  expand_expression (expr=expr@entry=0x7ffff5e61bd0) at expand.c:984
#3  0x000000000041217a in expand_cast (expr=0x7ffff5e61c50) at expand.c:777
#4  expand_expression (expr=expr@entry=0x7ffff5e61c50) at expand.c:992
#5  0x00000000004123e2 in expand_compare (expr=0x7ffff5e61cd0) at expand.c:514
#6  expand_expression (expr=<optimized out>) at expand.c:978
#7  0x00000000004127ba in expand_preop (expr=0x7ffff5e61d10) at expand.c:752
#8  expand_expression (expr=<optimized out>) at expand.c:984
#9  0x00000000004127ba in expand_preop (expr=0x7ffff5e61d50) at expand.c:752
#10 expand_expression (expr=<optimized out>) at expand.c:984
#11 0x0000000000412364 in expand_arguments (head=0x7ffff5e39810) at expand.c:767
#12 expand_call (expr=0x7ffff5e61b90) at expand.c:832
#13 expand_expression (expr=expr@entry=0x7ffff5e61b90) at expand.c:995
#14 0x000000000041217a in expand_cast (expr=0x7ffff5e61e10) at expand.c:777
#15 expand_expression (expr=<optimized out>) at expand.c:992
#16 0x0000000000411c75 in expand_statement (stmt=stmt@entry=0x7ffff5fe3920) at expand.c:1202
#17 0x0000000000411e13 in expand_compound (stmt=0x7ffff5fe38d0) at expand.c:1133
#18 expand_statement (stmt=stmt@entry=0x7ffff5fe38d0) at expand.c:1164
#19 0x00000000004124ec in expand_expression (expr=<optimized out>) at expand.c:1007
#20 0x0000000000411dad in expand_statement (stmt=stmt@entry=0x7ffff5fe3880) at expand.c:1161
#21 0x0000000000411e13 in expand_compound (stmt=0x7ffff5fe3830) at expand.c:1133
#22 expand_statement (stmt=0x7ffff5fe3830) at expand.c:1164
#23 0x0000000000411c21 in expand_symbol (sym=sym@entry=0x7ffff5e312d0) at expand.c:1068
#24 0x0000000000401675 in check_symbols (list=0x7ffff6a63610) at sparse.c:281
#25 0x0000000000401208 in main (argc=<optimized out>, argv=<optimized out>) at sparse.c:300

...so something is corrupting the modifiers field at least and maybe
the whole ctype itself? I don't know the sparse code that well, so I'll
need to do some more digging to determine the root cause.

-- 
Jeff Layton <jlayton@poochiereds.net>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Vitaly Osipov <vitaly.osipov () gmail ! com>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Sat, 14 Jun 2014 14:05:22 +0000
Message-ID: <C8A16F18-29FD-48E3-9744-D2119A6CF384 () gmail ! com>
--------------------
Which GCC? I built sparse on Ubuntu with 4.8 and -fpic - still nothing. This must be Fedora specific somehow. 


Regards,

Vitaly 

> On 14 Jun 2014, at 11:44 pm, Jeff Layton <jlayton@poochiereds.net> wrote:
> 
> On Fri, 13 Jun 2014 08:56:50 -0700
> Josh Triplett <josh@joshtriplett.org> wrote:
> 
>>> On Fri, Jun 13, 2014 at 08:05:37AM -0400, Jeff Layton wrote:
>>> On Thu, 12 Jun 2014 18:06:25 +1000
>>> Vitaly Osipov <vitaly.osipov@gmail.com> wrote:
>>> 
>>>> Nothing shows up for me on x86_64, allmodconfig, linux-next from 10 of
>>>> June. My sparse has been compiled from sources.
>>>> 
>>>> $ make fs/locks.o C=2 CHECK="/home/vosipov/bin/sparse"
>>>>  CHK     include/config/kernel.release
>>>>  CHK     include/generated/uapi/linux/version.h
>>>>  CHK     include/generated/utsrelease.h
>>>>  CALL    scripts/checksyscalls.sh
>>>>  CHECK   scripts/mod/empty.c
>>>>  CHECK   fs/locks.c
>>>> 
>>>> $ sparse version
>>>> v0.5.0
>>>> 
>>>> $ which sparse
>>>> /home/vosipov/bin/sparse
>>>> 
>>>> Regards,
>>>> Vitaly
>>>> 
>>>> 
>>>>> On Wed, Jun 11, 2014 at 11:51 PM, Jeff Layton <jlayton@poochiereds.net> wrote:
>>>>> On Wed, 11 Jun 2014 16:11:46 +0300
>>>>> Dan Carpenter <dan.carpenter@oracle.com> wrote:
>>>>> 
>>>>>>> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
>>>>>>> $ rpm -q sparse
>>>>>>> sparse-0.5.0-1.fc20.x86_64
>>>>>>> 
>>>>>>> I see it all over the tree, but an easy example is fs/locks.c:
>>>>>>> 
>>>>>>> $ make fs/locks.o C=1
>>>>>>> make[1]: Nothing to be done for `all'.
>>>>>>> make[1]: Nothing to be done for `relocs'.
>>>>>>>  CHK     include/config/kernel.release
>>>>>>>  CHK     include/generated/uapi/linux/version.h
>>>>>>>  CHK     include/generated/utsrelease.h
>>>>>>>  CALL    scripts/checksyscalls.sh
>>>>>>>  CHECK   fs/locks.c
>>>>>>> include/linux/err.h:35:16: warning: dereference of noderef expression
>>>>>>> include/linux/err.h:30:23: warning: dereference of noderef expression
>>>>>>> include/linux/err.h:35:16: warning: dereference of noderef expression
>>>>>>> include/linux/err.h:30:23: warning: dereference of noderef expression
>>>>>>>  CC      fs/locks.o
>>>>>>> 
>>>>>>> It has two IS_ERR calls and two PTR_ERR calls, and each generates the
>>>>>>> warning.
>>>>>> 
>>>>>> I downloaded the Fedora SRPM and built the binary but I still wasn't
>>>>>> able to reproduce the bug.
>>>>>> 
>>>>>> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
>>>>>> 0.5.0
>>>>>> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
>>>>>>  CHK     include/config/kernel.release
>>>>>>  CHK     include/generated/uapi/linux/version.h
>>>>>>  CHK     include/generated/utsrelease.h
>>>>>>  CALL    scripts/checksyscalls.sh
>>>>>> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
>>>>>> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
>>>>>> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
>>>>>> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
>>>>>>  CHECK   scripts/mod/empty.c
>>>>>>  CHECK   fs/locks.c
>>>>>> dcarpenter@speke:~/progs/kernel/devel$
>>>>>> 
>>>>>> I'm on today's linux-next.  I can't think of a kernel configuration
>>>>>> issue which would cause this...
>>>>>> 
>>>>>> regards,
>>>>>> dan carpenter
>>>>> 
>>>>> Could it be arch-specific then? What arch are you using? I'm on x86_64.
>>>>> I know that quite a few other people have mentioned seeing these
>>>>> warnings as well, so I'm pretty sure it's not just me.
>>> 
>>> Ha! It turns out that my hand-built sparse also works fine, so the
>>> problem seems to be in the Fedora package.
>>> 
>>> With a little trial-and-error, I figured out what's causing the
>>> problem, but I'm a little baffled as to why it's occurring. 
>>> 
>>> The Fedora SRPM builds the program with -fpic. When I remove that flag,
>>> this problem goes away. I'd appreciate any insight into why that would
>>> break things. I doubt PIC really makes much difference security-wise in
>>> sparse, so removing it shouldn't matter much, but I wonder if this
>>> indicates an underlying bug in sparse itself?
>> 
>> Wow, that's horrifying.  I wonder if it might indicate a miscompilation
>> by GCC.  Does the problem persist if you build with -fpic -g?  If so,
>> you could set a few breakpoints and try to determine at what point the
>> behavior of the two sparse binaries diverges.
> 
> Yeah, this is a bit disturbing. Fedora already builds with -g, so yes,
> the problem does persist. I made a very small, simple C file that just
> calls IS_ERR to test with.
> 
> Broken sparse (built with -fpic):
> 
> Breakpoint 1, expand_dereference (expr=0x7ffff6f12210) at expand.c:629
> 629        if (expr->ctype->ctype.modifiers & MOD_NODEREF)
> (gdb) p expr->ctype->ctype.modifiers
> $3 = 0x65686374616d6e75
> 
> Built w/o -fpic at the same breakpoint:
> 
> Breakpoint 1, expand_dereference (expr=0x7ffff5e61bd0) at expand.c:629
> 629        if (expr->ctype->ctype.modifiers & MOD_NODEREF)
> (gdb) p expr->ctype->ctype.modifiers
> $2 = 0x0
> 
> The stack at that point is:
> 
> (gdb) bt
> #0  expand_dereference (expr=0x7ffff5e61bd0) at expand.c:629
> #1  expand_preop (expr=0x7ffff5e61bd0) at expand.c:736
> #2  expand_expression (expr=expr@entry=0x7ffff5e61bd0) at expand.c:984
> #3  0x000000000041217a in expand_cast (expr=0x7ffff5e61c50) at expand.c:777
> #4  expand_expression (expr=expr@entry=0x7ffff5e61c50) at expand.c:992
> #5  0x00000000004123e2 in expand_compare (expr=0x7ffff5e61cd0) at expand.c:514
> #6  expand_expression (expr=<optimized out>) at expand.c:978
> #7  0x00000000004127ba in expand_preop (expr=0x7ffff5e61d10) at expand.c:752
> #8  expand_expression (expr=<optimized out>) at expand.c:984
> #9  0x00000000004127ba in expand_preop (expr=0x7ffff5e61d50) at expand.c:752
> #10 expand_expression (expr=<optimized out>) at expand.c:984
> #11 0x0000000000412364 in expand_arguments (head=0x7ffff5e39810) at expand.c:767
> #12 expand_call (expr=0x7ffff5e61b90) at expand.c:832
> #13 expand_expression (expr=expr@entry=0x7ffff5e61b90) at expand.c:995
> #14 0x000000000041217a in expand_cast (expr=0x7ffff5e61e10) at expand.c:777
> #15 expand_expression (expr=<optimized out>) at expand.c:992
> #16 0x0000000000411c75 in expand_statement (stmt=stmt@entry=0x7ffff5fe3920) at expand.c:1202
> #17 0x0000000000411e13 in expand_compound (stmt=0x7ffff5fe38d0) at expand.c:1133
> #18 expand_statement (stmt=stmt@entry=0x7ffff5fe38d0) at expand.c:1164
> #19 0x00000000004124ec in expand_expression (expr=<optimized out>) at expand.c:1007
> #20 0x0000000000411dad in expand_statement (stmt=stmt@entry=0x7ffff5fe3880) at expand.c:1161
> #21 0x0000000000411e13 in expand_compound (stmt=0x7ffff5fe3830) at expand.c:1133
> #22 expand_statement (stmt=0x7ffff5fe3830) at expand.c:1164
> #23 0x0000000000411c21 in expand_symbol (sym=sym@entry=0x7ffff5e312d0) at expand.c:1068
> #24 0x0000000000401675 in check_symbols (list=0x7ffff6a63610) at sparse.c:281
> #25 0x0000000000401208 in main (argc=<optimized out>, argv=<optimized out>) at sparse.c:300
> 
> ...so something is corrupting the modifiers field at least and maybe
> the whole ctype itself? I don't know the sparse code that well, so I'll
> need to do some more digging to determine the root cause.
> 
> -- 
> Jeff Layton <jlayton@poochiereds.net>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Layton <jlayton () poochiereds ! net>
To: linux-sparse
Subject: Re: [PATCH][RFC] err.h: silence sparse warning: dereference of noderef expression
Date: Sat, 14 Jun 2014 16:47:35 +0000
Message-ID: <20140614124735.590baead () tlielax ! poochiereds ! net>
--------------------
On Sun, 15 Jun 2014 00:05:22 +1000
Vitaly Osipov <vitaly.osipov@gmail.com> wrote:

> Which GCC? I built sparse on Ubuntu with 4.8 and -fpic - still nothing. This must be Fedora specific somehow. 
> 
> 
> Regards,
> 
> Vitaly 
> 

$ gcc --version
gcc (GCC) 4.8.2 20131212 (Red Hat 4.8.2-7)

Yeah, playing around a little more, it seems like -fpic alone is not
enough to trigger it, but CFLAGS='-O2 -fpic' seems to cause it. Can you
confirm whether that helps you to reproduce it as well? Also, I'm on
x86_64 (in case the arch matters here).


> > On 14 Jun 2014, at 11:44 pm, Jeff Layton <jlayton@poochiereds.net> wrote:
> > 
> > On Fri, 13 Jun 2014 08:56:50 -0700
> > Josh Triplett <josh@joshtriplett.org> wrote:
> > 
> >>> On Fri, Jun 13, 2014 at 08:05:37AM -0400, Jeff Layton wrote:
> >>> On Thu, 12 Jun 2014 18:06:25 +1000
> >>> Vitaly Osipov <vitaly.osipov@gmail.com> wrote:
> >>> 
> >>>> Nothing shows up for me on x86_64, allmodconfig, linux-next from 10 of
> >>>> June. My sparse has been compiled from sources.
> >>>> 
> >>>> $ make fs/locks.o C=2 CHECK="/home/vosipov/bin/sparse"
> >>>>  CHK     include/config/kernel.release
> >>>>  CHK     include/generated/uapi/linux/version.h
> >>>>  CHK     include/generated/utsrelease.h
> >>>>  CALL    scripts/checksyscalls.sh
> >>>>  CHECK   scripts/mod/empty.c
> >>>>  CHECK   fs/locks.c
> >>>> 
> >>>> $ sparse version
> >>>> v0.5.0
> >>>> 
> >>>> $ which sparse
> >>>> /home/vosipov/bin/sparse
> >>>> 
> >>>> Regards,
> >>>> Vitaly
> >>>> 
> >>>> 
> >>>>> On Wed, Jun 11, 2014 at 11:51 PM, Jeff Layton <jlayton@poochiereds.net> wrote:
> >>>>> On Wed, 11 Jun 2014 16:11:46 +0300
> >>>>> Dan Carpenter <dan.carpenter@oracle.com> wrote:
> >>>>> 
> >>>>>>> On Wed, Jun 11, 2014 at 07:06:32AM -0400, Jeff Layton wrote:
> >>>>>>> $ rpm -q sparse
> >>>>>>> sparse-0.5.0-1.fc20.x86_64
> >>>>>>> 
> >>>>>>> I see it all over the tree, but an easy example is fs/locks.c:
> >>>>>>> 
> >>>>>>> $ make fs/locks.o C=1
> >>>>>>> make[1]: Nothing to be done for `all'.
> >>>>>>> make[1]: Nothing to be done for `relocs'.
> >>>>>>>  CHK     include/config/kernel.release
> >>>>>>>  CHK     include/generated/uapi/linux/version.h
> >>>>>>>  CHK     include/generated/utsrelease.h
> >>>>>>>  CALL    scripts/checksyscalls.sh
> >>>>>>>  CHECK   fs/locks.c
> >>>>>>> include/linux/err.h:35:16: warning: dereference of noderef expression
> >>>>>>> include/linux/err.h:30:23: warning: dereference of noderef expression
> >>>>>>> include/linux/err.h:35:16: warning: dereference of noderef expression
> >>>>>>> include/linux/err.h:30:23: warning: dereference of noderef expression
> >>>>>>>  CC      fs/locks.o
> >>>>>>> 
> >>>>>>> It has two IS_ERR calls and two PTR_ERR calls, and each generates the
> >>>>>>> warning.
> >>>>>> 
> >>>>>> I downloaded the Fedora SRPM and built the binary but I still wasn't
> >>>>>> able to reproduce the bug.
> >>>>>> 
> >>>>>> dcarpenter@speke:~/progs/kernel/devel$ /tmp/sparse/sparse-0.5.0/sparse --version
> >>>>>> 0.5.0
> >>>>>> dcarpenter@speke:~/progs/kernel/devel$ make C=2 CHECK=/tmp/sparse/sparse-0.5.0/sparse fs/locks.o
> >>>>>>  CHK     include/config/kernel.release
> >>>>>>  CHK     include/generated/uapi/linux/version.h
> >>>>>>  CHK     include/generated/utsrelease.h
> >>>>>>  CALL    scripts/checksyscalls.sh
> >>>>>> <stdin>:1226:2: warning: #warning syscall finit_module not implemented [-Wcpp]
> >>>>>> <stdin>:1229:2: warning: #warning syscall sched_setattr not implemented [-Wcpp]
> >>>>>> <stdin>:1232:2: warning: #warning syscall sched_getattr not implemented [-Wcpp]
> >>>>>> <stdin>:1235:2: warning: #warning syscall renameat2 not implemented [-Wcpp]
> >>>>>>  CHECK   scripts/mod/empty.c
> >>>>>>  CHECK   fs/locks.c
> >>>>>> dcarpenter@speke:~/progs/kernel/devel$
> >>>>>> 
> >>>>>> I'm on today's linux-next.  I can't think of a kernel configuration
> >>>>>> issue which would cause this...
> >>>>>> 
> >>>>>> regards,
> >>>>>> dan carpenter
> >>>>> 
> >>>>> Could it be arch-specific then? What arch are you using? I'm on x86_64.
> >>>>> I know that quite a few other people have mentioned seeing these
> >>>>> warnings as well, so I'm pretty sure it's not just me.
> >>> 
> >>> Ha! It turns out that my hand-built sparse also works fine, so the
> >>> problem seems to be in the Fedora package.
> >>> 
> >>> With a little trial-and-error, I figured out what's causing the
> >>> problem, but I'm a little baffled as to why it's occurring. 
> >>> 
> >>> The Fedora SRPM builds the program with -fpic. When I remove that flag,
> >>> this problem goes away. I'd appreciate any insight into why that would
> >>> break things. I doubt PIC really makes much difference security-wise in
> >>> sparse, so removing it shouldn't matter much, but I wonder if this
> >>> indicates an underlying bug in sparse itself?
> >> 
> >> Wow, that's horrifying.  I wonder if it might indicate a miscompilation
> >> by GCC.  Does the problem persist if you build with -fpic -g?  If so,
> >> you could set a few breakpoints and try to determine at what point the
> >> behavior of the two sparse binaries diverges.
> > 
> > Yeah, this is a bit disturbing. Fedora already builds with -g, so yes,
> > the problem does persist. I made a very small, simple C file that just
> > calls IS_ERR to test with.
> > 
> > Broken sparse (built with -fpic):
> > 
> > Breakpoint 1, expand_dereference (expr=0x7ffff6f12210) at expand.c:629
> > 629        if (expr->ctype->ctype.modifiers & MOD_NODEREF)
> > (gdb) p expr->ctype->ctype.modifiers
> > $3 = 0x65686374616d6e75
> > 
> > Built w/o -fpic at the same breakpoint:
> > 
> > Breakpoint 1, expand_dereference (expr=0x7ffff5e61bd0) at expand.c:629
> > 629        if (expr->ctype->ctype.modifiers & MOD_NODEREF)
> > (gdb) p expr->ctype->ctype.modifiers
> > $2 = 0x0
> > 
> > The stack at that point is:
> > 
> > (gdb) bt
> > #0  expand_dereference (expr=0x7ffff5e61bd0) at expand.c:629
> > #1  expand_preop (expr=0x7ffff5e61bd0) at expand.c:736
> > #2  expand_expression (expr=expr@entry=0x7ffff5e61bd0) at expand.c:984
> > #3  0x000000000041217a in expand_cast (expr=0x7ffff5e61c50) at expand.c:777
> > #4  expand_expression (expr=expr@entry=0x7ffff5e61c50) at expand.c:992
> > #5  0x00000000004123e2 in expand_compare (expr=0x7ffff5e61cd0) at expand.c:514
> > #6  expand_expression (expr=<optimized out>) at expand.c:978
> > #7  0x00000000004127ba in expand_preop (expr=0x7ffff5e61d10) at expand.c:752
> > #8  expand_expression (expr=<optimized out>) at expand.c:984
> > #9  0x00000000004127ba in expand_preop (expr=0x7ffff5e61d50) at expand.c:752
> > #10 expand_expression (expr=<optimized out>) at expand.c:984
> > #11 0x0000000000412364 in expand_arguments (head=0x7ffff5e39810) at expand.c:767
> > #12 expand_call (expr=0x7ffff5e61b90) at expand.c:832
> > #13 expand_expression (expr=expr@entry=0x7ffff5e61b90) at expand.c:995
> > #14 0x000000000041217a in expand_cast (expr=0x7ffff5e61e10) at expand.c:777
> > #15 expand_expression (expr=<optimized out>) at expand.c:992
> > #16 0x0000000000411c75 in expand_statement (stmt=stmt@entry=0x7ffff5fe3920) at expand.c:1202
> > #17 0x0000000000411e13 in expand_compound (stmt=0x7ffff5fe38d0) at expand.c:1133
> > #18 expand_statement (stmt=stmt@entry=0x7ffff5fe38d0) at expand.c:1164
> > #19 0x00000000004124ec in expand_expression (expr=<optimized out>) at expand.c:1007
> > #20 0x0000000000411dad in expand_statement (stmt=stmt@entry=0x7ffff5fe3880) at expand.c:1161
> > #21 0x0000000000411e13 in expand_compound (stmt=0x7ffff5fe3830) at expand.c:1133
> > #22 expand_statement (stmt=0x7ffff5fe3830) at expand.c:1164
> > #23 0x0000000000411c21 in expand_symbol (sym=sym@entry=0x7ffff5e312d0) at expand.c:1068
> > #24 0x0000000000401675 in check_symbols (list=0x7ffff6a63610) at sparse.c:281
> > #25 0x0000000000401208 in main (argc=<optimized out>, argv=<optimized out>) at sparse.c:300
> > 
> > ...so something is corrupting the modifiers field at least and maybe
> > the whole ctype itself? I don't know the sparse code that well, so I'll
> > need to do some more digging to determine the root cause.
> > 
> > -- 
> > Jeff Layton <jlayton@poochiereds.net>


-- 
Jeff Layton <jlayton@poochiereds.net>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCHv2 0/3] catch non-sign-extended '~' brainos ===

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Fri, 27 Jun 2014 11:19:00 +0000
Message-ID: <20140627111900.GA19158 () phil ! dovecot ! net>
--------------------
On Tue, Jun 10, 2014 at 10:54:04AM +0300, Phil Carmody wrote:
> Bitwise-not is often used to create masks. Unfortunately implicit conversions
> to longer types may leave the recipient with fewer set bit than he expected,
> if he started with an unsigned type. It's nice to warn that such constructs
> are dubious.
> 
> v2: cleaned up as per recommendations from Josh Triplett.

Any comments on these? 

Cheers,
Phil 
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Fri, 27 Jun 2014 17:16:23 +0000
Message-ID: <CANeU7QkVj1gm3wQ6r1=akKX9W1cQvE3Un32CD=1UBecFCaq18Q () mail ! gmail ! com>
--------------------
On Fri, Jun 27, 2014 at 4:19 AM, Phil Carmody <phil@dovecot.fi> wrote:
>
> Any comments on these?
>

Sorry I am falling behind the patches, again.

I have been thinking about your patch for a few days.

It is very common to implicit cast up, do some binary operation
then cast back down.  e.g.


static unsigned long long val;
static unsigned int ok10  = val | ~1u;
static unsigned char a;
static unsigned char ok11  = val | ~a;


Your patch will give false positive warning about those.

Do you known how many new warning does it give on the new
kernel build after apply your patch? I suspect there is a lot of
false positive. I want to do that but haven't get around to it yet.
Hint hint...

To reduce the false positive, we can check the zero extended bits
survived to the final expression. e.g. the finial expression did
down cast again and lost those bits. I also want an option to
turn this warning off because the possible false positive.

Also, if you only care about warning against up cast "~" of
unsigned type, you can do the checking at cast_to().
It will be simpler. I have a sort patch like this, given that I
did not check for the "unsigned int" type, nor do I check for
binary op. You can still get the idea.

In this way, you don't need to predict the up cast will happen
or not. You can call when the implicit up cast actually happens.

It does not solve the problem of checking down cast  after up cast
of finial expression though.

Chris

diff --git a/evaluate.c b/evaluate.c
index 7ce8c55..47e660e 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -294,8 +294,11 @@ static struct expression * cast_to(struct
expression *old, struct symbol *type)
         */
        switch (old->type) {
        case EXPR_PREOP:
-               if (old->ctype->bit_size < type->bit_size)
+               if (old->ctype->bit_size < type->bit_size) {
+                       if (old->op == '~')
+                               warning(old->pos, "dubious zero-extended '~'");
                        break;
+               }
                if (old->op == '~') {
                        old->ctype = type;
                        old->unop = cast_to(old->unop, type);
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Mon, 30 Jun 2014 17:27:27 +0000
Message-ID: <CANeU7Q=Tjexvw6LY3ZKiO8B3PvYiFo405DHYpuySJkevwxXeFA () mail ! gmail ! com>
--------------------
On Mon, Jun 30, 2014 at 9:44 AM, Christopher Li <sparse@chrisli.org> wrote:
> That give me 565 new warning. I attach the file here.
>
> I sample some, all the one I saw are false positive.

The real interesting question is, how many real kernel bug in that
565 warnings? It take some human effort to determine the warning
is false positive or not. If most of the warning are false positive, then
the warning is not usable.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Tue, 01 Jul 2014 19:42:51 +0000
Message-ID: <CANeU7QnQHzUHwP3imkcX2JX0NrR50rYjjXdObO1D03oHXQ82aA () mail ! gmail ! com>
--------------------
On Tue, Jul 1, 2014 at 4:30 AM, Phil Carmody <phil@dovecot.fi> wrote:
>
> With unsigned, it becomes a lot quieter, but still much noiser than my
> original. (I have a v3 which excludes an idiom using '/'.)
>

Yes, because it cover more than just binary operations.
If you consider zero extend the unsigned type introducing error,
the binary operation just how you use the error bits.

>> #define NLMSG_ALIGNTO    4U
>
> I consider that, pedantically, to be worth fixing. alignments are defined
> by the C standard to be of type size_t. It should either be ((size_t)4)

((size_t)4) is hell ugly.


> if you care about the precise type, or 4 if you don't, but not 4U. The
> 'U' adds nothing apart from a way to create an incorrect mask.

That is debatable. Enforcing 4U vs 4 is annoying and buy you nothing
most of the case.

I don't consider alignment  being 4U as wrong by itself.  The key question
is how you use it.

if we introduce:

#define ALIGNMASK(align)   (size_t)(~((align) -1))

And we always use the macro to create mask from alignment value.
Then there is no need to enforce signedness of the var passed into the
macro. Hey, it might even read better.


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Wed, 02 Jul 2014 07:43:29 +0000
Message-ID: <20140702074329.GD19158 () phil ! dovecot ! net>
--------------------
On Tue, Jul 01, 2014 at 12:42:51PM -0700, Christopher Li wrote:
> On Tue, Jul 1, 2014 at 4:30 AM, Phil Carmody <phil@dovecot.fi> wrote:
> > With unsigned, it becomes a lot quieter, but still much noiser than my
> > original. (I have a v3 which excludes an idiom using '/'.)
> 
> Yes, because it cover more than just binary operations.
> If you consider zero extend the unsigned type introducing error,
> the binary operation just how you use the error bits.
> 
> >> #define NLMSG_ALIGNTO    4U
> >
> > I consider that, pedantically, to be worth fixing. alignments are defined
> > by the C standard to be of type size_t. It should either be ((size_t)4)
> 
> ((size_t)4) is hell ugly.

Do you care about the precise type of the value?
If you do, then it may be ugly, but it's pretty much obligatory.
And if you don't care about the precise type...

> > if you care about the precise type, or 4 if you don't, but not 4U. The
> > 'U' adds nothing apart from a way to create an incorrect mask.
> 
> That is debatable. Enforcing 4U vs 4 is annoying and buy you nothing
> most of the case.

What do you mean by "enforcing"? I consider persuading people to write
simpler, less breakable code to be a good thing.

> I don't consider alignment being 4U as wrong by itself. The key question
> is how you use it.

Absolutely. And doing a ~ and then an up-cast is using it dangerously.
Isn't that what sparse is supposed to be checking for?

> if we introduce:
> 
> #define ALIGNMASK(align)   (size_t)(~((align) -1))
> 
> And we always use the macro to create mask from alignment value.
> Then there is no need to enforce signedness of the var passed into the
> macro. Hey, it might even read better.

Put 4U in that, and it still has the flaw of creating a truncated mask.
Put 4 in and it doesn't.

Do you still want to defend 4U?

Phil

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Wed, 02 Jul 2014 08:51:25 +0000
Message-ID: <CANeU7Q=RV4xC8REQg_LP5VJz9-WB-+o6UEo5N2Fea9Y2WqdSnA () mail ! gmail ! com>
--------------------
On Wed, Jul 2, 2014 at 12:43 AM, Phil Carmody <phil@dovecot.fi> wrote:
>
> Do you care about the precise type of the value?
> If you do, then it may be ugly, but it's pretty much obligatory.
> And if you don't care about the precise type...

Yes, I make a mistake on my macro. But alignment can be
precise being unsigned. In a 32 bit system, what if I want to make
a 2G align memory? Your signed alignment will force to be a
negative value. Which is not precise.

>> I don't consider alignment being 4U as wrong by itself. The key question
>> is how you use it.
>
> Absolutely. And doing a ~ and then an up-cast is using it dangerously.
> Isn't that what sparse is supposed to be checking for?

Well, you still need to get the false positive rate down. Currently then
signal to noise ratio is too low. I would not recommend turning it on
by default. Did you find some real bug in that 500 error report? Real
bug I mean it produce actually bug on the object code it generated.

>
>> if we introduce:
>>
>> #define ALIGNMASK(align)   (size_t)(~((align) -1))
>>
>> And we always use the macro to create mask from alignment value.
>> Then there is no need to enforce signedness of the var passed into the
>> macro. Hey, it might even read better.
>
> Put 4U in that, and it still has the flaw of creating a truncated mask.
> Put 4 in and it doesn't.

Right, I make a mistake on that macro. Good catch.  How about

#define ALIGNMASK(align)   (~((size_t)((align) -1)))

Will you be happy if I use 4U with that macro?

My point is, with the right macro, you can still use 4U to create
alignment. We don't have to fight over 4U vs 4.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: Re: [PATCHv2 0/3] catch non-sign-extended '~' brainos
Date: Wed, 02 Jul 2014 09:28:53 +0000
Message-ID: <20140702092853.GE19158 () phil ! dovecot ! net>
--------------------
On Wed, Jul 02, 2014 at 01:51:25AM -0700, Christopher Li wrote:
> On Wed, Jul 2, 2014 at 12:43 AM, Phil Carmody <phil@dovecot.fi> wrote:
> >
> > Do you care about the precise type of the value?
> > If you do, then it may be ugly, but it's pretty much obligatory.
> > And if you don't care about the precise type...
> 
> Yes, I make a mistake on my macro. But alignment can be
> precise being unsigned. In a 32 bit system, what if I want to make
> a 2G align memory? Your signed alignment will force to be a
> negative value. Which is not precise.

You always have the option of an explicit size_t in that case.

> >> I don't consider alignment being 4U as wrong by itself. The key question
> >> is how you use it.
> >
> > Absolutely. And doing a ~ and then an up-cast is using it dangerously.
> > Isn't that what sparse is supposed to be checking for?
> 
> Well, you still need to get the false positive rate down. Currently then
> signal to noise ratio is too low. I would not recommend turning it on
> by default. Did you find some real bug in that 500 error report? Real
> bug I mean it produce actually bug on the object code it generated.

I'd like to say I found a real bug in an different open source package
with that check enabled. However, that's not true; I wrote that check
because I was perturbed that sparse hadn't found the bug which I'd just 
had to debug manually. So yes, it can catch real world issues.

It's much more likely to find issues in userspace programs, where there's
more likelyhood of wanting to allocate blocks of memory larger than 4G,
of course.

> >> if we introduce:
> >>
> >> #define ALIGNMASK(align)   (size_t)(~((align) -1))
> >>
> >> And we always use the macro to create mask from alignment value.
> >> Then there is no need to enforce signedness of the var passed into the
> >> macro. Hey, it might even read better.
> >
> > Put 4U in that, and it still has the flaw of creating a truncated mask.
> > Put 4 in and it doesn't.
> 
> Right, I make a mistake on that macro. Good catch.  How about
> 
> #define ALIGNMASK(align)   (~((size_t)((align) -1)))
> 
> Will you be happy if I use 4U with that macro?

Indeed. However, if the only use of the 4U is when it is expanded
into the expression (size_t)((4U) -1), then what was the 'U' again?
It still seems like a cargo cult artefact.

> My point is, with the right macro, you can still use 4U to create
> alignment. We don't have to fight over 4U vs 4.

Agreed. And how do you know if you've got the right macro?
It's on that question that I'd like sparse to step in and help.

Phil
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCHv2 2/3] sparse: detect non-sign-extended masks created by '~' ===

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: [PATCHv2 2/3] sparse: detect non-sign-extended masks created by '~'
Date: Tue, 10 Jun 2014 07:54:06 +0000
Message-ID: <1402386847-23477-3-git-send-email-phil () dovecot ! fi>
--------------------
Consider the operation of rounding up to the nearest multiple of a power of 2.
e.g.  #define ALLOC_SIZE(t) ((sizeof(t) + ASIZE - 1) & ~(ASIZE - 1))

If ASIZE is unfortunately defined as an unsigned type smaller than size_t,
then the ~ will not undergo sign-bit extension, and an incorrect mask will
be used. If used in a memory allocation context this could be fatal.

Warn about such dubious 'large op ~short' usage.

v2: pulled noisy repeated parts into a helper

Signed-off-by: Phil Carmody <phil@dovecot.fi>
---
 evaluate.c | 26 ++++++++++++++++++++++++++
 1 file changed, 26 insertions(+)

diff --git a/evaluate.c b/evaluate.c
index 9052962..a16aa45 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -886,6 +886,25 @@ static struct symbol *evaluate_logical(struct expression *expr)
 	return &int_ctype;
 }
 
+static int int_size_cmp(struct symbol *left, struct symbol *right)
+{
+	left = integer_promotion(left);
+	right = integer_promotion(right);
+
+	return (left->bit_size > right->bit_size) ? 1 :
+		(right->bit_size > left->bit_size) ? -1 : 0;
+}
+
+static void check_masking(struct expression *expr, int op, int is_l,
+			  struct expression *sexpr, struct symbol *stype)
+{
+	if ((sexpr->type == EXPR_PREOP)
+	    && (sexpr->op == '~')
+	    && (stype->ctype.modifiers & MOD_UNSIGNED))
+		warning(expr->pos, "dubious zero-extended '~': %sx %c %sy",
+			"~"+!is_l, op, "~"+!!is_l);
+}
+
 static struct symbol *evaluate_binop(struct expression *expr)
 {
 	struct symbol *ltype, *rtype, *ctype;
@@ -917,6 +936,7 @@ static struct symbol *evaluate_binop(struct expression *expr)
 			rtype = integer_promotion(rtype);
 		} else {
 			// The rest do usual conversions
+			int size_cmp;
 			int left_not  = expr->left->type == EXPR_PREOP
 					&& expr->left->op == '!';
 			int right_not = expr->right->type == EXPR_PREOP
@@ -927,6 +947,12 @@ static struct symbol *evaluate_binop(struct expression *expr)
 					op,
 					right_not ? "!" : "");
 
+			size_cmp = int_size_cmp(ltype, rtype);
+			if (size_cmp > 0)
+				check_masking(expr, op, 0, expr->right, rtype);
+			else if (size_cmp < 0)
+				check_masking(expr, op, 1, expr->left, ltype);
+
 			ltype = usual_conversions(op, expr->left, expr->right,
 						  lclass, rclass, ltype, rtype);
 			ctype = rtype = ltype;
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [PATCHv2 3/3] validation: dubious bitwise operations with bitwise nots ===

From: Phil Carmody <phil () dovecot ! fi>
To: linux-sparse
Subject: [PATCHv2 3/3] validation: dubious bitwise operations with bitwise nots
Date: Tue, 10 Jun 2014 07:54:07 +0000
Message-ID: <1402386847-23477-4-git-send-email-phil () dovecot ! fi>
--------------------
Add some bitwise not tests.

v2: add the double-twiddle case, and made less cryptic.

Signed-off-by: Phil Carmody <phil@dovecot.fi>
---
 validation/dubious-bitwise-with-not.c | 38 ++++++++++++++++++++++++++++++++++-
 1 file changed, 37 insertions(+), 1 deletion(-)

diff --git a/validation/dubious-bitwise-with-not.c b/validation/dubious-bitwise-with-not.c
index c48bcae..5e232b8 100644
--- a/validation/dubious-bitwise-with-not.c
+++ b/validation/dubious-bitwise-with-not.c
@@ -10,8 +10,34 @@ static unsigned int ok5  = !1 && !2;
 static unsigned int bad5 = !1 &  !2;
 static unsigned int ok6  = !1 || !2;
 static unsigned int bad6 = !1 |  !2;
+static unsigned long long ok7a  = 0x100000001ull & ~1;
+static unsigned long long ok7b  = 0x100000001ull & ~1ull;
+static unsigned long long bad7  = 0x100000001ull & ~1u;
+static unsigned long long ok8a  = ~1    & 0x100000001ull;
+static unsigned long long ok8b  = ~1ull & 0x100000001ull;
+static unsigned long long bad8  = ~1u   & 0x100000001ull;
+static unsigned long long ok9a  = 0x100000001ull | ~1;
+static unsigned long long ok9b  = 0x100000001ull | ~1ull;
+static unsigned long long bad9  = 0x100000001ull | ~1u;
+static unsigned long long ok10a = ~1    | 0x100000001ull;
+static unsigned long long ok10b = ~1ull | 0x100000001ull;
+static unsigned long long bad10 = ~1u   | 0x100000001ull;
+static unsigned long long ok11a = 0x100000001ull + ~1;
+static unsigned long long ok11b = 0x100000001ull + ~1ull;
+static unsigned long long bad11 = 0x100000001ull + ~1u;
+static unsigned long long ok12a = ~1    + 0x100000001ull;
+static unsigned long long ok12b = ~1ull + 0x100000001ull;
+static unsigned long long bad12 = ~1u   + 0x100000001ull;
+static unsigned long long ok13a = 0x100000001ull - ~1;
+static unsigned long long ok13b = 0x100000001ull - ~1ull;
+static unsigned long long bad13 = 0x100000001ull - ~1u;
+static unsigned long long ok14a = ~1    - 0x100000001ull;
+static unsigned long long ok14b = ~1ull - 0x100000001ull;
+static unsigned long long bad14 = ~1u   - 0x100000001ull;
+static unsigned long long bad15 = ~0x100000001ull ^ ~1u;
+static unsigned long long bad16 = ~1u   ^ ~0x100000001ull;
 /*
- * check-name: Dubious bitwise operation on !x
+ * check-name: Dubious bitwise operations with !x or ~x
  *
  * check-error-start
 dubious-bitwise-with-not.c:2:31: warning: dubious: !x & y
@@ -20,5 +46,15 @@ dubious-bitwise-with-not.c:6:31: warning: dubious: x & !y
 dubious-bitwise-with-not.c:8:31: warning: dubious: x | !y
 dubious-bitwise-with-not.c:10:31: warning: dubious: !x & !y
 dubious-bitwise-with-not.c:12:31: warning: dubious: !x | !y
+dubious-bitwise-with-not.c:15:50: warning: dubious zero-extended '~': x & ~y
+dubious-bitwise-with-not.c:18:41: warning: dubious zero-extended '~': ~x & y
+dubious-bitwise-with-not.c:21:50: warning: dubious zero-extended '~': x | ~y
+dubious-bitwise-with-not.c:24:41: warning: dubious zero-extended '~': ~x | y
+dubious-bitwise-with-not.c:27:50: warning: dubious zero-extended '~': x + ~y
+dubious-bitwise-with-not.c:30:41: warning: dubious zero-extended '~': ~x + y
+dubious-bitwise-with-not.c:33:50: warning: dubious zero-extended '~': x - ~y
+dubious-bitwise-with-not.c:36:41: warning: dubious zero-extended '~': ~x - y
+dubious-bitwise-with-not.c:37:51: warning: dubious zero-extended '~': x ^ ~y
+dubious-bitwise-with-not.c:38:41: warning: dubious zero-extended '~': ~x ^ y
  * check-error-end
  */
-- 
2.0.0

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Wed, 12 Nov 2014 15:22:43 +0000
Message-ID: <CANeU7Qn8J2dn4V5Mx1WzUM9q+m=K66yUuEkN39bH_djRoBzqNA () mail ! gmail ! com>
--------------------
On Wed, Nov 12, 2014 at 9:35 PM, Matt Fleming <matt.fleming@intel.com> wrote:
> (Pulling sparse list in)
>
> On Wed, 2014-11-12 at 11:31 +0100, Ard Biesheuvel wrote:
>> > tree:   git://git.kernel.org/pub/scm/linux/kernel/git/mfleming/efi.git next
>> >>> arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expression (different modifiers)
>> >    arch/x86/boot/compressed/eboot.c:26:16:    expected struct efi_config const [pure] *
>> >    arch/x86/boot/compressed/eboot.c:26:16:    got struct efi_config *static [toplevel] efi_early
>> >
>>
>> This smells like a sparse bug: __pure applies to functions only, so
>> there is no way we could ever return something with the __pure
>> modifier attached.

That make sense.

>
> Yes, that warning does look a little strange.
>
> Christopher, Fengguang, what do you guys think?
>

Do you get me a small test function that reproduce the error with sparse?

We can even add a test case for it.

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Wed, 12 Nov 2014 15:34:33 +0000
Message-ID: <CAKv+Gu-L2EoqioZamh9arLSkXzQF4y=FDykk0YK1XvNkRGC-xg () mail ! gmail ! com>
--------------------
On 12 November 2014 16:22, Christopher Li <sparse@chrisli.org> wrote:
> On Wed, Nov 12, 2014 at 9:35 PM, Matt Fleming <matt.fleming@intel.com> wrote:
>> (Pulling sparse list in)
>>
>> On Wed, 2014-11-12 at 11:31 +0100, Ard Biesheuvel wrote:
>>> > tree:   git://git.kernel.org/pub/scm/linux/kernel/git/mfleming/efi.git next
>>> >>> arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expression (different modifiers)
>>> >    arch/x86/boot/compressed/eboot.c:26:16:    expected struct efi_config const [pure] *
>>> >    arch/x86/boot/compressed/eboot.c:26:16:    got struct efi_config *static [toplevel] efi_early
>>> >
>>>
>>> This smells like a sparse bug: __pure applies to functions only, so
>>> there is no way we could ever return something with the __pure
>>> modifier attached.
>
> That make sense.
>
>>
>> Yes, that warning does look a little strange.
>>
>> Christopher, Fengguang, what do you guys think?
>>
>
> Do you get me a small test function that reproduce the error with sparse?
>
> We can even add a test case for it.
>

Well, I spent some time playing around with this:

This one is accepted:

static __attribute__((__pure__)) int pure1(void)
{
    int i = 0;
    return i;
}

This one is not accepted:

static __attribute__((__pure__)) void *pure2(void)
{
    void *i = (void *)0;
    return i;
}

and produces

pure.c:11:16: warning: incorrect type in return expression (different modifiers)
pure.c:11:16:    expected void [pure] *
pure.c:11:16:    got void *i

I also noticed that the following triggers a warning as well:

static void*(*f)(void) = pure2;

(using the definition of pure2 as above)

pure.c:14:26: warning: incorrect type in initializer (different modifiers)
pure.c:14:26:    expected void *( *static [toplevel] f )( ... )
pure.c:14:26:    got void [pure] *( static [toplevel] *<noident> )( ... )

i.e., you are not allowed to assign a pointer to a pure function to a
non-pure function pointer, which is quite ok. The opposite should be
an error, though.

This patch

diff --git a/evaluate.c b/evaluate.c
index a5a830978bda..2e9ad8b7b31d 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -1375,7 +1375,7 @@ static int compatible_assignment_types(struct
expression *expr, struct symbol *t
                        goto Cast;
                }
                /* It's OK if the target is more volatile or const
than the source */
-               typediff = type_difference(&t->ctype, &s->ctype, 0, mod1);
+               typediff = type_difference(&t->ctype, &s->ctype, 0,
mod1 | MOD_PURE);
                if (typediff)
                        goto Err;
                return 1;

fixes the first issue, but I am not sure if it is an appropriate fix or not.

-- 
Ard.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Sun, 16 Nov 2014 17:58:44 +0000
Message-ID: <CAKv+Gu8DB6tCrpTqiCSWDGU4cRO1u3hqO9-K-cON5ODDMgsx1Q () mail ! gmail ! com>
--------------------
On 16 November 2014 11:13, Christopher Li <sparse@chrisli.org> wrote:
> On Wed, Nov 12, 2014 at 11:34 PM, Ard Biesheuvel
> <ard.biesheuvel@linaro.org> wrote:
>>
>> Well, I spent some time playing around with this:
>>
>> This one is accepted:
>>
>> static __attribute__((__pure__)) int pure1(void)
>> {
>>     int i = 0;
>>     return i;
>> }
>>
>> This one is not accepted:
>>
>> static __attribute__((__pure__)) void *pure2(void)
>> {
>>     void *i = (void *)0;
>>     return i;
>> }
>>
>
> Thanks for the test case. I have commit your test case with a bit more
> test case regarding function pointer assign.
>
> The change is in chrisl repository reveiw-pure-attr branch:
> https://git.kernel.org/cgit/devel/sparse/chrisl/sparse.git/log/?h=review-pure-attr
>
> I purpose this fix for it. It can pass your test case.
> This patch limit the pure attribute to functions.
> The pure bit should not be a modifier in the first place.
> But that is a much bigger change.
>
> Can you please help me test and review the change?
>

Sure!

I can confirm that this patch removes the incorrect warning during the
kernel build that triggered all of this.
However, I think your testcase is not quite correct: in particular,
this assignment

static void*(*f1_err)(void) = pure1;

is perfectly ok: it is fine to call a pure function through a non-pure
function pointer, but not the other way around. For instance, looking
at the efi example

arch/x86/boot/compressed/eboot.h:

__pure const struct efi_config *__efi_early(void);

#define efi_call_early(f, ...)                                         \
       __efi_early()->call(__efi_early()->f, __VA_ARGS__);

Note the 2 calls to __efi_early(). The purpose of __pure here is to
instruct GCC to emit only a single call to __efi_early(), because it
will return the same value both times.

In other words, GCC is allowed emit fewer calls to a __pure function
than there are calls in the source, and the same applies to calls
through a pure function pointer. However, if the pure pointer points
to a function that is not pure, i.e., back-to-back invocations may
legally return different results, then calling it through a pure
pointer is a bug, and needs to be flagged.

Regards,
Ard.




> diff --git a/evaluate.c b/evaluate.c
> index 035e448..4c8b64a 100644
> --- a/evaluate.c
> +++ b/evaluate.c
> @@ -632,6 +632,8 @@ const char *type_difference(struct ctype *c1,
> struct ctype *c2,
>         struct symbol *t1 = c1->base_type;
>         struct symbol *t2 = c2->base_type;
>         int move1 = 1, move2 = 1;
> +       unsigned long ignore = ~MOD_PURE;
> +
>         mod1 |= c1->modifiers;
>         mod2 |= c2->modifiers;
>         for (;;) {
> @@ -728,6 +730,7 @@ const char *type_difference(struct ctype *c1,
> struct ctype *c2,
>                         as1 = t1->ctype.as;
>                         mod2 = t2->ctype.modifiers;
>                         as2 = t2->ctype.as;
> +                       ignore = ~0;
>
>                         if (base1->variadic != base2->variadic)
>                                 return "incompatible variadic arguments";
> @@ -778,7 +781,7 @@ const char *type_difference(struct ctype *c1,
> struct ctype *c2,
>         }
>         if (as1 != as2)
>                 return "different address spaces";
> -       if ((mod1 ^ mod2) & ~MOD_IGNORE & ~MOD_SIGNEDNESS)
> +       if ((mod1 ^ mod2) & ~MOD_IGNORE & ~MOD_SIGNEDNESS & ignore)
>                 return "different modifiers";
>         return NULL;
>  }
> diff --git a/show-parse.c b/show-parse.c
> index fb54375..f274431 100644
> --- a/show-parse.c
> +++ b/show-parse.c
> @@ -326,6 +326,7 @@ deeper:
>                         was_ptr = 0;
>                 }
>                 append(name, "( ... )");
> +               mod = sym->ctype.modifiers;
>                 break;
>
>         case SYM_STRUCT:
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Mon, 17 Nov 2014 00:38:06 +0000
Message-ID: <CANeU7Qmo4t42N6A7ktB9GL2Ho0K9RqkJq3g0jn7s-qb5V2Ly9Q () mail ! gmail ! com>
--------------------
On Mon, Nov 17, 2014 at 1:58 AM, Ard Biesheuvel
<ard.biesheuvel@linaro.org> wrote:
> I can confirm that this patch removes the incorrect warning during the
> kernel build that triggered all of this.
> However, I think your testcase is not quite correct: in particular,
> this assignment
>
> static void*(*f1_err)(void) = pure1;

I see. Thanks for the review. So the above case should not raise
error. However, the following one should:

static __pure void *(*f3_err) = non_pure_func;

I got it the other way around. I will add that to the test case
and send out the second round review.

> Note the 2 calls to __efi_early(). The purpose of __pure here is to
> instruct GCC to emit only a single call to __efi_early(), because it
> will return the same value both times.

That is good to know.

> In other words, GCC is allowed emit fewer calls to a __pure function
> than there are calls in the source, and the same applies to calls
> through a pure function pointer. However, if the pure pointer points
> to a function that is not pure, i.e., back-to-back invocations may
> legally return different results, then calling it through a pure
> pointer is a bug, and needs to be flagged.

I am convinced :-)

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Mon, 17 Nov 2014 00:59:03 +0000
Message-ID: <CANeU7Qnd=AoE1ty=4gTrQQh6nKYWdA2WNKwm8s+GNnU9E6XQRQ () mail ! gmail ! com>
--------------------
On Mon, Nov 17, 2014 at 2:22 AM, Josh Triplett <josh@joshtriplett.org> wrote:
>
> Wait, is the above being parsed as applying the pure attribute to the
> return value rather than to the function?  Or is that not the issue
> here?

That seems to be the case here, e.g.  "__pure int pure1(long x);"
Currently sparse parse it as:
<node pure1>
    <function>
        <base type int>  [pure]

Ideally it should be:
<node pure1>
    <function> [pure]
        <base type int>

There is reason sparse does that. Sparse parse "__pure int" as a base
type to hold the __pure. The parse don't know if that is a function or
a function
pointer yet.

I haven't look at move the [pure] to function node. That is likely
a much bigger change.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Mon, 17 Nov 2014 15:35:46 +0000
Message-ID: <CANeU7QkZKv+c1y-_9DsvV-EqKnmm+NjUEGxhZBqSF_5AJ+XT1g () mail ! gmail ! com>
--------------------
On Mon, Nov 17, 2014 at 8:38 AM, Christopher Li <sparse@chrisli.org> wrote:
> I see. Thanks for the review. So the above case should not raise
> error. However, the following one should:
>
> static __pure void *(*f3_err) = non_pure_func;
>
> I got it the other way around. I will add that to the test case
> and send out the second round review.

I send push out the v2 version of the test case at
https://git.kernel.org/cgit/devel/sparse/chrisl/sparse.git/log/?h=review-pure-attr2

I haven't include the fix part yet. Do you see any thing wrong with the test
case?

Thanks

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Tue, 18 Nov 2014 16:09:37 +0000
Message-ID: <CANeU7Q=tQOotWvG+LcrWBqgDYMANaB71Gr_nv15jS9_0EiUetg () mail ! gmail ! com>
--------------------
On Tue, Nov 18, 2014 at 12:24 AM, Ard Biesheuvel
<ard.biesheuvel@linaro.org> wrote:
>
> No, the test case looks correct now. You may want to add a conflicting
> definition, for completeness, as that is an important case for sparse
> to verify.
> So you could just add
>
> static void *pure1(void); // conflicting declaration

Just to confirm. If function declare as non pure then second time
declare as pure, that  is a conflict error. That is very different from other
C attributes. C allow function declare attribute incrementally.

If what you said is true, then pure attribute is actually acting like a modifier
which don't fix not other non pure attribute.

> at the bottom, and ensure it is flagged by sparse as an error after
> you make your changes.

I am curios how does GCC behave on this incremental declare of pure
attribute. I just test it. GCC does not warn on the conflicting declare.

GCC seems warn on some thing shouldn't warn on the test case:

function "f2_ok" and "f5" shouldn't been warned. Strange.

validation/pure-function.c:14:1: warning: '__pure__' attribute ignored
[-Wattributes]
 static __attribute__((__pure__)) void*(*f2_ok)(void) = pure1;
 ^
validation/pure-function.c:15:1: warning: '__pure__' attribute ignored
[-Wattributes]
 static __attribute__((__pure__)) void*(*f3_error)(void) = non_pure1;
 ^
validation/pure-function.c:29:1: warning: '__pure__' attribute ignored
[-Wattributes]
 static __attribute__((__pure__)) int(*f5)(void) = pure2;
 ^
validation/pure-function.c:30:1: warning: '__pure__' attribute ignored
[-Wattributes]
 static __attribute__((__pure__)) int(*f6_error)(void) = non_pure2;


Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Wed, 19 Nov 2014 02:53:36 +0000
Message-ID: <CANeU7Q=uCR6P41F72J0X6c2=fgU5eefPj1NrzfnoYRtCuzYxYg () mail ! gmail ! com>
--------------------
On Wed, Nov 19, 2014 at 12:38 AM, Ard Biesheuvel
<ard.biesheuvel@linaro.org> wrote:
> Well, that is how sparse currently treats it, and I think that is correct.
> If an extern declaration in a .h file specifies  __pure, then GCC may
> legally emit fewer calls to that function than appear in the source.
> So if the actual implementation in the .c file is not __pure, then you
> have an error.

OK. I just want to figure out what is the right thing to do here.
It is ambiguous when the second time function declare without pure attribute,
weather it should follow the incremental declare rule or conflicting error.

If follow the C incremental declare rule, there is no error there.
It just an incomplete declare, compiler will internally merge all the
declare in the same scope and apply that to the final function.

e.g.
static __attribute__((noreturn)) void deadloop(void);

static void deadloop(void)
{
}

gcc will treat the second deadloop() function has noreturn attribute,
even though it does not have one in the second time declare.
That is why Gcc warns the function does return:
 /tmp/noreturn.c: In function 'deadloop':
/tmp/noreturn.c:6:1: warning: 'noreturn' function does return [enabled
by default]
 }

I try it on gcc, gcc does not emit error for the pure attribute conflicting.
That seems indicate gcc follow the incremental declare rule rather than
conflicting error.

Sparse has the symbol->same_symbol chain for that reason as well.
It can be used for merging different declare of the same function.
Some declare provide more detail specification, some did not.

> """
> static __attribute__((__pure__)) int pure2(void)
> {
> int i = 0;
> return i;
> }
> static int pure2(void); // error here
> """

See above. I am not sure that is an error here if we follow
the incremental declare rule.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Ard Biesheuvel <ard.biesheuvel () linaro ! org>
To: linux-sparse
Subject: Re: [efi:next 2/3] arch/x86/boot/compressed/eboot.c:26:16: sparse: incorrect type in return expressi
Date: Wed, 19 Nov 2014 11:31:08 +0000
Message-ID: <CAKv+Gu93S6bRjAoOnWdvkAmqRtaSK2z3mzP0czdttVQPuC0sSQ () mail ! gmail ! com>
--------------------
On 19 November 2014 03:53, Christopher Li <sparse@chrisli.org> wrote:
> On Wed, Nov 19, 2014 at 12:38 AM, Ard Biesheuvel
> <ard.biesheuvel@linaro.org> wrote:
>> Well, that is how sparse currently treats it, and I think that is correct.
>> If an extern declaration in a .h file specifies  __pure, then GCC may
>> legally emit fewer calls to that function than appear in the source.
>> So if the actual implementation in the .c file is not __pure, then you
>> have an error.
>
> OK. I just want to figure out what is the right thing to do here.
> It is ambiguous when the second time function declare without pure attribute,
> weather it should follow the incremental declare rule or conflicting error.
>
> If follow the C incremental declare rule, there is no error there.
> It just an incomplete declare, compiler will internally merge all the
> declare in the same scope and apply that to the final function.
>
> e.g.
> static __attribute__((noreturn)) void deadloop(void);
>
> static void deadloop(void)
> {
> }
>
> gcc will treat the second deadloop() function has noreturn attribute,
> even though it does not have one in the second time declare.
> That is why Gcc warns the function does return:
>  /tmp/noreturn.c: In function 'deadloop':
> /tmp/noreturn.c:6:1: warning: 'noreturn' function does return [enabled
> by default]
>  }
>
> I try it on gcc, gcc does not emit error for the pure attribute conflicting.
> That seems indicate gcc follow the incremental declare rule rather than
> conflicting error.
>

That may be the case, but GCC also does not warn if you are violating
the pureness rules.
For example, this function

__attribute__((__pure__)) int foo(void)
{
  static int i = 0;
  return ++i;
}

is obviously not pure, but GCC does not warn about that. But yes, GCC
follows the incremental rule, so if you mark a function as 'pure' only
in the header file, but not in the definition, then it will still be
considered pure.

> Sparse has the symbol->same_symbol chain for that reason as well.
> It can be used for merging different declare of the same function.
> Some declare provide more detail specification, some did not.
>
>> """
>> static __attribute__((__pure__)) int pure2(void)
>> {
>> int i = 0;
>> return i;
>> }
>> static int pure2(void); // error here
>> """
>
> See above. I am not sure that is an error here if we follow
> the incremental declare rule.
>

I think you are right. It is fairly common practice to define
attributes for a function /definition/ by preceding it with a
definition. e.g.,

int foo(void) __attribute__((__pure__));
int foo(void)
{
  static int i = 0;
  return ++i;
}

so this is obviously not an error.

So bottom line is that GCC does not warn about violating pureness
rules, and using the incremental declare rule seems appropriate, so
perhaps sparse should ignore pure altogether?

-- 
Ard.
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [next:master 4003/11577] drivers/usb/gadget/function/f_uac2.c:1595:1: sparse: symbol ===

From: Fengguang Wu <fengguang.wu () intel ! com>
To: linux-sparse
Subject: Re: [next:master 4003/11577] drivers/usb/gadget/function/f_uac2.c:1595:1: sparse: symbol
Date: Thu, 11 Dec 2014 04:30:25 +0000
Message-ID: <20141211043025.GA3661 () wfg-t540p ! sh ! intel ! com>
--------------------
Wondering how to quiet this sparse warning.. CC Christopher and others.

On Wed, Dec 10, 2014 at 12:14:33PM +0100, Andrzej Pietrasiewicz wrote:
> Hello Fengguang,
> 
> W dniu 10.12.2014 o 10:47, kbuild test robot pisze:
> >tree:   git://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git master
> >head:   5348e33950aad8d5ab06d83cb7ac4e6b4198f773
> >commit: cb0a59f541337e646fcea15628eb46866fedb8a3 [4003/11577] usb: gadget: Kconfig: enable separate compilation of uac1/uac2 functions
> >reproduce:
> >   # apt-get install sparse
> >   git checkout cb0a59f541337e646fcea15628eb46866fedb8a3
> >   make ARCH=x86_64 allmodconfig
> >   make C=1 CF=-D__CHECK_ENDIAN__
> >
> >
> >sparse warnings: (new ones prefixed by >>)
> >
> 
> <snip>
> >>>drivers/usb/gadget/function/f_uac2.c:1595:1: sparse: symbol '__UNIQUE_ID_author__COUNTER__' has multiple initializers (originally initialized at drivers/usb/gadget/function/f_uac2.c:1594)
> >
> >vim +/__UNIQUE_ID_author__COUNTER__ +1595 drivers/usb/gadget/function/f_uac2.c
> >
> 
> <snip>
> 
> >f8f93d24 Andrzej Pietrasiewicz 2014-07-22  1592  DECLARE_USB_FUNCTION_INIT(uac2, afunc_alloc_inst, afunc_alloc);
> >f8f93d24 Andrzej Pietrasiewicz 2014-07-22  1593  MODULE_LICENSE("GPL");
> >f8f93d24 Andrzej Pietrasiewicz 2014-07-22  1594  MODULE_AUTHOR("Yadwinder Singh");
> >f8f93d24 Andrzej Pietrasiewicz 2014-07-22 @1595  MODULE_AUTHOR("Jaswinder Singh");
> >
> 
> I'm not sure what is wrong with multiple invocations of MODULE_AUTHOR in a file?
> 
> git grep -c MODULE_AUTHOR | grep -v ":1" | wc
>     299     299   10219
> 
> The above commands looks for files where MODULE_AUTHOR is used
> more than once. There are ~300 files like that in the kernel source tree.
> 
> It is true that I'm a bit puzzled by the fact that the two authors names'
> are spelled almost identically, but at the beginning of the file in question
> there are their e-mails and they are completely different so I assume the
> two names are of two distinct persons.
> 
> AP
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [sparse PATCH RFC] Revert "Revert "sparse: Bump up sizeof(_Bool) to 8 bits"" ===

From: Jeff Layton <jlayton () primarydata ! com>
To: linux-sparse
Subject: [sparse PATCH RFC] Revert "Revert "sparse: Bump up sizeof(_Bool) to 8 bits""
Date: Tue, 15 Jul 2014 15:46:40 +0000
Message-ID: <1405439200-27515-1-git-send-email-jlayton () primarydata ! com>
--------------------
This reverts commit 65be24b8ddf54164ff25febfd3d5f9c26ae3877d.
bits_in_bool was originally set to 1 bit, and then was reset to 8 to
work around some issues with LLVM. Once those were resolved it was
apparently set back to being 1 bit.

The problem here is that, at least with GCC on x86_64, a _Bool always
seems to be end up being 8 bits (which makes sense -- how would you get
a pointer to it otherwise?). If you declare and initialize an array like
this:

    static _Bool boolarray[3] = {
            [0] = 1,
            [1] = 1,
    };

...you get warnings like this (which are bogus):

    ./test.c:2:10: warning: Initializer entry defined twice
    ./test.c:3:10:   also defined here

The bits_to_bytes conversion ends up wrong because it relies on
integer division, and that causes the above bogus warning.

Reset it back to 8 bits, and add a validation test that creates the
above array to ensure that we don't end up breaking it again.

Cc: Pekka Enberg <penberg@kernel.org>
Signed-off-by: Jeff Layton <jlayton@primarydata.com>
---
 target.c                                     |  2 +-
 validation/initializer-entry-defined-twice.c | 10 ++++++++++
 validation/sizeof-bool.c                     |  6 +-----
 3 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/target.c b/target.c
index 17b228ae924c..6a535bc0b2d7 100644
--- a/target.c
+++ b/target.c
@@ -14,7 +14,7 @@ int max_alignment = 16;
 /*
  * Integer data types
  */
-int bits_in_bool = 1;
+int bits_in_bool = 8;
 int bits_in_char = 8;
 int bits_in_short = 16;
 int bits_in_int = 32;
diff --git a/validation/initializer-entry-defined-twice.c b/validation/initializer-entry-defined-twice.c
index 968e3dd1af2a..8a5bd3a95631 100644
--- a/validation/initializer-entry-defined-twice.c
+++ b/validation/initializer-entry-defined-twice.c
@@ -41,6 +41,16 @@ static struct same_offset not_an_error = {
 	.field1 = { },
 	.field2 = 0
 };
+
+/*
+ * _Bools generally take a whole byte, so ensure that we can initialize
+ * them without spewing a warning.
+ */
+static _Bool boolarray[3] = {
+	[0] = 1,
+	[1] = 1,
+};
+
 /*
  * check-name: Initializer entry defined twice
  *
diff --git a/validation/sizeof-bool.c b/validation/sizeof-bool.c
index 6c68748a0b3f..71ae1bce3699 100644
--- a/validation/sizeof-bool.c
+++ b/validation/sizeof-bool.c
@@ -4,9 +4,5 @@ static int a(void)
 }
 /*
  * check-name: sizeof(_Bool) is valid
- * check-description: sizeof(_Bool) was rejected because _Bool is not an even
- * number of bytes
- * check-error-start
-sizeof-bool.c:3:16: warning: expression using sizeof bool
- * check-error-end
+ * check-description: sizeof(_Bool) is valid
  */
-- 
1.9.3

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Layton <jeff.layton () primarydata ! com>
To: linux-sparse
Subject: Re: [sparse PATCH RFC] Revert "Revert "sparse: Bump up sizeof(_Bool) to 8 bits""
Date: Wed, 16 Jul 2014 02:23:50 +0000
Message-ID: <20140715222350.028a7bf6 () f20 ! localdomain>
--------------------
On Tue, 15 Jul 2014 12:51:02 -0700
Christopher Li <sparse@chrisli.org> wrote:

> On Tue, Jul 15, 2014 at 8:46 AM, Jeff Layton <jlayton@primarydata.com> wrote:
> >
> >
> > The problem here is that, at least with GCC on x86_64, a _Bool always
> > seems to be end up being 8 bits (which makes sense -- how would you get
> > a pointer to it otherwise?). If you declare and initialize an array like
> > this:
> >
> >     static _Bool boolarray[3] = {
> >             [0] = 1,
> >             [1] = 1,
> >     };
> >
> > ...you get warnings like this (which are bogus):
> >
> >     ./test.c:2:10: warning: Initializer entry defined twice
> >     ./test.c:3:10:   also defined here
> 
> 
> Right.  The bug is in bits_to_bytes(). It round down instead of
> round up. "bits_in_bool" is only a default value. It can be
> reset to other value by the sparse application (sparse as
> library). So the rest of the code still need to coupe with
> it.
> 
>  How about fix bits_to_bytes() to round up:
> 
> diff --git a/target.h b/target.h
> index 1030c7c..140df3c 100644
> --- a/target.h
> +++ b/target.h
> @@ -49,7 +49,7 @@ extern int enum_alignment;
> 
>  static inline int bits_to_bytes(int bits)
>  {
> -       return bits >= 0 ? bits / bits_in_char : -1;
> +       return bits >= 0 ? (bits + bits_in_char - 1) / bits_in_char : -1;
>  }
> 

This makes the bitfield.c validation test fail:

     TEST     bitfield to integer promotion (bitfields.c)
error: actual error text does not match expected error text.
error: see bitfields.c.error.* for further investigation.
--- bitfields.c.error.expected	2014-07-15 22:01:09.236942195 -0400
+++ bitfields.c.error.got	2014-07-15 22:01:09.237942176 -0400
@@ -0,0 +1,2 @@
+bitfields.c:16:19: warning: invalid access past the end of 'y' (0 1)
+bitfields.c:16:19: warning: invalid access past the end of 'y' (0 1)

Though I haven't looked in detail yet as to why it's failing.

> >
> > integer division, and that causes the above bogus warning.
> >
> > Reset it back to 8 bits, and add a validation test that creates the
> > above array to ensure that we don't end up breaking it again.
> 
> The rest of the change looks good. Thanks for the test case.
> 
> My patch is not tested. If you are OK with it, submit a V2
> or I can fix the change for you.
> 
> Thanks
> 
> Chris


-- 
Jeff Layton <jlayton@primarydata.com>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [sparse PATCH RFC] Revert "Revert "sparse: Bump up sizeof(_Bool) to 8 bits""
Date: Wed, 16 Jul 2014 03:21:40 +0000
Message-ID: <CANeU7QngLBOJ-uMV0DFY6sqyi=SbTGJZ6TNZZYnY1jsVsUf12w () mail ! gmail ! com>
--------------------
On Tue, Jul 15, 2014 at 7:23 PM, Jeff Layton
<jeff.layton@primarydata.com> wrote:
> On Tue, 15 Jul 2014 12:51:02 -0700
>> --- a/target.h
>> +++ b/target.h
>> @@ -49,7 +49,7 @@ extern int enum_alignment;
>>
>>  static inline int bits_to_bytes(int bits)
>>  {
>> -       return bits >= 0 ? bits / bits_in_char : -1;
>> +       return bits >= 0 ? (bits + bits_in_char - 1) / bits_in_char : -1;
>>  }
>>
>
> This makes the bitfield.c validation test fail:
>
>      TEST     bitfield to integer promotion (bitfields.c)
> error: actual error text does not match expected error text.
> error: see bitfields.c.error.* for further investigation.
> --- bitfields.c.error.expected  2014-07-15 22:01:09.236942195 -0400
> +++ bitfields.c.error.got       2014-07-15 22:01:09.237942176 -0400
> @@ -0,0 +1,2 @@
> +bitfields.c:16:19: warning: invalid access past the end of 'y' (0 1)
> +bitfields.c:16:19: warning: invalid access past the end of 'y' (0 1)
>
> Though I haven't looked in detail yet as to why it's failing.

Let me take a look and get back to you. I recall there are one more
place in array handling need to use  bits_to_bytes() instead of reference
the bit size directly.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Jeff Layton <jeff.layton () primarydata ! com>
To: linux-sparse
Subject: Re: [sparse PATCH RFC] Revert "Revert "sparse: Bump up sizeof(_Bool) to 8 bits""
Date: Wed, 16 Jul 2014 16:24:55 +0000
Message-ID: <20140716122455.33df512f () tlielax ! poochiereds ! net>
--------------------
On Tue, 15 Jul 2014 20:21:40 -0700
Christopher Li <sparse@chrisli.org> wrote:

> On Tue, Jul 15, 2014 at 7:23 PM, Jeff Layton
> <jeff.layton@primarydata.com> wrote:
> > On Tue, 15 Jul 2014 12:51:02 -0700
> >> --- a/target.h
> >> +++ b/target.h
> >> @@ -49,7 +49,7 @@ extern int enum_alignment;
> >>
> >>  static inline int bits_to_bytes(int bits)
> >>  {
> >> -       return bits >= 0 ? bits / bits_in_char : -1;
> >> +       return bits >= 0 ? (bits + bits_in_char - 1) / bits_in_char : -1;
> >>  }
> >>
> >
> > This makes the bitfield.c validation test fail:
> >
> >      TEST     bitfield to integer promotion (bitfields.c)
> > error: actual error text does not match expected error text.
> > error: see bitfields.c.error.* for further investigation.
> > --- bitfields.c.error.expected  2014-07-15 22:01:09.236942195 -0400
> > +++ bitfields.c.error.got       2014-07-15 22:01:09.237942176 -0400
> > @@ -0,0 +1,2 @@
> > +bitfields.c:16:19: warning: invalid access past the end of 'y' (0 1)
> > +bitfields.c:16:19: warning: invalid access past the end of 'y' (0 1)
> >
> > Though I haven't looked in detail yet as to why it's failing.
> 
> Let me take a look and get back to you. I recall there are one more
> place in array handling need to use  bits_to_bytes() instead of reference
> the bit size directly.
> 
> Chris

Thanks, I think I might have found it. init_ctype tries to correct for
the fact that bits_to_bytes rounds up instead of down. With the
corrected function, we don't need that correction anymore.

I'll send the v2 patch soon, which seems to do the right thing.

Thanks!
-- 
Jeff Layton <jlayton@primarydata.com>
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: [sparse PATCH RFC] Revert "Revert "sparse: Bump up sizeof(_Bool) to 8 bits""
Date: Wed, 16 Jul 2014 21:39:14 +0000
Message-ID: <CANeU7Qkc6LrqM4HiLzirYeKfpnU-d10PyYmYpOr+s2u-K5w_BQ () mail ! gmail ! com>
--------------------
On Wed, Jul 16, 2014 at 9:24 AM, Jeff Layton
<jeff.layton@primarydata.com> wrote:
>
> Thanks, I think I might have found it. init_ctype tries to correct for
> the fact that bits_to_bytes rounds up instead of down. With the
> corrected function, we don't need that correction anymore.
>
> I'll send the v2 patch soon, which seems to do the right thing.
>

Great catch. I was looking at the it last night but haven't found
the cause. It was not cause by the array element alignment,
which I attach a purposed patch.

I will apply your V2 patch and the fix for the array. Every thing
should be happy now.

Chris

    round up for array element size to byte align

    When layout the array element, the element size should
    round up to byte align.

    Signed-off-by: Christopher Li <sparse@chrisli.org>

diff --git a/evaluate.c b/evaluate.c
index 7ce8c55..03992d0 100644
--- a/evaluate.c
+++ b/evaluate.c
@@ -2302,7 +2302,7 @@ static struct expression
*check_designators(struct expression *e,
                        }
                        type = ctype->ctype.base_type;
                        if (ctype->bit_size >= 0 && type->bit_size >= 0) {
-                               unsigned offset = e->idx_to * type->bit_size;
+                               unsigned offset =
array_element_offset(type->bit_size, e->idx_to);
                                if (offset >= ctype->bit_size) {
                                        err = "index out of bounds in";
                                        break;
diff --git a/symbol.c b/symbol.c
index 1a3df63..a697627 100644
--- a/symbol.c
+++ b/symbol.c
@@ -234,7 +234,8 @@ static struct symbol * examine_array_type(struct
symbol *sym)
                return sym;

        if (array_size) {
-               bit_size = base_type->bit_size *
get_expression_value_silent(array_size);
+               bit_size = array_element_offset(base_type->bit_size,
+
get_expression_value_silent(array_size));
                if (array_size->type != EXPR_VALUE) {
                        if (Wvla)
                                warning(array_size->pos, "Variable
length array is used.");
diff --git a/target.h b/target.h
index 140df3c..78c85cf 100644
--- a/target.h
+++ b/target.h
@@ -57,4 +57,12 @@ static inline int bytes_to_bits(int bytes)
        return bytes * bits_in_char;
 }

+static inline unsigned long array_element_offset(unsigned long
base_bits, int idx)
+{
+       int fragment = base_bits % bits_in_char;
+       if (fragment)
+               base_bits += bits_in_char - fragment;
+       return base_bits * idx;
+}
+
 #endif
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: [wireless-next:master 70/102] drivers/net/wireless/b43/phy_ht.c:338:35: sparse: cast truncates b ===

From: Fengguang Wu <fengguang.wu () intel ! com>
To: linux-sparse
Subject: Re: [wireless-next:master 70/102] drivers/net/wireless/b43/phy_ht.c:338:35: sparse: cast truncates b
Date: Tue, 16 Sep 2014 02:17:18 +0000
Message-ID: <20140916021718.GB16455 () localhost>
--------------------
I could disable this warning in my reports, but CC sparse authors
first to check if there are more elegant solutions.

On Mon, Sep 15, 2014 at 11:16:09PM +0200, Rafa Miecki wrote:
> On 15 September 2014 21:50, kbuild test robot <fengguang.wu@intel.com> wrote:
> > tree:   git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-next.git master
> > head:   1030f9fe65602465a89beaa05c3343cf9fd68a88
> > commit: 1f21de53ac8651b1a3e79576f1adf00aabecd052 [70/102] b43: HT-PHY: Implement band switching
> > reproduce:
> >   # apt-get install sparse
> >   git checkout 1f21de53ac8651b1a3e79576f1adf00aabecd052
> >   make ARCH=x86_64 allmodconfig
> >   make C=1 CF=-D__CHECK_ENDIAN__
> >
> >
> > sparse warnings: (new ones prefixed by >>)
> >
> >>> drivers/net/wireless/b43/phy_ht.c:338:35: sparse: cast truncates bits from constant value (ffff3fff becomes 3fff)
> >
> > vim +338 drivers/net/wireless/b43/phy_ht.c
> 
> I already got the same sparse warning twice (for different parts of code):
> 
> Message-ID: <53b5ab1e.Y9bKd3t4DteE6Pzc%fengguang.wu@intel.com>
> [wireless-next:master 163/164]
> drivers/net/wireless/b43/phy_n.c:5671:55: sparse: cast truncates bits
> from constant value (ffff7fff becomes 7fff)
> 
> Message-ID: <53c97150.9C2t3ebOTkndUZD5%fengguang.wu@intel.com>
> [wireless-next:master 70/75] drivers/net/wireless/b43/phy_n.c:6077:35:
> sparse: cast truncates bits from constant value (ffff3fff becomes
> 3fff)
> 
> In both of them I pointed that this is an expected behavior. No other
> solution was proposed.
> 
> Can this test be fixed or disabled?
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Dan Carpenter <dan.carpenter () oracle ! com>
To: linux-sparse
Subject: Re: [wireless-next:master 70/102] drivers/net/wireless/b43/phy_ht.c:338:35: sparse: cast truncates b
Date: Tue, 16 Sep 2014 07:20:35 +0000
Message-ID: <20140916072035.GG17875 () mwanda>
--------------------
On Tue, Sep 16, 2014 at 10:17:18AM +0800, Fengguang Wu wrote:
> I could disable this warning in my reports, but CC sparse authors
> first to check if there are more elegant solutions.

int main(void)
{
        printf("%x\n", (unsigned short)~(0xc00));   // <-- ok
        printf("%x\n", (unsigned short)~(0xc000));  // <-- complains

        return 0;
}

test.c:10:40: warning: cast truncates bits from constant value (ffff3fff becomes 3fff)

The reason the first one is ok is because we don't complain if the
truncated bits are purely sign bits.  I feel like it should apply to the
second statement as well.  If we're only masking out 0xffff then don't
complain.

regards,
dan carpenter

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: __attribute__((force)) should not be a storage class ===

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: __attribute__((force)) should not be a storage class
Date: Sat, 01 Feb 2014 18:49:35 +0000
Message-ID: <20140201184935.GA12321 () leaf>
--------------------
Commit 3829c4d8b097776e6b3472290a9fae08a705ab7a ("Don't mix storage
class bits with ctype->modifiers while parsing type") in 2009 separated
storage classes from modifiers; in the process, it changed
__attribute__((force)) from a modifier to a storage class.  I don't
think it makes sense to have force as a storage class, for one critical
reason: storage classes are mutually exclusive.

$ cat /tmp/test.c
static __attribute__((force)) int *p;
static int q = *p;
$ ./sparse /tmp/test.c
/tmp/test.c:1:28: error: multiple storage classes

Given this, I think force should become a modifier again.  Any
objections?

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: __attribute__((force)) should not be a storage class
Date: Sun, 02 Feb 2014 05:51:11 +0000
Message-ID: <CANeU7Qm1=8ks=Fu6LzjuAYxRqLPS3gssmD+uxNzDfN568Xxodw () mail ! gmail ! com>
--------------------
On Sat, Feb 1, 2014 at 10:49 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> Commit 3829c4d8b097776e6b3472290a9fae08a705ab7a ("Don't mix storage
> class bits with ctype->modifiers while parsing type") in 2009 separated
> storage classes from modifiers; in the process, it changed
> __attribute__((force)) from a modifier to a storage class.  I don't
> think it makes sense to have force as a storage class, for one critical
> reason: storage classes are mutually exclusive.

I am not convinced yet.

The current usage case for attribute "force" is to silence the type
mismatch during the type conversion. For variable declaration, there is
not need to silence any mismatch because there is no type conversion.

What you are purposing here is a new usage case. Do you want
to silence every single type mismatch in every assignment to that
variable? How about assignment from that variable?

That seems a lot of complexity to keep track of the attribute
belong to which level of the type tree.

>
> $ cat /tmp/test.c
> static __attribute__((force)) int *p;
> static int q = *p;

In this example, the attribute "force" is not needed.
I think it compiles fine without forcing it. The "force" don't
actually do any thing. So why do we want to support this?

I want to justify the extra complexity it add to the code
base.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: __attribute__((force)) should not be a storage class
Date: Sun, 02 Feb 2014 08:38:38 +0000
Message-ID: <20140202083838.GA20284 () leaf>
--------------------
On Sat, Feb 01, 2014 at 09:51:11PM -0800, Christopher Li wrote:
> On Sat, Feb 1, 2014 at 10:49 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> > Commit 3829c4d8b097776e6b3472290a9fae08a705ab7a ("Don't mix storage
> > class bits with ctype->modifiers while parsing type") in 2009 separated
> > storage classes from modifiers; in the process, it changed
> > __attribute__((force)) from a modifier to a storage class.  I don't
> > think it makes sense to have force as a storage class, for one critical
> > reason: storage classes are mutually exclusive.
> 
> I am not convinced yet.
> 
> The current usage case for attribute "force" is to silence the type
> mismatch during the type conversion. For variable declaration, there is
> not need to silence any mismatch because there is no type conversion.
> 
> What you are purposing here is a new usage case. Do you want
> to silence every single type mismatch in every assignment to that
> variable? How about assignment from that variable?

I'd suggest that either it should have exactly the same behavior as it does
when applied to the type of a function argument (suppressing
Sparse-specific pointer qualifier mismatches on input), or it should be
prohibited entirely on standalone variable declarations.  I'd be fine
with the latter, if you prefer.

> > $ cat /tmp/test.c
> > static __attribute__((force)) int *p;
> > static int q = *p;
> 
> In this example, the attribute "force" is not needed.
> I think it compiles fine without forcing it. The "force" don't
> actually do any thing. So why do we want to support this?

This particular case was simply an unrelated test case which happened to
trigger the error about having multiple storage classes.  The original
test case came from http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850#c3
; I noticed the use of -Wno-decl, presumably to suppress the warnings
about the two variables not being static, so I marked them as static and
got the error that motivated this thread.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: __attribute__((force)) should not be a storage class
Date: Thu, 27 Feb 2014 21:00:47 +0000
Message-ID: <CANeU7QkjEUOZ-0m7nLjqAoMx4WJnoBdzhM1Ef3Y=RN+ewPSBMA () mail ! gmail ! com>
--------------------
On Sun, Feb 2, 2014 at 12:38 AM, Josh Triplett <josh@joshtriplett.org> wrote:
> I'd suggest that either it should have exactly the same behavior as it does
> when applied to the type of a function argument (suppressing
> Sparse-specific pointer qualifier mismatches on input), or it should be
> prohibited entirely on standalone variable declarations.  I'd be fine
> with the latter, if you prefer.

BTW, patch are welcome to make it consistent, hopefully in a not too
complicate way.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: cgcc: please support -iwithprefix ===

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: cgcc: please support -iwithprefix
Date: Sat, 18 Jan 2014 00:22:22 +0000
Message-ID: <52D9C93E.80504 () zytor ! com>
--------------------
When doing embedded work, like kernels or other nonstandard
environments, we want to exclude the standard library with -nostdinc,
but that also excludes header files intrinsic to the *compiler* such as
<stdarg.h>.

gcc uses the option -iwithprefix for that, in particular "-iwithprefix
include" adds those compiler-specific header files back into the include
path.  cgcc doesn't seem to understand that and instead interprets the
option argument as an additional file.

It is unsual in gcc for an option argument to be separate, but it isn't
unique:

        -idirafter DIR
        -include FILE  -imacros FILE
        -iprefix FILE  -iwithprefix DIR
        -iwithprefixbefore DIR  -isystem DIR
        -imultilib DIR -isysroot DIR
	-Xpreprocessor OPTION
	-Xassembler OPTION
	-T SCRIPT
	-Xlinker OPTION
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet ===

From: Marcel Holtmann <marcel () holtmann ! org>
To: linux-netdev
Subject: Re: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet
Date: Thu, 11 Dec 2014 11:18:44 +0000
Message-ID: <479338B3-A0C0-4443-9C44-E03421F0679C () holtmann ! org>
--------------------
Hi Joe,

>>> Are you referring to the static code analyser sparse that is invoked
>>> through?
>> You have to explicitly enable endian checking, it's not on by
>> default.
> 
> There don't seem to be thousands of warnings anymore.
> 
> Maybe it's time to default enable it when using C=?
> 
> from: Documentation/sparse.txt:
> 
> The optional make variable CF can be used to pass arguments to sparse.  The
> build system passes -Wbitwise to sparse automatically.  To perform endianness
> checks, you may define __CHECK_ENDIAN__:
> 
>        make C=2 CF="-D__CHECK_ENDIAN__"
> 
> These checks are disabled by default as they generate a host of warnings.

actually a few subsystems use this in their Makefile:

	subdir-ccflags-y += -D__CHECK_ENDIAN__

We could start with that to enable endian checks by default in various places.

Regards

Marcel

--
To unsubscribe from this list: send the line "unsubscribe netdev" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Marcel Holtmann <marcel () holtmann ! org>
To: linux-arm-kernel
Subject: Re: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet
Date: Thu, 11 Dec 2014 11:18:44 +0000
Message-ID: <479338B3-A0C0-4443-9C44-E03421F0679C () holtmann ! org>
--------------------
Hi Joe,

>>> Are you referring to the static code analyser sparse that is invoked
>>> through?
>> You have to explicitly enable endian checking, it's not on by
>> default.
> 
> There don't seem to be thousands of warnings anymore.
> 
> Maybe it's time to default enable it when using C=?
> 
> from: Documentation/sparse.txt:
> 
> The optional make variable CF can be used to pass arguments to sparse.  The
> build system passes -Wbitwise to sparse automatically.  To perform endianness
> checks, you may define __CHECK_ENDIAN__:
> 
>        make C=2 CF="-D__CHECK_ENDIAN__"
> 
> These checks are disabled by default as they generate a host of warnings.

actually a few subsystems use this in their Makefile:

	subdir-ccflags-y += -D__CHECK_ENDIAN__

We could start with that to enable endian checks by default in various places.

Regards

Marcel


_______________________________________________
linux-arm-kernel mailing list
linux-arm-kernel@lists.infradead.org
http://lists.infradead.org/mailman/listinfo/linux-arm-kernel
================================================================================

From: Marcel Holtmann <marcel () holtmann ! org>
To: linux-sparse
Subject: Re: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet
Date: Thu, 11 Dec 2014 11:18:44 +0000
Message-ID: <479338B3-A0C0-4443-9C44-E03421F0679C () holtmann ! org>
--------------------
Hi Joe,

>>> Are you referring to the static code analyser sparse that is invoked
>>> through?
>> You have to explicitly enable endian checking, it's not on by
>> default.
> 
> There don't seem to be thousands of warnings anymore.
> 
> Maybe it's time to default enable it when using C=?
> 
> from: Documentation/sparse.txt:
> 
> The optional make variable CF can be used to pass arguments to sparse.  The
> build system passes -Wbitwise to sparse automatically.  To perform endianness
> checks, you may define __CHECK_ENDIAN__:
> 
>        make C=2 CF="-D__CHECK_ENDIAN__"
> 
> These checks are disabled by default as they generate a host of warnings.

actually a few subsystems use this in their Makefile:

	subdir-ccflags-y += -D__CHECK_ENDIAN__

We could start with that to enable endian checks by default in various places.

Regards

Marcel

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet dri ===

From: Joe Perches <joe () perches ! com>
To: linux-sparse
Subject: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet dri
Date: Thu, 11 Dec 2014 03:04:59 +0000
Message-ID: <1418267099.18092.28.camel () perches ! com>
--------------------
On Wed, 2014-12-10 at 20:41 -0500, David Miller wrote:
> From: Murali Karicheri <m-karicheri2@ti.com>
> > Are you referring to the static code analyser sparse that is invoked
> > through?
> You have to explicitly enable endian checking, it's not on by
> default.

There don't seem to be thousands of warnings anymore.

Maybe it's time to default enable it when using C=?

from: Documentation/sparse.txt:

The optional make variable CF can be used to pass arguments to sparse.  The
build system passes -Wbitwise to sparse automatically.  To perform endianness
checks, you may define __CHECK_ENDIAN__:

        make C=2 CF="-D__CHECK_ENDIAN__"

These checks are disabled by default as they generate a host of warnings.



--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-kernel
Subject: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet dri
Date: Thu, 11 Dec 2014 03:04:59 +0000
Message-ID: <1418267099.18092.28.camel () perches ! com>
--------------------
On Wed, 2014-12-10 at 20:41 -0500, David Miller wrote:
> From: Murali Karicheri <m-karicheri2@ti.com>
> > Are you referring to the static code analyser sparse that is invoked
> > through?
> You have to explicitly enable endian checking, it's not on by
> default.

There don't seem to be thousands of warnings anymore.

Maybe it's time to default enable it when using C=?

from: Documentation/sparse.txt:

The optional make variable CF can be used to pass arguments to sparse.  The
build system passes -Wbitwise to sparse automatically.  To perform endianness
checks, you may define __CHECK_ENDIAN__:

        make C=2 CF="-D__CHECK_ENDIAN__"

These checks are disabled by default as they generate a host of warnings.



--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Joe Perches <joe () perches ! com>
To: devicetree
Subject: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet dri
Date: Thu, 11 Dec 2014 03:04:59 +0000
Message-ID: <1418267099.18092.28.camel () perches ! com>
--------------------
On Wed, 2014-12-10 at 20:41 -0500, David Miller wrote:
> From: Murali Karicheri <m-karicheri2@ti.com>
> > Are you referring to the static code analyser sparse that is invoked
> > through?
> You have to explicitly enable endian checking, it's not on by
> default.

There don't seem to be thousands of warnings anymore.

Maybe it's time to default enable it when using C=?

from: Documentation/sparse.txt:

The optional make variable CF can be used to pass arguments to sparse.  The
build system passes -Wbitwise to sparse automatically.  To perform endianness
checks, you may define __CHECK_ENDIAN__:

        make C=2 CF="-D__CHECK_ENDIAN__"

These checks are disabled by default as they generate a host of warnings.



--
To unsubscribe from this list: send the line "unsubscribe devicetree" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Joe Perches <joe () perches ! com>
To: linux-netdev
Subject: default enable sparse __CHECK_ENDIAN__ (was: Re: [PATCH v7 2/3] net: Add Keystone NetCP ethernet dri
Date: Thu, 11 Dec 2014 03:04:59 +0000
Message-ID: <1418267099.18092.28.camel () perches ! com>
--------------------
On Wed, 2014-12-10 at 20:41 -0500, David Miller wrote:
> From: Murali Karicheri <m-karicheri2@ti.com>
> > Are you referring to the static code analyser sparse that is invoked
> > through?
> You have to explicitly enable endian checking, it's not on by
> default.

There don't seem to be thousands of warnings anymore.

Maybe it's time to default enable it when using C=?

from: Documentation/sparse.txt:

The optional make variable CF can be used to pass arguments to sparse.  The
build system passes -Wbitwise to sparse automatically.  To perform endianness
checks, you may define __CHECK_ENDIAN__:

        make C=2 CF="-D__CHECK_ENDIAN__"

These checks are disabled by default as they generate a host of warnings.



--
To unsubscribe from this list: send the line "unsubscribe netdev" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: fec_main: context imbalance in 'fec_set_features' ===

From: Fabio Estevam <festevam () gmail ! com>
To: linux-netdev
Subject: fec_main: context imbalance in 'fec_set_features'
Date: Thu, 02 Oct 2014 00:15:53 +0000
Message-ID: <CAOMZO5CJKp7+d8EPRZdr-3Bd9UxVU8fxLybFZ4uLn+cUQjPH8w () mail ! gmail ! com>
--------------------
Hi,

sparse complains the following:

drivers/net/ethernet/freescale/fec_main.c:2835:12: warning: context
imbalance in 'fec_set_features' - different lock contexts for basic
block

The code looks like this:

static int fec_set_features(struct net_device *netdev,
    netdev_features_t features)
{
    struct fec_enet_private *fep = netdev_priv(netdev);
    netdev_features_t changed = features ^ netdev->features;

    /* Quiesce the device if necessary */
    if (netif_running(netdev) && changed & FEATURES_NEED_QUIESCE) {
        napi_disable(&fep->napi);
        netif_tx_lock_bh(netdev);
        fec_stop(netdev);
    }

    netdev->features = features;

    /* Receive checksum has been changed */
    if (changed & NETIF_F_RXCSUM) {
        if (features & NETIF_F_RXCSUM)
            fep->csum_flags |= FLAG_RX_CSUM_ENABLED;
        else
            fep->csum_flags &= ~FLAG_RX_CSUM_ENABLED;
    }

    /* Resume the device after updates */
    if (netif_running(netdev) && changed & FEATURES_NEED_QUIESCE) {
        fec_restart(netdev);
        netif_tx_wake_all_queues(netdev);
        netif_tx_unlock_bh(netdev);
        napi_enable(&fep->napi);
    }

    return 0;
}

What would be the proper way to fix this warning?

Thanks,

Fabio Estevam
--
To unsubscribe from this list: send the line "unsubscribe netdev" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "fugang.duan () freescale ! com" <fugang ! duan () freescale ! com>
To: linux-sparse
Subject: RE: fec_main: context imbalance in 'fec_set_features'
Date: Thu, 09 Oct 2014 09:55:38 +0000
Message-ID: <f5e97105d948410d8346ea6f0bc0d79e () BY2PR03MB377 ! namprd03 ! prod ! outlook ! com>
--------------------
RnJvbTogRmFiaW8gRXN0ZXZhbSA8ZmVzdGV2YW1AZ21haWwuY29tPiBTZW50OiBUaHVyc2RheSwg
T2N0b2JlciAwMiwgMjAxNCA4OjE2IEFNDQo+VG86IExpIEZyYW5rLUIyMDU5NjsgRHVhbiBGdWdh
bmctQjM4NjExDQo+Q2M6IERhdmlkIFMuIE1pbGxlcjsgbmV0ZGV2QHZnZXIua2VybmVsLm9yZzsg
bGludXgtc3BhcnNlQHZnZXIua2VybmVsLm9yZw0KPlN1YmplY3Q6IGZlY19tYWluOiBjb250ZXh0
IGltYmFsYW5jZSBpbiAnZmVjX3NldF9mZWF0dXJlcycNCj4NCj5IaSwNCj4NCj5zcGFyc2UgY29t
cGxhaW5zIHRoZSBmb2xsb3dpbmc6DQo+DQo+ZHJpdmVycy9uZXQvZXRoZXJuZXQvZnJlZXNjYWxl
L2ZlY19tYWluLmM6MjgzNToxMjogd2FybmluZzogY29udGV4dA0KPmltYmFsYW5jZSBpbiAnZmVj
X3NldF9mZWF0dXJlcycgLSBkaWZmZXJlbnQgbG9jayBjb250ZXh0cyBmb3IgYmFzaWMgYmxvY2sN
Cj4NCj5UaGUgY29kZSBsb29rcyBsaWtlIHRoaXM6DQo+DQo+c3RhdGljIGludCBmZWNfc2V0X2Zl
YXR1cmVzKHN0cnVjdCBuZXRfZGV2aWNlICpuZXRkZXYsDQo+ICAgIG5ldGRldl9mZWF0dXJlc190
IGZlYXR1cmVzKQ0KPnsNCj4gICAgc3RydWN0IGZlY19lbmV0X3ByaXZhdGUgKmZlcCA9IG5ldGRl
dl9wcml2KG5ldGRldik7DQo+ICAgIG5ldGRldl9mZWF0dXJlc190IGNoYW5nZWQgPSBmZWF0dXJl
cyBeIG5ldGRldi0+ZmVhdHVyZXM7DQo+DQo+ICAgIC8qIFF1aWVzY2UgdGhlIGRldmljZSBpZiBu
ZWNlc3NhcnkgKi8NCj4gICAgaWYgKG5ldGlmX3J1bm5pbmcobmV0ZGV2KSAmJiBjaGFuZ2VkICYg
RkVBVFVSRVNfTkVFRF9RVUlFU0NFKSB7DQo+ICAgICAgICBuYXBpX2Rpc2FibGUoJmZlcC0+bmFw
aSk7DQo+ICAgICAgICBuZXRpZl90eF9sb2NrX2JoKG5ldGRldik7DQo+ICAgICAgICBmZWNfc3Rv
cChuZXRkZXYpOw0KPiAgICB9DQo+DQo+ICAgIG5ldGRldi0+ZmVhdHVyZXMgPSBmZWF0dXJlczsN
Cj4NCj4gICAgLyogUmVjZWl2ZSBjaGVja3N1bSBoYXMgYmVlbiBjaGFuZ2VkICovDQo+ICAgIGlm
IChjaGFuZ2VkICYgTkVUSUZfRl9SWENTVU0pIHsNCj4gICAgICAgIGlmIChmZWF0dXJlcyAmIE5F
VElGX0ZfUlhDU1VNKQ0KPiAgICAgICAgICAgIGZlcC0+Y3N1bV9mbGFncyB8PSBGTEFHX1JYX0NT
VU1fRU5BQkxFRDsNCj4gICAgICAgIGVsc2UNCj4gICAgICAgICAgICBmZXAtPmNzdW1fZmxhZ3Mg
Jj0gfkZMQUdfUlhfQ1NVTV9FTkFCTEVEOw0KPiAgICB9DQo+DQo+ICAgIC8qIFJlc3VtZSB0aGUg
ZGV2aWNlIGFmdGVyIHVwZGF0ZXMgKi8NCj4gICAgaWYgKG5ldGlmX3J1bm5pbmcobmV0ZGV2KSAm
JiBjaGFuZ2VkICYgRkVBVFVSRVNfTkVFRF9RVUlFU0NFKSB7DQo+ICAgICAgICBmZWNfcmVzdGFy
dChuZXRkZXYpOw0KPiAgICAgICAgbmV0aWZfdHhfd2FrZV9hbGxfcXVldWVzKG5ldGRldik7DQo+
ICAgICAgICBuZXRpZl90eF91bmxvY2tfYmgobmV0ZGV2KTsNCj4gICAgICAgIG5hcGlfZW5hYmxl
KCZmZXAtPm5hcGkpOw0KPiAgICB9DQo+DQo+ICAgIHJldHVybiAwOw0KPn0NCj4NCj5XaGF0IHdv
dWxkIGJlIHRoZSBwcm9wZXIgd2F5IHRvIGZpeCB0aGlzIHdhcm5pbmc/DQo+DQo+VGhhbmtzLA0K
Pg0KPkZhYmlvIEVzdGV2YW0NCg0KSGksIEZhYmlvLA0KDQpJIHJ1biBzcGFyc2UgYW5kIGNhbm5v
dCBnZXQgYW55IHdhcm5pbmcuDQoxLiBnaXQgY2xvbmUgZ2l0Oi8vZ2l0Lmtlcm5lbC5vcmcvcHVi
L3NjbS9kZXZlbC9zcGFyc2Uvc3BhcnNlLmdpdA0KICAgbWFrZQ0KICAgbWFrZSBpbnN0YWxsDQoy
LiBleHBvcnQgUEFUSD0kUEFUSDp+L2Jpbi8NCjMuIG1ha2Uga2VybmVsOiBtYWtlICAtajE2IEFS
Q0g9YXJtIENST1NTX0NPTVBJTEU9YXJtLXBva3ktbGludXgtZ251ZWFiaS0gekltYWdlIEM9Mg0K
DQpDb21taXQgSUQgb24gRGF2aWQgbmV0IHRyZWU6IDI4YjdkZWFlNzU2NDJjNTFmMDk3MzkxNzY1
ZmQzOWZmMGRkNmNlOTUNCg0KVGhlIHJlc3VsdDoNCiAgQ0hFQ0sgICBmcy9sb2NrZC9zdmM0cHJv
Yy5jDQogIENIRUNLICAgZHJpdmVycy9vZi9wbGF0Zm9ybS5jDQogIENIRUNLICAgZHJpdmVycy9p
bnB1dC90b3VjaHNjcmVlbi90c2MyMDA3LmMNCiAgQ0hFQ0sgICBkcml2ZXJzL210ZC9uYW5kL25h
bmRfdGltaW5ncy5jDQogIENIRUNLICAgZHJpdmVycy9wY2kvcHJvYmUuYw0KICBDSEVDSyAgIGRy
aXZlcnMvcGNpL2hvc3QtYnJpZGdlLmMNCiAgQ0hFQ0sgICBkcml2ZXJzL3BjaS9yZW1vdmUuYw0K
ZHJpdmVycy9tdGQvbmFuZC9uYW5kX3RpbWluZ3MuYzo0NToyOTogd2FybmluZzogY29uc3RhbnQg
MjUwMDAwMDAwMDAwIGlzIHNvIGJpZyBpdCBpcyBsb25nIGxvbmcNCiAgQ0hFQ0sgICBkcml2ZXJz
L210ZC9uYW5kL25hbmRfZWNjLmMNCiAgQ0hFQ0sgICBkcml2ZXJzL210ZC9uYW5kL25hbmRfaWRz
LmMNCiAgQ0hFQ0sgICBkcml2ZXJzL25ldC9ldGhlcm5ldC9mcmVlc2NhbGUvZmVjX21haW4uYw0K
ICBDSEVDSyAgIGRyaXZlcnMvb2YvZmR0LmMNCiAgQ0hFQ0sgICBkcml2ZXJzL29mL2ZkdF9hZGRy
ZXNzLmMNCiAgQ0hFQ0sgICBkcml2ZXJzL3BjaS9wY2kuYw0KICBDSEVDSyAgIGRyaXZlcnMvbXRk
L25hbmQvbXhjX25hbmQuYw0KICBDSEVDSyAgIGZzL25vdGlmeS9mc25vdGlmeS5jDQogIENIRUNL
ICAgZnMvbm90aWZ5L25vdGlmaWNhdGlvbi5jDQogIENIRUNLICAgZnMvbm90aWZ5L2dyb3VwLmMN
CiAgQ0hFQ0sgICBmcy9ub3RpZnkvaW5vZGVfbWFyay5jDQogIENIRUNLICAgZHJpdmVycy9uZXQv
ZXRoZXJuZXQvZnJlZXNjYWxlL2ZlY19wdHAuYw0KICBDSEVDSyAgIGZzL25vdGlmeS9tYXJrLmMN
CiAgQ0hFQ0sgICBmcy9ub3RpZnkvdmZzbW91bnRfbWFyay5jDQpkcml2ZXJzL3BjaS9wY2kuYzoz
NTo1OiB3YXJuaW5nOiBzeW1ib2wgJ2lzYV9kbWFfYnJpZGdlX2J1Z2d5JyB3YXMgbm90IGRlY2xh
cmVkLiBTaG91bGQgaXQgYmUgc3RhdGljPw0KZHJpdmVycy9wY2kvcGNpLmM6NDM5MjoxOiB3YXJu
aW5nOiBzeW1ib2wgJ2J1c19hdHRyX3Jlc291cmNlX2FsaWdubWVudCcgd2FzIG5vdCBkZWNsYXJl
ZC4gU2hvdWxkIGl0IGJlIHN0YXRpYz8NCiAgQ0hFQ0sgICBmcy9ub3RpZnkvZmRpbmZvLmMNCiAg
Q0hFQ0sgICBkcml2ZXJzL3BjaS9wY2ktZHJpdmVyLmMNCiAgQ0hFQ0sgICBkcml2ZXJzL3BjaS9z
ZWFyY2guYw0KICBDSEVDSyAgIGRyaXZlcnMvcGNpL3BjaS1zeXNmcy5jDQogIENIRUNLICAgZHJp
dmVycy9wY2kvcm9tLmMNCiAgQ0hFQ0sgICBkcml2ZXJzL3BjaS9zZXR1cC1yZXMuYw0KDQoNClJl
Z2FyZHMsDQpBbmR5DQo=
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Fabio Estevam <festevam () gmail ! com>
To: linux-netdev
Subject: Re: fec_main: context imbalance in 'fec_set_features'
Date: Thu, 09 Oct 2014 11:20:20 +0000
Message-ID: <CAOMZO5A_=o-J_ZhQPOaWcErc6ExUKk_-9MtSUY5MwGwm4Uc0-w () mail ! gmail ! com>
--------------------
Hi Fugang,

On Thu, Oct 9, 2014 at 6:55 AM, fugang.duan@freescale.com
<fugang.duan@freescale.com> wrote:

> I run sparse and cannot get any warning.

Try it on linux-next with the following command:

make -j4 C=1  2>fect.txt drivers/net/ethernet/freescale/fec_main.o

cat v6.txt
drivers/net/ethernet/freescale/fec_main.c:2916:12: warning: context
imbalance in 'fec_set_features' - different lock contexts for basic
block
--
To unsubscribe from this list: send the line "unsubscribe netdev" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Fabio Estevam <festevam () gmail ! com>
To: linux-sparse
Subject: Re: fec_main: context imbalance in 'fec_set_features'
Date: Thu, 09 Oct 2014 11:20:20 +0000
Message-ID: <CAOMZO5A_=o-J_ZhQPOaWcErc6ExUKk_-9MtSUY5MwGwm4Uc0-w () mail ! gmail ! com>
--------------------
Hi Fugang,

On Thu, Oct 9, 2014 at 6:55 AM, fugang.duan@freescale.com
<fugang.duan@freescale.com> wrote:

> I run sparse and cannot get any warning.

Try it on linux-next with the following command:

make -j4 C=1  2>fect.txt drivers/net/ethernet/freescale/fec_main.o

cat v6.txt
drivers/net/ethernet/freescale/fec_main.c:2916:12: warning: context
imbalance in 'fec_set_features' - different lock contexts for basic
block
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-netdev
Subject: Re: fec_main: context imbalance in 'fec_set_features'
Date: Sat, 11 Oct 2014 02:07:13 +0000
Message-ID: <CANeU7Qn2WX3CCN5YzFqcWngYu_Uy2wQ=mW1gBhGYMAaLhOkkZg () mail ! gmail ! com>
--------------------
On Thu, Oct 2, 2014 at 8:15 AM, Fabio Estevam <festevam@gmail.com> wrote:
> Hi,
>
> sparse complains the following:
>
> drivers/net/ethernet/freescale/fec_main.c:2835:12: warning: context
> imbalance in 'fec_set_features' - different lock contexts for basic
> block

That is expected to receive warnings. Sparse can't really tell the lock
and unlock are actually on the same condition and it never change.

>
> The code looks like this:
>
> static int fec_set_features(struct net_device *netdev,
>     netdev_features_t features)
> {
>     struct fec_enet_private *fep = netdev_priv(netdev);
>     netdev_features_t changed = features ^ netdev->features;
>
>     /* Quiesce the device if necessary */
>     if (netif_running(netdev) && changed & FEATURES_NEED_QUIESCE) {

e.g. netdev is running here, you take the lock.


>         napi_disable(&fep->napi);
>         netif_tx_lock_bh(netdev);
>         fec_stop(netdev);
>     }
>
>     netdev->features = features;
>>
>     /* Resume the device after updates */
>     if (netif_running(netdev) && changed & FEATURES_NEED_QUIESCE) {

Then there is race some one shutdown the netdev before the code hits
here (is it possible? it is hard to tell from this source alone.)
Then the unlock is skipped.

>         fec_restart(netdev);
>         netif_tx_wake_all_queues(netdev);

Sparse is complaining, there exist a code path, from execution flow
point of view, (without considering the data flow analyze), there exists a
code path lock and unlock are not balanced.

It is possible that warning code path is not actually executable
due to data flow reason(e.g. "changed" never change during the same function).
But sparse did not have data flow analyze to know that.

If you move the code, e.g. the code inside the lock area into a function.
You can write:

if (need_lock) {
       lock();
       do_something_real();
       unlock();
} else {
       do_something_real();
}

That way, sparse don't see such a code path can trigger lock unbalanced.

Chris
--
To unsubscribe from this list: send the line "unsubscribe netdev" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: fec_main: context imbalance in 'fec_set_features'
Date: Sat, 11 Oct 2014 02:07:13 +0000
Message-ID: <CANeU7Qn2WX3CCN5YzFqcWngYu_Uy2wQ=mW1gBhGYMAaLhOkkZg () mail ! gmail ! com>
--------------------
On Thu, Oct 2, 2014 at 8:15 AM, Fabio Estevam <festevam@gmail.com> wrote:
> Hi,
>
> sparse complains the following:
>
> drivers/net/ethernet/freescale/fec_main.c:2835:12: warning: context
> imbalance in 'fec_set_features' - different lock contexts for basic
> block

That is expected to receive warnings. Sparse can't really tell the lock
and unlock are actually on the same condition and it never change.

>
> The code looks like this:
>
> static int fec_set_features(struct net_device *netdev,
>     netdev_features_t features)
> {
>     struct fec_enet_private *fep = netdev_priv(netdev);
>     netdev_features_t changed = features ^ netdev->features;
>
>     /* Quiesce the device if necessary */
>     if (netif_running(netdev) && changed & FEATURES_NEED_QUIESCE) {

e.g. netdev is running here, you take the lock.


>         napi_disable(&fep->napi);
>         netif_tx_lock_bh(netdev);
>         fec_stop(netdev);
>     }
>
>     netdev->features = features;
>>
>     /* Resume the device after updates */
>     if (netif_running(netdev) && changed & FEATURES_NEED_QUIESCE) {

Then there is race some one shutdown the netdev before the code hits
here (is it possible? it is hard to tell from this source alone.)
Then the unlock is skipped.

>         fec_restart(netdev);
>         netif_tx_wake_all_queues(netdev);

Sparse is complaining, there exist a code path, from execution flow
point of view, (without considering the data flow analyze), there exists a
code path lock and unlock are not balanced.

It is possible that warning code path is not actually executable
due to data flow reason(e.g. "changed" never change during the same function).
But sparse did not have data flow analyze to know that.

If you move the code, e.g. the code inside the lock area into a function.
You can write:

if (need_lock) {
       lock();
       do_something_real();
       unlock();
} else {
       do_something_real();
}

That way, sparse don't see such a code path can trigger lock unbalanced.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: gcc tickets for sparse attributes ===

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-kernel
Subject: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 05:27:08 +0000
Message-ID: <52D8BF2C.9090604 () zytor ! com>
--------------------
Hi,

I have filed gcc tickets asking for direct support in gcc for some
sparse extensions that we use heavily in the kernel:

http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850
http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59851

However, I would also like support for the context extensions, but I'm
not knowledgeable enough to describe the semantics accurately.  Would
anyone be willing to file a ticket describing how the context extension
works well enough that it could be implemented?

	-hpa
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 05:27:08 +0000
Message-ID: <52D8BF2C.9090604 () zytor ! com>
--------------------
Hi,

I have filed gcc tickets asking for direct support in gcc for some
sparse extensions that we use heavily in the kernel:

http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850
http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59851

However, I would also like support for the context extensions, but I'm
not knowledgeable enough to describe the semantics accurately.  Would
anyone be willing to file a ticket describing how the context extension
works well enough that it could be implemented?

	-hpa
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-sparse
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 05:35:09 +0000
Message-ID: <52D8C10D.6010006 () zytor ! com>
--------------------
On 01/16/2014 09:27 PM, H. Peter Anvin wrote:
> Hi,
> 
> I have filed gcc tickets asking for direct support in gcc for some
> sparse extensions that we use heavily in the kernel:
> 
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59851
> 

Add:
http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59852

	-hpa


--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: "H. Peter Anvin" <hpa () zytor ! com>
To: linux-kernel
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 05:35:09 +0000
Message-ID: <52D8C10D.6010006 () zytor ! com>
--------------------
On 01/16/2014 09:27 PM, H. Peter Anvin wrote:
> Hi,
> 
> I have filed gcc tickets asking for direct support in gcc for some
> sparse extensions that we use heavily in the kernel:
> 
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59851
> 

Add:
http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59852

	-hpa


--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Johannes Berg <johannes () sipsolutions ! net>
To: linux-sparse
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 08:33:16 +0000
Message-ID: <1389947596.4354.2.camel () jlt4 ! sipsolutions ! net>
--------------------
On Thu, 2014-01-16 at 21:27 -0800, H. Peter Anvin wrote:

> However, I would also like support for the context extensions, but I'm
> not knowledgeable enough to describe the semantics accurately.  Would
> anyone be willing to file a ticket describing how the context extension
> works well enough that it could be implemented?

IMHO the context extension doesn't work well enough in sparse to
document and implement as is. It would be much better if it actually was
able to differentiate between contexts, rather than treating each one
the same. This would avoid the problem that locking one lock and
unlocking another (in the kernel's __acquire/ __release mechanism) could
still result in a warning.

johannes

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 09:18:46 +0000
Message-ID: <20140117091845.GB577 () leaf>
--------------------
On Thu, Jan 16, 2014 at 09:27:08PM -0800, H. Peter Anvin wrote:
> I have filed gcc tickets asking for direct support in gcc for some
> sparse extensions that we use heavily in the kernel:
> 
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59851
> 
> However, I would also like support for the context extensions, but I'm
> not knowledgeable enough to describe the semantics accurately.  Would
> anyone be willing to file a ticket describing how the context extension
> works well enough that it could be implemented?

http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59856

Also:

http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59855

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 09:18:46 +0000
Message-ID: <20140117091845.GB577 () leaf>
--------------------
On Thu, Jan 16, 2014 at 09:27:08PM -0800, H. Peter Anvin wrote:
> I have filed gcc tickets asking for direct support in gcc for some
> sparse extensions that we use heavily in the kernel:
> 
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59850
> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59851
> 
> However, I would also like support for the context extensions, but I'm
> not knowledgeable enough to describe the semantics accurately.  Would
> anyone be willing to file a ticket describing how the context extension
> works well enough that it could be implemented?

http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59856

Also:

http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59855

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-kernel
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 09:22:28 +0000
Message-ID: <20140117092223.GC577 () leaf>
--------------------
On Fri, Jan 17, 2014 at 09:33:16AM +0100, Johannes Berg wrote:
> On Thu, 2014-01-16 at 21:27 -0800, H. Peter Anvin wrote:
> 
> > However, I would also like support for the context extensions, but I'm
> > not knowledgeable enough to describe the semantics accurately.  Would
> > anyone be willing to file a ticket describing how the context extension
> > works well enough that it could be implemented?
> 
> IMHO the context extension doesn't work well enough in sparse to
> document and implement as is. It would be much better if it actually was
> able to differentiate between contexts, rather than treating each one
> the same.

That would certainly be nice, but that's something actually much more
easily done in GCC than in Sparse, given the types of information GCC
already has available to implement features like alias analysis.

In any case, the spec I wrote up assumes a distinction between contexts,
but allows for an initial implementation like Sparse's that ignores the
distinction.

> This would avoid the problem that locking one lock and
> unlocking another (in the kernel's __acquire/ __release mechanism) could
> still result in a warning.

That would actually *not* produce a warning, though it should.  In
general, I *think* an implementation like Sparse's that ignores the
distinction between locks should produce false negatives but not false
positives.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================

From: Josh Triplett <josh () joshtriplett ! org>
To: linux-sparse
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 09:22:28 +0000
Message-ID: <20140117092223.GC577 () leaf>
--------------------
On Fri, Jan 17, 2014 at 09:33:16AM +0100, Johannes Berg wrote:
> On Thu, 2014-01-16 at 21:27 -0800, H. Peter Anvin wrote:
> 
> > However, I would also like support for the context extensions, but I'm
> > not knowledgeable enough to describe the semantics accurately.  Would
> > anyone be willing to file a ticket describing how the context extension
> > works well enough that it could be implemented?
> 
> IMHO the context extension doesn't work well enough in sparse to
> document and implement as is. It would be much better if it actually was
> able to differentiate between contexts, rather than treating each one
> the same.

That would certainly be nice, but that's something actually much more
easily done in GCC than in Sparse, given the types of information GCC
already has available to implement features like alias analysis.

In any case, the spec I wrote up assumes a distinction between contexts,
but allows for an initial implementation like Sparse's that ignores the
distinction.

> This would avoid the problem that locking one lock and
> unlocking another (in the kernel's __acquire/ __release mechanism) could
> still result in a warning.

That would actually *not* produce a warning, though it should.  In
general, I *think* an implementation like Sparse's that ignores the
distinction between locks should produce false negatives but not false
positives.

- Josh Triplett
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Johannes Berg <johannes () sipsolutions ! net>
To: linux-sparse
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 10:23:25 +0000
Message-ID: <1389954205.10404.1.camel () jlt4 ! sipsolutions ! net>
--------------------

> > IMHO the context extension doesn't work well enough in sparse to
> > document and implement as is. It would be much better if it actually was
> > able to differentiate between contexts, rather than treating each one
> > the same.
> 
> That would certainly be nice, but that's something actually much more
> easily done in GCC than in Sparse, given the types of information GCC
> already has available to implement features like alias analysis.

Right.

> In any case, the spec I wrote up assumes a distinction between contexts,
> but allows for an initial implementation like Sparse's that ignores the
> distinction.

Ok cool. :)

> > This would avoid the problem that locking one lock and
> > unlocking another (in the kernel's __acquire/ __release mechanism) could
> > still result in a warning.
> 
> That would actually *not* produce a warning, though it should.  In
> general, I *think* an implementation like Sparse's that ignores the
> distinction between locks should produce false negatives but not false
> positives.

Right, it doesn't report one now.

johannes

--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Johannes Berg <johannes () sipsolutions ! net>
To: linux-kernel
Subject: Re: gcc tickets for sparse attributes
Date: Fri, 17 Jan 2014 10:23:25 +0000
Message-ID: <1389954205.10404.1.camel () jlt4 ! sipsolutions ! net>
--------------------

> > IMHO the context extension doesn't work well enough in sparse to
> > document and implement as is. It would be much better if it actually was
> > able to differentiate between contexts, rather than treating each one
> > the same.
> 
> That would certainly be nice, but that's something actually much more
> easily done in GCC than in Sparse, given the types of information GCC
> already has available to implement features like alias analysis.

Right.

> In any case, the spec I wrote up assumes a distinction between contexts,
> but allows for an initial implementation like Sparse's that ignores the
> distinction.

Ok cool. :)

> > This would avoid the problem that locking one lock and
> > unlocking another (in the kernel's __acquire/ __release mechanism) could
> > still result in a warning.
> 
> That would actually *not* produce a warning, though it should.  In
> general, I *think* an implementation like Sparse's that ignores the
> distinction between locks should produce false negatives but not false
> positives.

Right, it doesn't report one now.

johannes

--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
Please read the FAQ at  http://www.tux.org/lkml/
================================================================================


################################################################################

=== Thread: sparse 0.5.0 release? ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: sparse 0.5.0 release?
Date: Thu, 27 Feb 2014 20:06:39 +0000
Message-ID: <CANeU7Q=A00MvV==8c3MEZsXZeTJAg06zSKPrWfTgFFJ5+nXFiQ () mail ! gmail ! com>
--------------------
On Wed, Feb 26, 2014 at 5:42 PM, Greg KH <gregkh@linuxfoundation.org> wrote:
>
> I see that sparse 0.5.0 has been tagged in git, yet there is no tarballs
> on kernel.org for it for distros to package up.  Any ideas when that
> would happen?

As soon as I refresh my kup skills? I just put the sparse 0.5.0 tar file
under:

https://www.kernel.org/pub/software/devel/sparse/dist/

It should be there by now.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Greg KH <gregkh () linuxfoundation ! org>
To: linux-sparse
Subject: Re: sparse 0.5.0 release?
Date: Thu, 27 Feb 2014 20:32:52 +0000
Message-ID: <20140227203252.GA31091 () kroah ! com>
--------------------
On Thu, Feb 27, 2014 at 12:06:39PM -0800, Christopher Li wrote:
> On Wed, Feb 26, 2014 at 5:42 PM, Greg KH <gregkh@linuxfoundation.org> wrote:
> >
> > I see that sparse 0.5.0 has been tagged in git, yet there is no tarballs
> > on kernel.org for it for distros to package up.  Any ideas when that
> > would happen?
> 
> As soon as I refresh my kup skills? I just put the sparse 0.5.0 tar file
> under:
> 
> https://www.kernel.org/pub/software/devel/sparse/dist/
> 
> It should be there by now.

Yes, I see it there now, thanks so much for this.

greg k-h
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: sparse and anonymous unions ===

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: sparse and anonymous unions
Date: Thu, 03 Apr 2014 19:15:16 +0000
Message-ID: <CANeU7Qn4Kk7c9w2nkcknENJUuBGZALQjT44Yy-0vU+jYpAs=tA () mail ! gmail ! com>
--------------------
On Mon, Mar 31, 2014 at 10:17 AM, Linus Torvalds
<torvalds@linux-foundation.org> wrote:
> Chris, mind applying this one too? It removes more lines than it adds
> while fixing things, by removing the helper function that isn't good
> at anoymous unions, and using another one that does this all right..

The patch is applied. I add the signed off for you too, hope you don't mind.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

=== Thread: sparse-llvm: link errors with LLVM 3.5.0 ===

From: Alain Kalker <a.c.kalker () gmail ! com>
To: linux-sparse
Subject: sparse-llvm: link errors with LLVM 3.5.0
Date: Sun, 21 Sep 2014 18:49:18 +0000
Message-ID: <lvn6je$63j$1 () ger ! gmane ! org>
--------------------
Hi all,

I'm getting link errors building sparse on Arch Linux, which has LLVM 
version 3.5.0.

An example:
/usr/lib/libLLVMSupport.a(Mutex.o): In function 
`llvm::sys::MutexImpl::MutexImpl(bool)':
(.text._ZN4llvm3sys9MutexImplC2Eb+0x37): undefined reference to 
`pthread_mutexattr_init'


================================================================================


################################################################################

=== Thread: spurious warning for sizeof(bool) ===

From: Pranith Kumar <bobby.prani () gmail ! com>
To: linux-sparse
Subject: spurious warning for sizeof(bool)
Date: Tue, 23 Sep 2014 15:37:44 +0000
Message-ID: <CAJhHMCAee+Q=P3oRdGhMcA_x0cbWShd+SkPyqzpDaT2=DjC=EQ () mail ! gmail ! com>
--------------------
Hello,

I am getting these spurious warnings for a sizeof(bool) expression

kernel/rcu/tree.c:202:14: warning: expression using sizeof bool

Is this going to be fixed anytime soon?

Thanks!
-- 
Pranith
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pranith Kumar <bobby.prani () gmail ! com>
To: linux-sparse
Subject: Re: spurious warning for sizeof(bool)
Date: Wed, 24 Sep 2014 23:40:46 +0000
Message-ID: <CAJhHMCDhai4WxRg5_1PQXq=MpO4a6Eyv9+Ep7hu09irnqJVHDg () mail ! gmail ! com>
--------------------
Is anyone reading these emails? :)

On Tue, Sep 23, 2014 at 11:37 AM, Pranith Kumar <bobby.prani@gmail.com> wrote:
> Hello,
>
> I am getting these spurious warnings for a sizeof(bool) expression
>
> kernel/rcu/tree.c:202:14: warning: expression using sizeof bool
>
> Is this going to be fixed anytime soon?
>
> Thanks!
> --
> Pranith



-- 
Pranith
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Pranith Kumar <bobby.prani () gmail ! com>
To: linux-sparse
Subject: Re: spurious warning for sizeof(bool)
Date: Thu, 25 Sep 2014 00:21:30 +0000
Message-ID: <CAJhHMCALfvu9SgRoVBXXvyxtq2KQoymLSRnxvSP095tz6rO2Ng () mail ! gmail ! com>
--------------------
On Wed, Sep 24, 2014 at 8:02 PM, Christopher Li <sparse@chrisli.org> wrote:
>>>
>>> I am getting these spurious warnings for a sizeof(bool) expression
>>>
>>> kernel/rcu/tree.c:202:14: warning: expression using sizeof bool
>>>
>>> Is this going to be fixed anytime soon?
>>>
>
> Which sparse version are you using? In the git chrisl repository,
> sparse does not give that warning by default any more.
>
> Chris

HI Chris,

Could you please update the official sparse git repo?

git://git.kernel.org/pub/scm/devel/sparse/sparse.git

-- 
Pranith
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================

From: Christopher Li <sparse () chrisli ! org>
To: linux-sparse
Subject: Re: spurious warning for sizeof(bool)
Date: Thu, 25 Sep 2014 01:02:43 +0000
Message-ID: <CANeU7Q=Dvhvm-=6rPyr4fV+Sd8ajWnGH39msYqjua3G=pKqNOA () mail ! gmail ! com>
--------------------
On Thu, Sep 25, 2014 at 8:21 AM, Pranith Kumar <bobby.prani@gmail.com> wrote:
> HI Chris,
>
> Could you please update the official sparse git repo?
>
> git://git.kernel.org/pub/scm/devel/sparse/sparse.git
>

Right now it is at a relative clean stage since the anonymous union
warning is fixed.

I just pushed it to official repository.

Chris
--
To unsubscribe from this list: send the line "unsubscribe linux-sparse" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html
================================================================================


################################################################################

