{
  "year": "2008",
  "stats": {
    "total_threads": 3,
    "total_messages": 11,
    "categories": {
      "context_analysis": 3
    }
  },
  "threads": [
    {
      "subject": "Re: context imbalance false positive sparse warnings",
      "normalized_subject": "context imbalance false positive sparse warnings",
      "message_count": 6,
      "participants": [
        "Stalin Kenny",
        "Johannes Berg",
        "Harvey Harrison",
        "Steve French"
      ],
      "categories": [
        "kernel_integration",
        "sparse_internals",
        "context_analysis"
      ],
      "first_date": "2008-08-19T21:19:58+00:00",
      "last_date": "2008-09-10T07:47:11+00:00",
      "year": 2008,
      "messages": [
        {
          "filepath": "emails/2008/08/121918109217626.mbox",
          "message_id": "<524f69650808191419j3e3a261dj9757ae4ea7a682bf () mail ! gmail ! com>",
          "author_name": "Steve French",
          "author_email": "smfrench () gmail ! com",
          "subject": "context imbalance false positive sparse warnings",
          "date": "2008-08-19 21:19:58+00:00",
          "date_str": "Tue, 19 Aug 2008 21:19:58 +0000",
          "body": "Just building one directory of the kernel (./fs/*.c), ie \"make bzImage\nC=1\" generates more than 200 sparse warnings similar to\n        warning: context imbalance in 'set_task_ioprio': wrong count at exit\n\nEven the simplest use cases throw this error e.g. fs/super.c line 162-164:\n\nstatic void put_super(struct super_block *sb)\n{\n        spin_lock(&sb_lock);\n        __put_super(sb);\n        spin_unlock(&sb_lock);\n}\n\n\nIt doesn't look like sparse has been fixed in a few months, unless the\nsparse tool repository has moved from the\n     /pub/scm / devel/sparse/sparse.git\ndirectory on git.kernel.org\n\nIs there a way to turn just this warning off (the thousands of context\nimbalance messages generated by the kernel build make it harder to see\nreal errors which sparse could catch)?\n\n\n\n-- \nThanks,\n\nSteve\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-kernel\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html\nPlease read the FAQ at  http://www.tux.org/lkml/",
          "year": "2008",
          "month": "08"
        },
        {
          "filepath": "emails/2008/08/121918273820782.mbox",
          "message_id": "<524f69650808191447o62a421c3n65f3938c9fc28dd7 () mail ! gmail ! com>",
          "author_name": "Steve French",
          "author_email": "smfrench () gmail ! com",
          "subject": "context imbalance false positive sparse warnings",
          "date": "2008-08-19 21:47:29+00:00",
          "date_str": "Tue, 19 Aug 2008 21:47:29 +0000",
          "body": "Just building one directory of the kernel (./fs/*.c), ie \"make bzImage\nC=1\" generates more than 200 sparse warnings similar to\n       warning: context imbalance in 'set_task_ioprio': wrong count at exit\n\nEven the simplest use cases throw this error e.g. fs/super.c line 162-164:\n\nstatic void put_super(struct super_block *sb)\n{\n       spin_lock(&sb_lock);\n       __put_super(sb);\n       spin_unlock(&sb_lock);\n}\n\n\nIt doesn't look like sparse has been fixed in a few months, unless the\nsparse tool repository has moved from the\n    /pub/scm / devel/sparse/sparse.git\ndirectory on git.kernel.org\n\nIs there a way to turn just this warning off (the thousands of context\nimbalance messages generated by the kernel build make it harder to see\nreal errors which sparse could catch)?\n\n\n-- \nThanks,\n\nSteve\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "08"
        },
        {
          "filepath": "emails/2008/08/121918327421584.mbox",
          "message_id": "<8cef9d540808191500n10fa910eo674c8b8f2dd5b612 () mail ! gmail ! com>",
          "author_name": "Stalin Kenny",
          "author_email": "stalinlinux () gmail ! com",
          "subject": "Re: context imbalance false positive sparse warnings",
          "date": "2008-08-19 22:00:14+00:00",
          "date_str": "Tue, 19 Aug 2008 22:00:14 +0000",
          "body": "> Even the simplest use cases throw this error e.g. fs/super.c line 162-164:\n>\n> static void put_super(struct super_block *sb)\n> {\n>       spin_lock(&sb_lock);\n>       __put_super(sb);\n>       spin_unlock(&sb_lock);\n> }\n\nWhat is the sparse error when you call this function ?\n\n\nOn 8/19/08, Steve French <smfrench@gmail.com> wrote:\n> Just building one directory of the kernel (./fs/*.c), ie \"make bzImage\n> C=1\" generates more than 200 sparse warnings similar to\n>       warning: context imbalance in 'set_task_ioprio': wrong count at exit\n>\n> Even the simplest use cases throw this error e.g. fs/super.c line 162-164:\n>\n> static void put_super(struct super_block *sb)\n> {\n>       spin_lock(&sb_lock);\n>       __put_super(sb);\n>       spin_unlock(&sb_lock);\n> }\n>\n>\n> It doesn't look like sparse has been fixed in a few months, unless the\n> sparse tool repository has moved from the\n>    /pub/scm / devel/sparse/sparse.git\n> directory on git.kernel.org\n>\n> Is there a way to turn just this warning off (the thousands of context\n> imbalance messages generated by the kernel build make it harder to see\n> real errors which sparse could catch)?\n>\n>\n> --\n> Thanks,\n>\n> Steve\n> --\n> To unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\n> the body of a message to majordomo@vger.kernel.org\n> More majordomo info at  http://vger.kernel.org/majordomo-info.html\n>\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "08"
        },
        {
          "filepath": "emails/2008/08/121918477624280.mbox",
          "message_id": "<1219184769.17033.95.camel () brick>",
          "author_name": "Harvey Harrison",
          "author_email": "harvey.harrison () gmail ! com",
          "subject": "Re: context imbalance false positive sparse warnings",
          "date": "2008-08-19 22:26:09+00:00",
          "date_str": "Tue, 19 Aug 2008 22:26:09 +0000",
          "body": "On Tue, 2008-08-19 at 17:22 -0500, Steve French wrote:\n> On Tue, Aug 19, 2008 at 5:00 PM, Stalin Kenny <stalinlinux@gmail.com> wrote:\n> >> Even the simplest use cases throw this error e.g. fs/super.c line 162-164:\n> >>\n> >> static void put_super(struct super_block *sb)\n> >> {\n> >>       spin_lock(&sb_lock);\n> >>       __put_super(sb);\n> >>       spin_unlock(&sb_lock);\n> >> }\n> >\n> > What is the sparse error when you call this function ?\n> CHECK   fs/super.c\n> fs/super.c:164:2: warning: context imbalance in 'put_super': wrong count at exit\n> fs/super.c:164:2:    context 'lock': wanted 0, got 1\n> \n> \n\nJohannes Berg had a 9-patch series that improved this somewhat, but they had\nsome bugs in them (crashes).  But I've been running with them anyway as they\ndo improve cases like this significantly.\n\nHarvey\n\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "08"
        },
        {
          "filepath": "emails/2008/08/122103283900824.mbox",
          "message_id": "<1221032831.12266.8.camel () johannes ! berg>",
          "author_name": "Johannes Berg",
          "author_email": "johannes () sipsolutions ! net",
          "subject": "Re: context imbalance false positive sparse warnings",
          "date": "2008-09-10 07:47:11+00:00",
          "date_str": "Wed, 10 Sep 2008 07:47:11 +0000",
          "body": "\n--=-HeyPaPgrJcGGC+Eka914\nContent-Type: text/plain\nContent-Transfer-Encoding: quoted-printable\n\nOn Tue, 2008-08-19 at 15:26 -0700, Harvey Harrison wrote:\n> On Tue, 2008-08-19 at 17:22 -0500, Steve French wrote:\n> > On Tue, Aug 19, 2008 at 5:00 PM, Stalin Kenny <stalinlinux@gmail.com> w=\nrote:\n> > >> Even the simplest use cases throw this error e.g. fs/super.c line 16=\n2-164:\n> > >>\n> > >> static void put_super(struct super_block *sb)\n> > >> {\n> > >>       spin_lock(&sb_lock);\n> > >>       __put_super(sb);\n> > >>       spin_unlock(&sb_lock);\n> > >> }\n> > >\n> > > What is the sparse error when you call this function ?\n> > CHECK   fs/super.c\n> > fs/super.c:164:2: warning: context imbalance in 'put_super': wrong coun=\nt at exit\n> > fs/super.c:164:2:    context 'lock': wanted 0, got 1\n> >=20\n> >=20\n>=20\n> Johannes Berg had a 9-patch series that improved this somewhat, but they =\nhad\n> some bugs in them (crashes).  But I've been running with them anyway as t=\nhey\n> do improve cases like this significantly.\n\nI've just sent out a fixed version and with it I get no errors on\nfs/super.c when I apply this small fixup:\n\ndiff --git a/fs/super.c b/fs/super.c\nindex e931ae9..6810845 100644\n--- a/fs/super.c\n+++ b/fs/super.c\n@@ -201,7 +201,7 @@ EXPORT_SYMBOL(deactivate_super);\n  *\tsuccess, 0 if we had failed (superblock contents was already dead or\n  *\tdying when grab_super() had been called).\n  */\n-static int grab_super(struct super_block *s) __releases(sb_lock)\n+static int grab_super(struct super_block *s) __releases(&sb_lock)\n {\n \ts->s_count++;\n \tspin_unlock(&sb_lock);\n\njohannes\n\n--=-HeyPaPgrJcGGC+Eka914\nContent-Type: application/pgp-signature; name=signature.asc\nContent-Description: This is a digitally signed message part\n\n-----BEGIN PGP SIGNATURE-----\nComment: Johannes Berg (powerbook)\n\niQIcBAABAgAGBQJIx3t7AAoJEKVg1VMiehFYSKMP/0I+EvSTYrmnC9beBQ4MFEn1\nF1LQttZ5AKuMPvjygJLlGeWj6XbVfWTMXeqcTpLutvgoZanmI7LP4Mnr4bdZ81sU\nekApB4wqf8DTTb4tIHoRkoxPOzuesLAM6KNl9YI9lC85LvIEa/Sa4ShSfsB4Qnr8\npnFU/lcegFXBHwfT60nJ4jkJpMdSXibYMIXhul5eJsP8LHYu7CscuUT9PFNsHTT0\nX/SG6FR0W5NEudwO3/6Atu9WI2yIGfhWqH/o9ThqQmHeb28e8YQHNNwTPQp+HFfx\ni4NiZW4ztNWGiLPxRgmS65FaW6VzL8ZoQEUSYJ2N8wAzz3/dvn+oLHV1ObqAXYNj\nuVoNn32x0cXOjf94GQnf9dyVTgazFgER5U2zNa0Gp9XJigN+j70k9a2oDWI+4QL5\ni5B9N+eeWi3qi5+XBg8s8XydTJeqck5mCWoKGHNTBu+c0QPZBxsmxgTWG5idOqXO\nstGXO/PUpQGo3pczKS5MCDwnu3NqIvM4M5ivMcWRrmewcQRr1aTn2xNoRk4tCPa4\n7JoYgwNNJ87vwe1qMpDAy9dKke1AuD72lOuIX+EuJkjJtcl9+VvXw4kZSWf7H7Vj\ntaicUL+NuKydpkHZ3OAug2mxNFaU02ySZJmDtsmOa7o7eUZaH/KWByBfkZSaSEh5\ntsy4JuFBW5xxjOtBw+/P\n=6rRF\n-----END PGP SIGNATURE-----\n\n--=-HeyPaPgrJcGGC+Eka914--\n\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "08"
        },
        {
          "filepath": "emails/2008/09/122103283900824.mbox",
          "message_id": "<1221032831.12266.8.camel () johannes ! berg>",
          "author_name": "Johannes Berg",
          "author_email": "johannes () sipsolutions ! net",
          "subject": "Re: context imbalance false positive sparse warnings",
          "date": "2008-09-10 07:47:11+00:00",
          "date_str": "Wed, 10 Sep 2008 07:47:11 +0000",
          "body": "\n--=-HeyPaPgrJcGGC+Eka914\nContent-Type: text/plain\nContent-Transfer-Encoding: quoted-printable\n\nOn Tue, 2008-08-19 at 15:26 -0700, Harvey Harrison wrote:\n> On Tue, 2008-08-19 at 17:22 -0500, Steve French wrote:\n> > On Tue, Aug 19, 2008 at 5:00 PM, Stalin Kenny <stalinlinux@gmail.com> w=\nrote:\n> > >> Even the simplest use cases throw this error e.g. fs/super.c line 16=\n2-164:\n> > >>\n> > >> static void put_super(struct super_block *sb)\n> > >> {\n> > >>       spin_lock(&sb_lock);\n> > >>       __put_super(sb);\n> > >>       spin_unlock(&sb_lock);\n> > >> }\n> > >\n> > > What is the sparse error when you call this function ?\n> > CHECK   fs/super.c\n> > fs/super.c:164:2: warning: context imbalance in 'put_super': wrong coun=\nt at exit\n> > fs/super.c:164:2:    context 'lock': wanted 0, got 1\n> >=20\n> >=20\n>=20\n> Johannes Berg had a 9-patch series that improved this somewhat, but they =\nhad\n> some bugs in them (crashes).  But I've been running with them anyway as t=\nhey\n> do improve cases like this significantly.\n\nI've just sent out a fixed version and with it I get no errors on\nfs/super.c when I apply this small fixup:\n\ndiff --git a/fs/super.c b/fs/super.c\nindex e931ae9..6810845 100644\n--- a/fs/super.c\n+++ b/fs/super.c\n@@ -201,7 +201,7 @@ EXPORT_SYMBOL(deactivate_super);\n  *\tsuccess, 0 if we had failed (superblock contents was already dead or\n  *\tdying when grab_super() had been called).\n  */\n-static int grab_super(struct super_block *s) __releases(sb_lock)\n+static int grab_super(struct super_block *s) __releases(&sb_lock)\n {\n \ts->s_count++;\n \tspin_unlock(&sb_lock);\n\njohannes\n\n--=-HeyPaPgrJcGGC+Eka914\nContent-Type: application/pgp-signature; name=signature.asc\nContent-Description: This is a digitally signed message part\n\n-----BEGIN PGP SIGNATURE-----\nComment: Johannes Berg (powerbook)\n\niQIcBAABAgAGBQJIx3t7AAoJEKVg1VMiehFYSKMP/0I+EvSTYrmnC9beBQ4MFEn1\nF1LQttZ5AKuMPvjygJLlGeWj6XbVfWTMXeqcTpLutvgoZanmI7LP4Mnr4bdZ81sU\nekApB4wqf8DTTb4tIHoRkoxPOzuesLAM6KNl9YI9lC85LvIEa/Sa4ShSfsB4Qnr8\npnFU/lcegFXBHwfT60nJ4jkJpMdSXibYMIXhul5eJsP8LHYu7CscuUT9PFNsHTT0\nX/SG6FR0W5NEudwO3/6Atu9WI2yIGfhWqH/o9ThqQmHeb28e8YQHNNwTPQp+HFfx\ni4NiZW4ztNWGiLPxRgmS65FaW6VzL8ZoQEUSYJ2N8wAzz3/dvn+oLHV1ObqAXYNj\nuVoNn32x0cXOjf94GQnf9dyVTgazFgER5U2zNa0Gp9XJigN+j70k9a2oDWI+4QL5\ni5B9N+eeWi3qi5+XBg8s8XydTJeqck5mCWoKGHNTBu+c0QPZBxsmxgTWG5idOqXO\nstGXO/PUpQGo3pczKS5MCDwnu3NqIvM4M5ivMcWRrmewcQRr1aTn2xNoRk4tCPa4\n7JoYgwNNJ87vwe1qMpDAy9dKke1AuD72lOuIX+EuJkjJtcl9+VvXw4kZSWf7H7Vj\ntaicUL+NuKydpkHZ3OAug2mxNFaU02ySZJmDtsmOa7o7eUZaH/KWByBfkZSaSEh5\ntsy4JuFBW5xxjOtBw+/P\n=6rRF\n-----END PGP SIGNATURE-----\n\n--=-HeyPaPgrJcGGC+Eka914--\n\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "09"
        }
      ],
      "primary_category": "context_analysis"
    },
    {
      "subject": "some newbie questions about __attribute__((context,...))",
      "normalized_subject": "some newbie questions about __attribute__((context,...))",
      "message_count": 2,
      "participants": [
        "Robert P. J. Day",
        "Johannes Berg"
      ],
      "categories": [
        "context_analysis",
        "compiler_compat",
        "sparse_internals"
      ],
      "first_date": "2008-07-19T11:49:53+00:00",
      "last_date": "2008-07-19T12:42:20+00:00",
      "year": 2008,
      "messages": [
        {
          "filepath": "emails/2008/07/121646825428383.mbox",
          "message_id": "<alpine.LFD.1.10.0807190737340.24056 () localhost ! localdomain>",
          "author_name": "Robert P. J. Day",
          "author_email": "rpjday () crashcourse ! ca",
          "subject": "some newbie questions about __attribute__((context,...))",
          "date": "2008-07-19 11:49:53+00:00",
          "date_str": "Sat, 19 Jul 2008 11:49:53 +0000",
          "body": "\n  (if there's a good writeup on this, or a previous mailing post\nexplaining this, a pointer to that will do just fine.)\n\n  i'm trying to understand how this context checking is actually done\nby sparse.  from the sparse man page:\n\n\"Functions with the extended attribute\n__attribute__((context(expression,in_context,out_context)) require the\ncontext expression (for instance, a lock) to have the value in_context\n(a constant nonnegative integer) when called, and return with the\nvalue out_context (a constant nonnegative integer).\"\n\n  fair enough, but what are the possibilities for that \"expression\"\nand what exactly is being compared to the values of 0 or 1?  sure, a\nlock is an obvious candidate, but you can't really simply be comparing\nthe value of a lock to 0 or 1 -- a lock is a *structure* which doesn't\nhave a simple value of 0 or 1.\n\n  so, to try to keep things simple, what is happening in the\nbackground with code like this:\n\n=====\nstatic void *aarp_seq_start(struct seq_file *seq, loff_t *pos)\n        __acquires(aarp_lock)\n{\n        struct aarp_iter_state *iter = seq->private;\n\n        read_lock_bh(&aarp_lock);\n        iter->table     = resolved;\n        iter->bucket    = 0;\n\n        return *pos ? iter_next(iter, pos) : SEQ_START_TOKEN;\n}\n=====\n\n  and how is that call to read_lock_bh() changing the \"context\" value\nof the object aarp_lock?  thanks for any enlightenment.\n\nrday\n--\n\n\n========================================================================\nRobert P. J. Day\nLinux Consulting, Training and Annoying Kernel Pedantry:\n    Have classroom, will lecture.\n\nhttp://crashcourse.ca                          Waterloo, Ontario, CANADA\n========================================================================\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "07"
        },
        {
          "filepath": "emails/2008/07/121647140932289.mbox",
          "message_id": "<1216471340.29432.3.camel () johannes ! berg>",
          "author_name": "Johannes Berg",
          "author_email": "johannes () sipsolutions ! net",
          "subject": "Re: some newbie questions about __attribute__((context,...))",
          "date": "2008-07-19 12:42:20+00:00",
          "date_str": "Sat, 19 Jul 2008 12:42:20 +0000",
          "body": "\n--=-IevsOXMNs1ddq+XTc9MB\nContent-Type: text/plain\nContent-Transfer-Encoding: quoted-printable\n\n\n> \"Functions with the extended attribute\n> __attribute__((context(expression,in_context,out_context)) require the\n> context expression (for instance, a lock) to have the value in_context\n> (a constant nonnegative integer) when called, and return with the\n> value out_context (a constant nonnegative integer).\"\n>=20\n>   fair enough, but what are the possibilities for that \"expression\"\n\nNone. It's currently mostly ignored. I posted patches to fix this, which\nhad problems, and the fixes to those patches haven't been merged yet.\n\nWith my patches, the possibilities are either an expression that sparse\ncan resolve, e.g.\n\nvoid do_lock(void *lock) __attribute__((context(lock,0,1))) {...}\n\nor for compatibility anything else that is then treated as a constant:\n\nvoid do_lock(void) __attribute__((context(GLOBAL_LOCK,0,1))) {...}\n\n> and what exactly is being compared to the values of 0 or 1?  sure, a\n> lock is an obvious candidate, but you can't really simply be comparing\n> the value of a lock to 0 or 1 -- a lock is a *structure* which doesn't\n> have a simple value of 0 or 1.\n\nSparse internally tracks the \"value\" of such a context. My examples\nabove would increase the context in the function, and every time that\nfunction is called the context is increased, and if such a context is\n\"leaked\" then sparse will complain it isn't 0.\n\n> static void *aarp_seq_start(struct seq_file *seq, loff_t *pos)\n>         __acquires(aarp_lock)\n> {\n>         struct aarp_iter_state *iter =3D seq->private;\n>=20\n>         read_lock_bh(&aarp_lock);\n>         iter->table     =3D resolved;\n>         iter->bucket    =3D 0;\n>=20\n>         return *pos ? iter_next(iter, pos) : SEQ_START_TOKEN;\n> }\n> =3D=3D=3D=3D=3D\n>=20\n>   and how is that call to read_lock_bh() changing the \"context\" value\n> of the object aarp_lock?  thanks for any enlightenment.\n\nWell, read_lock_bh() acquires the context named \"aarp_lock\", and\naarp_seq_start is annotated to also do that. If you write\n\nvoid foo()\n{\n\tread_lock_bh(&aarp_lock);\n}\n\nthen sparse will complain that the context is leaked in foo.\n\nIf you really want to do any serious work with sparse's context tracking\nI can only suggest to apply my patches.\n\njohannes\n\n--=-IevsOXMNs1ddq+XTc9MB\nContent-Type: application/pgp-signature; name=signature.asc\nContent-Description: This is a digitally signed message part\n\n-----BEGIN PGP SIGNATURE-----\nComment: Johannes Berg (powerbook)\n\niQIcBAABAgAGBQJIgeEpAAoJEKVg1VMiehFYpy0QAKARhoF6CTc0v/CvpqLiYBN4\ndg74cs8ZOdd0IYNeKzEz3YmqgRNRPG7zgxlX7VIqAXNn0Nx7Hz2vG1/0V59t1d9n\ntduU/cHLCExZrXF3TB/jwuANIYjnwoXlzjw8RdwBYlkHwXJ1vnMGLArEsiYXSQq3\n4rfinP68sYHWmud+jaKCWpsruf9HYLcpGSoQUdLzwx2sZvHRs3zvQRDx4r/cEbJo\nIfLptwUfb3TTuJosgoNV7PdIuWU/RUrR+/0OiZwQ7EmkmNYfC4+hl5lQZHShVRGt\n6I95jSmZG7rjyaU06RZGk/6XCVZKz0jMKxJfytE3MhHyMQVPN5UmvkakbyUp16sM\nMwVIx29Sa2FjC0rYsQvkVI4GSiuUqYx+DIIUIz3xO/IkuikAysMGBpUv4v1iQEmK\n+KP3G3yb+KYIIZRvAPMUn9wy6q1uuorKTZ9Ut91+w+rONRmAChMOGlZt9pVmkpdS\n458M5qzPLkT1QPOaAxRDhf6nLot0eyFHBGBFVptmnfiyMNKj+xHW3f3baIIbd8ta\nBV8Aw6Z0gvaRwitQUo/7Js/VJEqgRhNHbJ4WLeii6/ij53cTNNZL9/Z95azPAQFt\nwUBOXQoDq9uB5lVwUxwvmPGzxjMzh17FmV8w1tdEMIGlM3JC4ZHaYbXHA428MN2u\nLNsWEeWIEsRPVpc/OD83\n=c1fS\n-----END PGP SIGNATURE-----\n\n--=-IevsOXMNs1ddq+XTc9MB--\n\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "07"
        }
      ],
      "primary_category": "context_analysis"
    },
    {
      "subject": "Context imbalance false positive",
      "normalized_subject": "Context imbalance false positive",
      "message_count": 3,
      "participants": [
        "Luis R. Rodriguez",
        "Johannes Berg"
      ],
      "categories": [
        "context_analysis",
        "sparse_internals"
      ],
      "first_date": "2008-07-17T23:52:31+00:00",
      "last_date": "2008-07-18T14:25:18+00:00",
      "year": 2008,
      "messages": [
        {
          "filepath": "emails/2008/07/121633890928843.mbox",
          "message_id": "<43e72e890807171652r133c973dh160ea28d361a4601 () mail ! gmail ! com>",
          "author_name": "Luis R. Rodriguez",
          "author_email": "mcgrof () gmail ! com",
          "subject": "Context imbalance false positive",
          "date": "2008-07-17 23:52:31+00:00",
          "date_str": "Thu, 17 Jul 2008 23:52:31 +0000",
          "body": "I'm not sure how to resolve a situation like this:\n\n#include <linux/module.h>\n#include <linux/spinlock.h>\n\nMODULE_AUTHOR(\"Luis R. Rodriguez\");\nMODULE_LICENSE(\"GPL\");\n\nstatic spinlock_t some_lock;\n\nstatic void lock(int bh_flag)\n{\n        if (bh_flag)\n                spin_lock_bh(&some_lock);\n        else\n                spin_lock(&some_lock);\n}\n\nstatic void unlock(int bh_flag)\n{\n        if (bh_flag)\n                spin_unlock_bh(&some_lock);\n        else\n                spin_unlock(&some_lock);\n}\n\nstatic int hello_init(void)\n{\n        spin_lock_init(&some_lock);\n        lock(1);\n        printk(\"I am a module, cheers!\\n\");\n        unlock(1);\n        return 0;\n}\n\nstatic void goodbye_exit(void)\n{\n        printk(\"Goodbye cruel world!\\n\");\n}\n\nmodule_init(hello_init);\nmodule_exit(goodbye_exit);\n\n----\n\nSparse complains with:\n/home/mcgrof/devel/spin_lock_sparse/sparse_spinlock.c:14:3: warning:\ncontext imbalance in 'lock': wrong count at exit\n/home/mcgrof/devel/spin_lock_sparse/sparse_spinlock.c:14:3:    context\n'lock': wanted 0, got 1\n/home/mcgrof/devel/spin_lock_sparse/sparse_spinlock.c:20:3: warning:\ncontext problem in 'unlock': '_spin_unlock_bh' expected different\ncontext\n/home/mcgrof/devel/spin_lock_sparse/sparse_spinlock.c:20:3:    context\n'lock': wanted >= 1, got 0\n\nYou can test compile from files here:\n\nhttp://ruslug.rutgers.edu/~mcgrof/spin_lock_sparse/\n\n  Luis\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "07"
        },
        {
          "filepath": "emails/2008/07/121636956428913.mbox",
          "message_id": "<1216369525.27738.4.camel () johannes ! berg>",
          "author_name": "Johannes Berg",
          "author_email": "johannes () sipsolutions ! net",
          "subject": "Re: Context imbalance false positive",
          "date": "2008-07-18 08:25:25+00:00",
          "date_str": "Fri, 18 Jul 2008 08:25:25 +0000",
          "body": "\n--=-Q8XlgAsHnCxpeCYAB+//\nContent-Type: text/plain\nContent-Transfer-Encoding: quoted-printable\n\nOn Thu, 2008-07-17 at 16:52 -0700, Luis R. Rodriguez wrote:\n> I'm not sure how to resolve a situation like this:\n\n> static void lock(int bh_flag)\n> {\n>         if (bh_flag)\n>                 spin_lock_bh(&some_lock);\n>         else\n>                 spin_lock(&some_lock);\n\nThe only generally accepted way is to not program locking dependent on\nflags.\n\nYou can sneak in sparse annotations to do it anyway, but I won't tell\nyou how :)\n\njohannes\n\n--=-Q8XlgAsHnCxpeCYAB+//\nContent-Type: application/pgp-signature; name=signature.asc\nContent-Description: This is a digitally signed message part\n\n-----BEGIN PGP SIGNATURE-----\nComment: Johannes Berg (powerbook)\n\niQIcBAABAgAGBQJIgFNvAAoJEKVg1VMiehFY+kAP/A/FgkyRFLBkrx0URLTSNLBa\n/IEU+UawFdEsZDSSIdSZzZ0uD7kYONkTRDgIcvUHT8M7UN5UipxZ3jNH/1Urijzh\n2JYY60S22AjGIBvl7vWe8w/CCAjguBifgWs6gJfI3ou0clunbMlodnJYga8NwuaN\nI1vCDkONU+iXqS28cbVySG72SKyczEbG2CbzSYaD9v3Nvr0z41a85fES6S/dNQt5\nXZ8/dDrtG8KzbZbBzMRDrJoBZMvZScPxQFYbZYuE47fA4/vNpbvjEquhYnV+EUGK\n/kJMEB5xXj8mipqOSffqnPG1I9K68X6XR3BgOGioUNdX2Fj+BJdD70nNV64dRpMh\nqI3lhZDwcHzib9LmfqHzqbPeafDK2rKll8dtdxprfue3d2Y/45OXm73UycYOK3lI\nL2+v2URXAKp3TqSBPuQwy7Aib0w5dnlOOL4cldeU0U2lYa4XaF0xYJrQhquqlmrf\nTNNBNiBStUoInUxtrwQkXp0lZ3dAn3BnuZVKWAU/Id3HKVNlxgsXw0Ir3SnGkUQ3\nvBokt6h2M2Ewn7TBPeffuaMVI5sASW9sz89n1vpLajzsHxrH+Q0LA44nbOFKmQ4s\nBXtKIk50McZmToSnD9z4pUA3jKxTrbwwwT2XXo8q3u2NOAd1Jg3CkqQ5Pl+BCfJC\nIa9mfZg2rxTau1+1R4wV\n=kDYj\n-----END PGP SIGNATURE-----\n\n--=-Q8XlgAsHnCxpeCYAB+//--\n\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "07"
        },
        {
          "filepath": "emails/2008/07/121639112830884.mbox",
          "message_id": "<43e72e890807180725q4e1f0c8fu1da7185ade275aa1 () mail ! gmail ! com>",
          "author_name": "Luis R. Rodriguez",
          "author_email": "mcgrof () gmail ! com",
          "subject": "Re: Context imbalance false positive",
          "date": "2008-07-18 14:25:18+00:00",
          "date_str": "Fri, 18 Jul 2008 14:25:18 +0000",
          "body": "On Fri, Jul 18, 2008 at 1:25 AM, Johannes Berg\n<johannes@sipsolutions.net> wrote:\n> On Thu, 2008-07-17 at 16:52 -0700, Luis R. Rodriguez wrote:\n>> I'm not sure how to resolve a situation like this:\n>\n>> static void lock(int bh_flag)\n>> {\n>>         if (bh_flag)\n>>                 spin_lock_bh(&some_lock);\n>>         else\n>>                 spin_lock(&some_lock);\n>\n> The only generally accepted way is to not program locking dependent on\n> flags.\n\nAgreed, and that's what I'm trying to do actually. I think the above\nis pure absolute garbage.\n\n> You can sneak in sparse annotations to do it anyway, but I won't tell\n> you how :)\n\nIf you mean by __acquires() and __releases() then that didn't help.\n\n  Luis\n--\nTo unsubscribe from this list: send the line \"unsubscribe linux-sparse\" in\nthe body of a message to majordomo@vger.kernel.org\nMore majordomo info at  http://vger.kernel.org/majordomo-info.html",
          "year": "2008",
          "month": "07"
        }
      ],
      "primary_category": "context_analysis"
    }
  ]
}