<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sparse Development History & Roadmap</title>
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-card: #12121a;
            --bg-hover: #1a1a25;
            --text: #e4e4e7;
            --text-muted: #71717a;
            --accent: #3b82f6;
            --accent-soft: rgba(59, 130, 246, 0.15);
            --border: #27272a;
            --green: #22c55e;
            --yellow: #eab308;
            --red: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

        /* Header */
        header {
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        nav { display: flex; gap: 32px; }

        nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        nav a:hover, nav a.active { color: var(--text); }

        /* Hero */
        .hero {
            padding: 80px 0 60px;
            text-align: center;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--text), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            color: var(--text-muted);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 48px;
        }

        .stat { text-align: center; }
        .stat-value { font-size: 2.5rem; font-weight: 700; color: var(--accent); }
        .stat-label { font-size: 0.85rem; color: var(--text-muted); }

        /* Sections */
        section { padding: 60px 0; }

        .section-header {
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .section-header p {
            color: var(--text-muted);
        }

        /* Topic Cards */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .topic-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .topic-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .topic-card h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .topic-card h3 .count {
            background: var(--accent-soft);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .topic-card p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .topic-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .topic-tag {
            background: var(--bg);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Roadmap */
        .roadmap {
            position: relative;
        }

        .roadmap-year {
            margin-bottom: 48px;
        }

        .year-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .year-badge {
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .year-stats {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .decisions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-left: 20px;
            padding-left: 20px;
            border-left: 2px solid var(--border);
        }

        .decision-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px 20px;
            transition: all 0.2s;
        }

        .decision-item:hover {
            border-color: var(--accent);
        }

        .decision-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 8px;
        }

        .decision-title {
            font-weight: 500;
            flex: 1;
        }

        .decision-outcome {
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .decision-outcome.merged { background: rgba(34, 197, 94, 0.15); color: var(--green); }
        .decision-outcome.accepted { background: rgba(59, 130, 246, 0.15); color: var(--accent); }
        .decision-outcome.rejected { background: rgba(239, 68, 68, 0.15); color: var(--red); }
        .decision-outcome.discussed { background: rgba(234, 179, 8, 0.15); color: var(--yellow); }

        .decision-meta {
            display: flex;
            gap: 16px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Thread Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .modal-overlay.active { display: block; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            max-width: 900px;
            margin: 0 auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--bg-card);
        }

        .modal-header h2 {
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body { padding: 24px; }

        .thread-message {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .message-author { font-weight: 600; }
        .message-date { color: var(--text-muted); font-size: 0.85rem; }

        .message-body {
            font-family: 'SF Mono', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            color: var(--text-muted);
            max-height: 300px;
            overflow-y: auto;
        }

        /* Footer */
        footer {
            border-top: 1px solid var(--border);
            padding: 40px 0;
            text-align: center;
            color: var(--text-muted);
        }

        footer a { color: var(--accent); text-decoration: none; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .stats-row { flex-wrap: wrap; gap: 24px; }
            .topics-grid { grid-template-columns: 1fr; }
            nav { gap: 16px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">Sparse</div>
            <nav>
                <a href="#topics" class="active">Topics</a>
                <a href="#roadmap">Roadmap</a>
                <a href="#decisions">Key Decisions</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <h1>Sparse Development History</h1>
                <p>22 years of mailing list discussions, organized by topic. Understand how decisions were made and why.</p>
                <div class="stats-row">
                    <div class="stat">
                        <div class="stat-value">8,002</div>
                        <div class="stat-label">Messages</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">2,348</div>
                        <div class="stat-label">Threads</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">7</div>
                        <div class="stat-label">Topic Areas</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="topics">
            <div class="container">
                <div class="section-header">
                    <h2>Browse by Topic</h2>
                    <p>Click any topic to explore related discussions and decisions</p>
                </div>
                <div class="topics-grid" id="topics-grid">
                    <!-- Filled by JS -->
                </div>
            </div>
        </section>

        <section id="roadmap">
            <div class="container">
                <div class="section-header">
                    <h2>Development Roadmap</h2>
                    <p>Major decisions and milestones by year</p>
                </div>
                <div class="roadmap" id="roadmap-content">
                    <!-- Filled by JS -->
                </div>
            </div>
        </section>

        <section id="decisions">
            <div class="container">
                <div class="section-header">
                    <h2>Key Decisions</h2>
                    <p>Important technical decisions with their rationale</p>
                </div>
                <div id="decisions-list">
                    <!-- Filled by JS -->
                </div>
            </div>
        </section>
    </main>

    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title"></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
                <div class="decision-meta" id="modal-meta"></div>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Data extracted from <a href="https://marc.info/?l=linux-sparse" target="_blank">MARC linux-sparse archive</a></p>
            <p>Filtered: 414 spam, 110 unrelated messages removed</p>
        </div>
    </footer>

    <script>
        // Load data
        let topicsData = null;

        async function loadData() {
            try {
                const resp = await fetch('topics_data.json');
                topicsData = await resp.json();
                renderTopics();
                renderRoadmap();
                renderDecisions();
            } catch (e) {
                console.error('Failed to load data:', e);
            }
        }

        function renderTopics() {
            const grid = document.getElementById('topics-grid');
            const categories = topicsData.category_info;
            const stats = topicsData.stats.categories;

            let html = '';
            for (const [id, info] of Object.entries(categories)) {
                const count = stats[id] || 0;
                const keywords = info.keywords.slice(0, 5);

                html += `
                    <div class="topic-card" onclick="showTopicThreads('${id}')">
                        <h3>${info.title} <span class="count">${count} threads</span></h3>
                        <p>${info.description}</p>
                        <div class="topic-tags">
                            ${keywords.map(k => `<span class="topic-tag">${k}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            grid.innerHTML = html;
        }

        function renderRoadmap() {
            const container = document.getElementById('roadmap-content');
            const roadmap = topicsData.roadmap;

            // Sort years descending
            const years = Object.keys(roadmap).sort((a, b) => b - a);

            let html = '';
            for (const year of years.slice(0, 8)) {
                const data = roadmap[year];
                const events = data.events.slice(0, 5);

                html += `
                    <div class="roadmap-year">
                        <div class="year-header">
                            <div class="year-badge">${year}</div>
                            <div class="year-stats">${data.events.length} significant discussions</div>
                        </div>
                        <div class="decisions-list">
                            ${events.map(e => `
                                <div class="decision-item" onclick="showThread('${e.subject}')">
                                    <div class="decision-header">
                                        <div class="decision-title">${escapeHtml(e.subject)}</div>
                                        <span class="decision-outcome ${e.outcome || 'discussed'}">${e.outcome || 'discussed'}</span>
                                    </div>
                                    <div class="decision-meta">
                                        <span>${e.message_count} messages</span>
                                        <span>${e.participants.slice(0, 3).join(', ')}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function renderDecisions() {
            const container = document.getElementById('decisions-list');
            const decisions = topicsData.key_decisions.slice(0, 15);

            let html = '<div class="decisions-list" style="margin-left:0;padding-left:0;border:none;">';
            for (const d of decisions) {
                html += `
                    <div class="decision-item" onclick="showDecision('${escapeHtml(d.normalized_subject)}')">
                        <div class="decision-header">
                            <div class="decision-title">${escapeHtml(d.normalized_subject)}</div>
                            <span class="decision-outcome ${d.outcome || 'discussed'}">${d.outcome || 'discussed'}</span>
                        </div>
                        <div class="decision-meta">
                            <span>${d.message_count} messages</span>
                            <span>${d.year}</span>
                            <span>${d.participants.slice(0, 3).join(', ')}</span>
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            container.innerHTML = html;
        }

        function showTopicThreads(categoryId) {
            const threads = topicsData.topics[categoryId] || [];
            const info = topicsData.category_info[categoryId];

            let html = '';
            for (const t of threads.slice(0, 20)) {
                html += `
                    <div class="thread-message">
                        <div class="message-header">
                            <span class="message-author">${escapeHtml(t.subject)}</span>
                            <span class="message-date">${t.first_date ? new Date(t.first_date).toLocaleDateString() : ''}</span>
                        </div>
                        <div style="color:var(--text-muted);font-size:0.85rem;">
                            ${t.message_count} messages &bull; ${t.participants.slice(0, 3).join(', ')}
                        </div>
                    </div>
                `;
            }

            document.getElementById('modal-title').textContent = info.title;
            document.getElementById('modal-meta').innerHTML = `<span>${info.description}</span>`;
            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('active');
        }

        function showThread(subject) {
            // Find thread in any category
            let thread = null;
            for (const cat of Object.values(topicsData.topics)) {
                thread = cat.find(t => t.subject === subject || t.normalized_subject === subject);
                if (thread) break;
            }

            if (!thread) return;

            let html = '';
            for (const msg of thread.messages.slice(0, 10)) {
                const date = msg.date ? new Date(msg.date).toLocaleString() : msg.date_str;
                const body = msg.body.substring(0, 1500);

                html += `
                    <div class="thread-message">
                        <div class="message-header">
                            <span class="message-author">${escapeHtml(msg.author_name)}</span>
                            <span class="message-date">${date}</span>
                        </div>
                        <div class="message-body">${escapeHtml(body)}</div>
                    </div>
                `;
            }

            document.getElementById('modal-title').textContent = thread.subject;
            document.getElementById('modal-meta').innerHTML = `
                <span>${thread.message_count} messages</span>
                <span>${thread.participants.join(', ')}</span>
            `;
            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('active');
        }

        function showDecision(subject) {
            const decision = topicsData.key_decisions.find(d => d.normalized_subject === subject);
            if (!decision) return;

            let html = `
                <div class="thread-message">
                    <div class="message-header">
                        <span class="message-author">First Message</span>
                    </div>
                    <div class="message-body">${escapeHtml(decision.first_message_body)}</div>
                </div>
            `;

            if (decision.rationale.length > 0) {
                html += '<h3 style="margin:20px 0 10px;font-size:1rem;">Key Rationale</h3>';
                for (const r of decision.rationale) {
                    html += `
                        <div class="thread-message">
                            <div class="message-header">
                                <span class="message-author">${escapeHtml(r.author)}</span>
                            </div>
                            <div class="message-body">${escapeHtml(r.text)}</div>
                        </div>
                    `;
                }
            }

            document.getElementById('modal-title').textContent = decision.normalized_subject;
            document.getElementById('modal-meta').innerHTML = `
                <span>${decision.message_count} messages</span>
                <span>${decision.year}</span>
                <span class="decision-outcome ${decision.outcome || 'discussed'}">${decision.outcome || 'discussed'}</span>
            `;
            document.getElementById('modal-body').innerHTML = html;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        // Close modal on escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
        });

        document.getElementById('modal').addEventListener('click', e => {
            if (e.target.id === 'modal') closeModal();
        });

        // Load on page load
        loadData();
    </script>
</body>
</html>
